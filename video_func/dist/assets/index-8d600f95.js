(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))u(m);new MutationObserver(m=>{for(const g of m)if(g.type==="childList")for(const R of g.addedNodes)R.tagName==="LINK"&&R.rel==="modulepreload"&&u(R)}).observe(document,{childList:!0,subtree:!0});function d(m){const g={};return m.integrity&&(g.integrity=m.integrity),m.referrerPolicy&&(g.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?g.credentials="include":m.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function u(m){if(m.ep)return;m.ep=!0;const g=d(m);fetch(m.href,g)}})();var YE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function KB(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var xN={exports:{}},Qh={},VN={exports:{}},ct={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rl=Symbol.for("react.element"),YB=Symbol.for("react.portal"),zB=Symbol.for("react.fragment"),qB=Symbol.for("react.strict_mode"),JB=Symbol.for("react.profiler"),XB=Symbol.for("react.provider"),QB=Symbol.for("react.context"),$B=Symbol.for("react.forward_ref"),ZB=Symbol.for("react.suspense"),e3=Symbol.for("react.memo"),t3=Symbol.for("react.lazy"),g0=Symbol.iterator;function n3(i){return i===null||typeof i!="object"?null:(i=g0&&i[g0]||i["@@iterator"],typeof i=="function"?i:null)}var jN={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},FN=Object.assign,BN={};function Oc(i,s,d){this.props=i,this.context=s,this.refs=BN,this.updater=d||jN}Oc.prototype.isReactComponent={};Oc.prototype.setState=function(i,s){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,s,"setState")};Oc.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function GN(){}GN.prototype=Oc.prototype;function Tg(i,s,d){this.props=i,this.context=s,this.refs=BN,this.updater=d||jN}var vg=Tg.prototype=new GN;vg.constructor=Tg;FN(vg,Oc.prototype);vg.isPureReactComponent=!0;var S0=Array.isArray,WN=Object.prototype.hasOwnProperty,Rg={current:null},HN={key:!0,ref:!0,__self:!0,__source:!0};function KN(i,s,d){var u,m={},g=null,R=null;if(s!=null)for(u in s.ref!==void 0&&(R=s.ref),s.key!==void 0&&(g=""+s.key),s)WN.call(s,u)&&!HN.hasOwnProperty(u)&&(m[u]=s[u]);var b=arguments.length-2;if(b===1)m.children=d;else if(1<b){for(var P=Array(b),k=0;k<b;k++)P[k]=arguments[k+2];m.children=P}if(i&&i.defaultProps)for(u in b=i.defaultProps,b)m[u]===void 0&&(m[u]=b[u]);return{$$typeof:rl,type:i,key:g,ref:R,props:m,_owner:Rg.current}}function r3(i,s){return{$$typeof:rl,type:i.type,key:s,ref:i.ref,props:i.props,_owner:i._owner}}function yg(i){return typeof i=="object"&&i!==null&&i.$$typeof===rl}function i3(i){var s={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(d){return s[d]})}var T0=/\/+/g;function zE(i,s){return typeof i=="object"&&i!==null&&i.key!=null?i3(""+i.key):s.toString(36)}function ch(i,s,d,u,m){var g=typeof i;(g==="undefined"||g==="boolean")&&(i=null);var R=!1;if(i===null)R=!0;else switch(g){case"string":case"number":R=!0;break;case"object":switch(i.$$typeof){case rl:case YB:R=!0}}if(R)return R=i,m=m(R),i=u===""?"."+zE(R,0):u,S0(m)?(d="",i!=null&&(d=i.replace(T0,"$&/")+"/"),ch(m,s,d,"",function(k){return k})):m!=null&&(yg(m)&&(m=r3(m,d+(!m.key||R&&R.key===m.key?"":(""+m.key).replace(T0,"$&/")+"/")+i)),s.push(m)),1;if(R=0,u=u===""?".":u+":",S0(i))for(var b=0;b<i.length;b++){g=i[b];var P=u+zE(g,b);R+=ch(g,s,d,P,m)}else if(P=n3(i),typeof P=="function")for(i=P.call(i),b=0;!(g=i.next()).done;)g=g.value,P=u+zE(g,b++),R+=ch(g,s,d,P,m);else if(g==="object")throw s=String(i),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return R}function Ku(i,s,d){if(i==null)return i;var u=[],m=0;return ch(i,u,"","",function(g){return s.call(d,g,m++)}),u}function o3(i){if(i._status===-1){var s=i._result;s=s(),s.then(function(d){(i._status===0||i._status===-1)&&(i._status=1,i._result=d)},function(d){(i._status===0||i._status===-1)&&(i._status=2,i._result=d)}),i._status===-1&&(i._status=0,i._result=s)}if(i._status===1)return i._result.default;throw i._result}var lr={current:null},dh={transition:null},s3={ReactCurrentDispatcher:lr,ReactCurrentBatchConfig:dh,ReactCurrentOwner:Rg};ct.Children={map:Ku,forEach:function(i,s,d){Ku(i,function(){s.apply(this,arguments)},d)},count:function(i){var s=0;return Ku(i,function(){s++}),s},toArray:function(i){return Ku(i,function(s){return s})||[]},only:function(i){if(!yg(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};ct.Component=Oc;ct.Fragment=zB;ct.Profiler=JB;ct.PureComponent=Tg;ct.StrictMode=qB;ct.Suspense=ZB;ct.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=s3;ct.cloneElement=function(i,s,d){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var u=FN({},i.props),m=i.key,g=i.ref,R=i._owner;if(s!=null){if(s.ref!==void 0&&(g=s.ref,R=Rg.current),s.key!==void 0&&(m=""+s.key),i.type&&i.type.defaultProps)var b=i.type.defaultProps;for(P in s)WN.call(s,P)&&!HN.hasOwnProperty(P)&&(u[P]=s[P]===void 0&&b!==void 0?b[P]:s[P])}var P=arguments.length-2;if(P===1)u.children=d;else if(1<P){b=Array(P);for(var k=0;k<P;k++)b[k]=arguments[k+2];u.children=b}return{$$typeof:rl,type:i.type,key:m,ref:g,props:u,_owner:R}};ct.createContext=function(i){return i={$$typeof:QB,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:XB,_context:i},i.Consumer=i};ct.createElement=KN;ct.createFactory=function(i){var s=KN.bind(null,i);return s.type=i,s};ct.createRef=function(){return{current:null}};ct.forwardRef=function(i){return{$$typeof:$B,render:i}};ct.isValidElement=yg;ct.lazy=function(i){return{$$typeof:t3,_payload:{_status:-1,_result:i},_init:o3}};ct.memo=function(i,s){return{$$typeof:e3,type:i,compare:s===void 0?null:s}};ct.startTransition=function(i){var s=dh.transition;dh.transition={};try{i()}finally{dh.transition=s}};ct.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};ct.useCallback=function(i,s){return lr.current.useCallback(i,s)};ct.useContext=function(i){return lr.current.useContext(i)};ct.useDebugValue=function(){};ct.useDeferredValue=function(i){return lr.current.useDeferredValue(i)};ct.useEffect=function(i,s){return lr.current.useEffect(i,s)};ct.useId=function(){return lr.current.useId()};ct.useImperativeHandle=function(i,s,d){return lr.current.useImperativeHandle(i,s,d)};ct.useInsertionEffect=function(i,s){return lr.current.useInsertionEffect(i,s)};ct.useLayoutEffect=function(i,s){return lr.current.useLayoutEffect(i,s)};ct.useMemo=function(i,s){return lr.current.useMemo(i,s)};ct.useReducer=function(i,s,d){return lr.current.useReducer(i,s,d)};ct.useRef=function(i){return lr.current.useRef(i)};ct.useState=function(i){return lr.current.useState(i)};ct.useSyncExternalStore=function(i,s,d){return lr.current.useSyncExternalStore(i,s,d)};ct.useTransition=function(){return lr.current.useTransition()};ct.version="18.2.0";VN.exports=ct;var Cr=VN.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var a3=Cr,c3=Symbol.for("react.element"),d3=Symbol.for("react.fragment"),l3=Object.prototype.hasOwnProperty,u3=a3.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,h3={key:!0,ref:!0,__self:!0,__source:!0};function YN(i,s,d){var u,m={},g=null,R=null;d!==void 0&&(g=""+d),s.key!==void 0&&(g=""+s.key),s.ref!==void 0&&(R=s.ref);for(u in s)l3.call(s,u)&&!h3.hasOwnProperty(u)&&(m[u]=s[u]);if(i&&i.defaultProps)for(u in s=i.defaultProps,s)m[u]===void 0&&(m[u]=s[u]);return{$$typeof:c3,type:i,key:g,ref:R,props:m,_owner:u3.current}}Qh.Fragment=d3;Qh.jsx=YN;Qh.jsxs=YN;xN.exports=Qh;var bt=xN.exports,y_={},zN={exports:{}},qr={},qN={exports:{}},JN={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function s(ye,We){var Fe=ye.length;ye.push(We);e:for(;0<Fe;){var Qt=Fe-1>>>1,un=ye[Qt];if(0<m(un,We))ye[Qt]=We,ye[Fe]=un,Fe=Qt;else break e}}function d(ye){return ye.length===0?null:ye[0]}function u(ye){if(ye.length===0)return null;var We=ye[0],Fe=ye.pop();if(Fe!==We){ye[0]=Fe;e:for(var Qt=0,un=ye.length,ca=un>>>1;Qt<ca;){var Ei=2*(Qt+1)-1,Dc=ye[Ei],_i=Ei+1,da=ye[_i];if(0>m(Dc,Fe))_i<un&&0>m(da,Dc)?(ye[Qt]=da,ye[_i]=Fe,Qt=_i):(ye[Qt]=Dc,ye[Ei]=Fe,Qt=Ei);else if(_i<un&&0>m(da,Fe))ye[Qt]=da,ye[_i]=Fe,Qt=_i;else break e}}return We}function m(ye,We){var Fe=ye.sortIndex-We.sortIndex;return Fe!==0?Fe:ye.id-We.id}if(typeof performance=="object"&&typeof performance.now=="function"){var g=performance;i.unstable_now=function(){return g.now()}}else{var R=Date,b=R.now();i.unstable_now=function(){return R.now()-b}}var P=[],k=[],H=1,B=null,z=3,ie=!1,j=!1,oe=!1,Je=typeof setTimeout=="function"?setTimeout:null,V=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function G(ye){for(var We=d(k);We!==null;){if(We.callback===null)u(k);else if(We.startTime<=ye)u(k),We.sortIndex=We.expirationTime,s(P,We);else break;We=d(k)}}function ne(ye){if(oe=!1,G(ye),!j)if(d(P)!==null)j=!0,mi(Se);else{var We=d(k);We!==null&&aa(ne,We.startTime-ye)}}function Se(ye,We){j=!1,oe&&(oe=!1,V(we),we=-1),ie=!0;var Fe=z;try{for(G(We),B=d(P);B!==null&&(!(B.expirationTime>We)||ye&&!hr());){var Qt=B.callback;if(typeof Qt=="function"){B.callback=null,z=B.priorityLevel;var un=Qt(B.expirationTime<=We);We=i.unstable_now(),typeof un=="function"?B.callback=un:B===d(P)&&u(P),G(We)}else u(P);B=d(P)}if(B!==null)var ca=!0;else{var Ei=d(k);Ei!==null&&aa(ne,Ei.startTime-We),ca=!1}return ca}finally{B=null,z=Fe,ie=!1}}var Te=!1,Oe=null,we=-1,lt=5,tt=-1;function hr(){return!(i.unstable_now()-tt<lt)}function Io(){if(Oe!==null){var ye=i.unstable_now();tt=ye;var We=!0;try{We=Oe(!0,ye)}finally{We?Ts():(Te=!1,Oe=null)}}else Te=!1}var Ts;if(typeof x=="function")Ts=function(){x(Io)};else if(typeof MessageChannel<"u"){var fi=new MessageChannel,sa=fi.port2;fi.port1.onmessage=Io,Ts=function(){sa.postMessage(null)}}else Ts=function(){Je(Io,0)};function mi(ye){Oe=ye,Te||(Te=!0,Ts())}function aa(ye,We){we=Je(function(){ye(i.unstable_now())},We)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(ye){ye.callback=null},i.unstable_continueExecution=function(){j||ie||(j=!0,mi(Se))},i.unstable_forceFrameRate=function(ye){0>ye||125<ye?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):lt=0<ye?Math.floor(1e3/ye):5},i.unstable_getCurrentPriorityLevel=function(){return z},i.unstable_getFirstCallbackNode=function(){return d(P)},i.unstable_next=function(ye){switch(z){case 1:case 2:case 3:var We=3;break;default:We=z}var Fe=z;z=We;try{return ye()}finally{z=Fe}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(ye,We){switch(ye){case 1:case 2:case 3:case 4:case 5:break;default:ye=3}var Fe=z;z=ye;try{return We()}finally{z=Fe}},i.unstable_scheduleCallback=function(ye,We,Fe){var Qt=i.unstable_now();switch(typeof Fe=="object"&&Fe!==null?(Fe=Fe.delay,Fe=typeof Fe=="number"&&0<Fe?Qt+Fe:Qt):Fe=Qt,ye){case 1:var un=-1;break;case 2:un=250;break;case 5:un=1073741823;break;case 4:un=1e4;break;default:un=5e3}return un=Fe+un,ye={id:H++,callback:We,priorityLevel:ye,startTime:Fe,expirationTime:un,sortIndex:-1},Fe>Qt?(ye.sortIndex=Fe,s(k,ye),d(P)===null&&ye===d(k)&&(oe?(V(we),we=-1):oe=!0,aa(ne,Fe-Qt))):(ye.sortIndex=un,s(P,ye),j||ie||(j=!0,mi(Se))),ye},i.unstable_shouldYield=hr,i.unstable_wrapCallback=function(ye){var We=z;return function(){var Fe=z;z=We;try{return ye.apply(this,arguments)}finally{z=Fe}}}})(JN);qN.exports=JN;var p3=qN.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var XN=Cr,zr=p3;function ue(i){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+i,d=1;d<arguments.length;d++)s+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var QN=new Set,jd={};function ia(i,s){Sc(i,s),Sc(i+"Capture",s)}function Sc(i,s){for(jd[i]=s,i=0;i<s.length;i++)QN.add(s[i])}var So=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),I_=Object.prototype.hasOwnProperty,f3=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,v0={},R0={};function m3(i){return I_.call(R0,i)?!0:I_.call(v0,i)?!1:f3.test(i)?R0[i]=!0:(v0[i]=!0,!1)}function E3(i,s,d,u){if(d!==null&&d.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return u?!1:d!==null?!d.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function _3(i,s,d,u){if(s===null||typeof s>"u"||E3(i,s,d,u))return!0;if(u)return!1;if(d!==null)switch(d.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function ur(i,s,d,u,m,g,R){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=u,this.attributeNamespace=m,this.mustUseProperty=d,this.propertyName=i,this.type=s,this.sanitizeURL=g,this.removeEmptyString=R}var Kn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){Kn[i]=new ur(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var s=i[0];Kn[s]=new ur(s,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){Kn[i]=new ur(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Kn[i]=new ur(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){Kn[i]=new ur(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){Kn[i]=new ur(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){Kn[i]=new ur(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){Kn[i]=new ur(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){Kn[i]=new ur(i,5,!1,i.toLowerCase(),null,!1,!1)});var Ig=/[\-:]([a-z])/g;function Cg(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var s=i.replace(Ig,Cg);Kn[s]=new ur(s,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var s=i.replace(Ig,Cg);Kn[s]=new ur(s,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var s=i.replace(Ig,Cg);Kn[s]=new ur(s,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){Kn[i]=new ur(i,1,!1,i.toLowerCase(),null,!1,!1)});Kn.xlinkHref=new ur("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){Kn[i]=new ur(i,1,!1,i.toLowerCase(),null,!0,!0)});function Ag(i,s,d,u){var m=Kn.hasOwnProperty(s)?Kn[s]:null;(m!==null?m.type!==0:u||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(_3(s,d,m,u)&&(d=null),u||m===null?m3(s)&&(d===null?i.removeAttribute(s):i.setAttribute(s,""+d)):m.mustUseProperty?i[m.propertyName]=d===null?m.type===3?!1:"":d:(s=m.attributeName,u=m.attributeNamespace,d===null?i.removeAttribute(s):(m=m.type,d=m===3||m===4&&d===!0?"":""+d,u?i.setAttributeNS(u,s,d):i.setAttribute(s,d))))}var yo=XN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Yu=Symbol.for("react.element"),tc=Symbol.for("react.portal"),nc=Symbol.for("react.fragment"),Og=Symbol.for("react.strict_mode"),C_=Symbol.for("react.profiler"),$N=Symbol.for("react.provider"),ZN=Symbol.for("react.context"),wg=Symbol.for("react.forward_ref"),A_=Symbol.for("react.suspense"),O_=Symbol.for("react.suspense_list"),Ng=Symbol.for("react.memo"),ts=Symbol.for("react.lazy"),eb=Symbol.for("react.offscreen"),y0=Symbol.iterator;function md(i){return i===null||typeof i!="object"?null:(i=y0&&i[y0]||i["@@iterator"],typeof i=="function"?i:null)}var nn=Object.assign,qE;function Id(i){if(qE===void 0)try{throw Error()}catch(d){var s=d.stack.trim().match(/\n( *(at )?)/);qE=s&&s[1]||""}return`
`+qE+i}var JE=!1;function XE(i,s){if(!i||JE)return"";JE=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(k){var u=k}Reflect.construct(i,[],s)}else{try{s.call()}catch(k){u=k}i.call(s.prototype)}else{try{throw Error()}catch(k){u=k}i()}}catch(k){if(k&&u&&typeof k.stack=="string"){for(var m=k.stack.split(`
`),g=u.stack.split(`
`),R=m.length-1,b=g.length-1;1<=R&&0<=b&&m[R]!==g[b];)b--;for(;1<=R&&0<=b;R--,b--)if(m[R]!==g[b]){if(R!==1||b!==1)do if(R--,b--,0>b||m[R]!==g[b]){var P=`
`+m[R].replace(" at new "," at ");return i.displayName&&P.includes("<anonymous>")&&(P=P.replace("<anonymous>",i.displayName)),P}while(1<=R&&0<=b);break}}}finally{JE=!1,Error.prepareStackTrace=d}return(i=i?i.displayName||i.name:"")?Id(i):""}function g3(i){switch(i.tag){case 5:return Id(i.type);case 16:return Id("Lazy");case 13:return Id("Suspense");case 19:return Id("SuspenseList");case 0:case 2:case 15:return i=XE(i.type,!1),i;case 11:return i=XE(i.type.render,!1),i;case 1:return i=XE(i.type,!0),i;default:return""}}function w_(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case nc:return"Fragment";case tc:return"Portal";case C_:return"Profiler";case Og:return"StrictMode";case A_:return"Suspense";case O_:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case ZN:return(i.displayName||"Context")+".Consumer";case $N:return(i._context.displayName||"Context")+".Provider";case wg:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case Ng:return s=i.displayName||null,s!==null?s:w_(i.type)||"Memo";case ts:s=i._payload,i=i._init;try{return w_(i(s))}catch{}}return null}function S3(i){var s=i.type;switch(i.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=s.render,i=i.displayName||i.name||"",s.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return w_(s);case 8:return s===Og?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function ms(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function tb(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function T3(i){var s=tb(i)?"checked":"value",d=Object.getOwnPropertyDescriptor(i.constructor.prototype,s),u=""+i[s];if(!i.hasOwnProperty(s)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var m=d.get,g=d.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return m.call(this)},set:function(R){u=""+R,g.call(this,R)}}),Object.defineProperty(i,s,{enumerable:d.enumerable}),{getValue:function(){return u},setValue:function(R){u=""+R},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function zu(i){i._valueTracker||(i._valueTracker=T3(i))}function nb(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var d=s.getValue(),u="";return i&&(u=tb(i)?i.checked?"true":"false":i.value),i=u,i!==d?(s.setValue(i),!0):!1}function Ah(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function N_(i,s){var d=s.checked;return nn({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??i._wrapperState.initialChecked})}function I0(i,s){var d=s.defaultValue==null?"":s.defaultValue,u=s.checked!=null?s.checked:s.defaultChecked;d=ms(s.value!=null?s.value:d),i._wrapperState={initialChecked:u,initialValue:d,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function rb(i,s){s=s.checked,s!=null&&Ag(i,"checked",s,!1)}function b_(i,s){rb(i,s);var d=ms(s.value),u=s.type;if(d!=null)u==="number"?(d===0&&i.value===""||i.value!=d)&&(i.value=""+d):i.value!==""+d&&(i.value=""+d);else if(u==="submit"||u==="reset"){i.removeAttribute("value");return}s.hasOwnProperty("value")?D_(i,s.type,d):s.hasOwnProperty("defaultValue")&&D_(i,s.type,ms(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(i.defaultChecked=!!s.defaultChecked)}function C0(i,s,d){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var u=s.type;if(!(u!=="submit"&&u!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+i._wrapperState.initialValue,d||s===i.value||(i.value=s),i.defaultValue=s}d=i.name,d!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,d!==""&&(i.name=d)}function D_(i,s,d){(s!=="number"||Ah(i.ownerDocument)!==i)&&(d==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+d&&(i.defaultValue=""+d))}var Cd=Array.isArray;function pc(i,s,d,u){if(i=i.options,s){s={};for(var m=0;m<d.length;m++)s["$"+d[m]]=!0;for(d=0;d<i.length;d++)m=s.hasOwnProperty("$"+i[d].value),i[d].selected!==m&&(i[d].selected=m),m&&u&&(i[d].defaultSelected=!0)}else{for(d=""+ms(d),s=null,m=0;m<i.length;m++){if(i[m].value===d){i[m].selected=!0,u&&(i[m].defaultSelected=!0);return}s!==null||i[m].disabled||(s=i[m])}s!==null&&(s.selected=!0)}}function P_(i,s){if(s.dangerouslySetInnerHTML!=null)throw Error(ue(91));return nn({},s,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function A0(i,s){var d=s.value;if(d==null){if(d=s.children,s=s.defaultValue,d!=null){if(s!=null)throw Error(ue(92));if(Cd(d)){if(1<d.length)throw Error(ue(93));d=d[0]}s=d}s==null&&(s=""),d=s}i._wrapperState={initialValue:ms(d)}}function ib(i,s){var d=ms(s.value),u=ms(s.defaultValue);d!=null&&(d=""+d,d!==i.value&&(i.value=d),s.defaultValue==null&&i.defaultValue!==d&&(i.defaultValue=d)),u!=null&&(i.defaultValue=""+u)}function O0(i){var s=i.textContent;s===i._wrapperState.initialValue&&s!==""&&s!==null&&(i.value=s)}function ob(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function L_(i,s){return i==null||i==="http://www.w3.org/1999/xhtml"?ob(s):i==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var qu,sb=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,d,u,m){MSApp.execUnsafeLocalFunction(function(){return i(s,d,u,m)})}:i}(function(i,s){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=s;else{for(qu=qu||document.createElement("div"),qu.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=qu.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;s.firstChild;)i.appendChild(s.firstChild)}});function Fd(i,s){if(s){var d=i.firstChild;if(d&&d===i.lastChild&&d.nodeType===3){d.nodeValue=s;return}}i.textContent=s}var bd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},v3=["Webkit","ms","Moz","O"];Object.keys(bd).forEach(function(i){v3.forEach(function(s){s=s+i.charAt(0).toUpperCase()+i.substring(1),bd[s]=bd[i]})});function ab(i,s,d){return s==null||typeof s=="boolean"||s===""?"":d||typeof s!="number"||s===0||bd.hasOwnProperty(i)&&bd[i]?(""+s).trim():s+"px"}function cb(i,s){i=i.style;for(var d in s)if(s.hasOwnProperty(d)){var u=d.indexOf("--")===0,m=ab(d,s[d],u);d==="float"&&(d="cssFloat"),u?i.setProperty(d,m):i[d]=m}}var R3=nn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function k_(i,s){if(s){if(R3[i]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(ue(137,i));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(ue(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(ue(61))}if(s.style!=null&&typeof s.style!="object")throw Error(ue(62))}}function M_(i,s){if(i.indexOf("-")===-1)return typeof s.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var U_=null;function bg(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var x_=null,fc=null,mc=null;function w0(i){if(i=sl(i)){if(typeof x_!="function")throw Error(ue(280));var s=i.stateNode;s&&(s=np(s),x_(i.stateNode,i.type,s))}}function db(i){fc?mc?mc.push(i):mc=[i]:fc=i}function lb(){if(fc){var i=fc,s=mc;if(mc=fc=null,w0(i),s)for(i=0;i<s.length;i++)w0(s[i])}}function ub(i,s){return i(s)}function hb(){}var QE=!1;function pb(i,s,d){if(QE)return i(s,d);QE=!0;try{return ub(i,s,d)}finally{QE=!1,(fc!==null||mc!==null)&&(hb(),lb())}}function Bd(i,s){var d=i.stateNode;if(d===null)return null;var u=np(d);if(u===null)return null;d=u[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(i=i.type,u=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!u;break e;default:i=!1}if(i)return null;if(d&&typeof d!="function")throw Error(ue(231,s,typeof d));return d}var V_=!1;if(So)try{var Ed={};Object.defineProperty(Ed,"passive",{get:function(){V_=!0}}),window.addEventListener("test",Ed,Ed),window.removeEventListener("test",Ed,Ed)}catch{V_=!1}function y3(i,s,d,u,m,g,R,b,P){var k=Array.prototype.slice.call(arguments,3);try{s.apply(d,k)}catch(H){this.onError(H)}}var Dd=!1,Oh=null,wh=!1,j_=null,I3={onError:function(i){Dd=!0,Oh=i}};function C3(i,s,d,u,m,g,R,b,P){Dd=!1,Oh=null,y3.apply(I3,arguments)}function A3(i,s,d,u,m,g,R,b,P){if(C3.apply(this,arguments),Dd){if(Dd){var k=Oh;Dd=!1,Oh=null}else throw Error(ue(198));wh||(wh=!0,j_=k)}}function oa(i){var s=i,d=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,s.flags&4098&&(d=s.return),i=s.return;while(i)}return s.tag===3?d:null}function fb(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function N0(i){if(oa(i)!==i)throw Error(ue(188))}function O3(i){var s=i.alternate;if(!s){if(s=oa(i),s===null)throw Error(ue(188));return s!==i?null:i}for(var d=i,u=s;;){var m=d.return;if(m===null)break;var g=m.alternate;if(g===null){if(u=m.return,u!==null){d=u;continue}break}if(m.child===g.child){for(g=m.child;g;){if(g===d)return N0(m),i;if(g===u)return N0(m),s;g=g.sibling}throw Error(ue(188))}if(d.return!==u.return)d=m,u=g;else{for(var R=!1,b=m.child;b;){if(b===d){R=!0,d=m,u=g;break}if(b===u){R=!0,u=m,d=g;break}b=b.sibling}if(!R){for(b=g.child;b;){if(b===d){R=!0,d=g,u=m;break}if(b===u){R=!0,u=g,d=m;break}b=b.sibling}if(!R)throw Error(ue(189))}}if(d.alternate!==u)throw Error(ue(190))}if(d.tag!==3)throw Error(ue(188));return d.stateNode.current===d?i:s}function mb(i){return i=O3(i),i!==null?Eb(i):null}function Eb(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var s=Eb(i);if(s!==null)return s;i=i.sibling}return null}var _b=zr.unstable_scheduleCallback,b0=zr.unstable_cancelCallback,w3=zr.unstable_shouldYield,N3=zr.unstable_requestPaint,ln=zr.unstable_now,b3=zr.unstable_getCurrentPriorityLevel,Dg=zr.unstable_ImmediatePriority,gb=zr.unstable_UserBlockingPriority,Nh=zr.unstable_NormalPriority,D3=zr.unstable_LowPriority,Sb=zr.unstable_IdlePriority,$h=null,Xi=null;function P3(i){if(Xi&&typeof Xi.onCommitFiberRoot=="function")try{Xi.onCommitFiberRoot($h,i,void 0,(i.current.flags&128)===128)}catch{}}var Pi=Math.clz32?Math.clz32:M3,L3=Math.log,k3=Math.LN2;function M3(i){return i>>>=0,i===0?32:31-(L3(i)/k3|0)|0}var Ju=64,Xu=4194304;function Ad(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function bh(i,s){var d=i.pendingLanes;if(d===0)return 0;var u=0,m=i.suspendedLanes,g=i.pingedLanes,R=d&268435455;if(R!==0){var b=R&~m;b!==0?u=Ad(b):(g&=R,g!==0&&(u=Ad(g)))}else R=d&~m,R!==0?u=Ad(R):g!==0&&(u=Ad(g));if(u===0)return 0;if(s!==0&&s!==u&&!(s&m)&&(m=u&-u,g=s&-s,m>=g||m===16&&(g&4194240)!==0))return s;if(u&4&&(u|=d&16),s=i.entangledLanes,s!==0)for(i=i.entanglements,s&=u;0<s;)d=31-Pi(s),m=1<<d,u|=i[d],s&=~m;return u}function U3(i,s){switch(i){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function x3(i,s){for(var d=i.suspendedLanes,u=i.pingedLanes,m=i.expirationTimes,g=i.pendingLanes;0<g;){var R=31-Pi(g),b=1<<R,P=m[R];P===-1?(!(b&d)||b&u)&&(m[R]=U3(b,s)):P<=s&&(i.expiredLanes|=b),g&=~b}}function F_(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function Tb(){var i=Ju;return Ju<<=1,!(Ju&4194240)&&(Ju=64),i}function $E(i){for(var s=[],d=0;31>d;d++)s.push(i);return s}function il(i,s,d){i.pendingLanes|=s,s!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,s=31-Pi(s),i[s]=d}function V3(i,s){var d=i.pendingLanes&~s;i.pendingLanes=s,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=s,i.mutableReadLanes&=s,i.entangledLanes&=s,s=i.entanglements;var u=i.eventTimes;for(i=i.expirationTimes;0<d;){var m=31-Pi(d),g=1<<m;s[m]=0,u[m]=-1,i[m]=-1,d&=~g}}function Pg(i,s){var d=i.entangledLanes|=s;for(i=i.entanglements;d;){var u=31-Pi(d),m=1<<u;m&s|i[u]&s&&(i[u]|=s),d&=~m}}var At=0;function vb(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var Rb,Lg,yb,Ib,Cb,B_=!1,Qu=[],as=null,cs=null,ds=null,Gd=new Map,Wd=new Map,rs=[],j3="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function D0(i,s){switch(i){case"focusin":case"focusout":as=null;break;case"dragenter":case"dragleave":cs=null;break;case"mouseover":case"mouseout":ds=null;break;case"pointerover":case"pointerout":Gd.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Wd.delete(s.pointerId)}}function _d(i,s,d,u,m,g){return i===null||i.nativeEvent!==g?(i={blockedOn:s,domEventName:d,eventSystemFlags:u,nativeEvent:g,targetContainers:[m]},s!==null&&(s=sl(s),s!==null&&Lg(s)),i):(i.eventSystemFlags|=u,s=i.targetContainers,m!==null&&s.indexOf(m)===-1&&s.push(m),i)}function F3(i,s,d,u,m){switch(s){case"focusin":return as=_d(as,i,s,d,u,m),!0;case"dragenter":return cs=_d(cs,i,s,d,u,m),!0;case"mouseover":return ds=_d(ds,i,s,d,u,m),!0;case"pointerover":var g=m.pointerId;return Gd.set(g,_d(Gd.get(g)||null,i,s,d,u,m)),!0;case"gotpointercapture":return g=m.pointerId,Wd.set(g,_d(Wd.get(g)||null,i,s,d,u,m)),!0}return!1}function Ab(i){var s=qs(i.target);if(s!==null){var d=oa(s);if(d!==null){if(s=d.tag,s===13){if(s=fb(d),s!==null){i.blockedOn=s,Cb(i.priority,function(){yb(d)});return}}else if(s===3&&d.stateNode.current.memoizedState.isDehydrated){i.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}i.blockedOn=null}function lh(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var d=G_(i.domEventName,i.eventSystemFlags,s[0],i.nativeEvent);if(d===null){d=i.nativeEvent;var u=new d.constructor(d.type,d);U_=u,d.target.dispatchEvent(u),U_=null}else return s=sl(d),s!==null&&Lg(s),i.blockedOn=d,!1;s.shift()}return!0}function P0(i,s,d){lh(i)&&d.delete(s)}function B3(){B_=!1,as!==null&&lh(as)&&(as=null),cs!==null&&lh(cs)&&(cs=null),ds!==null&&lh(ds)&&(ds=null),Gd.forEach(P0),Wd.forEach(P0)}function gd(i,s){i.blockedOn===s&&(i.blockedOn=null,B_||(B_=!0,zr.unstable_scheduleCallback(zr.unstable_NormalPriority,B3)))}function Hd(i){function s(m){return gd(m,i)}if(0<Qu.length){gd(Qu[0],i);for(var d=1;d<Qu.length;d++){var u=Qu[d];u.blockedOn===i&&(u.blockedOn=null)}}for(as!==null&&gd(as,i),cs!==null&&gd(cs,i),ds!==null&&gd(ds,i),Gd.forEach(s),Wd.forEach(s),d=0;d<rs.length;d++)u=rs[d],u.blockedOn===i&&(u.blockedOn=null);for(;0<rs.length&&(d=rs[0],d.blockedOn===null);)Ab(d),d.blockedOn===null&&rs.shift()}var Ec=yo.ReactCurrentBatchConfig,Dh=!0;function G3(i,s,d,u){var m=At,g=Ec.transition;Ec.transition=null;try{At=1,kg(i,s,d,u)}finally{At=m,Ec.transition=g}}function W3(i,s,d,u){var m=At,g=Ec.transition;Ec.transition=null;try{At=4,kg(i,s,d,u)}finally{At=m,Ec.transition=g}}function kg(i,s,d,u){if(Dh){var m=G_(i,s,d,u);if(m===null)c_(i,s,u,Ph,d),D0(i,u);else if(F3(m,i,s,d,u))u.stopPropagation();else if(D0(i,u),s&4&&-1<j3.indexOf(i)){for(;m!==null;){var g=sl(m);if(g!==null&&Rb(g),g=G_(i,s,d,u),g===null&&c_(i,s,u,Ph,d),g===m)break;m=g}m!==null&&u.stopPropagation()}else c_(i,s,u,null,d)}}var Ph=null;function G_(i,s,d,u){if(Ph=null,i=bg(u),i=qs(i),i!==null)if(s=oa(i),s===null)i=null;else if(d=s.tag,d===13){if(i=fb(s),i!==null)return i;i=null}else if(d===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null);return Ph=i,null}function Ob(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(b3()){case Dg:return 1;case gb:return 4;case Nh:case D3:return 16;case Sb:return 536870912;default:return 16}default:return 16}}var os=null,Mg=null,uh=null;function wb(){if(uh)return uh;var i,s=Mg,d=s.length,u,m="value"in os?os.value:os.textContent,g=m.length;for(i=0;i<d&&s[i]===m[i];i++);var R=d-i;for(u=1;u<=R&&s[d-u]===m[g-u];u++);return uh=m.slice(i,1<u?1-u:void 0)}function hh(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function $u(){return!0}function L0(){return!1}function Jr(i){function s(d,u,m,g,R){this._reactName=d,this._targetInst=m,this.type=u,this.nativeEvent=g,this.target=R,this.currentTarget=null;for(var b in i)i.hasOwnProperty(b)&&(d=i[b],this[b]=d?d(g):g[b]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?$u:L0,this.isPropagationStopped=L0,this}return nn(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=$u)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=$u)},persist:function(){},isPersistent:$u}),s}var wc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ug=Jr(wc),ol=nn({},wc,{view:0,detail:0}),H3=Jr(ol),ZE,e_,Sd,Zh=nn({},ol,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xg,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Sd&&(Sd&&i.type==="mousemove"?(ZE=i.screenX-Sd.screenX,e_=i.screenY-Sd.screenY):e_=ZE=0,Sd=i),ZE)},movementY:function(i){return"movementY"in i?i.movementY:e_}}),k0=Jr(Zh),K3=nn({},Zh,{dataTransfer:0}),Y3=Jr(K3),z3=nn({},ol,{relatedTarget:0}),t_=Jr(z3),q3=nn({},wc,{animationName:0,elapsedTime:0,pseudoElement:0}),J3=Jr(q3),X3=nn({},wc,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Q3=Jr(X3),$3=nn({},wc,{data:0}),M0=Jr($3),Z3={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},eG={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tG={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function nG(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=tG[i])?!!s[i]:!1}function xg(){return nG}var rG=nn({},ol,{key:function(i){if(i.key){var s=Z3[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=hh(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?eG[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xg,charCode:function(i){return i.type==="keypress"?hh(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?hh(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),iG=Jr(rG),oG=nn({},Zh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),U0=Jr(oG),sG=nn({},ol,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xg}),aG=Jr(sG),cG=nn({},wc,{propertyName:0,elapsedTime:0,pseudoElement:0}),dG=Jr(cG),lG=nn({},Zh,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),uG=Jr(lG),hG=[9,13,27,32],Vg=So&&"CompositionEvent"in window,Pd=null;So&&"documentMode"in document&&(Pd=document.documentMode);var pG=So&&"TextEvent"in window&&!Pd,Nb=So&&(!Vg||Pd&&8<Pd&&11>=Pd),x0=String.fromCharCode(32),V0=!1;function bb(i,s){switch(i){case"keyup":return hG.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Db(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var rc=!1;function fG(i,s){switch(i){case"compositionend":return Db(s);case"keypress":return s.which!==32?null:(V0=!0,x0);case"textInput":return i=s.data,i===x0&&V0?null:i;default:return null}}function mG(i,s){if(rc)return i==="compositionend"||!Vg&&bb(i,s)?(i=wb(),uh=Mg=os=null,rc=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Nb&&s.locale!=="ko"?null:s.data;default:return null}}var EG={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function j0(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!EG[i.type]:s==="textarea"}function Pb(i,s,d,u){db(u),s=Lh(s,"onChange"),0<s.length&&(d=new Ug("onChange","change",null,d,u),i.push({event:d,listeners:s}))}var Ld=null,Kd=null;function _G(i){Wb(i,0)}function ep(i){var s=sc(i);if(nb(s))return i}function gG(i,s){if(i==="change")return s}var Lb=!1;if(So){var n_;if(So){var r_="oninput"in document;if(!r_){var F0=document.createElement("div");F0.setAttribute("oninput","return;"),r_=typeof F0.oninput=="function"}n_=r_}else n_=!1;Lb=n_&&(!document.documentMode||9<document.documentMode)}function B0(){Ld&&(Ld.detachEvent("onpropertychange",kb),Kd=Ld=null)}function kb(i){if(i.propertyName==="value"&&ep(Kd)){var s=[];Pb(s,Kd,i,bg(i)),pb(_G,s)}}function SG(i,s,d){i==="focusin"?(B0(),Ld=s,Kd=d,Ld.attachEvent("onpropertychange",kb)):i==="focusout"&&B0()}function TG(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return ep(Kd)}function vG(i,s){if(i==="click")return ep(s)}function RG(i,s){if(i==="input"||i==="change")return ep(s)}function yG(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var ki=typeof Object.is=="function"?Object.is:yG;function Yd(i,s){if(ki(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var d=Object.keys(i),u=Object.keys(s);if(d.length!==u.length)return!1;for(u=0;u<d.length;u++){var m=d[u];if(!I_.call(s,m)||!ki(i[m],s[m]))return!1}return!0}function G0(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function W0(i,s){var d=G0(i);i=0;for(var u;d;){if(d.nodeType===3){if(u=i+d.textContent.length,i<=s&&u>=s)return{node:d,offset:s-i};i=u}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=G0(d)}}function Mb(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?Mb(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function Ub(){for(var i=window,s=Ah();s instanceof i.HTMLIFrameElement;){try{var d=typeof s.contentWindow.location.href=="string"}catch{d=!1}if(d)i=s.contentWindow;else break;s=Ah(i.document)}return s}function jg(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}function IG(i){var s=Ub(),d=i.focusedElem,u=i.selectionRange;if(s!==d&&d&&d.ownerDocument&&Mb(d.ownerDocument.documentElement,d)){if(u!==null&&jg(d)){if(s=u.start,i=u.end,i===void 0&&(i=s),"selectionStart"in d)d.selectionStart=s,d.selectionEnd=Math.min(i,d.value.length);else if(i=(s=d.ownerDocument||document)&&s.defaultView||window,i.getSelection){i=i.getSelection();var m=d.textContent.length,g=Math.min(u.start,m);u=u.end===void 0?g:Math.min(u.end,m),!i.extend&&g>u&&(m=u,u=g,g=m),m=W0(d,g);var R=W0(d,u);m&&R&&(i.rangeCount!==1||i.anchorNode!==m.node||i.anchorOffset!==m.offset||i.focusNode!==R.node||i.focusOffset!==R.offset)&&(s=s.createRange(),s.setStart(m.node,m.offset),i.removeAllRanges(),g>u?(i.addRange(s),i.extend(R.node,R.offset)):(s.setEnd(R.node,R.offset),i.addRange(s)))}}for(s=[],i=d;i=i.parentNode;)i.nodeType===1&&s.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<s.length;d++)i=s[d],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var CG=So&&"documentMode"in document&&11>=document.documentMode,ic=null,W_=null,kd=null,H_=!1;function H0(i,s,d){var u=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;H_||ic==null||ic!==Ah(u)||(u=ic,"selectionStart"in u&&jg(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),kd&&Yd(kd,u)||(kd=u,u=Lh(W_,"onSelect"),0<u.length&&(s=new Ug("onSelect","select",null,s,d),i.push({event:s,listeners:u}),s.target=ic)))}function Zu(i,s){var d={};return d[i.toLowerCase()]=s.toLowerCase(),d["Webkit"+i]="webkit"+s,d["Moz"+i]="moz"+s,d}var oc={animationend:Zu("Animation","AnimationEnd"),animationiteration:Zu("Animation","AnimationIteration"),animationstart:Zu("Animation","AnimationStart"),transitionend:Zu("Transition","TransitionEnd")},i_={},xb={};So&&(xb=document.createElement("div").style,"AnimationEvent"in window||(delete oc.animationend.animation,delete oc.animationiteration.animation,delete oc.animationstart.animation),"TransitionEvent"in window||delete oc.transitionend.transition);function tp(i){if(i_[i])return i_[i];if(!oc[i])return i;var s=oc[i],d;for(d in s)if(s.hasOwnProperty(d)&&d in xb)return i_[i]=s[d];return i}var Vb=tp("animationend"),jb=tp("animationiteration"),Fb=tp("animationstart"),Bb=tp("transitionend"),Gb=new Map,K0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _s(i,s){Gb.set(i,s),ia(s,[i])}for(var o_=0;o_<K0.length;o_++){var s_=K0[o_],AG=s_.toLowerCase(),OG=s_[0].toUpperCase()+s_.slice(1);_s(AG,"on"+OG)}_s(Vb,"onAnimationEnd");_s(jb,"onAnimationIteration");_s(Fb,"onAnimationStart");_s("dblclick","onDoubleClick");_s("focusin","onFocus");_s("focusout","onBlur");_s(Bb,"onTransitionEnd");Sc("onMouseEnter",["mouseout","mouseover"]);Sc("onMouseLeave",["mouseout","mouseover"]);Sc("onPointerEnter",["pointerout","pointerover"]);Sc("onPointerLeave",["pointerout","pointerover"]);ia("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ia("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ia("onBeforeInput",["compositionend","keypress","textInput","paste"]);ia("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ia("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ia("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Od="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wG=new Set("cancel close invalid load scroll toggle".split(" ").concat(Od));function Y0(i,s,d){var u=i.type||"unknown-event";i.currentTarget=d,A3(u,s,void 0,i),i.currentTarget=null}function Wb(i,s){s=(s&4)!==0;for(var d=0;d<i.length;d++){var u=i[d],m=u.event;u=u.listeners;e:{var g=void 0;if(s)for(var R=u.length-1;0<=R;R--){var b=u[R],P=b.instance,k=b.currentTarget;if(b=b.listener,P!==g&&m.isPropagationStopped())break e;Y0(m,b,k),g=P}else for(R=0;R<u.length;R++){if(b=u[R],P=b.instance,k=b.currentTarget,b=b.listener,P!==g&&m.isPropagationStopped())break e;Y0(m,b,k),g=P}}}if(wh)throw i=j_,wh=!1,j_=null,i}function Yt(i,s){var d=s[J_];d===void 0&&(d=s[J_]=new Set);var u=i+"__bubble";d.has(u)||(Hb(s,i,2,!1),d.add(u))}function a_(i,s,d){var u=0;s&&(u|=4),Hb(d,i,u,s)}var eh="_reactListening"+Math.random().toString(36).slice(2);function zd(i){if(!i[eh]){i[eh]=!0,QN.forEach(function(d){d!=="selectionchange"&&(wG.has(d)||a_(d,!1,i),a_(d,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[eh]||(s[eh]=!0,a_("selectionchange",!1,s))}}function Hb(i,s,d,u){switch(Ob(s)){case 1:var m=G3;break;case 4:m=W3;break;default:m=kg}d=m.bind(null,s,d,i),m=void 0,!V_||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(m=!0),u?m!==void 0?i.addEventListener(s,d,{capture:!0,passive:m}):i.addEventListener(s,d,!0):m!==void 0?i.addEventListener(s,d,{passive:m}):i.addEventListener(s,d,!1)}function c_(i,s,d,u,m){var g=u;if(!(s&1)&&!(s&2)&&u!==null)e:for(;;){if(u===null)return;var R=u.tag;if(R===3||R===4){var b=u.stateNode.containerInfo;if(b===m||b.nodeType===8&&b.parentNode===m)break;if(R===4)for(R=u.return;R!==null;){var P=R.tag;if((P===3||P===4)&&(P=R.stateNode.containerInfo,P===m||P.nodeType===8&&P.parentNode===m))return;R=R.return}for(;b!==null;){if(R=qs(b),R===null)return;if(P=R.tag,P===5||P===6){u=g=R;continue e}b=b.parentNode}}u=u.return}pb(function(){var k=g,H=bg(d),B=[];e:{var z=Gb.get(i);if(z!==void 0){var ie=Ug,j=i;switch(i){case"keypress":if(hh(d)===0)break e;case"keydown":case"keyup":ie=iG;break;case"focusin":j="focus",ie=t_;break;case"focusout":j="blur",ie=t_;break;case"beforeblur":case"afterblur":ie=t_;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ie=k0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ie=Y3;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ie=aG;break;case Vb:case jb:case Fb:ie=J3;break;case Bb:ie=dG;break;case"scroll":ie=H3;break;case"wheel":ie=uG;break;case"copy":case"cut":case"paste":ie=Q3;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ie=U0}var oe=(s&4)!==0,Je=!oe&&i==="scroll",V=oe?z!==null?z+"Capture":null:z;oe=[];for(var x=k,G;x!==null;){G=x;var ne=G.stateNode;if(G.tag===5&&ne!==null&&(G=ne,V!==null&&(ne=Bd(x,V),ne!=null&&oe.push(qd(x,ne,G)))),Je)break;x=x.return}0<oe.length&&(z=new ie(z,j,null,d,H),B.push({event:z,listeners:oe}))}}if(!(s&7)){e:{if(z=i==="mouseover"||i==="pointerover",ie=i==="mouseout"||i==="pointerout",z&&d!==U_&&(j=d.relatedTarget||d.fromElement)&&(qs(j)||j[To]))break e;if((ie||z)&&(z=H.window===H?H:(z=H.ownerDocument)?z.defaultView||z.parentWindow:window,ie?(j=d.relatedTarget||d.toElement,ie=k,j=j?qs(j):null,j!==null&&(Je=oa(j),j!==Je||j.tag!==5&&j.tag!==6)&&(j=null)):(ie=null,j=k),ie!==j)){if(oe=k0,ne="onMouseLeave",V="onMouseEnter",x="mouse",(i==="pointerout"||i==="pointerover")&&(oe=U0,ne="onPointerLeave",V="onPointerEnter",x="pointer"),Je=ie==null?z:sc(ie),G=j==null?z:sc(j),z=new oe(ne,x+"leave",ie,d,H),z.target=Je,z.relatedTarget=G,ne=null,qs(H)===k&&(oe=new oe(V,x+"enter",j,d,H),oe.target=G,oe.relatedTarget=Je,ne=oe),Je=ne,ie&&j)t:{for(oe=ie,V=j,x=0,G=oe;G;G=ec(G))x++;for(G=0,ne=V;ne;ne=ec(ne))G++;for(;0<x-G;)oe=ec(oe),x--;for(;0<G-x;)V=ec(V),G--;for(;x--;){if(oe===V||V!==null&&oe===V.alternate)break t;oe=ec(oe),V=ec(V)}oe=null}else oe=null;ie!==null&&z0(B,z,ie,oe,!1),j!==null&&Je!==null&&z0(B,Je,j,oe,!0)}}e:{if(z=k?sc(k):window,ie=z.nodeName&&z.nodeName.toLowerCase(),ie==="select"||ie==="input"&&z.type==="file")var Se=gG;else if(j0(z))if(Lb)Se=RG;else{Se=TG;var Te=SG}else(ie=z.nodeName)&&ie.toLowerCase()==="input"&&(z.type==="checkbox"||z.type==="radio")&&(Se=vG);if(Se&&(Se=Se(i,k))){Pb(B,Se,d,H);break e}Te&&Te(i,z,k),i==="focusout"&&(Te=z._wrapperState)&&Te.controlled&&z.type==="number"&&D_(z,"number",z.value)}switch(Te=k?sc(k):window,i){case"focusin":(j0(Te)||Te.contentEditable==="true")&&(ic=Te,W_=k,kd=null);break;case"focusout":kd=W_=ic=null;break;case"mousedown":H_=!0;break;case"contextmenu":case"mouseup":case"dragend":H_=!1,H0(B,d,H);break;case"selectionchange":if(CG)break;case"keydown":case"keyup":H0(B,d,H)}var Oe;if(Vg)e:{switch(i){case"compositionstart":var we="onCompositionStart";break e;case"compositionend":we="onCompositionEnd";break e;case"compositionupdate":we="onCompositionUpdate";break e}we=void 0}else rc?bb(i,d)&&(we="onCompositionEnd"):i==="keydown"&&d.keyCode===229&&(we="onCompositionStart");we&&(Nb&&d.locale!=="ko"&&(rc||we!=="onCompositionStart"?we==="onCompositionEnd"&&rc&&(Oe=wb()):(os=H,Mg="value"in os?os.value:os.textContent,rc=!0)),Te=Lh(k,we),0<Te.length&&(we=new M0(we,i,null,d,H),B.push({event:we,listeners:Te}),Oe?we.data=Oe:(Oe=Db(d),Oe!==null&&(we.data=Oe)))),(Oe=pG?fG(i,d):mG(i,d))&&(k=Lh(k,"onBeforeInput"),0<k.length&&(H=new M0("onBeforeInput","beforeinput",null,d,H),B.push({event:H,listeners:k}),H.data=Oe))}Wb(B,s)})}function qd(i,s,d){return{instance:i,listener:s,currentTarget:d}}function Lh(i,s){for(var d=s+"Capture",u=[];i!==null;){var m=i,g=m.stateNode;m.tag===5&&g!==null&&(m=g,g=Bd(i,d),g!=null&&u.unshift(qd(i,g,m)),g=Bd(i,s),g!=null&&u.push(qd(i,g,m))),i=i.return}return u}function ec(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function z0(i,s,d,u,m){for(var g=s._reactName,R=[];d!==null&&d!==u;){var b=d,P=b.alternate,k=b.stateNode;if(P!==null&&P===u)break;b.tag===5&&k!==null&&(b=k,m?(P=Bd(d,g),P!=null&&R.unshift(qd(d,P,b))):m||(P=Bd(d,g),P!=null&&R.push(qd(d,P,b)))),d=d.return}R.length!==0&&i.push({event:s,listeners:R})}var NG=/\r\n?/g,bG=/\u0000|\uFFFD/g;function q0(i){return(typeof i=="string"?i:""+i).replace(NG,`
`).replace(bG,"")}function th(i,s,d){if(s=q0(s),q0(i)!==s&&d)throw Error(ue(425))}function kh(){}var K_=null,Y_=null;function z_(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var q_=typeof setTimeout=="function"?setTimeout:void 0,DG=typeof clearTimeout=="function"?clearTimeout:void 0,J0=typeof Promise=="function"?Promise:void 0,PG=typeof queueMicrotask=="function"?queueMicrotask:typeof J0<"u"?function(i){return J0.resolve(null).then(i).catch(LG)}:q_;function LG(i){setTimeout(function(){throw i})}function d_(i,s){var d=s,u=0;do{var m=d.nextSibling;if(i.removeChild(d),m&&m.nodeType===8)if(d=m.data,d==="/$"){if(u===0){i.removeChild(m),Hd(s);return}u--}else d!=="$"&&d!=="$?"&&d!=="$!"||u++;d=m}while(d);Hd(s)}function ls(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return i}function X0(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var d=i.data;if(d==="$"||d==="$!"||d==="$?"){if(s===0)return i;s--}else d==="/$"&&s++}i=i.previousSibling}return null}var Nc=Math.random().toString(36).slice(2),qi="__reactFiber$"+Nc,Jd="__reactProps$"+Nc,To="__reactContainer$"+Nc,J_="__reactEvents$"+Nc,kG="__reactListeners$"+Nc,MG="__reactHandles$"+Nc;function qs(i){var s=i[qi];if(s)return s;for(var d=i.parentNode;d;){if(s=d[To]||d[qi]){if(d=s.alternate,s.child!==null||d!==null&&d.child!==null)for(i=X0(i);i!==null;){if(d=i[qi])return d;i=X0(i)}return s}i=d,d=i.parentNode}return null}function sl(i){return i=i[qi]||i[To],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function sc(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(ue(33))}function np(i){return i[Jd]||null}var X_=[],ac=-1;function gs(i){return{current:i}}function zt(i){0>ac||(i.current=X_[ac],X_[ac]=null,ac--)}function Gt(i,s){ac++,X_[ac]=i.current,i.current=s}var Es={},nr=gs(Es),wr=gs(!1),Zs=Es;function Tc(i,s){var d=i.type.contextTypes;if(!d)return Es;var u=i.stateNode;if(u&&u.__reactInternalMemoizedUnmaskedChildContext===s)return u.__reactInternalMemoizedMaskedChildContext;var m={},g;for(g in d)m[g]=s[g];return u&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=s,i.__reactInternalMemoizedMaskedChildContext=m),m}function Nr(i){return i=i.childContextTypes,i!=null}function Mh(){zt(wr),zt(nr)}function Q0(i,s,d){if(nr.current!==Es)throw Error(ue(168));Gt(nr,s),Gt(wr,d)}function Kb(i,s,d){var u=i.stateNode;if(s=s.childContextTypes,typeof u.getChildContext!="function")return d;u=u.getChildContext();for(var m in u)if(!(m in s))throw Error(ue(108,S3(i)||"Unknown",m));return nn({},d,u)}function Uh(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Es,Zs=nr.current,Gt(nr,i),Gt(wr,wr.current),!0}function $0(i,s,d){var u=i.stateNode;if(!u)throw Error(ue(169));d?(i=Kb(i,s,Zs),u.__reactInternalMemoizedMergedChildContext=i,zt(wr),zt(nr),Gt(nr,i)):zt(wr),Gt(wr,d)}var fo=null,rp=!1,l_=!1;function Yb(i){fo===null?fo=[i]:fo.push(i)}function UG(i){rp=!0,Yb(i)}function Ss(){if(!l_&&fo!==null){l_=!0;var i=0,s=At;try{var d=fo;for(At=1;i<d.length;i++){var u=d[i];do u=u(!0);while(u!==null)}fo=null,rp=!1}catch(m){throw fo!==null&&(fo=fo.slice(i+1)),_b(Dg,Ss),m}finally{At=s,l_=!1}}return null}var cc=[],dc=0,xh=null,Vh=0,ai=[],ci=0,ea=null,mo=1,Eo="";function Ys(i,s){cc[dc++]=Vh,cc[dc++]=xh,xh=i,Vh=s}function zb(i,s,d){ai[ci++]=mo,ai[ci++]=Eo,ai[ci++]=ea,ea=i;var u=mo;i=Eo;var m=32-Pi(u)-1;u&=~(1<<m),d+=1;var g=32-Pi(s)+m;if(30<g){var R=m-m%5;g=(u&(1<<R)-1).toString(32),u>>=R,m-=R,mo=1<<32-Pi(s)+m|d<<m|u,Eo=g+i}else mo=1<<g|d<<m|u,Eo=i}function Fg(i){i.return!==null&&(Ys(i,1),zb(i,1,0))}function Bg(i){for(;i===xh;)xh=cc[--dc],cc[dc]=null,Vh=cc[--dc],cc[dc]=null;for(;i===ea;)ea=ai[--ci],ai[ci]=null,Eo=ai[--ci],ai[ci]=null,mo=ai[--ci],ai[ci]=null}var Yr=null,Kr=null,Xt=!1,Di=null;function qb(i,s){var d=di(5,null,null,0);d.elementType="DELETED",d.stateNode=s,d.return=i,s=i.deletions,s===null?(i.deletions=[d],i.flags|=16):s.push(d)}function Z0(i,s){switch(i.tag){case 5:var d=i.type;return s=s.nodeType!==1||d.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(i.stateNode=s,Yr=i,Kr=ls(s.firstChild),!0):!1;case 6:return s=i.pendingProps===""||s.nodeType!==3?null:s,s!==null?(i.stateNode=s,Yr=i,Kr=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(d=ea!==null?{id:mo,overflow:Eo}:null,i.memoizedState={dehydrated:s,treeContext:d,retryLane:1073741824},d=di(18,null,null,0),d.stateNode=s,d.return=i,i.child=d,Yr=i,Kr=null,!0):!1;default:return!1}}function Q_(i){return(i.mode&1)!==0&&(i.flags&128)===0}function $_(i){if(Xt){var s=Kr;if(s){var d=s;if(!Z0(i,s)){if(Q_(i))throw Error(ue(418));s=ls(d.nextSibling);var u=Yr;s&&Z0(i,s)?qb(u,d):(i.flags=i.flags&-4097|2,Xt=!1,Yr=i)}}else{if(Q_(i))throw Error(ue(418));i.flags=i.flags&-4097|2,Xt=!1,Yr=i}}}function eN(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;Yr=i}function nh(i){if(i!==Yr)return!1;if(!Xt)return eN(i),Xt=!0,!1;var s;if((s=i.tag!==3)&&!(s=i.tag!==5)&&(s=i.type,s=s!=="head"&&s!=="body"&&!z_(i.type,i.memoizedProps)),s&&(s=Kr)){if(Q_(i))throw Jb(),Error(ue(418));for(;s;)qb(i,s),s=ls(s.nextSibling)}if(eN(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(ue(317));e:{for(i=i.nextSibling,s=0;i;){if(i.nodeType===8){var d=i.data;if(d==="/$"){if(s===0){Kr=ls(i.nextSibling);break e}s--}else d!=="$"&&d!=="$!"&&d!=="$?"||s++}i=i.nextSibling}Kr=null}}else Kr=Yr?ls(i.stateNode.nextSibling):null;return!0}function Jb(){for(var i=Kr;i;)i=ls(i.nextSibling)}function vc(){Kr=Yr=null,Xt=!1}function Gg(i){Di===null?Di=[i]:Di.push(i)}var xG=yo.ReactCurrentBatchConfig;function Ni(i,s){if(i&&i.defaultProps){s=nn({},s),i=i.defaultProps;for(var d in i)s[d]===void 0&&(s[d]=i[d]);return s}return s}var jh=gs(null),Fh=null,lc=null,Wg=null;function Hg(){Wg=lc=Fh=null}function Kg(i){var s=jh.current;zt(jh),i._currentValue=s}function Z_(i,s,d){for(;i!==null;){var u=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,u!==null&&(u.childLanes|=s)):u!==null&&(u.childLanes&s)!==s&&(u.childLanes|=s),i===d)break;i=i.return}}function _c(i,s){Fh=i,Wg=lc=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&s&&(Or=!0),i.firstContext=null)}function hi(i){var s=i._currentValue;if(Wg!==i)if(i={context:i,memoizedValue:s,next:null},lc===null){if(Fh===null)throw Error(ue(308));lc=i,Fh.dependencies={lanes:0,firstContext:i}}else lc=lc.next=i;return s}var Js=null;function Yg(i){Js===null?Js=[i]:Js.push(i)}function Xb(i,s,d,u){var m=s.interleaved;return m===null?(d.next=d,Yg(s)):(d.next=m.next,m.next=d),s.interleaved=d,vo(i,u)}function vo(i,s){i.lanes|=s;var d=i.alternate;for(d!==null&&(d.lanes|=s),d=i,i=i.return;i!==null;)i.childLanes|=s,d=i.alternate,d!==null&&(d.childLanes|=s),d=i,i=i.return;return d.tag===3?d.stateNode:null}var ns=!1;function zg(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Qb(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function _o(i,s){return{eventTime:i,lane:s,tag:0,payload:null,callback:null,next:null}}function us(i,s,d){var u=i.updateQueue;if(u===null)return null;if(u=u.shared,pt&2){var m=u.pending;return m===null?s.next=s:(s.next=m.next,m.next=s),u.pending=s,vo(i,d)}return m=u.interleaved,m===null?(s.next=s,Yg(u)):(s.next=m.next,m.next=s),u.interleaved=s,vo(i,d)}function ph(i,s,d){if(s=s.updateQueue,s!==null&&(s=s.shared,(d&4194240)!==0)){var u=s.lanes;u&=i.pendingLanes,d|=u,s.lanes=d,Pg(i,d)}}function tN(i,s){var d=i.updateQueue,u=i.alternate;if(u!==null&&(u=u.updateQueue,d===u)){var m=null,g=null;if(d=d.firstBaseUpdate,d!==null){do{var R={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};g===null?m=g=R:g=g.next=R,d=d.next}while(d!==null);g===null?m=g=s:g=g.next=s}else m=g=s;d={baseState:u.baseState,firstBaseUpdate:m,lastBaseUpdate:g,shared:u.shared,effects:u.effects},i.updateQueue=d;return}i=d.lastBaseUpdate,i===null?d.firstBaseUpdate=s:i.next=s,d.lastBaseUpdate=s}function Bh(i,s,d,u){var m=i.updateQueue;ns=!1;var g=m.firstBaseUpdate,R=m.lastBaseUpdate,b=m.shared.pending;if(b!==null){m.shared.pending=null;var P=b,k=P.next;P.next=null,R===null?g=k:R.next=k,R=P;var H=i.alternate;H!==null&&(H=H.updateQueue,b=H.lastBaseUpdate,b!==R&&(b===null?H.firstBaseUpdate=k:b.next=k,H.lastBaseUpdate=P))}if(g!==null){var B=m.baseState;R=0,H=k=P=null,b=g;do{var z=b.lane,ie=b.eventTime;if((u&z)===z){H!==null&&(H=H.next={eventTime:ie,lane:0,tag:b.tag,payload:b.payload,callback:b.callback,next:null});e:{var j=i,oe=b;switch(z=s,ie=d,oe.tag){case 1:if(j=oe.payload,typeof j=="function"){B=j.call(ie,B,z);break e}B=j;break e;case 3:j.flags=j.flags&-65537|128;case 0:if(j=oe.payload,z=typeof j=="function"?j.call(ie,B,z):j,z==null)break e;B=nn({},B,z);break e;case 2:ns=!0}}b.callback!==null&&b.lane!==0&&(i.flags|=64,z=m.effects,z===null?m.effects=[b]:z.push(b))}else ie={eventTime:ie,lane:z,tag:b.tag,payload:b.payload,callback:b.callback,next:null},H===null?(k=H=ie,P=B):H=H.next=ie,R|=z;if(b=b.next,b===null){if(b=m.shared.pending,b===null)break;z=b,b=z.next,z.next=null,m.lastBaseUpdate=z,m.shared.pending=null}}while(1);if(H===null&&(P=B),m.baseState=P,m.firstBaseUpdate=k,m.lastBaseUpdate=H,s=m.shared.interleaved,s!==null){m=s;do R|=m.lane,m=m.next;while(m!==s)}else g===null&&(m.shared.lanes=0);na|=R,i.lanes=R,i.memoizedState=B}}function nN(i,s,d){if(i=s.effects,s.effects=null,i!==null)for(s=0;s<i.length;s++){var u=i[s],m=u.callback;if(m!==null){if(u.callback=null,u=d,typeof m!="function")throw Error(ue(191,m));m.call(u)}}}var $b=new XN.Component().refs;function eg(i,s,d,u){s=i.memoizedState,d=d(u,s),d=d==null?s:nn({},s,d),i.memoizedState=d,i.lanes===0&&(i.updateQueue.baseState=d)}var ip={isMounted:function(i){return(i=i._reactInternals)?oa(i)===i:!1},enqueueSetState:function(i,s,d){i=i._reactInternals;var u=dr(),m=ps(i),g=_o(u,m);g.payload=s,d!=null&&(g.callback=d),s=us(i,g,m),s!==null&&(Li(s,i,m,u),ph(s,i,m))},enqueueReplaceState:function(i,s,d){i=i._reactInternals;var u=dr(),m=ps(i),g=_o(u,m);g.tag=1,g.payload=s,d!=null&&(g.callback=d),s=us(i,g,m),s!==null&&(Li(s,i,m,u),ph(s,i,m))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var d=dr(),u=ps(i),m=_o(d,u);m.tag=2,s!=null&&(m.callback=s),s=us(i,m,u),s!==null&&(Li(s,i,u,d),ph(s,i,u))}};function rN(i,s,d,u,m,g,R){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(u,g,R):s.prototype&&s.prototype.isPureReactComponent?!Yd(d,u)||!Yd(m,g):!0}function Zb(i,s,d){var u=!1,m=Es,g=s.contextType;return typeof g=="object"&&g!==null?g=hi(g):(m=Nr(s)?Zs:nr.current,u=s.contextTypes,g=(u=u!=null)?Tc(i,m):Es),s=new s(d,g),i.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=ip,i.stateNode=s,s._reactInternals=i,u&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=m,i.__reactInternalMemoizedMaskedChildContext=g),s}function iN(i,s,d,u){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(d,u),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(d,u),s.state!==i&&ip.enqueueReplaceState(s,s.state,null)}function tg(i,s,d,u){var m=i.stateNode;m.props=d,m.state=i.memoizedState,m.refs=$b,zg(i);var g=s.contextType;typeof g=="object"&&g!==null?m.context=hi(g):(g=Nr(s)?Zs:nr.current,m.context=Tc(i,g)),m.state=i.memoizedState,g=s.getDerivedStateFromProps,typeof g=="function"&&(eg(i,s,g,d),m.state=i.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(s=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),s!==m.state&&ip.enqueueReplaceState(m,m.state,null),Bh(i,d,m,u),m.state=i.memoizedState),typeof m.componentDidMount=="function"&&(i.flags|=4194308)}function Td(i,s,d){if(i=d.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(ue(309));var u=d.stateNode}if(!u)throw Error(ue(147,i));var m=u,g=""+i;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===g?s.ref:(s=function(R){var b=m.refs;b===$b&&(b=m.refs={}),R===null?delete b[g]:b[g]=R},s._stringRef=g,s)}if(typeof i!="string")throw Error(ue(284));if(!d._owner)throw Error(ue(290,i))}return i}function rh(i,s){throw i=Object.prototype.toString.call(s),Error(ue(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i))}function oN(i){var s=i._init;return s(i._payload)}function eD(i){function s(V,x){if(i){var G=V.deletions;G===null?(V.deletions=[x],V.flags|=16):G.push(x)}}function d(V,x){if(!i)return null;for(;x!==null;)s(V,x),x=x.sibling;return null}function u(V,x){for(V=new Map;x!==null;)x.key!==null?V.set(x.key,x):V.set(x.index,x),x=x.sibling;return V}function m(V,x){return V=fs(V,x),V.index=0,V.sibling=null,V}function g(V,x,G){return V.index=G,i?(G=V.alternate,G!==null?(G=G.index,G<x?(V.flags|=2,x):G):(V.flags|=2,x)):(V.flags|=1048576,x)}function R(V){return i&&V.alternate===null&&(V.flags|=2),V}function b(V,x,G,ne){return x===null||x.tag!==6?(x=__(G,V.mode,ne),x.return=V,x):(x=m(x,G),x.return=V,x)}function P(V,x,G,ne){var Se=G.type;return Se===nc?H(V,x,G.props.children,ne,G.key):x!==null&&(x.elementType===Se||typeof Se=="object"&&Se!==null&&Se.$$typeof===ts&&oN(Se)===x.type)?(ne=m(x,G.props),ne.ref=Td(V,x,G),ne.return=V,ne):(ne=Sh(G.type,G.key,G.props,null,V.mode,ne),ne.ref=Td(V,x,G),ne.return=V,ne)}function k(V,x,G,ne){return x===null||x.tag!==4||x.stateNode.containerInfo!==G.containerInfo||x.stateNode.implementation!==G.implementation?(x=g_(G,V.mode,ne),x.return=V,x):(x=m(x,G.children||[]),x.return=V,x)}function H(V,x,G,ne,Se){return x===null||x.tag!==7?(x=$s(G,V.mode,ne,Se),x.return=V,x):(x=m(x,G),x.return=V,x)}function B(V,x,G){if(typeof x=="string"&&x!==""||typeof x=="number")return x=__(""+x,V.mode,G),x.return=V,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Yu:return G=Sh(x.type,x.key,x.props,null,V.mode,G),G.ref=Td(V,null,x),G.return=V,G;case tc:return x=g_(x,V.mode,G),x.return=V,x;case ts:var ne=x._init;return B(V,ne(x._payload),G)}if(Cd(x)||md(x))return x=$s(x,V.mode,G,null),x.return=V,x;rh(V,x)}return null}function z(V,x,G,ne){var Se=x!==null?x.key:null;if(typeof G=="string"&&G!==""||typeof G=="number")return Se!==null?null:b(V,x,""+G,ne);if(typeof G=="object"&&G!==null){switch(G.$$typeof){case Yu:return G.key===Se?P(V,x,G,ne):null;case tc:return G.key===Se?k(V,x,G,ne):null;case ts:return Se=G._init,z(V,x,Se(G._payload),ne)}if(Cd(G)||md(G))return Se!==null?null:H(V,x,G,ne,null);rh(V,G)}return null}function ie(V,x,G,ne,Se){if(typeof ne=="string"&&ne!==""||typeof ne=="number")return V=V.get(G)||null,b(x,V,""+ne,Se);if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case Yu:return V=V.get(ne.key===null?G:ne.key)||null,P(x,V,ne,Se);case tc:return V=V.get(ne.key===null?G:ne.key)||null,k(x,V,ne,Se);case ts:var Te=ne._init;return ie(V,x,G,Te(ne._payload),Se)}if(Cd(ne)||md(ne))return V=V.get(G)||null,H(x,V,ne,Se,null);rh(x,ne)}return null}function j(V,x,G,ne){for(var Se=null,Te=null,Oe=x,we=x=0,lt=null;Oe!==null&&we<G.length;we++){Oe.index>we?(lt=Oe,Oe=null):lt=Oe.sibling;var tt=z(V,Oe,G[we],ne);if(tt===null){Oe===null&&(Oe=lt);break}i&&Oe&&tt.alternate===null&&s(V,Oe),x=g(tt,x,we),Te===null?Se=tt:Te.sibling=tt,Te=tt,Oe=lt}if(we===G.length)return d(V,Oe),Xt&&Ys(V,we),Se;if(Oe===null){for(;we<G.length;we++)Oe=B(V,G[we],ne),Oe!==null&&(x=g(Oe,x,we),Te===null?Se=Oe:Te.sibling=Oe,Te=Oe);return Xt&&Ys(V,we),Se}for(Oe=u(V,Oe);we<G.length;we++)lt=ie(Oe,V,we,G[we],ne),lt!==null&&(i&&lt.alternate!==null&&Oe.delete(lt.key===null?we:lt.key),x=g(lt,x,we),Te===null?Se=lt:Te.sibling=lt,Te=lt);return i&&Oe.forEach(function(hr){return s(V,hr)}),Xt&&Ys(V,we),Se}function oe(V,x,G,ne){var Se=md(G);if(typeof Se!="function")throw Error(ue(150));if(G=Se.call(G),G==null)throw Error(ue(151));for(var Te=Se=null,Oe=x,we=x=0,lt=null,tt=G.next();Oe!==null&&!tt.done;we++,tt=G.next()){Oe.index>we?(lt=Oe,Oe=null):lt=Oe.sibling;var hr=z(V,Oe,tt.value,ne);if(hr===null){Oe===null&&(Oe=lt);break}i&&Oe&&hr.alternate===null&&s(V,Oe),x=g(hr,x,we),Te===null?Se=hr:Te.sibling=hr,Te=hr,Oe=lt}if(tt.done)return d(V,Oe),Xt&&Ys(V,we),Se;if(Oe===null){for(;!tt.done;we++,tt=G.next())tt=B(V,tt.value,ne),tt!==null&&(x=g(tt,x,we),Te===null?Se=tt:Te.sibling=tt,Te=tt);return Xt&&Ys(V,we),Se}for(Oe=u(V,Oe);!tt.done;we++,tt=G.next())tt=ie(Oe,V,we,tt.value,ne),tt!==null&&(i&&tt.alternate!==null&&Oe.delete(tt.key===null?we:tt.key),x=g(tt,x,we),Te===null?Se=tt:Te.sibling=tt,Te=tt);return i&&Oe.forEach(function(Io){return s(V,Io)}),Xt&&Ys(V,we),Se}function Je(V,x,G,ne){if(typeof G=="object"&&G!==null&&G.type===nc&&G.key===null&&(G=G.props.children),typeof G=="object"&&G!==null){switch(G.$$typeof){case Yu:e:{for(var Se=G.key,Te=x;Te!==null;){if(Te.key===Se){if(Se=G.type,Se===nc){if(Te.tag===7){d(V,Te.sibling),x=m(Te,G.props.children),x.return=V,V=x;break e}}else if(Te.elementType===Se||typeof Se=="object"&&Se!==null&&Se.$$typeof===ts&&oN(Se)===Te.type){d(V,Te.sibling),x=m(Te,G.props),x.ref=Td(V,Te,G),x.return=V,V=x;break e}d(V,Te);break}else s(V,Te);Te=Te.sibling}G.type===nc?(x=$s(G.props.children,V.mode,ne,G.key),x.return=V,V=x):(ne=Sh(G.type,G.key,G.props,null,V.mode,ne),ne.ref=Td(V,x,G),ne.return=V,V=ne)}return R(V);case tc:e:{for(Te=G.key;x!==null;){if(x.key===Te)if(x.tag===4&&x.stateNode.containerInfo===G.containerInfo&&x.stateNode.implementation===G.implementation){d(V,x.sibling),x=m(x,G.children||[]),x.return=V,V=x;break e}else{d(V,x);break}else s(V,x);x=x.sibling}x=g_(G,V.mode,ne),x.return=V,V=x}return R(V);case ts:return Te=G._init,Je(V,x,Te(G._payload),ne)}if(Cd(G))return j(V,x,G,ne);if(md(G))return oe(V,x,G,ne);rh(V,G)}return typeof G=="string"&&G!==""||typeof G=="number"?(G=""+G,x!==null&&x.tag===6?(d(V,x.sibling),x=m(x,G),x.return=V,V=x):(d(V,x),x=__(G,V.mode,ne),x.return=V,V=x),R(V)):d(V,x)}return Je}var Rc=eD(!0),tD=eD(!1),al={},Qi=gs(al),Xd=gs(al),Qd=gs(al);function Xs(i){if(i===al)throw Error(ue(174));return i}function qg(i,s){switch(Gt(Qd,s),Gt(Xd,i),Gt(Qi,al),i=s.nodeType,i){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:L_(null,"");break;default:i=i===8?s.parentNode:s,s=i.namespaceURI||null,i=i.tagName,s=L_(s,i)}zt(Qi),Gt(Qi,s)}function yc(){zt(Qi),zt(Xd),zt(Qd)}function nD(i){Xs(Qd.current);var s=Xs(Qi.current),d=L_(s,i.type);s!==d&&(Gt(Xd,i),Gt(Qi,d))}function Jg(i){Xd.current===i&&(zt(Qi),zt(Xd))}var en=gs(0);function Gh(i){for(var s=i;s!==null;){if(s.tag===13){var d=s.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var u_=[];function Xg(){for(var i=0;i<u_.length;i++)u_[i]._workInProgressVersionPrimary=null;u_.length=0}var fh=yo.ReactCurrentDispatcher,h_=yo.ReactCurrentBatchConfig,ta=0,tn=null,wn=null,Un=null,Wh=!1,Md=!1,$d=0,VG=0;function Zn(){throw Error(ue(321))}function Qg(i,s){if(s===null)return!1;for(var d=0;d<s.length&&d<i.length;d++)if(!ki(i[d],s[d]))return!1;return!0}function $g(i,s,d,u,m,g){if(ta=g,tn=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,fh.current=i===null||i.memoizedState===null?GG:WG,i=d(u,m),Md){g=0;do{if(Md=!1,$d=0,25<=g)throw Error(ue(301));g+=1,Un=wn=null,s.updateQueue=null,fh.current=HG,i=d(u,m)}while(Md)}if(fh.current=Hh,s=wn!==null&&wn.next!==null,ta=0,Un=wn=tn=null,Wh=!1,s)throw Error(ue(300));return i}function Zg(){var i=$d!==0;return $d=0,i}function zi(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Un===null?tn.memoizedState=Un=i:Un=Un.next=i,Un}function pi(){if(wn===null){var i=tn.alternate;i=i!==null?i.memoizedState:null}else i=wn.next;var s=Un===null?tn.memoizedState:Un.next;if(s!==null)Un=s,wn=i;else{if(i===null)throw Error(ue(310));wn=i,i={memoizedState:wn.memoizedState,baseState:wn.baseState,baseQueue:wn.baseQueue,queue:wn.queue,next:null},Un===null?tn.memoizedState=Un=i:Un=Un.next=i}return Un}function Zd(i,s){return typeof s=="function"?s(i):s}function p_(i){var s=pi(),d=s.queue;if(d===null)throw Error(ue(311));d.lastRenderedReducer=i;var u=wn,m=u.baseQueue,g=d.pending;if(g!==null){if(m!==null){var R=m.next;m.next=g.next,g.next=R}u.baseQueue=m=g,d.pending=null}if(m!==null){g=m.next,u=u.baseState;var b=R=null,P=null,k=g;do{var H=k.lane;if((ta&H)===H)P!==null&&(P=P.next={lane:0,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null}),u=k.hasEagerState?k.eagerState:i(u,k.action);else{var B={lane:H,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null};P===null?(b=P=B,R=u):P=P.next=B,tn.lanes|=H,na|=H}k=k.next}while(k!==null&&k!==g);P===null?R=u:P.next=b,ki(u,s.memoizedState)||(Or=!0),s.memoizedState=u,s.baseState=R,s.baseQueue=P,d.lastRenderedState=u}if(i=d.interleaved,i!==null){m=i;do g=m.lane,tn.lanes|=g,na|=g,m=m.next;while(m!==i)}else m===null&&(d.lanes=0);return[s.memoizedState,d.dispatch]}function f_(i){var s=pi(),d=s.queue;if(d===null)throw Error(ue(311));d.lastRenderedReducer=i;var u=d.dispatch,m=d.pending,g=s.memoizedState;if(m!==null){d.pending=null;var R=m=m.next;do g=i(g,R.action),R=R.next;while(R!==m);ki(g,s.memoizedState)||(Or=!0),s.memoizedState=g,s.baseQueue===null&&(s.baseState=g),d.lastRenderedState=g}return[g,u]}function rD(){}function iD(i,s){var d=tn,u=pi(),m=s(),g=!ki(u.memoizedState,m);if(g&&(u.memoizedState=m,Or=!0),u=u.queue,eS(aD.bind(null,d,u,i),[i]),u.getSnapshot!==s||g||Un!==null&&Un.memoizedState.tag&1){if(d.flags|=2048,el(9,sD.bind(null,d,u,m,s),void 0,null),xn===null)throw Error(ue(349));ta&30||oD(d,s,m)}return m}function oD(i,s,d){i.flags|=16384,i={getSnapshot:s,value:d},s=tn.updateQueue,s===null?(s={lastEffect:null,stores:null},tn.updateQueue=s,s.stores=[i]):(d=s.stores,d===null?s.stores=[i]:d.push(i))}function sD(i,s,d,u){s.value=d,s.getSnapshot=u,cD(s)&&dD(i)}function aD(i,s,d){return d(function(){cD(s)&&dD(i)})}function cD(i){var s=i.getSnapshot;i=i.value;try{var d=s();return!ki(i,d)}catch{return!0}}function dD(i){var s=vo(i,1);s!==null&&Li(s,i,1,-1)}function sN(i){var s=zi();return typeof i=="function"&&(i=i()),s.memoizedState=s.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Zd,lastRenderedState:i},s.queue=i,i=i.dispatch=BG.bind(null,tn,i),[s.memoizedState,i]}function el(i,s,d,u){return i={tag:i,create:s,destroy:d,deps:u,next:null},s=tn.updateQueue,s===null?(s={lastEffect:null,stores:null},tn.updateQueue=s,s.lastEffect=i.next=i):(d=s.lastEffect,d===null?s.lastEffect=i.next=i:(u=d.next,d.next=i,i.next=u,s.lastEffect=i)),i}function lD(){return pi().memoizedState}function mh(i,s,d,u){var m=zi();tn.flags|=i,m.memoizedState=el(1|s,d,void 0,u===void 0?null:u)}function op(i,s,d,u){var m=pi();u=u===void 0?null:u;var g=void 0;if(wn!==null){var R=wn.memoizedState;if(g=R.destroy,u!==null&&Qg(u,R.deps)){m.memoizedState=el(s,d,g,u);return}}tn.flags|=i,m.memoizedState=el(1|s,d,g,u)}function aN(i,s){return mh(8390656,8,i,s)}function eS(i,s){return op(2048,8,i,s)}function uD(i,s){return op(4,2,i,s)}function hD(i,s){return op(4,4,i,s)}function pD(i,s){if(typeof s=="function")return i=i(),s(i),function(){s(null)};if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function fD(i,s,d){return d=d!=null?d.concat([i]):null,op(4,4,pD.bind(null,s,i),d)}function tS(){}function mD(i,s){var d=pi();s=s===void 0?null:s;var u=d.memoizedState;return u!==null&&s!==null&&Qg(s,u[1])?u[0]:(d.memoizedState=[i,s],i)}function ED(i,s){var d=pi();s=s===void 0?null:s;var u=d.memoizedState;return u!==null&&s!==null&&Qg(s,u[1])?u[0]:(i=i(),d.memoizedState=[i,s],i)}function _D(i,s,d){return ta&21?(ki(d,s)||(d=Tb(),tn.lanes|=d,na|=d,i.baseState=!0),s):(i.baseState&&(i.baseState=!1,Or=!0),i.memoizedState=d)}function jG(i,s){var d=At;At=d!==0&&4>d?d:4,i(!0);var u=h_.transition;h_.transition={};try{i(!1),s()}finally{At=d,h_.transition=u}}function gD(){return pi().memoizedState}function FG(i,s,d){var u=ps(i);if(d={lane:u,action:d,hasEagerState:!1,eagerState:null,next:null},SD(i))TD(s,d);else if(d=Xb(i,s,d,u),d!==null){var m=dr();Li(d,i,u,m),vD(d,s,u)}}function BG(i,s,d){var u=ps(i),m={lane:u,action:d,hasEagerState:!1,eagerState:null,next:null};if(SD(i))TD(s,m);else{var g=i.alternate;if(i.lanes===0&&(g===null||g.lanes===0)&&(g=s.lastRenderedReducer,g!==null))try{var R=s.lastRenderedState,b=g(R,d);if(m.hasEagerState=!0,m.eagerState=b,ki(b,R)){var P=s.interleaved;P===null?(m.next=m,Yg(s)):(m.next=P.next,P.next=m),s.interleaved=m;return}}catch{}finally{}d=Xb(i,s,m,u),d!==null&&(m=dr(),Li(d,i,u,m),vD(d,s,u))}}function SD(i){var s=i.alternate;return i===tn||s!==null&&s===tn}function TD(i,s){Md=Wh=!0;var d=i.pending;d===null?s.next=s:(s.next=d.next,d.next=s),i.pending=s}function vD(i,s,d){if(d&4194240){var u=s.lanes;u&=i.pendingLanes,d|=u,s.lanes=d,Pg(i,d)}}var Hh={readContext:hi,useCallback:Zn,useContext:Zn,useEffect:Zn,useImperativeHandle:Zn,useInsertionEffect:Zn,useLayoutEffect:Zn,useMemo:Zn,useReducer:Zn,useRef:Zn,useState:Zn,useDebugValue:Zn,useDeferredValue:Zn,useTransition:Zn,useMutableSource:Zn,useSyncExternalStore:Zn,useId:Zn,unstable_isNewReconciler:!1},GG={readContext:hi,useCallback:function(i,s){return zi().memoizedState=[i,s===void 0?null:s],i},useContext:hi,useEffect:aN,useImperativeHandle:function(i,s,d){return d=d!=null?d.concat([i]):null,mh(4194308,4,pD.bind(null,s,i),d)},useLayoutEffect:function(i,s){return mh(4194308,4,i,s)},useInsertionEffect:function(i,s){return mh(4,2,i,s)},useMemo:function(i,s){var d=zi();return s=s===void 0?null:s,i=i(),d.memoizedState=[i,s],i},useReducer:function(i,s,d){var u=zi();return s=d!==void 0?d(s):s,u.memoizedState=u.baseState=s,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:s},u.queue=i,i=i.dispatch=FG.bind(null,tn,i),[u.memoizedState,i]},useRef:function(i){var s=zi();return i={current:i},s.memoizedState=i},useState:sN,useDebugValue:tS,useDeferredValue:function(i){return zi().memoizedState=i},useTransition:function(){var i=sN(!1),s=i[0];return i=jG.bind(null,i[1]),zi().memoizedState=i,[s,i]},useMutableSource:function(){},useSyncExternalStore:function(i,s,d){var u=tn,m=zi();if(Xt){if(d===void 0)throw Error(ue(407));d=d()}else{if(d=s(),xn===null)throw Error(ue(349));ta&30||oD(u,s,d)}m.memoizedState=d;var g={value:d,getSnapshot:s};return m.queue=g,aN(aD.bind(null,u,g,i),[i]),u.flags|=2048,el(9,sD.bind(null,u,g,d,s),void 0,null),d},useId:function(){var i=zi(),s=xn.identifierPrefix;if(Xt){var d=Eo,u=mo;d=(u&~(1<<32-Pi(u)-1)).toString(32)+d,s=":"+s+"R"+d,d=$d++,0<d&&(s+="H"+d.toString(32)),s+=":"}else d=VG++,s=":"+s+"r"+d.toString(32)+":";return i.memoizedState=s},unstable_isNewReconciler:!1},WG={readContext:hi,useCallback:mD,useContext:hi,useEffect:eS,useImperativeHandle:fD,useInsertionEffect:uD,useLayoutEffect:hD,useMemo:ED,useReducer:p_,useRef:lD,useState:function(){return p_(Zd)},useDebugValue:tS,useDeferredValue:function(i){var s=pi();return _D(s,wn.memoizedState,i)},useTransition:function(){var i=p_(Zd)[0],s=pi().memoizedState;return[i,s]},useMutableSource:rD,useSyncExternalStore:iD,useId:gD,unstable_isNewReconciler:!1},HG={readContext:hi,useCallback:mD,useContext:hi,useEffect:eS,useImperativeHandle:fD,useInsertionEffect:uD,useLayoutEffect:hD,useMemo:ED,useReducer:f_,useRef:lD,useState:function(){return f_(Zd)},useDebugValue:tS,useDeferredValue:function(i){var s=pi();return wn===null?s.memoizedState=i:_D(s,wn.memoizedState,i)},useTransition:function(){var i=f_(Zd)[0],s=pi().memoizedState;return[i,s]},useMutableSource:rD,useSyncExternalStore:iD,useId:gD,unstable_isNewReconciler:!1};function Ic(i,s){try{var d="",u=s;do d+=g3(u),u=u.return;while(u);var m=d}catch(g){m=`
Error generating stack: `+g.message+`
`+g.stack}return{value:i,source:s,stack:m,digest:null}}function m_(i,s,d){return{value:i,source:null,stack:d??null,digest:s??null}}function ng(i,s){try{console.error(s.value)}catch(d){setTimeout(function(){throw d})}}var KG=typeof WeakMap=="function"?WeakMap:Map;function RD(i,s,d){d=_o(-1,d),d.tag=3,d.payload={element:null};var u=s.value;return d.callback=function(){Yh||(Yh=!0,hg=u),ng(i,s)},d}function yD(i,s,d){d=_o(-1,d),d.tag=3;var u=i.type.getDerivedStateFromError;if(typeof u=="function"){var m=s.value;d.payload=function(){return u(m)},d.callback=function(){ng(i,s)}}var g=i.stateNode;return g!==null&&typeof g.componentDidCatch=="function"&&(d.callback=function(){ng(i,s),typeof u!="function"&&(hs===null?hs=new Set([this]):hs.add(this));var R=s.stack;this.componentDidCatch(s.value,{componentStack:R!==null?R:""})}),d}function cN(i,s,d){var u=i.pingCache;if(u===null){u=i.pingCache=new KG;var m=new Set;u.set(s,m)}else m=u.get(s),m===void 0&&(m=new Set,u.set(s,m));m.has(d)||(m.add(d),i=oW.bind(null,i,s,d),s.then(i,i))}function dN(i){do{var s;if((s=i.tag===13)&&(s=i.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return i;i=i.return}while(i!==null);return null}function lN(i,s,d,u,m){return i.mode&1?(i.flags|=65536,i.lanes=m,i):(i===s?i.flags|=65536:(i.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(s=_o(-1,1),s.tag=2,us(d,s,1))),d.lanes|=1),i)}var YG=yo.ReactCurrentOwner,Or=!1;function cr(i,s,d,u){s.child=i===null?tD(s,null,d,u):Rc(s,i.child,d,u)}function uN(i,s,d,u,m){d=d.render;var g=s.ref;return _c(s,m),u=$g(i,s,d,u,g,m),d=Zg(),i!==null&&!Or?(s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~m,Ro(i,s,m)):(Xt&&d&&Fg(s),s.flags|=1,cr(i,s,u,m),s.child)}function hN(i,s,d,u,m){if(i===null){var g=d.type;return typeof g=="function"&&!dS(g)&&g.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(s.tag=15,s.type=g,ID(i,s,g,u,m)):(i=Sh(d.type,null,u,s,s.mode,m),i.ref=s.ref,i.return=s,s.child=i)}if(g=i.child,!(i.lanes&m)){var R=g.memoizedProps;if(d=d.compare,d=d!==null?d:Yd,d(R,u)&&i.ref===s.ref)return Ro(i,s,m)}return s.flags|=1,i=fs(g,u),i.ref=s.ref,i.return=s,s.child=i}function ID(i,s,d,u,m){if(i!==null){var g=i.memoizedProps;if(Yd(g,u)&&i.ref===s.ref)if(Or=!1,s.pendingProps=u=g,(i.lanes&m)!==0)i.flags&131072&&(Or=!0);else return s.lanes=i.lanes,Ro(i,s,m)}return rg(i,s,d,u,m)}function CD(i,s,d){var u=s.pendingProps,m=u.children,g=i!==null?i.memoizedState:null;if(u.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},Gt(hc,Hr),Hr|=d;else{if(!(d&1073741824))return i=g!==null?g.baseLanes|d:d,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:i,cachePool:null,transitions:null},s.updateQueue=null,Gt(hc,Hr),Hr|=i,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},u=g!==null?g.baseLanes:d,Gt(hc,Hr),Hr|=u}else g!==null?(u=g.baseLanes|d,s.memoizedState=null):u=d,Gt(hc,Hr),Hr|=u;return cr(i,s,m,d),s.child}function AD(i,s){var d=s.ref;(i===null&&d!==null||i!==null&&i.ref!==d)&&(s.flags|=512,s.flags|=2097152)}function rg(i,s,d,u,m){var g=Nr(d)?Zs:nr.current;return g=Tc(s,g),_c(s,m),d=$g(i,s,d,u,g,m),u=Zg(),i!==null&&!Or?(s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~m,Ro(i,s,m)):(Xt&&u&&Fg(s),s.flags|=1,cr(i,s,d,m),s.child)}function pN(i,s,d,u,m){if(Nr(d)){var g=!0;Uh(s)}else g=!1;if(_c(s,m),s.stateNode===null)Eh(i,s),Zb(s,d,u),tg(s,d,u,m),u=!0;else if(i===null){var R=s.stateNode,b=s.memoizedProps;R.props=b;var P=R.context,k=d.contextType;typeof k=="object"&&k!==null?k=hi(k):(k=Nr(d)?Zs:nr.current,k=Tc(s,k));var H=d.getDerivedStateFromProps,B=typeof H=="function"||typeof R.getSnapshotBeforeUpdate=="function";B||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(b!==u||P!==k)&&iN(s,R,u,k),ns=!1;var z=s.memoizedState;R.state=z,Bh(s,u,R,m),P=s.memoizedState,b!==u||z!==P||wr.current||ns?(typeof H=="function"&&(eg(s,d,H,u),P=s.memoizedState),(b=ns||rN(s,d,b,u,z,P,k))?(B||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(s.flags|=4194308)):(typeof R.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=u,s.memoizedState=P),R.props=u,R.state=P,R.context=k,u=b):(typeof R.componentDidMount=="function"&&(s.flags|=4194308),u=!1)}else{R=s.stateNode,Qb(i,s),b=s.memoizedProps,k=s.type===s.elementType?b:Ni(s.type,b),R.props=k,B=s.pendingProps,z=R.context,P=d.contextType,typeof P=="object"&&P!==null?P=hi(P):(P=Nr(d)?Zs:nr.current,P=Tc(s,P));var ie=d.getDerivedStateFromProps;(H=typeof ie=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(b!==B||z!==P)&&iN(s,R,u,P),ns=!1,z=s.memoizedState,R.state=z,Bh(s,u,R,m);var j=s.memoizedState;b!==B||z!==j||wr.current||ns?(typeof ie=="function"&&(eg(s,d,ie,u),j=s.memoizedState),(k=ns||rN(s,d,k,u,z,j,P)||!1)?(H||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(u,j,P),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(u,j,P)),typeof R.componentDidUpdate=="function"&&(s.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof R.componentDidUpdate!="function"||b===i.memoizedProps&&z===i.memoizedState||(s.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||b===i.memoizedProps&&z===i.memoizedState||(s.flags|=1024),s.memoizedProps=u,s.memoizedState=j),R.props=u,R.state=j,R.context=P,u=k):(typeof R.componentDidUpdate!="function"||b===i.memoizedProps&&z===i.memoizedState||(s.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||b===i.memoizedProps&&z===i.memoizedState||(s.flags|=1024),u=!1)}return ig(i,s,d,u,g,m)}function ig(i,s,d,u,m,g){AD(i,s);var R=(s.flags&128)!==0;if(!u&&!R)return m&&$0(s,d,!1),Ro(i,s,g);u=s.stateNode,YG.current=s;var b=R&&typeof d.getDerivedStateFromError!="function"?null:u.render();return s.flags|=1,i!==null&&R?(s.child=Rc(s,i.child,null,g),s.child=Rc(s,null,b,g)):cr(i,s,b,g),s.memoizedState=u.state,m&&$0(s,d,!0),s.child}function OD(i){var s=i.stateNode;s.pendingContext?Q0(i,s.pendingContext,s.pendingContext!==s.context):s.context&&Q0(i,s.context,!1),qg(i,s.containerInfo)}function fN(i,s,d,u,m){return vc(),Gg(m),s.flags|=256,cr(i,s,d,u),s.child}var og={dehydrated:null,treeContext:null,retryLane:0};function sg(i){return{baseLanes:i,cachePool:null,transitions:null}}function wD(i,s,d){var u=s.pendingProps,m=en.current,g=!1,R=(s.flags&128)!==0,b;if((b=R)||(b=i!==null&&i.memoizedState===null?!1:(m&2)!==0),b?(g=!0,s.flags&=-129):(i===null||i.memoizedState!==null)&&(m|=1),Gt(en,m&1),i===null)return $_(s),i=s.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(s.mode&1?i.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(R=u.children,i=u.fallback,g?(u=s.mode,g=s.child,R={mode:"hidden",children:R},!(u&1)&&g!==null?(g.childLanes=0,g.pendingProps=R):g=cp(R,u,0,null),i=$s(i,u,d,null),g.return=s,i.return=s,g.sibling=i,s.child=g,s.child.memoizedState=sg(d),s.memoizedState=og,i):nS(s,R));if(m=i.memoizedState,m!==null&&(b=m.dehydrated,b!==null))return zG(i,s,R,u,b,m,d);if(g){g=u.fallback,R=s.mode,m=i.child,b=m.sibling;var P={mode:"hidden",children:u.children};return!(R&1)&&s.child!==m?(u=s.child,u.childLanes=0,u.pendingProps=P,s.deletions=null):(u=fs(m,P),u.subtreeFlags=m.subtreeFlags&14680064),b!==null?g=fs(b,g):(g=$s(g,R,d,null),g.flags|=2),g.return=s,u.return=s,u.sibling=g,s.child=u,u=g,g=s.child,R=i.child.memoizedState,R=R===null?sg(d):{baseLanes:R.baseLanes|d,cachePool:null,transitions:R.transitions},g.memoizedState=R,g.childLanes=i.childLanes&~d,s.memoizedState=og,u}return g=i.child,i=g.sibling,u=fs(g,{mode:"visible",children:u.children}),!(s.mode&1)&&(u.lanes=d),u.return=s,u.sibling=null,i!==null&&(d=s.deletions,d===null?(s.deletions=[i],s.flags|=16):d.push(i)),s.child=u,s.memoizedState=null,u}function nS(i,s){return s=cp({mode:"visible",children:s},i.mode,0,null),s.return=i,i.child=s}function ih(i,s,d,u){return u!==null&&Gg(u),Rc(s,i.child,null,d),i=nS(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function zG(i,s,d,u,m,g,R){if(d)return s.flags&256?(s.flags&=-257,u=m_(Error(ue(422))),ih(i,s,R,u)):s.memoizedState!==null?(s.child=i.child,s.flags|=128,null):(g=u.fallback,m=s.mode,u=cp({mode:"visible",children:u.children},m,0,null),g=$s(g,m,R,null),g.flags|=2,u.return=s,g.return=s,u.sibling=g,s.child=u,s.mode&1&&Rc(s,i.child,null,R),s.child.memoizedState=sg(R),s.memoizedState=og,g);if(!(s.mode&1))return ih(i,s,R,null);if(m.data==="$!"){if(u=m.nextSibling&&m.nextSibling.dataset,u)var b=u.dgst;return u=b,g=Error(ue(419)),u=m_(g,u,void 0),ih(i,s,R,u)}if(b=(R&i.childLanes)!==0,Or||b){if(u=xn,u!==null){switch(R&-R){case 4:m=2;break;case 16:m=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:m=32;break;case 536870912:m=268435456;break;default:m=0}m=m&(u.suspendedLanes|R)?0:m,m!==0&&m!==g.retryLane&&(g.retryLane=m,vo(i,m),Li(u,i,m,-1))}return cS(),u=m_(Error(ue(421))),ih(i,s,R,u)}return m.data==="$?"?(s.flags|=128,s.child=i.child,s=sW.bind(null,i),m._reactRetry=s,null):(i=g.treeContext,Kr=ls(m.nextSibling),Yr=s,Xt=!0,Di=null,i!==null&&(ai[ci++]=mo,ai[ci++]=Eo,ai[ci++]=ea,mo=i.id,Eo=i.overflow,ea=s),s=nS(s,u.children),s.flags|=4096,s)}function mN(i,s,d){i.lanes|=s;var u=i.alternate;u!==null&&(u.lanes|=s),Z_(i.return,s,d)}function E_(i,s,d,u,m){var g=i.memoizedState;g===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:u,tail:d,tailMode:m}:(g.isBackwards=s,g.rendering=null,g.renderingStartTime=0,g.last=u,g.tail=d,g.tailMode=m)}function ND(i,s,d){var u=s.pendingProps,m=u.revealOrder,g=u.tail;if(cr(i,s,u.children,d),u=en.current,u&2)u=u&1|2,s.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&mN(i,d,s);else if(i.tag===19)mN(i,d,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}u&=1}if(Gt(en,u),!(s.mode&1))s.memoizedState=null;else switch(m){case"forwards":for(d=s.child,m=null;d!==null;)i=d.alternate,i!==null&&Gh(i)===null&&(m=d),d=d.sibling;d=m,d===null?(m=s.child,s.child=null):(m=d.sibling,d.sibling=null),E_(s,!1,m,d,g);break;case"backwards":for(d=null,m=s.child,s.child=null;m!==null;){if(i=m.alternate,i!==null&&Gh(i)===null){s.child=m;break}i=m.sibling,m.sibling=d,d=m,m=i}E_(s,!0,d,null,g);break;case"together":E_(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Eh(i,s){!(s.mode&1)&&i!==null&&(i.alternate=null,s.alternate=null,s.flags|=2)}function Ro(i,s,d){if(i!==null&&(s.dependencies=i.dependencies),na|=s.lanes,!(d&s.childLanes))return null;if(i!==null&&s.child!==i.child)throw Error(ue(153));if(s.child!==null){for(i=s.child,d=fs(i,i.pendingProps),s.child=d,d.return=s;i.sibling!==null;)i=i.sibling,d=d.sibling=fs(i,i.pendingProps),d.return=s;d.sibling=null}return s.child}function qG(i,s,d){switch(s.tag){case 3:OD(s),vc();break;case 5:nD(s);break;case 1:Nr(s.type)&&Uh(s);break;case 4:qg(s,s.stateNode.containerInfo);break;case 10:var u=s.type._context,m=s.memoizedProps.value;Gt(jh,u._currentValue),u._currentValue=m;break;case 13:if(u=s.memoizedState,u!==null)return u.dehydrated!==null?(Gt(en,en.current&1),s.flags|=128,null):d&s.child.childLanes?wD(i,s,d):(Gt(en,en.current&1),i=Ro(i,s,d),i!==null?i.sibling:null);Gt(en,en.current&1);break;case 19:if(u=(d&s.childLanes)!==0,i.flags&128){if(u)return ND(i,s,d);s.flags|=128}if(m=s.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),Gt(en,en.current),u)break;return null;case 22:case 23:return s.lanes=0,CD(i,s,d)}return Ro(i,s,d)}var bD,ag,DD,PD;bD=function(i,s){for(var d=s.child;d!==null;){if(d.tag===5||d.tag===6)i.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===s)break;for(;d.sibling===null;){if(d.return===null||d.return===s)return;d=d.return}d.sibling.return=d.return,d=d.sibling}};ag=function(){};DD=function(i,s,d,u){var m=i.memoizedProps;if(m!==u){i=s.stateNode,Xs(Qi.current);var g=null;switch(d){case"input":m=N_(i,m),u=N_(i,u),g=[];break;case"select":m=nn({},m,{value:void 0}),u=nn({},u,{value:void 0}),g=[];break;case"textarea":m=P_(i,m),u=P_(i,u),g=[];break;default:typeof m.onClick!="function"&&typeof u.onClick=="function"&&(i.onclick=kh)}k_(d,u);var R;d=null;for(k in m)if(!u.hasOwnProperty(k)&&m.hasOwnProperty(k)&&m[k]!=null)if(k==="style"){var b=m[k];for(R in b)b.hasOwnProperty(R)&&(d||(d={}),d[R]="")}else k!=="dangerouslySetInnerHTML"&&k!=="children"&&k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&k!=="autoFocus"&&(jd.hasOwnProperty(k)?g||(g=[]):(g=g||[]).push(k,null));for(k in u){var P=u[k];if(b=m!=null?m[k]:void 0,u.hasOwnProperty(k)&&P!==b&&(P!=null||b!=null))if(k==="style")if(b){for(R in b)!b.hasOwnProperty(R)||P&&P.hasOwnProperty(R)||(d||(d={}),d[R]="");for(R in P)P.hasOwnProperty(R)&&b[R]!==P[R]&&(d||(d={}),d[R]=P[R])}else d||(g||(g=[]),g.push(k,d)),d=P;else k==="dangerouslySetInnerHTML"?(P=P?P.__html:void 0,b=b?b.__html:void 0,P!=null&&b!==P&&(g=g||[]).push(k,P)):k==="children"?typeof P!="string"&&typeof P!="number"||(g=g||[]).push(k,""+P):k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&(jd.hasOwnProperty(k)?(P!=null&&k==="onScroll"&&Yt("scroll",i),g||b===P||(g=[])):(g=g||[]).push(k,P))}d&&(g=g||[]).push("style",d);var k=g;(s.updateQueue=k)&&(s.flags|=4)}};PD=function(i,s,d,u){d!==u&&(s.flags|=4)};function vd(i,s){if(!Xt)switch(i.tailMode){case"hidden":s=i.tail;for(var d=null;s!==null;)s.alternate!==null&&(d=s),s=s.sibling;d===null?i.tail=null:d.sibling=null;break;case"collapsed":d=i.tail;for(var u=null;d!==null;)d.alternate!==null&&(u=d),d=d.sibling;u===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:u.sibling=null}}function er(i){var s=i.alternate!==null&&i.alternate.child===i.child,d=0,u=0;if(s)for(var m=i.child;m!==null;)d|=m.lanes|m.childLanes,u|=m.subtreeFlags&14680064,u|=m.flags&14680064,m.return=i,m=m.sibling;else for(m=i.child;m!==null;)d|=m.lanes|m.childLanes,u|=m.subtreeFlags,u|=m.flags,m.return=i,m=m.sibling;return i.subtreeFlags|=u,i.childLanes=d,s}function JG(i,s,d){var u=s.pendingProps;switch(Bg(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return er(s),null;case 1:return Nr(s.type)&&Mh(),er(s),null;case 3:return u=s.stateNode,yc(),zt(wr),zt(nr),Xg(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(i===null||i.child===null)&&(nh(s)?s.flags|=4:i===null||i.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,Di!==null&&(mg(Di),Di=null))),ag(i,s),er(s),null;case 5:Jg(s);var m=Xs(Qd.current);if(d=s.type,i!==null&&s.stateNode!=null)DD(i,s,d,u,m),i.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!u){if(s.stateNode===null)throw Error(ue(166));return er(s),null}if(i=Xs(Qi.current),nh(s)){u=s.stateNode,d=s.type;var g=s.memoizedProps;switch(u[qi]=s,u[Jd]=g,i=(s.mode&1)!==0,d){case"dialog":Yt("cancel",u),Yt("close",u);break;case"iframe":case"object":case"embed":Yt("load",u);break;case"video":case"audio":for(m=0;m<Od.length;m++)Yt(Od[m],u);break;case"source":Yt("error",u);break;case"img":case"image":case"link":Yt("error",u),Yt("load",u);break;case"details":Yt("toggle",u);break;case"input":I0(u,g),Yt("invalid",u);break;case"select":u._wrapperState={wasMultiple:!!g.multiple},Yt("invalid",u);break;case"textarea":A0(u,g),Yt("invalid",u)}k_(d,g),m=null;for(var R in g)if(g.hasOwnProperty(R)){var b=g[R];R==="children"?typeof b=="string"?u.textContent!==b&&(g.suppressHydrationWarning!==!0&&th(u.textContent,b,i),m=["children",b]):typeof b=="number"&&u.textContent!==""+b&&(g.suppressHydrationWarning!==!0&&th(u.textContent,b,i),m=["children",""+b]):jd.hasOwnProperty(R)&&b!=null&&R==="onScroll"&&Yt("scroll",u)}switch(d){case"input":zu(u),C0(u,g,!0);break;case"textarea":zu(u),O0(u);break;case"select":case"option":break;default:typeof g.onClick=="function"&&(u.onclick=kh)}u=m,s.updateQueue=u,u!==null&&(s.flags|=4)}else{R=m.nodeType===9?m:m.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=ob(d)),i==="http://www.w3.org/1999/xhtml"?d==="script"?(i=R.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof u.is=="string"?i=R.createElement(d,{is:u.is}):(i=R.createElement(d),d==="select"&&(R=i,u.multiple?R.multiple=!0:u.size&&(R.size=u.size))):i=R.createElementNS(i,d),i[qi]=s,i[Jd]=u,bD(i,s,!1,!1),s.stateNode=i;e:{switch(R=M_(d,u),d){case"dialog":Yt("cancel",i),Yt("close",i),m=u;break;case"iframe":case"object":case"embed":Yt("load",i),m=u;break;case"video":case"audio":for(m=0;m<Od.length;m++)Yt(Od[m],i);m=u;break;case"source":Yt("error",i),m=u;break;case"img":case"image":case"link":Yt("error",i),Yt("load",i),m=u;break;case"details":Yt("toggle",i),m=u;break;case"input":I0(i,u),m=N_(i,u),Yt("invalid",i);break;case"option":m=u;break;case"select":i._wrapperState={wasMultiple:!!u.multiple},m=nn({},u,{value:void 0}),Yt("invalid",i);break;case"textarea":A0(i,u),m=P_(i,u),Yt("invalid",i);break;default:m=u}k_(d,m),b=m;for(g in b)if(b.hasOwnProperty(g)){var P=b[g];g==="style"?cb(i,P):g==="dangerouslySetInnerHTML"?(P=P?P.__html:void 0,P!=null&&sb(i,P)):g==="children"?typeof P=="string"?(d!=="textarea"||P!=="")&&Fd(i,P):typeof P=="number"&&Fd(i,""+P):g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&g!=="autoFocus"&&(jd.hasOwnProperty(g)?P!=null&&g==="onScroll"&&Yt("scroll",i):P!=null&&Ag(i,g,P,R))}switch(d){case"input":zu(i),C0(i,u,!1);break;case"textarea":zu(i),O0(i);break;case"option":u.value!=null&&i.setAttribute("value",""+ms(u.value));break;case"select":i.multiple=!!u.multiple,g=u.value,g!=null?pc(i,!!u.multiple,g,!1):u.defaultValue!=null&&pc(i,!!u.multiple,u.defaultValue,!0);break;default:typeof m.onClick=="function"&&(i.onclick=kh)}switch(d){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break e;case"img":u=!0;break e;default:u=!1}}u&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return er(s),null;case 6:if(i&&s.stateNode!=null)PD(i,s,i.memoizedProps,u);else{if(typeof u!="string"&&s.stateNode===null)throw Error(ue(166));if(d=Xs(Qd.current),Xs(Qi.current),nh(s)){if(u=s.stateNode,d=s.memoizedProps,u[qi]=s,(g=u.nodeValue!==d)&&(i=Yr,i!==null))switch(i.tag){case 3:th(u.nodeValue,d,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&th(u.nodeValue,d,(i.mode&1)!==0)}g&&(s.flags|=4)}else u=(d.nodeType===9?d:d.ownerDocument).createTextNode(u),u[qi]=s,s.stateNode=u}return er(s),null;case 13:if(zt(en),u=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(Xt&&Kr!==null&&s.mode&1&&!(s.flags&128))Jb(),vc(),s.flags|=98560,g=!1;else if(g=nh(s),u!==null&&u.dehydrated!==null){if(i===null){if(!g)throw Error(ue(318));if(g=s.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(ue(317));g[qi]=s}else vc(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;er(s),g=!1}else Di!==null&&(mg(Di),Di=null),g=!0;if(!g)return s.flags&65536?s:null}return s.flags&128?(s.lanes=d,s):(u=u!==null,u!==(i!==null&&i.memoizedState!==null)&&u&&(s.child.flags|=8192,s.mode&1&&(i===null||en.current&1?Nn===0&&(Nn=3):cS())),s.updateQueue!==null&&(s.flags|=4),er(s),null);case 4:return yc(),ag(i,s),i===null&&zd(s.stateNode.containerInfo),er(s),null;case 10:return Kg(s.type._context),er(s),null;case 17:return Nr(s.type)&&Mh(),er(s),null;case 19:if(zt(en),g=s.memoizedState,g===null)return er(s),null;if(u=(s.flags&128)!==0,R=g.rendering,R===null)if(u)vd(g,!1);else{if(Nn!==0||i!==null&&i.flags&128)for(i=s.child;i!==null;){if(R=Gh(i),R!==null){for(s.flags|=128,vd(g,!1),u=R.updateQueue,u!==null&&(s.updateQueue=u,s.flags|=4),s.subtreeFlags=0,u=d,d=s.child;d!==null;)g=d,i=u,g.flags&=14680066,R=g.alternate,R===null?(g.childLanes=0,g.lanes=i,g.child=null,g.subtreeFlags=0,g.memoizedProps=null,g.memoizedState=null,g.updateQueue=null,g.dependencies=null,g.stateNode=null):(g.childLanes=R.childLanes,g.lanes=R.lanes,g.child=R.child,g.subtreeFlags=0,g.deletions=null,g.memoizedProps=R.memoizedProps,g.memoizedState=R.memoizedState,g.updateQueue=R.updateQueue,g.type=R.type,i=R.dependencies,g.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),d=d.sibling;return Gt(en,en.current&1|2),s.child}i=i.sibling}g.tail!==null&&ln()>Cc&&(s.flags|=128,u=!0,vd(g,!1),s.lanes=4194304)}else{if(!u)if(i=Gh(R),i!==null){if(s.flags|=128,u=!0,d=i.updateQueue,d!==null&&(s.updateQueue=d,s.flags|=4),vd(g,!0),g.tail===null&&g.tailMode==="hidden"&&!R.alternate&&!Xt)return er(s),null}else 2*ln()-g.renderingStartTime>Cc&&d!==1073741824&&(s.flags|=128,u=!0,vd(g,!1),s.lanes=4194304);g.isBackwards?(R.sibling=s.child,s.child=R):(d=g.last,d!==null?d.sibling=R:s.child=R,g.last=R)}return g.tail!==null?(s=g.tail,g.rendering=s,g.tail=s.sibling,g.renderingStartTime=ln(),s.sibling=null,d=en.current,Gt(en,u?d&1|2:d&1),s):(er(s),null);case 22:case 23:return aS(),u=s.memoizedState!==null,i!==null&&i.memoizedState!==null!==u&&(s.flags|=8192),u&&s.mode&1?Hr&1073741824&&(er(s),s.subtreeFlags&6&&(s.flags|=8192)):er(s),null;case 24:return null;case 25:return null}throw Error(ue(156,s.tag))}function XG(i,s){switch(Bg(s),s.tag){case 1:return Nr(s.type)&&Mh(),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return yc(),zt(wr),zt(nr),Xg(),i=s.flags,i&65536&&!(i&128)?(s.flags=i&-65537|128,s):null;case 5:return Jg(s),null;case 13:if(zt(en),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(ue(340));vc()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return zt(en),null;case 4:return yc(),null;case 10:return Kg(s.type._context),null;case 22:case 23:return aS(),null;case 24:return null;default:return null}}var oh=!1,tr=!1,QG=typeof WeakSet=="function"?WeakSet:Set,Ie=null;function uc(i,s){var d=i.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(u){rn(i,s,u)}else d.current=null}function cg(i,s,d){try{d()}catch(u){rn(i,s,u)}}var EN=!1;function $G(i,s){if(K_=Dh,i=Ub(),jg(i)){if("selectionStart"in i)var d={start:i.selectionStart,end:i.selectionEnd};else e:{d=(d=i.ownerDocument)&&d.defaultView||window;var u=d.getSelection&&d.getSelection();if(u&&u.rangeCount!==0){d=u.anchorNode;var m=u.anchorOffset,g=u.focusNode;u=u.focusOffset;try{d.nodeType,g.nodeType}catch{d=null;break e}var R=0,b=-1,P=-1,k=0,H=0,B=i,z=null;t:for(;;){for(var ie;B!==d||m!==0&&B.nodeType!==3||(b=R+m),B!==g||u!==0&&B.nodeType!==3||(P=R+u),B.nodeType===3&&(R+=B.nodeValue.length),(ie=B.firstChild)!==null;)z=B,B=ie;for(;;){if(B===i)break t;if(z===d&&++k===m&&(b=R),z===g&&++H===u&&(P=R),(ie=B.nextSibling)!==null)break;B=z,z=B.parentNode}B=ie}d=b===-1||P===-1?null:{start:b,end:P}}else d=null}d=d||{start:0,end:0}}else d=null;for(Y_={focusedElem:i,selectionRange:d},Dh=!1,Ie=s;Ie!==null;)if(s=Ie,i=s.child,(s.subtreeFlags&1028)!==0&&i!==null)i.return=s,Ie=i;else for(;Ie!==null;){s=Ie;try{var j=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(j!==null){var oe=j.memoizedProps,Je=j.memoizedState,V=s.stateNode,x=V.getSnapshotBeforeUpdate(s.elementType===s.type?oe:Ni(s.type,oe),Je);V.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var G=s.stateNode.containerInfo;G.nodeType===1?G.textContent="":G.nodeType===9&&G.documentElement&&G.removeChild(G.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ue(163))}}catch(ne){rn(s,s.return,ne)}if(i=s.sibling,i!==null){i.return=s.return,Ie=i;break}Ie=s.return}return j=EN,EN=!1,j}function Ud(i,s,d){var u=s.updateQueue;if(u=u!==null?u.lastEffect:null,u!==null){var m=u=u.next;do{if((m.tag&i)===i){var g=m.destroy;m.destroy=void 0,g!==void 0&&cg(s,d,g)}m=m.next}while(m!==u)}}function sp(i,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var d=s=s.next;do{if((d.tag&i)===i){var u=d.create;d.destroy=u()}d=d.next}while(d!==s)}}function dg(i){var s=i.ref;if(s!==null){var d=i.stateNode;switch(i.tag){case 5:i=d;break;default:i=d}typeof s=="function"?s(i):s.current=i}}function LD(i){var s=i.alternate;s!==null&&(i.alternate=null,LD(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&(delete s[qi],delete s[Jd],delete s[J_],delete s[kG],delete s[MG])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function kD(i){return i.tag===5||i.tag===3||i.tag===4}function _N(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||kD(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function lg(i,s,d){var u=i.tag;if(u===5||u===6)i=i.stateNode,s?d.nodeType===8?d.parentNode.insertBefore(i,s):d.insertBefore(i,s):(d.nodeType===8?(s=d.parentNode,s.insertBefore(i,d)):(s=d,s.appendChild(i)),d=d._reactRootContainer,d!=null||s.onclick!==null||(s.onclick=kh));else if(u!==4&&(i=i.child,i!==null))for(lg(i,s,d),i=i.sibling;i!==null;)lg(i,s,d),i=i.sibling}function ug(i,s,d){var u=i.tag;if(u===5||u===6)i=i.stateNode,s?d.insertBefore(i,s):d.appendChild(i);else if(u!==4&&(i=i.child,i!==null))for(ug(i,s,d),i=i.sibling;i!==null;)ug(i,s,d),i=i.sibling}var Wn=null,bi=!1;function Zo(i,s,d){for(d=d.child;d!==null;)MD(i,s,d),d=d.sibling}function MD(i,s,d){if(Xi&&typeof Xi.onCommitFiberUnmount=="function")try{Xi.onCommitFiberUnmount($h,d)}catch{}switch(d.tag){case 5:tr||uc(d,s);case 6:var u=Wn,m=bi;Wn=null,Zo(i,s,d),Wn=u,bi=m,Wn!==null&&(bi?(i=Wn,d=d.stateNode,i.nodeType===8?i.parentNode.removeChild(d):i.removeChild(d)):Wn.removeChild(d.stateNode));break;case 18:Wn!==null&&(bi?(i=Wn,d=d.stateNode,i.nodeType===8?d_(i.parentNode,d):i.nodeType===1&&d_(i,d),Hd(i)):d_(Wn,d.stateNode));break;case 4:u=Wn,m=bi,Wn=d.stateNode.containerInfo,bi=!0,Zo(i,s,d),Wn=u,bi=m;break;case 0:case 11:case 14:case 15:if(!tr&&(u=d.updateQueue,u!==null&&(u=u.lastEffect,u!==null))){m=u=u.next;do{var g=m,R=g.destroy;g=g.tag,R!==void 0&&(g&2||g&4)&&cg(d,s,R),m=m.next}while(m!==u)}Zo(i,s,d);break;case 1:if(!tr&&(uc(d,s),u=d.stateNode,typeof u.componentWillUnmount=="function"))try{u.props=d.memoizedProps,u.state=d.memoizedState,u.componentWillUnmount()}catch(b){rn(d,s,b)}Zo(i,s,d);break;case 21:Zo(i,s,d);break;case 22:d.mode&1?(tr=(u=tr)||d.memoizedState!==null,Zo(i,s,d),tr=u):Zo(i,s,d);break;default:Zo(i,s,d)}}function gN(i){var s=i.updateQueue;if(s!==null){i.updateQueue=null;var d=i.stateNode;d===null&&(d=i.stateNode=new QG),s.forEach(function(u){var m=aW.bind(null,i,u);d.has(u)||(d.add(u),u.then(m,m))})}}function wi(i,s){var d=s.deletions;if(d!==null)for(var u=0;u<d.length;u++){var m=d[u];try{var g=i,R=s,b=R;e:for(;b!==null;){switch(b.tag){case 5:Wn=b.stateNode,bi=!1;break e;case 3:Wn=b.stateNode.containerInfo,bi=!0;break e;case 4:Wn=b.stateNode.containerInfo,bi=!0;break e}b=b.return}if(Wn===null)throw Error(ue(160));MD(g,R,m),Wn=null,bi=!1;var P=m.alternate;P!==null&&(P.return=null),m.return=null}catch(k){rn(m,s,k)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)UD(s,i),s=s.sibling}function UD(i,s){var d=i.alternate,u=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(wi(s,i),Yi(i),u&4){try{Ud(3,i,i.return),sp(3,i)}catch(oe){rn(i,i.return,oe)}try{Ud(5,i,i.return)}catch(oe){rn(i,i.return,oe)}}break;case 1:wi(s,i),Yi(i),u&512&&d!==null&&uc(d,d.return);break;case 5:if(wi(s,i),Yi(i),u&512&&d!==null&&uc(d,d.return),i.flags&32){var m=i.stateNode;try{Fd(m,"")}catch(oe){rn(i,i.return,oe)}}if(u&4&&(m=i.stateNode,m!=null)){var g=i.memoizedProps,R=d!==null?d.memoizedProps:g,b=i.type,P=i.updateQueue;if(i.updateQueue=null,P!==null)try{b==="input"&&g.type==="radio"&&g.name!=null&&rb(m,g),M_(b,R);var k=M_(b,g);for(R=0;R<P.length;R+=2){var H=P[R],B=P[R+1];H==="style"?cb(m,B):H==="dangerouslySetInnerHTML"?sb(m,B):H==="children"?Fd(m,B):Ag(m,H,B,k)}switch(b){case"input":b_(m,g);break;case"textarea":ib(m,g);break;case"select":var z=m._wrapperState.wasMultiple;m._wrapperState.wasMultiple=!!g.multiple;var ie=g.value;ie!=null?pc(m,!!g.multiple,ie,!1):z!==!!g.multiple&&(g.defaultValue!=null?pc(m,!!g.multiple,g.defaultValue,!0):pc(m,!!g.multiple,g.multiple?[]:"",!1))}m[Jd]=g}catch(oe){rn(i,i.return,oe)}}break;case 6:if(wi(s,i),Yi(i),u&4){if(i.stateNode===null)throw Error(ue(162));m=i.stateNode,g=i.memoizedProps;try{m.nodeValue=g}catch(oe){rn(i,i.return,oe)}}break;case 3:if(wi(s,i),Yi(i),u&4&&d!==null&&d.memoizedState.isDehydrated)try{Hd(s.containerInfo)}catch(oe){rn(i,i.return,oe)}break;case 4:wi(s,i),Yi(i);break;case 13:wi(s,i),Yi(i),m=i.child,m.flags&8192&&(g=m.memoizedState!==null,m.stateNode.isHidden=g,!g||m.alternate!==null&&m.alternate.memoizedState!==null||(oS=ln())),u&4&&gN(i);break;case 22:if(H=d!==null&&d.memoizedState!==null,i.mode&1?(tr=(k=tr)||H,wi(s,i),tr=k):wi(s,i),Yi(i),u&8192){if(k=i.memoizedState!==null,(i.stateNode.isHidden=k)&&!H&&i.mode&1)for(Ie=i,H=i.child;H!==null;){for(B=Ie=H;Ie!==null;){switch(z=Ie,ie=z.child,z.tag){case 0:case 11:case 14:case 15:Ud(4,z,z.return);break;case 1:uc(z,z.return);var j=z.stateNode;if(typeof j.componentWillUnmount=="function"){u=z,d=z.return;try{s=u,j.props=s.memoizedProps,j.state=s.memoizedState,j.componentWillUnmount()}catch(oe){rn(u,d,oe)}}break;case 5:uc(z,z.return);break;case 22:if(z.memoizedState!==null){TN(B);continue}}ie!==null?(ie.return=z,Ie=ie):TN(B)}H=H.sibling}e:for(H=null,B=i;;){if(B.tag===5){if(H===null){H=B;try{m=B.stateNode,k?(g=m.style,typeof g.setProperty=="function"?g.setProperty("display","none","important"):g.display="none"):(b=B.stateNode,P=B.memoizedProps.style,R=P!=null&&P.hasOwnProperty("display")?P.display:null,b.style.display=ab("display",R))}catch(oe){rn(i,i.return,oe)}}}else if(B.tag===6){if(H===null)try{B.stateNode.nodeValue=k?"":B.memoizedProps}catch(oe){rn(i,i.return,oe)}}else if((B.tag!==22&&B.tag!==23||B.memoizedState===null||B===i)&&B.child!==null){B.child.return=B,B=B.child;continue}if(B===i)break e;for(;B.sibling===null;){if(B.return===null||B.return===i)break e;H===B&&(H=null),B=B.return}H===B&&(H=null),B.sibling.return=B.return,B=B.sibling}}break;case 19:wi(s,i),Yi(i),u&4&&gN(i);break;case 21:break;default:wi(s,i),Yi(i)}}function Yi(i){var s=i.flags;if(s&2){try{e:{for(var d=i.return;d!==null;){if(kD(d)){var u=d;break e}d=d.return}throw Error(ue(160))}switch(u.tag){case 5:var m=u.stateNode;u.flags&32&&(Fd(m,""),u.flags&=-33);var g=_N(i);ug(i,g,m);break;case 3:case 4:var R=u.stateNode.containerInfo,b=_N(i);lg(i,b,R);break;default:throw Error(ue(161))}}catch(P){rn(i,i.return,P)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function ZG(i,s,d){Ie=i,xD(i)}function xD(i,s,d){for(var u=(i.mode&1)!==0;Ie!==null;){var m=Ie,g=m.child;if(m.tag===22&&u){var R=m.memoizedState!==null||oh;if(!R){var b=m.alternate,P=b!==null&&b.memoizedState!==null||tr;b=oh;var k=tr;if(oh=R,(tr=P)&&!k)for(Ie=m;Ie!==null;)R=Ie,P=R.child,R.tag===22&&R.memoizedState!==null?vN(m):P!==null?(P.return=R,Ie=P):vN(m);for(;g!==null;)Ie=g,xD(g),g=g.sibling;Ie=m,oh=b,tr=k}SN(i)}else m.subtreeFlags&8772&&g!==null?(g.return=m,Ie=g):SN(i)}}function SN(i){for(;Ie!==null;){var s=Ie;if(s.flags&8772){var d=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:tr||sp(5,s);break;case 1:var u=s.stateNode;if(s.flags&4&&!tr)if(d===null)u.componentDidMount();else{var m=s.elementType===s.type?d.memoizedProps:Ni(s.type,d.memoizedProps);u.componentDidUpdate(m,d.memoizedState,u.__reactInternalSnapshotBeforeUpdate)}var g=s.updateQueue;g!==null&&nN(s,g,u);break;case 3:var R=s.updateQueue;if(R!==null){if(d=null,s.child!==null)switch(s.child.tag){case 5:d=s.child.stateNode;break;case 1:d=s.child.stateNode}nN(s,R,d)}break;case 5:var b=s.stateNode;if(d===null&&s.flags&4){d=b;var P=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":P.autoFocus&&d.focus();break;case"img":P.src&&(d.src=P.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var k=s.alternate;if(k!==null){var H=k.memoizedState;if(H!==null){var B=H.dehydrated;B!==null&&Hd(B)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ue(163))}tr||s.flags&512&&dg(s)}catch(z){rn(s,s.return,z)}}if(s===i){Ie=null;break}if(d=s.sibling,d!==null){d.return=s.return,Ie=d;break}Ie=s.return}}function TN(i){for(;Ie!==null;){var s=Ie;if(s===i){Ie=null;break}var d=s.sibling;if(d!==null){d.return=s.return,Ie=d;break}Ie=s.return}}function vN(i){for(;Ie!==null;){var s=Ie;try{switch(s.tag){case 0:case 11:case 15:var d=s.return;try{sp(4,s)}catch(P){rn(s,d,P)}break;case 1:var u=s.stateNode;if(typeof u.componentDidMount=="function"){var m=s.return;try{u.componentDidMount()}catch(P){rn(s,m,P)}}var g=s.return;try{dg(s)}catch(P){rn(s,g,P)}break;case 5:var R=s.return;try{dg(s)}catch(P){rn(s,R,P)}}}catch(P){rn(s,s.return,P)}if(s===i){Ie=null;break}var b=s.sibling;if(b!==null){b.return=s.return,Ie=b;break}Ie=s.return}}var eW=Math.ceil,Kh=yo.ReactCurrentDispatcher,rS=yo.ReactCurrentOwner,li=yo.ReactCurrentBatchConfig,pt=0,xn=null,yn=null,Hn=0,Hr=0,hc=gs(0),Nn=0,tl=null,na=0,ap=0,iS=0,xd=null,Ar=null,oS=0,Cc=1/0,po=null,Yh=!1,hg=null,hs=null,sh=!1,ss=null,zh=0,Vd=0,pg=null,_h=-1,gh=0;function dr(){return pt&6?ln():_h!==-1?_h:_h=ln()}function ps(i){return i.mode&1?pt&2&&Hn!==0?Hn&-Hn:xG.transition!==null?(gh===0&&(gh=Tb()),gh):(i=At,i!==0||(i=window.event,i=i===void 0?16:Ob(i.type)),i):1}function Li(i,s,d,u){if(50<Vd)throw Vd=0,pg=null,Error(ue(185));il(i,d,u),(!(pt&2)||i!==xn)&&(i===xn&&(!(pt&2)&&(ap|=d),Nn===4&&is(i,Hn)),br(i,u),d===1&&pt===0&&!(s.mode&1)&&(Cc=ln()+500,rp&&Ss()))}function br(i,s){var d=i.callbackNode;x3(i,s);var u=bh(i,i===xn?Hn:0);if(u===0)d!==null&&b0(d),i.callbackNode=null,i.callbackPriority=0;else if(s=u&-u,i.callbackPriority!==s){if(d!=null&&b0(d),s===1)i.tag===0?UG(RN.bind(null,i)):Yb(RN.bind(null,i)),PG(function(){!(pt&6)&&Ss()}),d=null;else{switch(vb(u)){case 1:d=Dg;break;case 4:d=gb;break;case 16:d=Nh;break;case 536870912:d=Sb;break;default:d=Nh}d=KD(d,VD.bind(null,i))}i.callbackPriority=s,i.callbackNode=d}}function VD(i,s){if(_h=-1,gh=0,pt&6)throw Error(ue(327));var d=i.callbackNode;if(gc()&&i.callbackNode!==d)return null;var u=bh(i,i===xn?Hn:0);if(u===0)return null;if(u&30||u&i.expiredLanes||s)s=qh(i,u);else{s=u;var m=pt;pt|=2;var g=FD();(xn!==i||Hn!==s)&&(po=null,Cc=ln()+500,Qs(i,s));do try{rW();break}catch(b){jD(i,b)}while(1);Hg(),Kh.current=g,pt=m,yn!==null?s=0:(xn=null,Hn=0,s=Nn)}if(s!==0){if(s===2&&(m=F_(i),m!==0&&(u=m,s=fg(i,m))),s===1)throw d=tl,Qs(i,0),is(i,u),br(i,ln()),d;if(s===6)is(i,u);else{if(m=i.current.alternate,!(u&30)&&!tW(m)&&(s=qh(i,u),s===2&&(g=F_(i),g!==0&&(u=g,s=fg(i,g))),s===1))throw d=tl,Qs(i,0),is(i,u),br(i,ln()),d;switch(i.finishedWork=m,i.finishedLanes=u,s){case 0:case 1:throw Error(ue(345));case 2:zs(i,Ar,po);break;case 3:if(is(i,u),(u&130023424)===u&&(s=oS+500-ln(),10<s)){if(bh(i,0)!==0)break;if(m=i.suspendedLanes,(m&u)!==u){dr(),i.pingedLanes|=i.suspendedLanes&m;break}i.timeoutHandle=q_(zs.bind(null,i,Ar,po),s);break}zs(i,Ar,po);break;case 4:if(is(i,u),(u&4194240)===u)break;for(s=i.eventTimes,m=-1;0<u;){var R=31-Pi(u);g=1<<R,R=s[R],R>m&&(m=R),u&=~g}if(u=m,u=ln()-u,u=(120>u?120:480>u?480:1080>u?1080:1920>u?1920:3e3>u?3e3:4320>u?4320:1960*eW(u/1960))-u,10<u){i.timeoutHandle=q_(zs.bind(null,i,Ar,po),u);break}zs(i,Ar,po);break;case 5:zs(i,Ar,po);break;default:throw Error(ue(329))}}}return br(i,ln()),i.callbackNode===d?VD.bind(null,i):null}function fg(i,s){var d=xd;return i.current.memoizedState.isDehydrated&&(Qs(i,s).flags|=256),i=qh(i,s),i!==2&&(s=Ar,Ar=d,s!==null&&mg(s)),i}function mg(i){Ar===null?Ar=i:Ar.push.apply(Ar,i)}function tW(i){for(var s=i;;){if(s.flags&16384){var d=s.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var u=0;u<d.length;u++){var m=d[u],g=m.getSnapshot;m=m.value;try{if(!ki(g(),m))return!1}catch{return!1}}}if(d=s.child,s.subtreeFlags&16384&&d!==null)d.return=s,s=d;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function is(i,s){for(s&=~iS,s&=~ap,i.suspendedLanes|=s,i.pingedLanes&=~s,i=i.expirationTimes;0<s;){var d=31-Pi(s),u=1<<d;i[d]=-1,s&=~u}}function RN(i){if(pt&6)throw Error(ue(327));gc();var s=bh(i,0);if(!(s&1))return br(i,ln()),null;var d=qh(i,s);if(i.tag!==0&&d===2){var u=F_(i);u!==0&&(s=u,d=fg(i,u))}if(d===1)throw d=tl,Qs(i,0),is(i,s),br(i,ln()),d;if(d===6)throw Error(ue(345));return i.finishedWork=i.current.alternate,i.finishedLanes=s,zs(i,Ar,po),br(i,ln()),null}function sS(i,s){var d=pt;pt|=1;try{return i(s)}finally{pt=d,pt===0&&(Cc=ln()+500,rp&&Ss())}}function ra(i){ss!==null&&ss.tag===0&&!(pt&6)&&gc();var s=pt;pt|=1;var d=li.transition,u=At;try{if(li.transition=null,At=1,i)return i()}finally{At=u,li.transition=d,pt=s,!(pt&6)&&Ss()}}function aS(){Hr=hc.current,zt(hc)}function Qs(i,s){i.finishedWork=null,i.finishedLanes=0;var d=i.timeoutHandle;if(d!==-1&&(i.timeoutHandle=-1,DG(d)),yn!==null)for(d=yn.return;d!==null;){var u=d;switch(Bg(u),u.tag){case 1:u=u.type.childContextTypes,u!=null&&Mh();break;case 3:yc(),zt(wr),zt(nr),Xg();break;case 5:Jg(u);break;case 4:yc();break;case 13:zt(en);break;case 19:zt(en);break;case 10:Kg(u.type._context);break;case 22:case 23:aS()}d=d.return}if(xn=i,yn=i=fs(i.current,null),Hn=Hr=s,Nn=0,tl=null,iS=ap=na=0,Ar=xd=null,Js!==null){for(s=0;s<Js.length;s++)if(d=Js[s],u=d.interleaved,u!==null){d.interleaved=null;var m=u.next,g=d.pending;if(g!==null){var R=g.next;g.next=m,u.next=R}d.pending=u}Js=null}return i}function jD(i,s){do{var d=yn;try{if(Hg(),fh.current=Hh,Wh){for(var u=tn.memoizedState;u!==null;){var m=u.queue;m!==null&&(m.pending=null),u=u.next}Wh=!1}if(ta=0,Un=wn=tn=null,Md=!1,$d=0,rS.current=null,d===null||d.return===null){Nn=1,tl=s,yn=null;break}e:{var g=i,R=d.return,b=d,P=s;if(s=Hn,b.flags|=32768,P!==null&&typeof P=="object"&&typeof P.then=="function"){var k=P,H=b,B=H.tag;if(!(H.mode&1)&&(B===0||B===11||B===15)){var z=H.alternate;z?(H.updateQueue=z.updateQueue,H.memoizedState=z.memoizedState,H.lanes=z.lanes):(H.updateQueue=null,H.memoizedState=null)}var ie=dN(R);if(ie!==null){ie.flags&=-257,lN(ie,R,b,g,s),ie.mode&1&&cN(g,k,s),s=ie,P=k;var j=s.updateQueue;if(j===null){var oe=new Set;oe.add(P),s.updateQueue=oe}else j.add(P);break e}else{if(!(s&1)){cN(g,k,s),cS();break e}P=Error(ue(426))}}else if(Xt&&b.mode&1){var Je=dN(R);if(Je!==null){!(Je.flags&65536)&&(Je.flags|=256),lN(Je,R,b,g,s),Gg(Ic(P,b));break e}}g=P=Ic(P,b),Nn!==4&&(Nn=2),xd===null?xd=[g]:xd.push(g),g=R;do{switch(g.tag){case 3:g.flags|=65536,s&=-s,g.lanes|=s;var V=RD(g,P,s);tN(g,V);break e;case 1:b=P;var x=g.type,G=g.stateNode;if(!(g.flags&128)&&(typeof x.getDerivedStateFromError=="function"||G!==null&&typeof G.componentDidCatch=="function"&&(hs===null||!hs.has(G)))){g.flags|=65536,s&=-s,g.lanes|=s;var ne=yD(g,b,s);tN(g,ne);break e}}g=g.return}while(g!==null)}GD(d)}catch(Se){s=Se,yn===d&&d!==null&&(yn=d=d.return);continue}break}while(1)}function FD(){var i=Kh.current;return Kh.current=Hh,i===null?Hh:i}function cS(){(Nn===0||Nn===3||Nn===2)&&(Nn=4),xn===null||!(na&268435455)&&!(ap&268435455)||is(xn,Hn)}function qh(i,s){var d=pt;pt|=2;var u=FD();(xn!==i||Hn!==s)&&(po=null,Qs(i,s));do try{nW();break}catch(m){jD(i,m)}while(1);if(Hg(),pt=d,Kh.current=u,yn!==null)throw Error(ue(261));return xn=null,Hn=0,Nn}function nW(){for(;yn!==null;)BD(yn)}function rW(){for(;yn!==null&&!w3();)BD(yn)}function BD(i){var s=HD(i.alternate,i,Hr);i.memoizedProps=i.pendingProps,s===null?GD(i):yn=s,rS.current=null}function GD(i){var s=i;do{var d=s.alternate;if(i=s.return,s.flags&32768){if(d=XG(d,s),d!==null){d.flags&=32767,yn=d;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{Nn=6,yn=null;return}}else if(d=JG(d,s,Hr),d!==null){yn=d;return}if(s=s.sibling,s!==null){yn=s;return}yn=s=i}while(s!==null);Nn===0&&(Nn=5)}function zs(i,s,d){var u=At,m=li.transition;try{li.transition=null,At=1,iW(i,s,d,u)}finally{li.transition=m,At=u}return null}function iW(i,s,d,u){do gc();while(ss!==null);if(pt&6)throw Error(ue(327));d=i.finishedWork;var m=i.finishedLanes;if(d===null)return null;if(i.finishedWork=null,i.finishedLanes=0,d===i.current)throw Error(ue(177));i.callbackNode=null,i.callbackPriority=0;var g=d.lanes|d.childLanes;if(V3(i,g),i===xn&&(yn=xn=null,Hn=0),!(d.subtreeFlags&2064)&&!(d.flags&2064)||sh||(sh=!0,KD(Nh,function(){return gc(),null})),g=(d.flags&15990)!==0,d.subtreeFlags&15990||g){g=li.transition,li.transition=null;var R=At;At=1;var b=pt;pt|=4,rS.current=null,$G(i,d),UD(d,i),IG(Y_),Dh=!!K_,Y_=K_=null,i.current=d,ZG(d),N3(),pt=b,At=R,li.transition=g}else i.current=d;if(sh&&(sh=!1,ss=i,zh=m),g=i.pendingLanes,g===0&&(hs=null),P3(d.stateNode),br(i,ln()),s!==null)for(u=i.onRecoverableError,d=0;d<s.length;d++)m=s[d],u(m.value,{componentStack:m.stack,digest:m.digest});if(Yh)throw Yh=!1,i=hg,hg=null,i;return zh&1&&i.tag!==0&&gc(),g=i.pendingLanes,g&1?i===pg?Vd++:(Vd=0,pg=i):Vd=0,Ss(),null}function gc(){if(ss!==null){var i=vb(zh),s=li.transition,d=At;try{if(li.transition=null,At=16>i?16:i,ss===null)var u=!1;else{if(i=ss,ss=null,zh=0,pt&6)throw Error(ue(331));var m=pt;for(pt|=4,Ie=i.current;Ie!==null;){var g=Ie,R=g.child;if(Ie.flags&16){var b=g.deletions;if(b!==null){for(var P=0;P<b.length;P++){var k=b[P];for(Ie=k;Ie!==null;){var H=Ie;switch(H.tag){case 0:case 11:case 15:Ud(8,H,g)}var B=H.child;if(B!==null)B.return=H,Ie=B;else for(;Ie!==null;){H=Ie;var z=H.sibling,ie=H.return;if(LD(H),H===k){Ie=null;break}if(z!==null){z.return=ie,Ie=z;break}Ie=ie}}}var j=g.alternate;if(j!==null){var oe=j.child;if(oe!==null){j.child=null;do{var Je=oe.sibling;oe.sibling=null,oe=Je}while(oe!==null)}}Ie=g}}if(g.subtreeFlags&2064&&R!==null)R.return=g,Ie=R;else e:for(;Ie!==null;){if(g=Ie,g.flags&2048)switch(g.tag){case 0:case 11:case 15:Ud(9,g,g.return)}var V=g.sibling;if(V!==null){V.return=g.return,Ie=V;break e}Ie=g.return}}var x=i.current;for(Ie=x;Ie!==null;){R=Ie;var G=R.child;if(R.subtreeFlags&2064&&G!==null)G.return=R,Ie=G;else e:for(R=x;Ie!==null;){if(b=Ie,b.flags&2048)try{switch(b.tag){case 0:case 11:case 15:sp(9,b)}}catch(Se){rn(b,b.return,Se)}if(b===R){Ie=null;break e}var ne=b.sibling;if(ne!==null){ne.return=b.return,Ie=ne;break e}Ie=b.return}}if(pt=m,Ss(),Xi&&typeof Xi.onPostCommitFiberRoot=="function")try{Xi.onPostCommitFiberRoot($h,i)}catch{}u=!0}return u}finally{At=d,li.transition=s}}return!1}function yN(i,s,d){s=Ic(d,s),s=RD(i,s,1),i=us(i,s,1),s=dr(),i!==null&&(il(i,1,s),br(i,s))}function rn(i,s,d){if(i.tag===3)yN(i,i,d);else for(;s!==null;){if(s.tag===3){yN(s,i,d);break}else if(s.tag===1){var u=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(hs===null||!hs.has(u))){i=Ic(d,i),i=yD(s,i,1),s=us(s,i,1),i=dr(),s!==null&&(il(s,1,i),br(s,i));break}}s=s.return}}function oW(i,s,d){var u=i.pingCache;u!==null&&u.delete(s),s=dr(),i.pingedLanes|=i.suspendedLanes&d,xn===i&&(Hn&d)===d&&(Nn===4||Nn===3&&(Hn&130023424)===Hn&&500>ln()-oS?Qs(i,0):iS|=d),br(i,s)}function WD(i,s){s===0&&(i.mode&1?(s=Xu,Xu<<=1,!(Xu&130023424)&&(Xu=4194304)):s=1);var d=dr();i=vo(i,s),i!==null&&(il(i,s,d),br(i,d))}function sW(i){var s=i.memoizedState,d=0;s!==null&&(d=s.retryLane),WD(i,d)}function aW(i,s){var d=0;switch(i.tag){case 13:var u=i.stateNode,m=i.memoizedState;m!==null&&(d=m.retryLane);break;case 19:u=i.stateNode;break;default:throw Error(ue(314))}u!==null&&u.delete(s),WD(i,d)}var HD;HD=function(i,s,d){if(i!==null)if(i.memoizedProps!==s.pendingProps||wr.current)Or=!0;else{if(!(i.lanes&d)&&!(s.flags&128))return Or=!1,qG(i,s,d);Or=!!(i.flags&131072)}else Or=!1,Xt&&s.flags&1048576&&zb(s,Vh,s.index);switch(s.lanes=0,s.tag){case 2:var u=s.type;Eh(i,s),i=s.pendingProps;var m=Tc(s,nr.current);_c(s,d),m=$g(null,s,u,i,m,d);var g=Zg();return s.flags|=1,typeof m=="object"&&m!==null&&typeof m.render=="function"&&m.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,Nr(u)?(g=!0,Uh(s)):g=!1,s.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,zg(s),m.updater=ip,s.stateNode=m,m._reactInternals=s,tg(s,u,i,d),s=ig(null,s,u,!0,g,d)):(s.tag=0,Xt&&g&&Fg(s),cr(null,s,m,d),s=s.child),s;case 16:u=s.elementType;e:{switch(Eh(i,s),i=s.pendingProps,m=u._init,u=m(u._payload),s.type=u,m=s.tag=dW(u),i=Ni(u,i),m){case 0:s=rg(null,s,u,i,d);break e;case 1:s=pN(null,s,u,i,d);break e;case 11:s=uN(null,s,u,i,d);break e;case 14:s=hN(null,s,u,Ni(u.type,i),d);break e}throw Error(ue(306,u,""))}return s;case 0:return u=s.type,m=s.pendingProps,m=s.elementType===u?m:Ni(u,m),rg(i,s,u,m,d);case 1:return u=s.type,m=s.pendingProps,m=s.elementType===u?m:Ni(u,m),pN(i,s,u,m,d);case 3:e:{if(OD(s),i===null)throw Error(ue(387));u=s.pendingProps,g=s.memoizedState,m=g.element,Qb(i,s),Bh(s,u,null,d);var R=s.memoizedState;if(u=R.element,g.isDehydrated)if(g={element:u,isDehydrated:!1,cache:R.cache,pendingSuspenseBoundaries:R.pendingSuspenseBoundaries,transitions:R.transitions},s.updateQueue.baseState=g,s.memoizedState=g,s.flags&256){m=Ic(Error(ue(423)),s),s=fN(i,s,u,d,m);break e}else if(u!==m){m=Ic(Error(ue(424)),s),s=fN(i,s,u,d,m);break e}else for(Kr=ls(s.stateNode.containerInfo.firstChild),Yr=s,Xt=!0,Di=null,d=tD(s,null,u,d),s.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(vc(),u===m){s=Ro(i,s,d);break e}cr(i,s,u,d)}s=s.child}return s;case 5:return nD(s),i===null&&$_(s),u=s.type,m=s.pendingProps,g=i!==null?i.memoizedProps:null,R=m.children,z_(u,m)?R=null:g!==null&&z_(u,g)&&(s.flags|=32),AD(i,s),cr(i,s,R,d),s.child;case 6:return i===null&&$_(s),null;case 13:return wD(i,s,d);case 4:return qg(s,s.stateNode.containerInfo),u=s.pendingProps,i===null?s.child=Rc(s,null,u,d):cr(i,s,u,d),s.child;case 11:return u=s.type,m=s.pendingProps,m=s.elementType===u?m:Ni(u,m),uN(i,s,u,m,d);case 7:return cr(i,s,s.pendingProps,d),s.child;case 8:return cr(i,s,s.pendingProps.children,d),s.child;case 12:return cr(i,s,s.pendingProps.children,d),s.child;case 10:e:{if(u=s.type._context,m=s.pendingProps,g=s.memoizedProps,R=m.value,Gt(jh,u._currentValue),u._currentValue=R,g!==null)if(ki(g.value,R)){if(g.children===m.children&&!wr.current){s=Ro(i,s,d);break e}}else for(g=s.child,g!==null&&(g.return=s);g!==null;){var b=g.dependencies;if(b!==null){R=g.child;for(var P=b.firstContext;P!==null;){if(P.context===u){if(g.tag===1){P=_o(-1,d&-d),P.tag=2;var k=g.updateQueue;if(k!==null){k=k.shared;var H=k.pending;H===null?P.next=P:(P.next=H.next,H.next=P),k.pending=P}}g.lanes|=d,P=g.alternate,P!==null&&(P.lanes|=d),Z_(g.return,d,s),b.lanes|=d;break}P=P.next}}else if(g.tag===10)R=g.type===s.type?null:g.child;else if(g.tag===18){if(R=g.return,R===null)throw Error(ue(341));R.lanes|=d,b=R.alternate,b!==null&&(b.lanes|=d),Z_(R,d,s),R=g.sibling}else R=g.child;if(R!==null)R.return=g;else for(R=g;R!==null;){if(R===s){R=null;break}if(g=R.sibling,g!==null){g.return=R.return,R=g;break}R=R.return}g=R}cr(i,s,m.children,d),s=s.child}return s;case 9:return m=s.type,u=s.pendingProps.children,_c(s,d),m=hi(m),u=u(m),s.flags|=1,cr(i,s,u,d),s.child;case 14:return u=s.type,m=Ni(u,s.pendingProps),m=Ni(u.type,m),hN(i,s,u,m,d);case 15:return ID(i,s,s.type,s.pendingProps,d);case 17:return u=s.type,m=s.pendingProps,m=s.elementType===u?m:Ni(u,m),Eh(i,s),s.tag=1,Nr(u)?(i=!0,Uh(s)):i=!1,_c(s,d),Zb(s,u,m),tg(s,u,m,d),ig(null,s,u,!0,i,d);case 19:return ND(i,s,d);case 22:return CD(i,s,d)}throw Error(ue(156,s.tag))};function KD(i,s){return _b(i,s)}function cW(i,s,d,u){this.tag=i,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function di(i,s,d,u){return new cW(i,s,d,u)}function dS(i){return i=i.prototype,!(!i||!i.isReactComponent)}function dW(i){if(typeof i=="function")return dS(i)?1:0;if(i!=null){if(i=i.$$typeof,i===wg)return 11;if(i===Ng)return 14}return 2}function fs(i,s){var d=i.alternate;return d===null?(d=di(i.tag,s,i.key,i.mode),d.elementType=i.elementType,d.type=i.type,d.stateNode=i.stateNode,d.alternate=i,i.alternate=d):(d.pendingProps=s,d.type=i.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=i.flags&14680064,d.childLanes=i.childLanes,d.lanes=i.lanes,d.child=i.child,d.memoizedProps=i.memoizedProps,d.memoizedState=i.memoizedState,d.updateQueue=i.updateQueue,s=i.dependencies,d.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},d.sibling=i.sibling,d.index=i.index,d.ref=i.ref,d}function Sh(i,s,d,u,m,g){var R=2;if(u=i,typeof i=="function")dS(i)&&(R=1);else if(typeof i=="string")R=5;else e:switch(i){case nc:return $s(d.children,m,g,s);case Og:R=8,m|=8;break;case C_:return i=di(12,d,s,m|2),i.elementType=C_,i.lanes=g,i;case A_:return i=di(13,d,s,m),i.elementType=A_,i.lanes=g,i;case O_:return i=di(19,d,s,m),i.elementType=O_,i.lanes=g,i;case eb:return cp(d,m,g,s);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case $N:R=10;break e;case ZN:R=9;break e;case wg:R=11;break e;case Ng:R=14;break e;case ts:R=16,u=null;break e}throw Error(ue(130,i==null?i:typeof i,""))}return s=di(R,d,s,m),s.elementType=i,s.type=u,s.lanes=g,s}function $s(i,s,d,u){return i=di(7,i,u,s),i.lanes=d,i}function cp(i,s,d,u){return i=di(22,i,u,s),i.elementType=eb,i.lanes=d,i.stateNode={isHidden:!1},i}function __(i,s,d){return i=di(6,i,null,s),i.lanes=d,i}function g_(i,s,d){return s=di(4,i.children!==null?i.children:[],i.key,s),s.lanes=d,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}function lW(i,s,d,u,m){this.tag=s,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=$E(0),this.expirationTimes=$E(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$E(0),this.identifierPrefix=u,this.onRecoverableError=m,this.mutableSourceEagerHydrationData=null}function lS(i,s,d,u,m,g,R,b,P){return i=new lW(i,s,d,b,P),s===1?(s=1,g===!0&&(s|=8)):s=0,g=di(3,null,null,s),i.current=g,g.stateNode=i,g.memoizedState={element:u,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},zg(g),i}function uW(i,s,d){var u=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:tc,key:u==null?null:""+u,children:i,containerInfo:s,implementation:d}}function YD(i){if(!i)return Es;i=i._reactInternals;e:{if(oa(i)!==i||i.tag!==1)throw Error(ue(170));var s=i;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(Nr(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(ue(171))}if(i.tag===1){var d=i.type;if(Nr(d))return Kb(i,d,s)}return s}function zD(i,s,d,u,m,g,R,b,P){return i=lS(d,u,!0,i,m,g,R,b,P),i.context=YD(null),d=i.current,u=dr(),m=ps(d),g=_o(u,m),g.callback=s??null,us(d,g,m),i.current.lanes=m,il(i,m,u),br(i,u),i}function dp(i,s,d,u){var m=s.current,g=dr(),R=ps(m);return d=YD(d),s.context===null?s.context=d:s.pendingContext=d,s=_o(g,R),s.payload={element:i},u=u===void 0?null:u,u!==null&&(s.callback=u),i=us(m,s,R),i!==null&&(Li(i,m,R,g),ph(i,m,R)),R}function Jh(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function IN(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var d=i.retryLane;i.retryLane=d!==0&&d<s?d:s}}function uS(i,s){IN(i,s),(i=i.alternate)&&IN(i,s)}function hW(){return null}var qD=typeof reportError=="function"?reportError:function(i){console.error(i)};function hS(i){this._internalRoot=i}lp.prototype.render=hS.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(ue(409));dp(i,s,null,null)};lp.prototype.unmount=hS.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;ra(function(){dp(null,i,null,null)}),s[To]=null}};function lp(i){this._internalRoot=i}lp.prototype.unstable_scheduleHydration=function(i){if(i){var s=Ib();i={blockedOn:null,target:i,priority:s};for(var d=0;d<rs.length&&s!==0&&s<rs[d].priority;d++);rs.splice(d,0,i),d===0&&Ab(i)}};function pS(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function up(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function CN(){}function pW(i,s,d,u,m){if(m){if(typeof u=="function"){var g=u;u=function(){var k=Jh(R);g.call(k)}}var R=zD(s,u,i,0,null,!1,!1,"",CN);return i._reactRootContainer=R,i[To]=R.current,zd(i.nodeType===8?i.parentNode:i),ra(),R}for(;m=i.lastChild;)i.removeChild(m);if(typeof u=="function"){var b=u;u=function(){var k=Jh(P);b.call(k)}}var P=lS(i,0,!1,null,null,!1,!1,"",CN);return i._reactRootContainer=P,i[To]=P.current,zd(i.nodeType===8?i.parentNode:i),ra(function(){dp(s,P,d,u)}),P}function hp(i,s,d,u,m){var g=d._reactRootContainer;if(g){var R=g;if(typeof m=="function"){var b=m;m=function(){var P=Jh(R);b.call(P)}}dp(s,R,i,m)}else R=pW(d,s,i,m,u);return Jh(R)}Rb=function(i){switch(i.tag){case 3:var s=i.stateNode;if(s.current.memoizedState.isDehydrated){var d=Ad(s.pendingLanes);d!==0&&(Pg(s,d|1),br(s,ln()),!(pt&6)&&(Cc=ln()+500,Ss()))}break;case 13:ra(function(){var u=vo(i,1);if(u!==null){var m=dr();Li(u,i,1,m)}}),uS(i,1)}};Lg=function(i){if(i.tag===13){var s=vo(i,134217728);if(s!==null){var d=dr();Li(s,i,134217728,d)}uS(i,134217728)}};yb=function(i){if(i.tag===13){var s=ps(i),d=vo(i,s);if(d!==null){var u=dr();Li(d,i,s,u)}uS(i,s)}};Ib=function(){return At};Cb=function(i,s){var d=At;try{return At=i,s()}finally{At=d}};x_=function(i,s,d){switch(s){case"input":if(b_(i,d),s=d.name,d.type==="radio"&&s!=null){for(d=i;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<d.length;s++){var u=d[s];if(u!==i&&u.form===i.form){var m=np(u);if(!m)throw Error(ue(90));nb(u),b_(u,m)}}}break;case"textarea":ib(i,d);break;case"select":s=d.value,s!=null&&pc(i,!!d.multiple,s,!1)}};ub=sS;hb=ra;var fW={usingClientEntryPoint:!1,Events:[sl,sc,np,db,lb,sS]},Rd={findFiberByHostInstance:qs,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},mW={bundleType:Rd.bundleType,version:Rd.version,rendererPackageName:Rd.rendererPackageName,rendererConfig:Rd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:yo.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=mb(i),i===null?null:i.stateNode},findFiberByHostInstance:Rd.findFiberByHostInstance||hW,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ah=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ah.isDisabled&&ah.supportsFiber)try{$h=ah.inject(mW),Xi=ah}catch{}}qr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fW;qr.createPortal=function(i,s){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!pS(s))throw Error(ue(200));return uW(i,s,null,d)};qr.createRoot=function(i,s){if(!pS(i))throw Error(ue(299));var d=!1,u="",m=qD;return s!=null&&(s.unstable_strictMode===!0&&(d=!0),s.identifierPrefix!==void 0&&(u=s.identifierPrefix),s.onRecoverableError!==void 0&&(m=s.onRecoverableError)),s=lS(i,1,!1,null,null,d,!1,u,m),i[To]=s.current,zd(i.nodeType===8?i.parentNode:i),new hS(s)};qr.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(ue(188)):(i=Object.keys(i).join(","),Error(ue(268,i)));return i=mb(s),i=i===null?null:i.stateNode,i};qr.flushSync=function(i){return ra(i)};qr.hydrate=function(i,s,d){if(!up(s))throw Error(ue(200));return hp(null,i,s,!0,d)};qr.hydrateRoot=function(i,s,d){if(!pS(i))throw Error(ue(405));var u=d!=null&&d.hydratedSources||null,m=!1,g="",R=qD;if(d!=null&&(d.unstable_strictMode===!0&&(m=!0),d.identifierPrefix!==void 0&&(g=d.identifierPrefix),d.onRecoverableError!==void 0&&(R=d.onRecoverableError)),s=zD(s,null,i,1,d??null,m,!1,g,R),i[To]=s.current,zd(i),u)for(i=0;i<u.length;i++)d=u[i],m=d._getVersion,m=m(d._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[d,m]:s.mutableSourceEagerHydrationData.push(d,m);return new lp(s)};qr.render=function(i,s,d){if(!up(s))throw Error(ue(200));return hp(null,i,s,!1,d)};qr.unmountComponentAtNode=function(i){if(!up(i))throw Error(ue(40));return i._reactRootContainer?(ra(function(){hp(null,null,i,!1,function(){i._reactRootContainer=null,i[To]=null})}),!0):!1};qr.unstable_batchedUpdates=sS;qr.unstable_renderSubtreeIntoContainer=function(i,s,d,u){if(!up(d))throw Error(ue(200));if(i==null||i._reactInternals===void 0)throw Error(ue(38));return hp(i,s,d,!1,u)};qr.version="18.2.0-next-9e3b772b8-20220608";function JD(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(JD)}catch(i){console.error(i)}}JD(),zN.exports=qr;var EW=zN.exports,AN=EW;y_.createRoot=AN.createRoot,y_.hydrateRoot=AN.hydrateRoot;var XD={exports:{}};(function(i,s){(function(d,u){i.exports=u()})(YE,function(){function d(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in e)){var o=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,o.get?o:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(e)}var u=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof YE<"u"?YE:typeof self<"u"?self:{},m=function(e){try{return!!e()}catch{return!0}},g=!m(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),R=g,b=Function.prototype,P=b.bind,k=b.call,H=R&&P.bind(k,k),B=R?function(e){return e&&H(e)}:function(e){return e&&function(){return k.apply(e,arguments)}},z=B({}.isPrototypeOf),ie=function(e){return e&&e.Math==Math&&e},j=ie(typeof globalThis=="object"&&globalThis)||ie(typeof window=="object"&&window)||ie(typeof self=="object"&&self)||ie(typeof u=="object"&&u)||function(){return this}()||Function("return this")(),oe=g,Je=Function.prototype,V=Je.apply,x=Je.call,G=typeof Reflect=="object"&&Reflect.apply||(oe?x.bind(V):function(){return x.apply(V,arguments)}),ne=function(e){return typeof e=="function"},Se={},Te=!m(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Oe=g,we=Function.prototype.call,lt=Oe?we.bind(we):function(){return we.apply(we,arguments)},tt={},hr={}.propertyIsEnumerable,Io=Object.getOwnPropertyDescriptor,Ts=Io&&!hr.call({1:2},1);tt.f=Ts?function(e){var t=Io(this,e);return!!t&&t.enumerable}:hr;var fi,sa,mi=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},aa=B,ye=aa({}.toString),We=aa("".slice),Fe=function(e){return We(ye(e),8,-1)},Qt=B,un=m,ca=Fe,Ei=j.Object,Dc=Qt("".split),_i=un(function(){return!Ei("z").propertyIsEnumerable(0)})?function(e){return ca(e)=="String"?Dc(e,""):Ei(e)}:Ei,da=j.TypeError,ll=function(e){if(e==null)throw da("Can't call method on "+e);return e},gP=_i,SP=ll,Co=function(e){return gP(SP(e))},TP=ne,Xr=function(e){return typeof e=="object"?e!==null:TP(e)},Ao={},Sp=Ao,Tp=j,vP=ne,SS=function(e){return vP(e)?e:void 0},Mi=function(e,t){return arguments.length<2?SS(Sp[e])||SS(Tp[e]):Sp[e]&&Sp[e][t]||Tp[e]&&Tp[e][t]},vs=Mi("navigator","userAgent")||"",TS=j,vp=vs,vS=TS.process,RS=TS.Deno,yS=vS&&vS.versions||RS&&RS.version,IS=yS&&yS.v8;IS&&(sa=(fi=IS.split("."))[0]>0&&fi[0]<4?1:+(fi[0]+fi[1])),!sa&&vp&&(!(fi=vp.match(/Edge\/(\d+)/))||fi[1]>=74)&&(fi=vp.match(/Chrome\/(\d+)/))&&(sa=+fi[1]);var la=sa,CS=la,RP=m,Rp=!!Object.getOwnPropertySymbols&&!RP(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&CS&&CS<41}),AS=Rp&&!Symbol.sham&&typeof Symbol.iterator=="symbol",yP=Mi,IP=ne,CP=z,AP=AS,OP=j.Object,yp=AP?function(e){return typeof e=="symbol"}:function(e){var t=yP("Symbol");return IP(t)&&CP(t.prototype,OP(e))},wP=j.String,ul=function(e){try{return wP(e)}catch{return"Object"}},NP=ne,bP=ul,DP=j.TypeError,Zi=function(e){if(NP(e))return e;throw DP(bP(e)+" is not a function")},PP=Zi,Ip=function(e,t){var n=e[t];return n==null?void 0:PP(n)},Cp=lt,Ap=ne,Op=Xr,LP=j.TypeError,hl={exports:{}},OS=j,kP=Object.defineProperty,MP=function(e,t){try{kP(OS,e,{value:t,configurable:!0,writable:!0})}catch{OS[e]=t}return t},wS="__core-js_shared__",wp=j[wS]||MP(wS,{}),NS=wp;(hl.exports=function(e,t){return NS[e]||(NS[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.20.3",mode:"pure",copyright:" 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.20.3/LICENSE",source:"https://github.com/zloirock/core-js"});var UP=ll,xP=j.Object,Oo=function(e){return xP(UP(e))},VP=Oo,jP=B({}.hasOwnProperty),rr=Object.hasOwn||function(e,t){return jP(VP(e),t)},FP=B,BP=0,GP=Math.random(),WP=FP(1 .toString),Np=function(e){return"Symbol("+(e===void 0?"":e)+")_"+WP(++BP+GP,36)},HP=j,KP=hl.exports,bS=rr,YP=Np,DS=Rp,PS=AS,Pc=KP("wks"),Rs=HP.Symbol,LS=Rs&&Rs.for,zP=PS?Rs:Rs&&Rs.withoutSetter||YP,hn=function(e){if(!bS(Pc,e)||!DS&&typeof Pc[e]!="string"){var t="Symbol."+e;DS&&bS(Rs,e)?Pc[e]=Rs[e]:Pc[e]=PS&&LS?LS(t):zP(t)}return Pc[e]},qP=lt,kS=Xr,MS=yp,JP=Ip,XP=function(e,t){var n,r;if(t==="string"&&Ap(n=e.toString)&&!Op(r=Cp(n,e))||Ap(n=e.valueOf)&&!Op(r=Cp(n,e))||t!=="string"&&Ap(n=e.toString)&&!Op(r=Cp(n,e)))return r;throw LP("Can't convert object to primitive value")},QP=hn,$P=j.TypeError,ZP=QP("toPrimitive"),eL=function(e,t){if(!kS(e)||MS(e))return e;var n,r=JP(e,ZP);if(r){if(t===void 0&&(t="default"),n=qP(r,e,t),!kS(n)||MS(n))return n;throw $P("Can't convert object to primitive value")}return t===void 0&&(t="number"),XP(e,t)},tL=yp,pl=function(e){var t=eL(e,"string");return tL(t)?t:t+""},US=Xr,bp=j.document,nL=US(bp)&&US(bp.createElement),Dp=function(e){return nL?bp.createElement(e):{}},rL=Dp,xS=!Te&&!m(function(){return Object.defineProperty(rL("div"),"a",{get:function(){return 7}}).a!=7}),iL=Te,oL=lt,sL=tt,aL=mi,cL=Co,dL=pl,lL=rr,uL=xS,VS=Object.getOwnPropertyDescriptor;Se.f=iL?VS:function(e,t){if(e=cL(e),t=dL(t),uL)try{return VS(e,t)}catch{}if(lL(e,t))return aL(!oL(sL.f,e,t),e[t])};var hL=m,pL=ne,fL=/#|\.prototype\./,Lc=function(e,t){var n=EL[mL(e)];return n==gL||n!=_L&&(pL(t)?hL(t):!!t)},mL=Lc.normalize=function(e){return String(e).replace(fL,".").toLowerCase()},EL=Lc.data={},_L=Lc.NATIVE="N",gL=Lc.POLYFILL="P",jS=Lc,SL=Zi,TL=g,vL=B(B.bind),kc=function(e,t){return SL(e),t===void 0?e:TL?vL(e,t):function(){return e.apply(t,arguments)}},gi={},FS=Te&&m(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),BS=j,RL=Xr,yL=BS.String,IL=BS.TypeError,Si=function(e){if(RL(e))return e;throw IL(yL(e)+" is not an object")},CL=Te,AL=xS,OL=FS,fl=Si,GS=pl,wL=j.TypeError,Pp=Object.defineProperty,NL=Object.getOwnPropertyDescriptor,bL="enumerable",DL="configurable",PL="writable";gi.f=CL?OL?function(e,t,n){if(fl(e),t=GS(t),fl(n),typeof e=="function"&&t==="prototype"&&"value"in n&&PL in n&&!n.writable){var r=NL(e,t);r&&r.writable&&(e[t]=n.value,n={configurable:DL in n?n.configurable:r.configurable,enumerable:bL in n?n.enumerable:r.enumerable,writable:!1})}return Pp(e,t,n)}:Pp:function(e,t,n){if(fl(e),t=GS(t),fl(n),AL)try{return Pp(e,t,n)}catch{}if("get"in n||"set"in n)throw wL("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var LL=gi,kL=mi,ys=Te?function(e,t,n){return LL.f(e,t,kL(1,n))}:function(e,t,n){return e[t]=n,e},ml=j,ML=G,UL=B,xL=ne,VL=Se.f,jL=jS,ua=Ao,FL=kc,ha=ys,WS=rr,BL=function(e){var t=function(n,r,o){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,o)}return ML(e,this,arguments)};return t.prototype=e.prototype,t},Vn=function(e,t){var n,r,o,a,c,l,h,f,p=e.target,E=e.global,T=e.stat,y=e.proto,C=E?ml:T?ml[p]:(ml[p]||{}).prototype,A=E?ua:ua[p]||ha(ua,p,{})[p],O=A.prototype;for(o in t)n=!jL(E?o:p+(T?".":"#")+o,e.forced)&&C&&WS(C,o),c=A[o],n&&(l=e.noTargetGet?(f=VL(C,o))&&f.value:C[o]),a=n&&l?l:t[o],n&&typeof c==typeof a||(h=e.bind&&n?FL(a,ml):e.wrap&&n?BL(a):y&&xL(a)?UL(a):a,(e.sham||a&&a.sham||c&&c.sham)&&ha(h,"sham",!0),ha(A,o,h),y&&(WS(ua,r=p+"Prototype")||ha(ua,r,{}),ha(ua[r],o,a),e.real&&O&&!O[o]&&ha(O,o,a)))},GL=Math.ceil,WL=Math.floor,Lp=function(e){var t=+e;return t!=t||t===0?0:(t>0?WL:GL)(t)},HL=Lp,KL=Math.min,YL=function(e){return e>0?KL(HL(e),9007199254740991):0},wo=function(e){return YL(e.length)},zL=Zi,qL=Oo,JL=_i,XL=wo,QL=j.TypeError,HS=function(e){return function(t,n,r,o){zL(n);var a=qL(t),c=JL(a),l=XL(a),h=e?l-1:0,f=e?-1:1;if(r<2)for(;;){if(h in c){o=c[h],h+=f;break}if(h+=f,e?h<0:l<=h)throw QL("Reduce of empty array with no initial value")}for(;e?h>=0:l>h;h+=f)h in c&&(o=n(o,c[h],h,a));return o}},$L={left:HS(!1),right:HS(!0)},ZL=m,kp=function(e,t){var n=[][e];return!!n&&ZL(function(){n.call(null,t||function(){throw 1},1)})},El=Fe(j.process)=="process",ek=$L.left,KS=la,tk=El;Vn({target:"Array",proto:!0,forced:!kp("reduce")||!tk&&KS>79&&KS<83},{reduce:function(e){var t=arguments.length;return ek(this,e,t,t>1?arguments[1]:void 0)}});var nk=Ao,No=function(e){return nk[e+"Prototype"]},rk=No("Array").reduce,ik=z,ok=rk,Mp=Array.prototype,YS=function(e){var t=e.reduce;return e===Mp||ik(Mp,e)&&t===Mp.reduce?ok:t},bo=YS;let zS=!0,qS=!0;function _l(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function Is(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,o=r.addEventListener;r.addEventListener=function(c,l){if(c!==t)return o.apply(this,arguments);const h=f=>{const p=n(f);p&&(l.handleEvent?l.handleEvent(p):l(p))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(l,h),o.apply(this,[c,h])};const a=r.removeEventListener;r.removeEventListener=function(c,l){if(c!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(l))return a.apply(this,arguments);const h=this._eventMap[t].get(l);return this._eventMap[t].delete(l),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[c,h])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(c){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),c&&this.addEventListener(t,this["_on"+t]=c)},enumerable:!0,configurable:!0})}function sk(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(zS=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function ak(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(qS=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function JS(){if(typeof window=="object"){if(zS)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Up(e,t){qS&&console.warn(e+" is deprecated, please use "+t+" instead.")}function ck(e){const t={browser:null,version:null};if(e===void 0||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=_l(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=_l(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=_l(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function XS(e){return Object.prototype.toString.call(e)==="[object Object]"}function QS(e){var t;return XS(e)?bo(t=Object.keys(e)).call(t,function(n,r){const o=XS(e[r]),a=o?QS(e[r]):e[r],c=o&&!Object.keys(a).length;return a===void 0||c?n:Object.assign(n,{[r]:a})},{}):e}function $S(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",o=new Map;if(t===null)return o;const a=[];return e.forEach(c=>{c.type==="track"&&c.trackIdentifier===t.id&&a.push(c)}),a.forEach(c=>{e.forEach(l=>{l.type===r&&l.trackId===c.id&&function h(f,p,E){p&&!E.has(p.id)&&(E.set(p.id,p),Object.keys(p).forEach(T=>{T.endsWith("Id")?h(f,f.get(p[T]),E):T.endsWith("Ids")&&p[T].forEach(y=>{h(f,f.get(y),E)})}))}(e,l,o)})}),o}var dk=hl.exports,lk=Np,ZS=dk("keys"),gl=function(e){return ZS[e]||(ZS[e]=lk(e))},uk=!m(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),hk=j,pk=rr,fk=ne,mk=Oo,Ek=uk,eT=gl("IE_PROTO"),xp=hk.Object,_k=xp.prototype,Vp=Ek?xp.getPrototypeOf:function(e){var t=mk(e);if(pk(t,eT))return t[eT];var n=t.constructor;return fk(n)&&t instanceof n?n.prototype:t instanceof xp?_k:null},tT=j,gk=ne,Sk=tT.String,Tk=tT.TypeError,vk=B,Rk=Si,yk=function(e){if(typeof e=="object"||gk(e))return e;throw Tk("Can't set "+Sk(e)+" as a prototype")},Ik=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=vk(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch{}return function(r,o){return Rk(r),yk(o),t?e(r,o):r.__proto__=o,r}}():void 0),Sl={},Ck=Lp,Ak=Math.max,Ok=Math.min,jp=function(e,t){var n=Ck(e);return n<0?Ak(n+t,0):Ok(n,t)},wk=Co,Nk=jp,bk=wo,nT=function(e){return function(t,n,r){var o,a=wk(t),c=bk(a),l=Nk(r,c);if(e&&n!=n){for(;c>l;)if((o=a[l++])!=o)return!0}else for(;c>l;l++)if((e||l in a)&&a[l]===n)return e||l||0;return!e&&-1}},Dk={includes:nT(!0),indexOf:nT(!1)},Tl={},Fp=rr,Pk=Co,Lk=Dk.indexOf,kk=Tl,rT=B([].push),iT=function(e,t){var n,r=Pk(e),o=0,a=[];for(n in r)!Fp(kk,n)&&Fp(r,n)&&rT(a,n);for(;t.length>o;)Fp(r,n=t[o++])&&(~Lk(a,n)||rT(a,n));return a},Bp=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Mk=iT,Uk=Bp.concat("length","prototype");Sl.f=Object.getOwnPropertyNames||function(e){return Mk(e,Uk)};var Gp={};Gp.f=Object.getOwnPropertySymbols;var xk=Mi,Vk=Sl,jk=Gp,Fk=Si,Bk=B([].concat),Gk=xk("Reflect","ownKeys")||function(e){var t=Vk.f(Fk(e)),n=jk.f;return n?Bk(t,n(e)):t},oT=rr,Wk=Gk,Hk=Se,Kk=gi,Wp={},Yk=iT,zk=Bp,Hp=Object.keys||function(e){return Yk(e,zk)},qk=Te,Jk=FS,Xk=gi,Qk=Si,$k=Co,Zk=Hp;Wp.f=qk&&!Jk?Object.defineProperties:function(e,t){Qk(e);for(var n,r=$k(t),o=Zk(t),a=o.length,c=0;a>c;)Xk.f(e,n=o[c++],r[n]);return e};var vl,sT=Mi("document","documentElement"),e1=Si,t1=Wp,aT=Bp,n1=Tl,r1=sT,i1=Dp,cT=gl("IE_PROTO"),Kp=function(){},dT=function(e){return"<script>"+e+"<\/script>"},lT=function(e){e.write(dT("")),e.close();var t=e.parentWindow.Object;return e=null,t},Rl=function(){try{vl=new ActiveXObject("htmlfile")}catch{}var e,t;Rl=typeof document<"u"?document.domain&&vl?lT(vl):((t=i1("iframe")).style.display="none",r1.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write(dT("document.F=Object")),e.close(),e.F):lT(vl);for(var n=aT.length;n--;)delete Rl.prototype[aT[n]];return Rl()};n1[cT]=!0;var yl=Object.create||function(e,t){var n;return e!==null?(Kp.prototype=e1(e),n=new Kp,Kp.prototype=null,n[cT]=e):n=Rl(),t===void 0?n:t1.f(n,t)},o1=B("".replace),s1=String(Error("zxcasd").stack),uT=/\n\s*at [^:]*:[^\n]*/,a1=uT.test(s1),c1=Xr,d1=ys,pa={},l1=pa,u1=hn("iterator"),h1=Array.prototype,hT={};hT[hn("toStringTag")]="z";var Yp=String(hT)==="[object z]",p1=j,f1=Yp,m1=ne,Il=Fe,E1=hn("toStringTag"),_1=p1.Object,g1=Il(function(){return arguments}())=="Arguments",Do=f1?Il:function(e){var t,n,r;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(o,a){try{return o[a]}catch{}}(t=_1(e),E1))=="string"?n:g1?Il(t):(r=Il(t))=="Object"&&m1(t.callee)?"Arguments":r},S1=Do,pT=Ip,T1=pa,v1=hn("iterator"),fT=function(e){if(e!=null)return pT(e,v1)||pT(e,"@@iterator")||T1[S1(e)]},R1=lt,y1=Zi,I1=Si,C1=ul,A1=fT,O1=j.TypeError,w1=lt,mT=Si,N1=Ip,b1=kc,D1=lt,P1=Si,L1=ul,k1=function(e){return e!==void 0&&(l1.Array===e||h1[u1]===e)},M1=wo,ET=z,U1=function(e,t){var n=arguments.length<2?A1(e):t;if(y1(n))return I1(R1(n,e));throw O1(C1(e)+" is not iterable")},x1=fT,_T=function(e,t,n){var r,o;mT(e);try{if(!(r=N1(e,"return"))){if(t==="throw")throw n;return n}r=w1(r,e)}catch(a){o=!0,r=a}if(t==="throw")throw n;if(o)throw r;return mT(r),n},V1=j.TypeError,Cl=function(e,t){this.stopped=e,this.result=t},gT=Cl.prototype,Al=function(e,t,n){var r,o,a,c,l,h,f,p=n&&n.that,E=!(!n||!n.AS_ENTRIES),T=!(!n||!n.IS_ITERATOR),y=!(!n||!n.INTERRUPTED),C=b1(t,p),A=function(M){return r&&_T(r,"normal",M),new Cl(!0,M)},O=function(M){return E?(P1(M),y?C(M[0],M[1],A):C(M[0],M[1])):y?C(M,A):C(M)};if(T)r=e;else{if(!(o=x1(e)))throw V1(L1(e)+" is not iterable");if(k1(o)){for(a=0,c=M1(e);c>a;a++)if((l=O(e[a]))&&ET(gT,l))return l;return new Cl(!1)}r=U1(e,o)}for(h=r.next;!(f=D1(h,r)).done;){try{l=O(f.value)}catch(M){_T(r,"throw",M)}if(typeof l=="object"&&l&&ET(gT,l))return l}return new Cl(!1)},j1=Do,F1=j.String,fa=function(e){if(j1(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return F1(e)},B1=fa,G1=mi,W1=!m(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",G1(1,7)),e.stack!==7)}),H1=Vn,K1=j,Y1=z,z1=Vp,Ol=Ik,q1=function(e,t,n){for(var r=Wk(t),o=Kk.f,a=Hk.f,c=0;c<r.length;c++){var l=r[c];oT(e,l)||n&&oT(n,l)||o(e,l,a(t,l))}},ST=yl,wl=ys,zp=mi,J1=function(e,t){if(a1&&typeof e=="string")for(;t--;)e=o1(e,uT,"");return e},X1=function(e,t){c1(t)&&"cause"in t&&d1(e,"cause",t.cause)},Q1=Al,$1=function(e,t){return e===void 0?arguments.length<2?"":t:B1(e)},Z1=W1,eM=hn("toStringTag"),Nl=K1.Error,tM=[].push,Mc=function(e,t){var n,r=arguments.length>2?arguments[2]:void 0,o=Y1(qp,this);Ol?n=Ol(new Nl,o?z1(this):qp):(n=o?this:ST(qp),wl(n,eM,"Error")),t!==void 0&&wl(n,"message",$1(t)),Z1&&wl(n,"stack",J1(n.stack,1)),X1(n,r);var a=[];return Q1(e,tM,{that:a}),wl(n,"errors",a),n};Ol?Ol(Mc,Nl):q1(Mc,Nl,{name:!0});var qp=Mc.prototype=ST(Nl.prototype,{constructor:zp(1,Mc),message:zp(1,""),name:zp(1,"AggregateError")});H1({global:!0},{AggregateError:Mc});var nM=ne,Jp=wp,rM=B(Function.toString);nM(Jp.inspectSource)||(Jp.inspectSource=function(e){return rM(e)});var bl,Uc,Dl,Xp=Jp.inspectSource,iM=ne,oM=Xp,TT=j.WeakMap,sM=iM(TT)&&/native code/.test(oM(TT)),vT=j,Qp=B,aM=Xr,cM=ys,$p=rr,Zp=wp,dM=gl,lM=Tl,RT="Object already initialized",ef=vT.TypeError,uM=vT.WeakMap;if(sM||Zp.state){var Cs=Zp.state||(Zp.state=new uM),hM=Qp(Cs.get),yT=Qp(Cs.has),pM=Qp(Cs.set);bl=function(e,t){if(yT(Cs,e))throw new ef(RT);return t.facade=e,pM(Cs,e,t),t},Uc=function(e){return hM(Cs,e)||{}},Dl=function(e){return yT(Cs,e)}}else{var ma=dM("state");lM[ma]=!0,bl=function(e,t){if($p(e,ma))throw new ef(RT);return t.facade=e,cM(e,ma,t),t},Uc=function(e){return $p(e,ma)?e[ma]:{}},Dl=function(e){return $p(e,ma)}}var As,IT,CT,Pl={set:bl,get:Uc,has:Dl,enforce:function(e){return Dl(e)?Uc(e):bl(e,{})},getterFor:function(e){return function(t){var n;if(!aM(t)||(n=Uc(t)).type!==e)throw ef("Incompatible receiver, "+e+" required");return n}}},tf=Te,fM=rr,AT=Function.prototype,mM=tf&&Object.getOwnPropertyDescriptor,nf=fM(AT,"name"),OT={EXISTS:nf,PROPER:nf&&(function(){}).name==="something",CONFIGURABLE:nf&&(!tf||tf&&mM(AT,"name").configurable)},EM=ys,Ll=function(e,t,n,r){r&&r.enumerable?e[t]=n:EM(e,t,n)},_M=m,gM=ne,SM=yl,wT=Vp,TM=Ll,rf=hn("iterator"),NT=!1;[].keys&&("next"in(CT=[].keys())?(IT=wT(wT(CT)))!==Object.prototype&&(As=IT):NT=!0);var vM=As==null||_M(function(){var e={};return As[rf].call(e)!==e});gM((As=vM?{}:SM(As))[rf])||TM(As,rf,function(){return this});var bT={IteratorPrototype:As,BUGGY_SAFARI_ITERATORS:NT},RM=Do,yM=Yp?{}.toString:function(){return"[object "+RM(this)+"]"},IM=Yp,CM=gi.f,AM=ys,OM=rr,wM=yM,DT=hn("toStringTag"),xc=function(e,t,n,r){if(e){var o=n?e:e.prototype;OM(o,DT)||CM(o,DT,{configurable:!0,value:t}),r&&!IM&&AM(o,"toString",wM)}},NM=bT.IteratorPrototype,bM=yl,DM=mi,PM=xc,LM=pa,kM=function(){return this},MM=Vn,UM=lt,xM=function(e,t,n,r){var o=t+" Iterator";return e.prototype=bM(NM,{next:DM(+!r,n)}),PM(e,o,!1,!0),LM[o]=kM,e},VM=Vp,jM=xc,PT=Ll,LT=pa,FM=OT.PROPER,kl=bT.BUGGY_SAFARI_ITERATORS,of=hn("iterator"),kT="keys",Ml="values",MT="entries",BM=function(){return this},UT=function(e,t,n,r,o,a,c){xM(n,t,r);var l,h,f,p=function(M){if(M===o&&A)return A;if(!kl&&M in y)return y[M];switch(M){case kT:case Ml:case MT:return function(){return new n(this,M)}}return function(){return new n(this)}},E=t+" Iterator",T=!1,y=e.prototype,C=y[of]||y["@@iterator"]||o&&y[o],A=!kl&&C||p(o),O=t=="Array"&&y.entries||C;if(O&&(l=VM(O.call(new e)))!==Object.prototype&&l.next&&(jM(l,E,!0,!0),LT[E]=BM),FM&&o==Ml&&C&&C.name!==Ml&&(T=!0,A=function(){return UM(C,this)}),o)if(h={values:p(Ml),keys:a?A:p(kT),entries:p(MT)},c)for(f in h)(kl||T||!(f in y))&&PT(y,f,h[f]);else MM({target:t,proto:!0,forced:kl||T},h);return c&&y[of]!==A&&PT(y,of,A,{name:o}),LT[t]=A,h},GM=Co,xT=pa,VT=Pl;gi.f;var WM=UT,jT="Array Iterator",HM=VT.set,KM=VT.getterFor(jT);WM(Array,"Array",function(e,t){HM(this,{type:jT,target:GM(e),index:0,kind:t})},function(){var e=KM(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):n=="keys"?{value:r,done:!1}:n=="values"?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values"),xT.Arguments=xT.Array;var FT=j.Promise,YM=Ll,zM=Mi,qM=gi,JM=Te,BT=hn("species"),XM=z,QM=j.TypeError,GT=hn("iterator"),WT=!1;try{var $M=0,HT={next:function(){return{done:!!$M++}},return:function(){WT=!0}};HT[GT]=function(){return this},Array.from(HT,function(){throw 2})}catch{}var ZM=B,eU=m,KT=ne,tU=Do,nU=Xp,YT=function(){},rU=[],zT=Mi("Reflect","construct"),sf=/^\s*(?:class|function)\b/,iU=ZM(sf.exec),oU=!sf.exec(YT),Vc=function(e){if(!KT(e))return!1;try{return zT(YT,rU,e),!0}catch{return!1}},qT=function(e){if(!KT(e))return!1;switch(tU(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return oU||!!iU(sf,nU(e))}catch{return!0}};qT.sham=!0;var jc,Ea,JT,af,cf=!zT||eU(function(){var e;return Vc(Vc.call)||!Vc(Object)||!Vc(function(){e=!0})||e})?qT:Vc,sU=cf,aU=ul,cU=j.TypeError,XT=Si,dU=function(e){if(sU(e))return e;throw cU(aU(e)+" is not a constructor")},lU=hn("species"),QT=function(e,t){var n,r=XT(e).constructor;return r===void 0||(n=XT(r)[lU])==null?t:dU(n)},df=B([].slice),$T=/(?:ipad|iphone|ipod).*applewebkit/i.test(vs),Dr=j,uU=G,hU=kc,ZT=ne,pU=rr,fU=m,ev=sT,mU=df,tv=Dp,EU=$T,_U=El,lf=Dr.setImmediate,uf=Dr.clearImmediate,gU=Dr.process,hf=Dr.Dispatch,SU=Dr.Function,nv=Dr.MessageChannel,TU=Dr.String,pf=0,Fc={},vU="onreadystatechange";try{jc=Dr.location}catch{}var ff=function(e){if(pU(Fc,e)){var t=Fc[e];delete Fc[e],t()}},mf=function(e){return function(){ff(e)}},rv=function(e){ff(e.data)},iv=function(e){Dr.postMessage(TU(e),jc.protocol+"//"+jc.host)};lf&&uf||(lf=function(e){var t=mU(arguments,1);return Fc[++pf]=function(){uU(ZT(e)?e:SU(e),void 0,t)},Ea(pf),pf},uf=function(e){delete Fc[e]},_U?Ea=function(e){gU.nextTick(mf(e))}:hf&&hf.now?Ea=function(e){hf.now(mf(e))}:nv&&!EU?(af=(JT=new nv).port2,JT.port1.onmessage=rv,Ea=hU(af.postMessage,af)):Dr.addEventListener&&ZT(Dr.postMessage)&&!Dr.importScripts&&jc&&jc.protocol!=="file:"&&!fU(iv)?(Ea=iv,Dr.addEventListener("message",rv,!1)):Ea=vU in tv("script")?function(e){ev.appendChild(tv("script")).onreadystatechange=function(){ev.removeChild(this),ff(e)}}:function(e){setTimeout(mf(e),0)});var Bc,Os,Gc,_a,Ef,_f,gf,ov,sv={set:lf,clear:uf},RU=j,yU=/ipad|iphone|ipod/i.test(vs)&&RU.Pebble!==void 0,IU=/web0s(?!.*chrome)/i.test(vs),ws=j,av=kc,CU=Se.f,Sf=sv.set,AU=$T,OU=yU,wU=IU,Tf=El,cv=ws.MutationObserver||ws.WebKitMutationObserver,dv=ws.document,lv=ws.process,Ul=ws.Promise,uv=CU(ws,"queueMicrotask"),hv=uv&&uv.value;hv||(Bc=function(){var e,t;for(Tf&&(e=lv.domain)&&e.exit();Os;){t=Os.fn,Os=Os.next;try{t()}catch(n){throw Os?_a():Gc=void 0,n}}Gc=void 0,e&&e.enter()},AU||Tf||wU||!cv||!dv?!OU&&Ul&&Ul.resolve?((gf=Ul.resolve(void 0)).constructor=Ul,ov=av(gf.then,gf),_a=function(){ov(Bc)}):Tf?_a=function(){lv.nextTick(Bc)}:(Sf=av(Sf,ws),_a=function(){Sf(Bc)}):(Ef=!0,_f=dv.createTextNode(""),new cv(Bc).observe(_f,{characterData:!0}),_a=function(){_f.data=Ef=!Ef}));var NU=hv||function(e){var t={fn:e,next:void 0};Gc&&(Gc.next=t),Os||(Os=t,_a()),Gc=t},ga={},pv=Zi,bU=function(e){var t,n;this.promise=new e(function(r,o){if(t!==void 0||n!==void 0)throw TypeError("Bad Promise constructor");t=r,n=o}),this.resolve=pv(t),this.reject=pv(n)};ga.f=function(e){return new bU(e)};var DU=Si,PU=Xr,LU=ga,fv=function(e,t){if(DU(e),PU(t)&&t.constructor===e)return t;var n=LU.f(e);return(0,n.resolve)(t),n.promise},kU=j,xl=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},mv=function(){this.head=null,this.tail=null};mv.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var vf,Ev,Rf,MU=typeof window=="object",Vl=Vn,eo=j,UU=Mi,Po=lt,yf=FT,xU=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:YM(e,r,t[r],n);return e},VU=xc,jU=function(e){var t=zM(e),n=qM.f;JM&&t&&!t[BT]&&n(t,BT,{configurable:!0,get:function(){return this}})},If=Zi,jl=ne,FU=Xr,BU=function(e,t){if(XM(t,e))return e;throw QM("Incorrect invocation")},GU=Xp,_v=Al,WU=function(e,t){if(!t&&!WT)return!1;var n=!1;try{var r={};r[GT]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch{}return n},HU=QT,gv=sv.set,Cf=NU,KU=fv,YU=function(e,t){var n=kU.console;n&&n.error&&(arguments.length==1?n.error(e):n.error(e,t))},Sv=ga,Af=xl,zU=mv,Of=Pl,qU=jS,JU=MU,Fl=El,Tv=la,XU=hn("species"),Ui="Promise",vv=Of.getterFor(Ui),QU=Of.set,$U=Of.getterFor(Ui),ZU=yf&&yf.prototype,xi=yf,Bl=ZU,Rv=eo.TypeError,wf=eo.document,Nf=eo.process,Sa=Sv.f,ex=Sa,tx=!!(wf&&wf.createEvent&&eo.dispatchEvent),yv=jl(eo.PromiseRejectionEvent),Iv="unhandledrejection",Gl=qU(Ui,function(){var e=GU(xi),t=e!==String(xi);if(!t&&Tv===66||!Bl.finally)return!0;if(Tv>=51&&/native code/.test(e))return!1;var n=new xi(function(o){o(1)}),r=function(o){o(function(){},function(){})};return(n.constructor={})[XU]=r,!(n.then(function(){})instanceof r)||!t&&JU&&!yv}),nx=Gl||!WU(function(e){xi.all(e).catch(function(){})}),Cv=function(e){var t;return!(!FU(e)||!jl(t=e.then))&&t},Av=function(e,t){var n,r,o,a=t.value,c=t.state==1,l=c?e.ok:e.fail,h=e.resolve,f=e.reject,p=e.domain;try{l?(c||(t.rejection===2&&ix(t),t.rejection=1),l===!0?n=a:(p&&p.enter(),n=l(a),p&&(p.exit(),o=!0)),n===e.promise?f(Rv("Promise-chain cycle")):(r=Cv(n))?Po(r,n,h,f):h(n)):f(a)}catch(E){p&&!o&&p.exit(),f(E)}},Ov=function(e,t){e.notified||(e.notified=!0,Cf(function(){for(var n,r=e.reactions;n=r.get();)Av(n,e);e.notified=!1,t&&!e.rejection&&rx(e)}))},wv=function(e,t,n){var r,o;tx?((r=wf.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),eo.dispatchEvent(r)):r={promise:t,reason:n},!yv&&(o=eo["on"+e])?o(r):e===Iv&&YU("Unhandled promise rejection",n)},rx=function(e){Po(gv,eo,function(){var t,n=e.facade,r=e.value;if(Nv(e)&&(t=Af(function(){Fl?Nf.emit("unhandledRejection",r,n):wv(Iv,n,r)}),e.rejection=Fl||Nv(e)?2:1,t.error))throw t.value})},Nv=function(e){return e.rejection!==1&&!e.parent},ix=function(e){Po(gv,eo,function(){var t=e.facade;Fl?Nf.emit("rejectionHandled",t):wv("rejectionhandled",t,e.value)})},Ta=function(e,t,n){return function(r){e(t,r,n)}},va=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,Ov(e,!0))},bf=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw Rv("Promise can't be resolved itself");var r=Cv(t);r?Cf(function(){var o={done:!1};try{Po(r,t,Ta(bf,o,e),Ta(va,o,e))}catch(a){va(o,a,e)}}):(e.value=t,e.state=1,Ov(e,!1))}catch(o){va({done:!1},o,e)}}};Gl&&(Bl=(xi=function(e){BU(this,Bl),If(e),Po(vf,this);var t=vv(this);try{e(Ta(bf,t),Ta(va,t))}catch(n){va(t,n)}}).prototype,(vf=function(e){QU(this,{type:Ui,done:!1,notified:!1,parent:!1,reactions:new zU,rejection:!1,state:0,value:void 0})}).prototype=xU(Bl,{then:function(e,t){var n=$U(this),r=Sa(HU(this,xi));return n.parent=!0,r.ok=!jl(e)||e,r.fail=jl(t)&&t,r.domain=Fl?Nf.domain:void 0,n.state==0?n.reactions.add(r):Cf(function(){Av(r,n)}),r.promise},catch:function(e){return this.then(void 0,e)}}),Ev=function(){var e=new vf,t=vv(e);this.promise=e,this.resolve=Ta(bf,t),this.reject=Ta(va,t)},Sv.f=Sa=function(e){return e===xi||e===Rf?new Ev(e):ex(e)}),Vl({global:!0,wrap:!0,forced:Gl},{Promise:xi}),VU(xi,Ui,!1,!0),jU(Ui),Rf=UU(Ui),Vl({target:Ui,stat:!0,forced:Gl},{reject:function(e){var t=Sa(this);return Po(t.reject,void 0,e),t.promise}}),Vl({target:Ui,stat:!0,forced:!0},{resolve:function(e){return KU(this===Rf?xi:this,e)}}),Vl({target:Ui,stat:!0,forced:nx},{all:function(e){var t=this,n=Sa(t),r=n.resolve,o=n.reject,a=Af(function(){var c=If(t.resolve),l=[],h=0,f=1;_v(e,function(p){var E=h++,T=!1;f++,Po(c,t,p).then(function(y){T||(T=!0,l[E]=y,--f||r(l))},o)}),--f||r(l)});return a.error&&o(a.value),n.promise},race:function(e){var t=this,n=Sa(t),r=n.reject,o=Af(function(){var a=If(t.resolve);_v(e,function(c){Po(a,t,c).then(n.resolve,r)})});return o.error&&r(o.value),n.promise}});var ox=lt,sx=Zi,ax=ga,cx=xl,dx=Al;Vn({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=ax.f(t),r=n.resolve,o=n.reject,a=cx(function(){var c=sx(t.resolve),l=[],h=0,f=1;dx(e,function(p){var E=h++,T=!1;f++,ox(c,t,p).then(function(y){T||(T=!0,l[E]={status:"fulfilled",value:y},--f||r(l))},function(y){T||(T=!0,l[E]={status:"rejected",reason:y},--f||r(l))})}),--f||r(l)});return a.error&&o(a.value),n.promise}});var lx=Zi,ux=Mi,hx=lt,px=ga,fx=xl,mx=Al,bv="No one promise resolved";Vn({target:"Promise",stat:!0},{any:function(e){var t=this,n=ux("AggregateError"),r=px.f(t),o=r.resolve,a=r.reject,c=fx(function(){var l=lx(t.resolve),h=[],f=0,p=1,E=!1;mx(e,function(T){var y=f++,C=!1;p++,hx(l,t,T).then(function(A){C||E||(E=!0,o(A))},function(A){C||E||(C=!0,h[y]=A,--p||a(new n(h,bv)))})}),--p||a(new n(h,bv))});return c.error&&a(c.value),r.promise}});var Dv=FT,Ex=Mi,_x=ne,gx=QT,Pv=fv;Vn({target:"Promise",proto:!0,real:!0,forced:!!Dv&&m(function(){Dv.prototype.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=gx(this,Ex("Promise")),n=_x(e);return this.then(n?function(r){return Pv(t,e()).then(function(){return r})}:e,n?function(r){return Pv(t,e()).then(function(){throw r})}:e)}});var Df=B,Sx=Lp,Tx=fa,vx=ll,Rx=Df("".charAt),Lv=Df("".charCodeAt),yx=Df("".slice),kv=function(e){return function(t,n){var r,o,a=Tx(vx(t)),c=Sx(n),l=a.length;return c<0||c>=l?e?"":void 0:(r=Lv(a,c))<55296||r>56319||c+1===l||(o=Lv(a,c+1))<56320||o>57343?e?Rx(a,c):r:e?yx(a,c,c+2):o-56320+(r-55296<<10)+65536}},Ix={codeAt:kv(!1),charAt:kv(!0)}.charAt,Cx=fa,Mv=Pl,Ax=UT,Uv="String Iterator",Ox=Mv.set,wx=Mv.getterFor(Uv);Ax(String,"String",function(e){Ox(this,{type:Uv,string:Cx(e),index:0})},function(){var e,t=wx(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=Ix(n,r),t.index+=e.length,{value:e,done:!1})});var Nx=Ao.Promise,bx={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Dx=j,Px=Do,Lx=ys,xv=pa,Vv=hn("toStringTag");for(var Pf in bx){var jv=Dx[Pf],Lf=jv&&jv.prototype;Lf&&Px(Lf)!==Vv&&Lx(Lf,Vv,Pf),xv[Pf]=xv.Array}var Fv=Nx,se=Fv;const Bv=JS;function Gv(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const l={};return Object.keys(c).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;const f=typeof c[h]=="object"?c[h]:{ideal:c[h]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);const p=function(E,T){return E?E+T.charAt(0).toUpperCase()+T.slice(1):T==="deviceId"?"sourceId":T};if(f.ideal!==void 0){l.optional=l.optional||[];let E={};typeof f.ideal=="number"?(E[p("min",h)]=f.ideal,l.optional.push(E),E={},E[p("max",h)]=f.ideal,l.optional.push(E)):(E[p("",h)]=f.ideal,l.optional.push(E))}f.exact!==void 0&&typeof f.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[p("",h)]=f.exact):["min","max"].forEach(E=>{f[E]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[p(E,h)]=f[E])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},o=function(c,l){if(t.version>=61)return l(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){const h=function(f,p,E){p in f&&!(E in f)&&(f[E]=f[p],delete f[p])};h((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),h(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=r(c.audio)}if(c&&typeof c.video=="object"){let h=c.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});const f=t.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||f)){let p;if(delete c.video.facingMode,h.exact==="environment"||h.ideal==="environment"?p=["back","rear"]:h.exact!=="user"&&h.ideal!=="user"||(p=["front"]),p)return n.mediaDevices.enumerateDevices().then(E=>{let T=(E=E.filter(y=>y.kind==="videoinput")).find(y=>p.some(C=>y.label.toLowerCase().includes(C)));return!T&&E.length&&p.includes("back")&&(T=E[E.length-1]),T&&(c.video.deviceId=h.exact?{exact:T.deviceId}:{ideal:T.deviceId}),c.video=r(c.video),Bv("chrome: "+JSON.stringify(c)),l(c)})}c.video=r(c.video)}return Bv("chrome: "+JSON.stringify(c)),l(c)},a=function(c){return t.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(c,l,h){o(c,f=>{n.webkitGetUserMedia(f,l,p=>{h&&h(a(p))})})}).bind(n),n.mediaDevices.getUserMedia){const c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return o(l,h=>c(h).then(f=>{if(h.audio&&!f.getAudioTracks().length||h.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return f},f=>se.reject(a(f))))}}}function Wv(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Hv(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===r.track.id):{track:r.track};const a=new Event("track");a.track=r.track,a.receiver=o,a.transceiver={receiver:o},a.streams=[n.stream],this.dispatchEvent(a)}),n.stream.getTracks().forEach(r=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===r.id):{track:r};const a=new Event("track");a.track=r,a.receiver=o,a.transceiver={receiver:o},a.streams=[n.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Is(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Kv(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(o,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=o.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:o}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,l){let h=o.apply(this,arguments);return h||(h=t(this,c),this._senders.push(h)),h};const a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){a.apply(this,arguments);const l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(a=>{this._senders.push(t(this,a))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],r.apply(this,[o]),o.getTracks().forEach(a=>{const c=this._senders.find(l=>l.track===a);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Yv(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,r,o]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const a=function(l){const h={};return l.result().forEach(f=>{const p={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(E=>{p[E]=f.stat(E)}),h[p.id]=p}),h},c=function(l){return new Map(Object.keys(l).map(h=>[h,l[h]]))};if(arguments.length>=2){const l=function(h){r(c(a(h)))};return t.apply(this,[l,n])}return new se((l,h)=>{t.apply(this,[function(f){l(c(a(f)))},h])}).then(r,o)}}function zv(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(a=>a._pc=this),o});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=r.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(a=>$S(a,o.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(o=>o._pc=this),r}),Is(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>$S(o,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let r,o,a;return this.getSenders().forEach(c=>{c.track===n&&(r?a=!0:r=c)}),this.getReceivers().forEach(c=>(c.track===n&&(o?a=!0:o=c),c.track===n)),a||r&&o?se.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():o?o.getStats():se.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function qv(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=t.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(h=>{if(this.getSenders().find(f=>f.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(h=>c.indexOf(h)===-1);this._shimmedLocalStreams[a.id]=[a].concat(l)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],r.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const l=this._shimmedLocalStreams[c].indexOf(a);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),o.apply(this,arguments)}}function Jv(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return qv(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const f=n.apply(this);return this._reverseStreams=this._reverseStreams||{},f.map(p=>this._reverseStreams[p.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(f){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},f.getTracks().forEach(p=>{if(this.getSenders().find(E=>E.track===p))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[f.id]){const p=new e.MediaStream(f.getTracks());this._streams[f.id]=p,this._reverseStreams[p.id]=f,f=p}r.apply(this,[f])};const o=e.RTCPeerConnection.prototype.removeStream;function a(f,p){let E=p.sdp;return Object.keys(f._reverseStreams||[]).forEach(T=>{const y=f._reverseStreams[T],C=f._streams[y.id];E=E.replace(new RegExp(C.id,"g"),y.id)}),new RTCSessionDescription({type:p.type,sdp:E})}function c(f,p){let E=p.sdp;return Object.keys(f._reverseStreams||[]).forEach(T=>{const y=f._reverseStreams[T],C=f._streams[y.id];E=E.replace(new RegExp(y.id,"g"),C.id)}),new RTCSessionDescription({type:p.type,sdp:E})}e.RTCPeerConnection.prototype.removeStream=function(f){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[f.id]||f]),delete this._reverseStreams[this._streams[f.id]?this._streams[f.id].id:f.id],delete this._streams[f.id]},e.RTCPeerConnection.prototype.addTrack=function(f,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const E=[].slice.call(arguments,1);if(E.length!==1||!E[0].getTracks().find(C=>C===f))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(C=>C.track===f))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const y=this._streams[p.id];if(y)y.addTrack(f),se.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const C=new e.MediaStream([f]);this._streams[p.id]=C,this._reverseStreams[C.id]=p,this.addStream(C)}return this.getSenders().find(C=>C.track===f)},["createOffer","createAnswer"].forEach(function(f){const p=e.RTCPeerConnection.prototype[f],E={[f](){const T=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[y=>{const C=a(this,y);T[0].apply(null,[C])},y=>{T[1]&&T[1].apply(null,y)},arguments[2]]):p.apply(this,arguments).then(y=>a(this,y))}};e.RTCPeerConnection.prototype[f]=E[f]});const l=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=c(this,arguments[0]),l.apply(this,arguments)):l.apply(this,arguments)};const h=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const f=h.get.apply(this);return f.type===""?f:a(this,f)}}),e.RTCPeerConnection.prototype.removeTrack=function(f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!f._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(f._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let p;this._streams=this._streams||{},Object.keys(this._streams).forEach(E=>{this._streams[E].getTracks().find(T=>f.track===T)&&(p=this._streams[E])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(f.track),this.dispatchEvent(new Event("negotiationneeded")))}}function kf(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=e.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=o[n]})}function Xv(e,t){Is(e,"negotiationneeded",n=>{const r=n.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n})}var Qv=Object.freeze({__proto__:null,shimMediaStream:Wv,shimOnTrack:Hv,shimGetSendersWithDtmf:Kv,shimGetStats:Yv,shimSenderReceiverGetStats:zv,shimAddTrackRemoveTrackWithNative:qv,shimAddTrackRemoveTrack:Jv,shimPeerConnection:kf,fixNegotiationNeeded:Xv,shimGetUserMedia:Gv,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(r=>{const o=n.video&&n.video.width,a=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:c||3}},o&&(n.video.mandatory.maxWidth=o),a&&(n.video.mandatory.maxHeight=a),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function $v(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(o,a,c){Up("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(o).then(a,c)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const o=function(c,l,h){l in c&&!(h in c)&&(c[h]=c[l],delete c[l])},a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),o(c.audio,"autoGainControl","mozAutoGainControl"),o(c.audio,"noiseSuppression","mozNoiseSuppression")),a(c)},r&&r.prototype.getSettings){const c=r.prototype.getSettings;r.prototype.getSettings=function(){const l=c.apply(this,arguments);return o(l,"mozAutoGainControl","autoGainControl"),o(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){const c=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),o(l,"autoGainControl","mozAutoGainControl"),o(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function Zv(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Mf(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const a=e.RTCPeerConnection.prototype[o],c={[o](){return arguments[0]=new(o==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};e.RTCPeerConnection.prototype[o]=c[o]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[o,a,c]=arguments;return r.apply(this,[o||null]).then(l=>{if(t.version<53&&!a)try{l.forEach(h=>{h.type=n[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;l.forEach((f,p)=>{l.set(p,Object.assign({},f,{type:n[f.type]||f.type}))})}return l}).then(a,c)}}function eR(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(o=>o._pc=this),r});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):se.resolve(new Map)}}function tR(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n}),Is(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function nR(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){Up("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&t.getTracks().includes(n.track)&&this.removeTrack(n)})})}function rR(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function iR(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=t.apply(this,arguments);if(r){const{sender:a}=o,c=a.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n,a.sendEncodings=n,this.setParametersPromises.push(a.setParameters(c).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return o})}function oR(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function sR(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?se.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function aR(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?se.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var cR=Object.freeze({__proto__:null,shimOnTrack:Zv,shimPeerConnection:Mf,shimSenderGetStats:eR,shimReceiverGetStats:tR,shimRemoveStream:nR,shimRTCDataChannel:rR,shimAddTransceiver:iR,shimGetParameters:oR,shimCreateOffer:sR,shimCreateAnswer:aR,shimGetUserMedia:$v,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,se.reject(r)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}});function dR(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>t.call(this,r,n)),n.getVideoTracks().forEach(r=>t.call(this,r,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return o&&o.forEach(c=>{this._localStreams?this._localStreams.includes(c)||this._localStreams.push(c):this._localStreams=[c]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const r=t.getTracks();this.getSenders().forEach(o=>{r.includes(o.track)&&this.removeTrack(o)})})}}function lR(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(o=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(o))return;this._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,this.dispatchEvent(a)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(o=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(o)>=0)return;n._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,n.dispatchEvent(a)})}),t.apply(n,arguments)}}}function uR(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,o=t.setLocalDescription,a=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(h,f){const p=arguments.length>=2?arguments[2]:arguments[0],E=n.apply(this,[p]);return f?(E.then(h,f),se.resolve()):E},t.createAnswer=function(h,f){const p=arguments.length>=2?arguments[2]:arguments[0],E=r.apply(this,[p]);return f?(E.then(h,f),se.resolve()):E};let l=function(h,f,p){const E=o.apply(this,[h]);return p?(E.then(f,p),se.resolve()):E};t.setLocalDescription=l,l=function(h,f,p){const E=a.apply(this,[h]);return p?(E.then(f,p),se.resolve()):E},t.setRemoteDescription=l,l=function(h,f,p){const E=c.apply(this,[h]);return p?(E.then(f,p),se.resolve()):E},t.addIceCandidate=l}function hR(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=o=>r(pR(o))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,r,o){t.mediaDevices.getUserMedia(n).then(r,o)}).bind(t))}function pR(e){return e&&e.video!==void 0?Object.assign({},e,{video:QS(e.video)}):e}function fR(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const o=[];for(let a=0;a<n.iceServers.length;a++){let c=n.iceServers[a];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(Up("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,o.push(c)):o.push(n.iceServers[a])}n.iceServers=o}return new t(n,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function mR(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ER(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const o=this.getTransceivers().find(a=>a.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):n.offerToReceiveVideo!==!0||o||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function _R(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var gR=Object.freeze({__proto__:null,shimLocalStreamsAPI:dR,shimRemoteStreamsAPI:lR,shimCallbacksAPI:uR,shimGetUserMedia:hR,shimConstraints:pR,shimRTCIceServerUrls:fR,shimTrackEventTransceiver:mR,shimCreateOfferLegacy:ER,shimAudioContext:_R}),kx=`	
\v\f\r \u2028\u2029\uFEFF`,Mx=ll,Ux=fa,SR=B("".replace),Wl=`[	
\v\f\r \u2028\u2029\uFEFF]`,xx=RegExp("^"+Wl+Wl+"*"),Vx=RegExp(Wl+Wl+"*$"),Uf=function(e){return function(t){var n=Ux(Mx(t));return 1&e&&(n=SR(n,xx,"")),2&e&&(n=SR(n,Vx,"")),n}},jx={start:Uf(1),end:Uf(2),trim:Uf(3)},Fx=OT.PROPER,Bx=m,TR=kx,Gx=jx.trim;Vn({target:"String",proto:!0,forced:function(e){return Bx(function(){return!!TR[e]()||""[e]()!==""||Fx&&TR[e].name!==e})}("trim")},{trim:function(){return Gx(this)}});var Wx=No("String").trim,Hx=z,Kx=Wx,xf=String.prototype,to=function(e){var t=e.trim;return typeof e=="string"||e===xf||Hx(xf,e)&&t===xf.trim?Kx:t},Vf={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return to(n).call(n).split(`
`).map(r=>to(r).call(r))},t.splitSections=function(n){return n.split(`
m=`).map((r,o)=>{var a;return to(a=o>0?"m="+r:r).call(a)+`\r
`})},t.getDescription=function(n){const r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){const r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(o=>o.indexOf(r)===0)},t.parseCandidate=function(n){let r;r=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const o={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let a=8;a<r.length;a+=2)switch(r[a]){case"raddr":o.relatedAddress=r[a+1];break;case"rport":o.relatedPort=parseInt(r[a+1],10);break;case"tcptype":o.tcpType=r[a+1];break;case"ufrag":o.ufrag=r[a+1],o.usernameFragment=r[a+1];break;default:o[r[a]]===void 0&&(o[r[a]]=r[a+1])}return o},t.writeCandidate=function(n){const r=[];r.push(n.foundation);const o=n.component;o==="rtp"?r.push(1):o==="rtcp"?r.push(2):r.push(o),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const a=n.type;return r.push("typ"),r.push(a),a!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substr(14).split(" ")},t.parseRtpMap=function(n){let r=n.substr(9).split(" ");const o={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),o.name=r[0],o.clockRate=parseInt(r[1],10),o.channels=r.length===3?parseInt(r[2],10):1,o.numChannels=o.channels,o},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const o=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(o!==1?"/"+o:"")+`\r
`},t.parseExtmap=function(n){const r=n.substr(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1]}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+`\r
`},t.parseFmtp=function(n){const r={};let o;const a=n.substr(n.indexOf(" ")+1).split(";");for(let h=0;h<a.length;h++){var c,l;o=to(c=a[h]).call(c).split("="),r[to(l=o[0]).call(l)]=o[1]}return r},t.writeFmtp=function(n){let r="",o=n.payloadType;if(n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const a=[];Object.keys(n.parameters).forEach(c=>{n.parameters[c]!==void 0?a.push(c+"="+n.parameters[c]):a.push(c)}),r+="a=fmtp:"+o+" "+a.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){const r=n.substr(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",o=n.payloadType;return n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(a=>{r+="a=rtcp-fb:"+o+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){const r=n.indexOf(" "),o={ssrc:parseInt(n.substr(7,r-7),10)},a=n.indexOf(":",r);return a>-1?(o.attribute=n.substr(r+1,a-r-1),o.value=n.substr(a+1)):o.attribute=n.substr(r+1),o},t.parseSsrcGroup=function(n){const r=n.substr(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(o=>parseInt(o,10))}},t.getMid=function(n){const r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substr(6)},t.parseFingerprint=function(n){const r=n.substr(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let o="a=setup:"+r+`\r
`;return n.fingerprints.forEach(a=>{o+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),o},t.parseCryptoLine=function(n){const r=n.substr(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substr(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){const o=t.matchPrefix(n+r,"a=ice-ufrag:")[0],a=t.matchPrefix(n+r,"a=ice-pwd:")[0];return o&&a?{usernameFragment:o.substr(12),password:a.substr(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=t.splitLines(n)[0].split(" ");for(let a=3;a<o.length;a++){const c=o[a],l=t.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const h=t.parseRtpMap(l),f=t.matchPrefix(n,"a=fmtp:"+c+" ");switch(h.parameters=f.length?t.parseFmtp(f[0]):{},h.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(t.parseRtcpFb),r.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(h.name.toUpperCase())}}}return t.matchPrefix(n,"a=extmap:").forEach(a=>{r.headerExtensions.push(t.parseExtmap(a))}),r},t.writeRtpDescription=function(n,r){let o="";o+="m="+n+" ",o+=r.codecs.length>0?"9":"0",o+=" UDP/TLS/RTP/SAVPF ",o+=r.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(c=>{o+=t.writeRtpMap(c),o+=t.writeFmtp(c),o+=t.writeRtcpFb(c)});let a=0;return r.codecs.forEach(c=>{c.maxptime>a&&(a=c.maxptime)}),a>0&&(o+="a=maxptime:"+a+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(c=>{o+=t.writeExtmap(c)}),o},t.parseRtpEncodingParameters=function(n){const r=[],o=t.parseRtpParameters(n),a=o.fecMechanisms.indexOf("RED")!==-1,c=o.fecMechanisms.indexOf("ULPFEC")!==-1,l=t.matchPrefix(n,"a=ssrc:").map(T=>t.parseSsrcMedia(T)).filter(T=>T.attribute==="cname"),h=l.length>0&&l[0].ssrc;let f;const p=t.matchPrefix(n,"a=ssrc-group:FID").map(T=>T.substr(17).split(" ").map(y=>parseInt(y,10)));p.length>0&&p[0].length>1&&p[0][0]===h&&(f=p[0][1]),o.codecs.forEach(T=>{if(T.name.toUpperCase()==="RTX"&&T.parameters.apt){let y={ssrc:h,codecPayloadType:parseInt(T.parameters.apt,10)};h&&f&&(y.rtx={ssrc:f}),r.push(y),a&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:h,mechanism:c?"red+ulpfec":"red"},r.push(y))}}),r.length===0&&h&&r.push({ssrc:h});let E=t.matchPrefix(n,"b=");return E.length&&(E=E[0].indexOf("b=TIAS:")===0?parseInt(E[0].substr(7),10):E[0].indexOf("b=AS:")===0?1e3*parseInt(E[0].substr(5),10)*.95-16e3:void 0,r.forEach(T=>{T.maxBitrate=E})),r},t.parseRtcpParameters=function(n){const r={},o=t.matchPrefix(n,"a=ssrc:").map(l=>t.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];o&&(r.cname=o.value,r.ssrc=o.ssrc);const a=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=a.length>0,r.compound=a.length===0;const c=t.matchPrefix(n,"a=rtcp-mux");return r.mux=c.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r;const o=t.matchPrefix(n,"a=msid:");if(o.length===1)return r=o[0].substr(7).split(" "),{stream:r[0],track:r[1]};const a=t.matchPrefix(n,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return a.length>0?(r=a[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(n){const r=t.parseMLine(n),o=t.matchPrefix(n,"a=max-message-size:");let a;o.length>0&&(a=parseInt(o[0].substr(19),10)),isNaN(a)&&(a=65536);const c=t.matchPrefix(n,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substr(12),10),protocol:r.fmt,maxMessageSize:a};const l=t.matchPrefix(n,"a=sctpmap:");if(l.length>0){const h=l[0].substr(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:a}}},t.writeSctpDescription=function(n,r){let o=[];return o=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&o.push("a=max-message-size:"+r.maxMessageSize+`\r
`),o.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(n,r,o){let a;const c=r!==void 0?r:2;return a=n||t.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+a+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){const o=t.splitLines(n);for(let a=0;a<o.length;a++)switch(o[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[a].substr(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substr(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const r=t.splitLines(n)[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(n){const r=t.matchPrefix(n,"o=")[0].substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=t.splitLines(n);for(let o=0;o<r.length;o++)if(r[o].length<2||r[o].charAt(1)!=="=")return!1;return!0},e.exports=t})(Vf);var Ra=Vf.exports,Yx=Object.freeze(d({__proto__:null,default:Ra},[Vf.exports]));function Hl(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const r=new t(n),o=Ra.parseCandidate(n.candidate),a=Object.assign(r,o);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,Is(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function jf(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Is(e,"icecandidate",t=>{if(t.candidate){const n=Ra.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function Kl(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const h=Ra.splitSections(l.sdp);return h.shift(),h.some(f=>{const p=Ra.parseMLine(f);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},r=function(l){const h=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(h===null||h.length<2)return-1;const f=parseInt(h[1],10);return f!=f?-1:f},o=function(l){let h=65536;return t.browser==="firefox"&&(h=t.version<57?l===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),h},a=function(l,h){let f=65536;t.browser==="firefox"&&t.version===57&&(f=65535);const p=Ra.matchPrefix(l.sdp,"a=max-message-size:");return p.length>0?f=parseInt(p[0].substr(19),10):t.browser==="firefox"&&h!==-1&&(f=2147483637),f},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=r(arguments[0]),h=o(l),f=a(arguments[0],l);let p;p=h===0&&f===0?Number.POSITIVE_INFINITY:h===0||f===0?Math.max(h,f):Math.min(h,f);const E={};Object.defineProperty(E,"maxMessageSize",{get:()=>p}),this._sctp=E}return c.apply(this,arguments)}}function Yl(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,o){const a=r.send;r.send=function(){const c=arguments[0],l=c.length||c.size||c.byteLength;if(r.readyState==="open"&&o.sctp&&l>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return a.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return t(r,this),r},Is(e,"datachannel",r=>(t(r.channel,r.target),r))}function Ff(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const a=o.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;const c=new Event("connectionstatechange",o);a.dispatchEvent(c)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Bf(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=r.sdp.split(`
`).filter(a=>to(a).call(a)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:o}):r.sdp=o}return n.apply(this,arguments)}}function zl(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?se.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),se.resolve())})}function ql(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}var zx=Object.freeze({__proto__:null,shimRTCIceCandidate:Hl,shimRTCIceCandidateRelayProtocol:jf,shimMaxMessageSize:Kl,shimSendThrowTypeError:Yl,shimConnectionState:Ff,removeExtmapAllowMixed:Bf,shimAddIceCandidateNullOrEmpty:zl,shimParameterlessSetLocalDescription:ql});let pn,Xe;(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=JS,r=ck(e),o={browserDetails:r,commonShim:zx,extractVersion:_l,disableLog:sk,disableWarnings:ak,sdp:Yx};switch(r.browser){case"chrome":if(!Qv||!kf||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=Qv,zl(e,r),ql(e),Gv(e,r),Wv(e),kf(e,r),Hv(e),Jv(e,r),Kv(e),Yv(e),zv(e),Xv(e,r),Hl(e),jf(e),Ff(e),Kl(e,r),Yl(e),Bf(e,r);break;case"firefox":if(!cR||!Mf||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=cR,zl(e,r),ql(e),$v(e,r),Mf(e,r),Zv(e),nR(e),eR(e),tR(e),rR(e),iR(e),oR(e),sR(e),aR(e),Hl(e),Ff(e),Kl(e,r),Yl(e);break;case"safari":if(!gR||!t.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=gR,zl(e,r),ql(e),fR(e),ER(e),uR(e),dR(e),lR(e),mR(e),hR(e),_R(e),Hl(e),jf(e),Kl(e,r),Yl(e),Bf(e,r);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),function(e){e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot"}(pn||(pn={})),function(e){e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger"}(Xe||(Xe={}));var Gf={exports:{}};(function(e,t){(function(n,r){var o="function",a="undefined",c="object",l="string",h="major",f="model",p="name",E="type",T="vendor",y="version",C="architecture",A="console",O="mobile",M="tablet",U="smarttv",q="wearable",ae="embedded",X="Amazon",Q="Apple",Y="ASUS",Z="BlackBerry",Ge="Firefox",pe="Google",st="Huawei",$e="LG",Nt="Microsoft",cn="Motorola",Ct="Opera",Qn="Samsung",F="Sharp",J="Sony",re="Xiaomi",ge="Zebra",Ve="Facebook",$="Chromium OS",S="Mac OS",w=function(Rt){for(var Vt={},rt=0;rt<Rt.length;rt++)Vt[Rt[rt].toUpperCase()]=Rt[rt];return Vt},D=function(Rt,Vt){return typeof Rt===l&&W(Vt).indexOf(W(Rt))!==-1},W=function(Rt){return Rt.toLowerCase()},Re=function(Rt,Vt){if(typeof Rt===l)return Rt=Rt.replace(/^\s\s*/,""),typeof Vt===a?Rt:Rt.substring(0,350)},at=function(Rt,Vt){for(var rt,Gn,Ki,yt,xe,$n,$o=0;$o<Vt.length&&!xe;){var Oi=Vt[$o],_0=Vt[$o+1];for(rt=Gn=0;rt<Oi.length&&!xe&&Oi[rt];)if(xe=Oi[rt++].exec(Rt))for(Ki=0;Ki<_0.length;Ki++)$n=xe[++Gn],typeof(yt=_0[Ki])===c&&yt.length>0?yt.length===2?typeof yt[1]==o?this[yt[0]]=yt[1].call(this,$n):this[yt[0]]=yt[1]:yt.length===3?typeof yt[1]!==o||yt[1].exec&&yt[1].test?this[yt[0]]=$n?$n.replace(yt[1],yt[2]):r:this[yt[0]]=$n?yt[1].call(this,$n,yt[2]):r:yt.length===4&&(this[yt[0]]=$n?yt[3].call(this,$n.replace(yt[1],yt[2])):r):this[yt]=$n||r;$o+=2}},dn=function(Rt,Vt){for(var rt in Vt)if(typeof Vt[rt]===c&&Vt[rt].length>0){for(var Gn=0;Gn<Vt[rt].length;Gn++)if(D(Vt[rt][Gn],Rt))return rt==="?"?r:rt}else if(D(Vt[rt],Rt))return rt==="?"?r:rt;return Rt},si={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Xo={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,y],[/opios[\/ ]+([\w\.]+)/i],[y,[p,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[y,[p,Ct]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[p,y],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[p,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[y,[p,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[y,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[p,"IE"]],[/yabrowser\/([\w\.]+)/i],[y,[p,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure Browser"],y],[/\bfocus\/([\w\.]+)/i],[y,[p,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[y,[p,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[p,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[p,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[y,[p,Ge]],[/\bqihu|(qi?ho?o?|360)browser/i],[[p,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1 Browser"],y],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[p,y],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,Ve],y],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[p,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[p,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[p,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,"Chrome WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[p,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,y],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[y,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[y,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[y,dn,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[p,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[p,y],[/(cobalt)\/([\w\.]+)/i],[p,[y,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[C,"amd64"]],[/(ia32(?=;))/i],[[C,W]],[/((?:i[346]|x)86)[;\)]/i],[[C,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[C,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[C,"armhf"]],[/windows (ce|mobile); ppc;/i],[[C,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[C,/ower/,"",W]],[/(sun4\w)[;\)]/i],[[C,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[C,W]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[f,[T,Qn],[E,M]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[f,[T,Qn],[E,O]],[/\((ip(?:hone|od)[\w ]*);/i],[f,[T,Q],[E,O]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[f,[T,Q],[E,M]],[/(macintosh);/i],[f,[T,Q]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[f,[T,F],[E,O]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[f,[T,st],[E,M]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[f,[T,st],[E,O]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[f,/_/g," "],[T,re],[E,O]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[f,/_/g," "],[T,re],[E,M]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[f,[T,"OPPO"],[E,O]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[f,[T,"Vivo"],[E,O]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[f,[T,"Realme"],[E,O]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[f,[T,cn],[E,O]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[f,[T,cn],[E,M]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[f,[T,$e],[E,M]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[f,[T,$e],[E,O]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[f,[T,"Lenovo"],[E,M]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[f,/_/g," "],[T,"Nokia"],[E,O]],[/(pixel c)\b/i],[f,[T,pe],[E,M]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[f,[T,pe],[E,O]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[f,[T,J],[E,O]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[f,"Xperia Tablet"],[T,J],[E,M]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[f,[T,"OnePlus"],[E,O]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[f,[T,X],[E,M]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[f,/(.+)/g,"Fire Phone $1"],[T,X],[E,O]],[/(playbook);[-\w\),; ]+(rim)/i],[f,T,[E,M]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[f,[T,Z],[E,O]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[f,[T,Y],[E,M]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[f,[T,Y],[E,O]],[/(nexus 9)/i],[f,[T,"HTC"],[E,M]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[T,[f,/_/g," "],[E,O]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[f,[T,"Acer"],[E,M]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[f,[T,"Meizu"],[E,O]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[T,f,[E,O]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[T,f,[E,M]],[/(surface duo)/i],[f,[T,Nt],[E,M]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[f,[T,"Fairphone"],[E,O]],[/(u304aa)/i],[f,[T,"AT&T"],[E,O]],[/\bsie-(\w*)/i],[f,[T,"Siemens"],[E,O]],[/\b(rct\w+) b/i],[f,[T,"RCA"],[E,M]],[/\b(venue[\d ]{2,7}) b/i],[f,[T,"Dell"],[E,M]],[/\b(q(?:mv|ta)\w+) b/i],[f,[T,"Verizon"],[E,M]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[f,[T,"Barnes & Noble"],[E,M]],[/\b(tm\d{3}\w+) b/i],[f,[T,"NuVision"],[E,M]],[/\b(k88) b/i],[f,[T,"ZTE"],[E,M]],[/\b(nx\d{3}j) b/i],[f,[T,"ZTE"],[E,O]],[/\b(gen\d{3}) b.+49h/i],[f,[T,"Swiss"],[E,O]],[/\b(zur\d{3}) b/i],[f,[T,"Swiss"],[E,M]],[/\b((zeki)?tb.*\b) b/i],[f,[T,"Zeki"],[E,M]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[T,"Dragon Touch"],f,[E,M]],[/\b(ns-?\w{0,9}) b/i],[f,[T,"Insignia"],[E,M]],[/\b((nxa|next)-?\w{0,9}) b/i],[f,[T,"NextBook"],[E,M]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[T,"Voice"],f,[E,O]],[/\b(lvtel\-)?(v1[12]) b/i],[[T,"LvTel"],f,[E,O]],[/\b(ph-1) /i],[f,[T,"Essential"],[E,O]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[f,[T,"Envizen"],[E,M]],[/\b(trio[-\w\. ]+) b/i],[f,[T,"MachSpeed"],[E,M]],[/\btu_(1491) b/i],[f,[T,"Rotor"],[E,M]],[/(shield[\w ]+) b/i],[f,[T,"Nvidia"],[E,M]],[/(sprint) (\w+)/i],[T,f,[E,O]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[T,Nt],[E,O]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[f,[T,ge],[E,M]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[f,[T,ge],[E,O]],[/smart-tv.+(samsung)/i],[T,[E,U]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[T,Qn],[E,U]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[T,$e],[E,U]],[/(apple) ?tv/i],[T,[f,"Apple TV"],[E,U]],[/crkey/i],[[f,"Chromecast"],[T,pe],[E,U]],[/droid.+aft(\w)( bui|\))/i],[f,[T,X],[E,U]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[f,[T,F],[E,U]],[/(bravia[\w ]+)( bui|\))/i],[f,[T,J],[E,U]],[/(mitv-\w{5}) bui/i],[f,[T,re],[E,U]],[/Hbbtv.*(technisat) (.*);/i],[T,f,[E,U]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[T,Re],[f,Re],[E,U]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[E,U]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[T,f,[E,A]],[/droid.+; (shield) bui/i],[f,[T,"Nvidia"],[E,A]],[/(playstation [345portablevi]+)/i],[f,[T,J],[E,A]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[f,[T,Nt],[E,A]],[/((pebble))app/i],[T,f,[E,q]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[f,[T,Q],[E,q]],[/droid.+; (glass) \d/i],[f,[T,pe],[E,q]],[/droid.+; (wt63?0{2,3})\)/i],[f,[T,ge],[E,q]],[/(quest( 2| pro)?)/i],[f,[T,Ve],[E,q]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[T,[E,ae]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[f,[E,O]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[f,[E,M]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[E,M]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[E,O]],[/(android[-\w\. ]{0,9});.+buil/i],[f,[T,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[p,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[p,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,y],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[p,[y,dn,si]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,"Windows"],[y,dn,si]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,S],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,y],[/\(bb(10);/i],[y,[p,Z]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[p,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[p,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,$],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,y],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[p,y]]},Wr=function(Rt,Vt){if(typeof Rt===c&&(Vt=Rt,Rt=r),!(this instanceof Wr))return new Wr(Rt,Vt).getResult();var rt=typeof n!==a&&n.navigator?n.navigator:r,Gn=Rt||(rt&&rt.userAgent?rt.userAgent:""),Ki=rt&&rt.userAgentData?rt.userAgentData:r,yt=Vt?function(xe,$n){var $o={};for(var Oi in xe)$n[Oi]&&$n[Oi].length%2==0?$o[Oi]=$n[Oi].concat(xe[Oi]):$o[Oi]=xe[Oi];return $o}(Xo,Vt):Xo;return this.getBrowser=function(){var xe={};return xe.name=r,xe.version=r,at.call(xe,Gn,yt.browser),xe.major=function($n){return typeof $n===l?$n.replace(/[^\d\.]/g,"").split(".")[0]:r}(xe.version),rt&&rt.brave&&typeof rt.brave.isBrave==o&&(xe.name="Brave"),xe},this.getCPU=function(){var xe={};return xe.architecture=r,at.call(xe,Gn,yt.cpu),xe},this.getDevice=function(){var xe={};return xe.vendor=r,xe.model=r,xe.type=r,at.call(xe,Gn,yt.device),!xe.type&&Ki&&Ki.mobile&&(xe.type=O),xe.model=="Macintosh"&&rt&&typeof rt.standalone!==a&&rt.maxTouchPoints&&rt.maxTouchPoints>2&&(xe.model="iPad",xe.type=M),xe},this.getEngine=function(){var xe={};return xe.name=r,xe.version=r,at.call(xe,Gn,yt.engine),xe},this.getOS=function(){var xe={};return xe.name=r,xe.version=r,at.call(xe,Gn,yt.os),!xe.name&&Ki&&Ki.platform!="Unknown"&&(xe.name=Ki.platform.replace(/chrome os/i,$).replace(/macos/i,S)),xe},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Gn},this.setUA=function(xe){return Gn=typeof xe===l&&xe.length>350?Re(xe,350):xe,this},this.setUA(Gn),this};Wr.VERSION="0.7.34",Wr.BROWSER=w([p,y,h]),Wr.CPU=w([C]),Wr.DEVICE=w([f,T,E,A,O,U,M,q,ae]),Wr.ENGINE=Wr.OS=w([p,y]),e.exports&&(t=e.exports=Wr),t.UAParser=Wr;var Qo=typeof n!==a&&(n.jQuery||n.Zepto);if(Qo&&!Qo.ua){var Za=new Wr;Qo.ua=Za.getResult(),Qo.ua.get=function(){return Za.getUA()},Qo.ua.set=function(Rt){Za.setUA(Rt);var Vt=Za.getResult();for(var rt in Vt)Qo.ua[rt]=Vt[rt]}}})(typeof window=="object"?window:u)})(Gf,Gf.exports);const Wf=new Gf.exports;let Hf,pr,no=Wf.getResult(),Kf=null;function He(e){if(!Kf){e&&Wf.setUA(e),no=Wf.getResult();const t=function(a){if(a.engine.name==="Blink"&&a.browser.name!=="WeChat")return Xe.CHROME;switch(a.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Xe.CHROME;case"Safari":case"Mobile Safari":return Xe.SAFARI;case"Edge":return Xe.EDGE;case"Firefox":return Xe.FIREFOX;case"QQBrowser":return Xe.QQ;case"Opera":return Xe.OPERA;case"WeChat":return Xe.WECHAT;default:return a.browser.name||""}}(no),n=function(a){let c;return c=a.engine.name==="Blink"?a.engine.version||"":a.browser.version||"",c.split(".")[0]}(no),r=function(a){switch(a.os.name){case"Windows":return a.os.version?a.os.name+" "+a.os.version:a.os.name;default:return a.os.name||""}}(no),o=no.os.version;if(!(t&&n&&r&&o))return{name:t,version:n,os:r,osVersion:o};Kf={name:t,version:n,os:r,osVersion:o}}return Kf}function vR(){return He().os}function RR(){const e=He();return"".concat(e.os," ").concat(e.osVersion)}function Jl(){const e=He();return!!(no.engine.name==="WebKit"&&e.os===pn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Xe.SAFARI||Pn()&&e.name!==Xe.SAFARI)}function qx(){const e=He();if(Jl()){if(e.os===pn.MAC_OS)return!0;if(e.os===pn.IOS){const t=no.os.version&&no.os.version.split(".");if(t&&Number(t[0])===14&&t[1]&&Number(t[1])>=3||t&&Number(t[0])>14)return!0}}return!1}function Jx(){return no.engine.name==="WebKit"}function Yf(){return He().name===Xe.CHROME}function Dn(){return He().name===Xe.SAFARI}function gt(){return He().name===Xe.FIREFOX}function Pn(){return He().os===pn.IOS}function zf(e){const t=He();return!(t.name!==Xe.CHROME||!t.osVersion)&&Number(t.version)>=e}function yR(e){const t=He();return!(t.name!==Xe.EDGE||!t.osVersion)&&Number(t.version)>=e}function IR(e){const t=He();return!(t.name!==Xe.OPERA||!t.osVersion)&&Number(t.version)>=e}function CR(){const e=He();return!(e.name!==Xe.CHROME||!e.osVersion)&&Number(e.version)<=90}function AR(){const e=He();if(e.os!==pn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function ya(){const e=He();if(e.os!==pn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function qf(){const e=He();if(e.os!==pn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function OR(){const e=He();if(e.os!==pn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Vi(){return Dn()&&navigator.maxTouchPoints>0}function wR(){return He().name===Xe.WECHAT}function NR(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Ns(){const e=He();return e.name===Xe.EDGE||e.name===Xe.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Xl(){return vR()===pn.ANDROID}function Wc(){const e=He();return Xl()&&(e.name===Xe.CHROME||e.name===Xe.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}(function(e){e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY"})(Hf||(Hf={})),function(e){e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver"}(pr||(pr={}));var bR={exports:{}},Xx=Vn,Qx=Te,DR=gi.f;Xx({target:"Object",stat:!0,forced:Object.defineProperty!==DR,sham:!Qx},{defineProperty:DR});var PR=Ao.Object,$x=bR.exports=function(e,t,n){return PR.defineProperty(e,t,n)};PR.defineProperty.sham&&($x.sham=!0);var LR=bR.exports;function _(e,t,n){return t in e?LR(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Jf,Xf={exports:{}},kR=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},Zx=kR,Qf=Object.prototype.toString,$f=(Jf=Object.create(null),function(e){var t=Qf.call(e);return Jf[t]||(Jf[t]=t.slice(8,-1).toLowerCase())});function bs(e){return e=e.toLowerCase(),function(t){return $f(t)===e}}function Zf(e){return Array.isArray(e)}function Ql(e){return e===void 0}var MR=bs("ArrayBuffer");function UR(e){return e!==null&&typeof e=="object"}function $l(e){if($f(e)!=="object")return!1;var t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}var e2=bs("Date"),t2=bs("File"),n2=bs("Blob"),r2=bs("FileList");function em(e){return Qf.call(e)==="[object Function]"}var i2=bs("URLSearchParams");function tm(e,t){if(e!=null)if(typeof e!="object"&&(e=[e]),Zf(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}var nm,o2=(nm=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(e){return nm&&e instanceof nm}),jn={isArray:Zf,isArrayBuffer:MR,isBuffer:function(e){return e!==null&&!Ql(e)&&e.constructor!==null&&!Ql(e.constructor)&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)},isFormData:function(e){var t="[object FormData]";return e&&(typeof FormData=="function"&&e instanceof FormData||Qf.call(e)===t||em(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&MR(e.buffer)},isString:function(e){return typeof e=="string"},isNumber:function(e){return typeof e=="number"},isObject:UR,isPlainObject:$l,isUndefined:Ql,isDate:e2,isFile:t2,isBlob:n2,isFunction:em,isStream:function(e){return UR(e)&&em(e.pipe)},isURLSearchParams:i2,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:tm,merge:function e(){var t={};function n(a,c){$l(t[c])&&$l(a)?t[c]=e(t[c],a):$l(a)?t[c]=e({},a):Zf(a)?t[c]=a.slice():t[c]=a}for(var r=0,o=arguments.length;r<o;r++)tm(arguments[r],n);return t},extend:function(e,t,n){return tm(t,function(r,o){e[o]=n&&typeof r=="function"?Zx(r,n):r}),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return e.charCodeAt(0)===65279&&(e=e.slice(1)),e},inherits:function(e,t,n,r){e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,n&&Object.assign(e.prototype,n)},toFlatObject:function(e,t,n){var r,o,a,c={};t=t||{};do{for(o=(r=Object.getOwnPropertyNames(e)).length;o-- >0;)c[a=r[o]]||(t[a]=e[a],c[a]=!0);e=Object.getPrototypeOf(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:$f,kindOfTest:bs,endsWith:function(e,t,n){e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;var r=e.indexOf(t,n);return r!==-1&&r===n},toArray:function(e){if(!e)return null;var t=e.length;if(Ql(t))return null;for(var n=new Array(t);t-- >0;)n[t]=e[t];return n},isTypedArray:o2,isFileList:r2},Ia=jn;function xR(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var VR=function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(Ia.isURLSearchParams(t))r=t.toString();else{var o=[];Ia.forEach(t,function(c,l){c!=null&&(Ia.isArray(c)?l+="[]":c=[c],Ia.forEach(c,function(h){Ia.isDate(h)?h=h.toISOString():Ia.isObject(h)&&(h=JSON.stringify(h)),o.push(xR(l)+"="+xR(h))}))}),r=o.join("&")}if(r){var a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+r}return e},s2=jn;function Zl(){this.handlers=[]}Zl.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},Zl.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},Zl.prototype.forEach=function(e){s2.forEach(this.handlers,function(t){t!==null&&e(t)})};var a2=Zl,c2=jn,jR=jn;function Ca(e,t,n,r,o){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),o&&(this.response=o)}jR.inherits(Ca,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var FR=Ca.prototype,BR={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(e){BR[e]={value:e}}),Object.defineProperties(Ca,BR),Object.defineProperty(FR,"isAxiosError",{value:!0}),Ca.from=function(e,t,n,r,o,a){var c=Object.create(FR);return jR.toFlatObject(e,c,function(l){return l!==Error.prototype}),Ca.call(c,e.message,t,n,r,o),c.name=e.name,a&&Object.assign(c,a),c};var Aa=Ca,GR={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ti=jn,WR=function(e,t){t=t||new FormData;var n=[];function r(o){return o===null?"":Ti.isDate(o)?o.toISOString():Ti.isArrayBuffer(o)||Ti.isTypedArray(o)?typeof Blob=="function"?new Blob([o]):Buffer.from(o):o}return function o(a,c){if(Ti.isPlainObject(a)||Ti.isArray(a)){if(n.indexOf(a)!==-1)throw Error("Circular reference detected in "+c);n.push(a),Ti.forEach(a,function(l,h){if(!Ti.isUndefined(l)){var f,p=c?c+"."+h:h;if(l&&!c&&typeof l=="object"){if(Ti.endsWith(h,"{}"))l=JSON.stringify(l);else if(Ti.endsWith(h,"[]")&&(f=Ti.toArray(l)))return void f.forEach(function(E){!Ti.isUndefined(E)&&t.append(p,r(E))})}o(l,p)}}),n.pop()}else t.append(c,r(a))}(e),t},rm=Aa,eu=jn,d2=eu.isStandardBrowserEnv()?{write:function(e,t,n,r,o,a){var c=[];c.push(e+"="+encodeURIComponent(t)),eu.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),eu.isString(r)&&c.push("path="+r),eu.isString(o)&&c.push("domain="+o),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},l2=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},u2=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},HR=function(e,t){return e&&!l2(t)?u2(e,t):t},im=jn,h2=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],KR=jn,p2=KR.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(o){var a=o;return t&&(n.setAttribute("href",a),a=n.href),n.setAttribute("href",a),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(o){var a=KR.isString(o)?r(o):o;return a.protocol===e.protocol&&a.host===e.host}}():function(){return!0},om=Aa;function YR(e){om.call(this,e??"canceled",om.ERR_CANCELED),this.name="CanceledError"}jn.inherits(YR,om,{__CANCEL__:!0});var tu=YR,Hc=jn,f2=function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new rm("Request failed with status code "+n.status,[rm.ERR_BAD_REQUEST,rm.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)},m2=d2,E2=VR,_2=HR,g2=function(e){var t,n,r,o={};return e&&im.forEach(e.split(`
`),function(a){if(r=a.indexOf(":"),t=im.trim(a.substr(0,r)).toLowerCase(),n=im.trim(a.substr(r+1)),t){if(o[t]&&h2.indexOf(t)>=0)return;o[t]=t==="set-cookie"?(o[t]?o[t]:[]).concat([n]):o[t]?o[t]+", "+n:n}}),o},S2=p2,T2=GR,ro=Aa,v2=tu,R2=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""},y2=function(e){return new Promise(function(t,n){var r,o=e.data,a=e.headers,c=e.responseType;function l(){e.cancelToken&&e.cancelToken.unsubscribe(r),e.signal&&e.signal.removeEventListener("abort",r)}Hc.isFormData(o)&&Hc.isStandardBrowserEnv()&&delete a["Content-Type"];var h=new XMLHttpRequest;if(e.auth){var f=e.auth.username||"",p=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";a.Authorization="Basic "+btoa(f+":"+p)}var E=_2(e.baseURL,e.url);function T(){if(h){var A="getAllResponseHeaders"in h?g2(h.getAllResponseHeaders()):null,O={data:c&&c!=="text"&&c!=="json"?h.response:h.responseText,status:h.status,statusText:h.statusText,headers:A,config:e,request:h};f2(function(M){t(M),l()},function(M){n(M),l()},O),h=null}}if(h.open(e.method.toUpperCase(),E2(E,e.params,e.paramsSerializer),!0),h.timeout=e.timeout,"onloadend"in h?h.onloadend=T:h.onreadystatechange=function(){h&&h.readyState===4&&(h.status!==0||h.responseURL&&h.responseURL.indexOf("file:")===0)&&setTimeout(T)},h.onabort=function(){h&&(n(new ro("Request aborted",ro.ECONNABORTED,e,h)),h=null)},h.onerror=function(){n(new ro("Network Error",ro.ERR_NETWORK,e,h,h)),h=null},h.ontimeout=function(){var A=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",O=e.transitional||T2;e.timeoutErrorMessage&&(A=e.timeoutErrorMessage),n(new ro(A,O.clarifyTimeoutError?ro.ETIMEDOUT:ro.ECONNABORTED,e,h)),h=null},Hc.isStandardBrowserEnv()){var y=(e.withCredentials||S2(E))&&e.xsrfCookieName?m2.read(e.xsrfCookieName):void 0;y&&(a[e.xsrfHeaderName]=y)}"setRequestHeader"in h&&Hc.forEach(a,function(A,O){o===void 0&&O.toLowerCase()==="content-type"?delete a[O]:h.setRequestHeader(O,A)}),Hc.isUndefined(e.withCredentials)||(h.withCredentials=!!e.withCredentials),c&&c!=="json"&&(h.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&h.addEventListener("progress",e.onDownloadProgress),typeof e.onUploadProgress=="function"&&h.upload&&h.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(r=function(A){h&&(n(!A||A&&A.type?new v2:A),h.abort(),h=null)},e.cancelToken&&e.cancelToken.subscribe(r),e.signal&&(e.signal.aborted?r():e.signal.addEventListener("abort",r))),o||(o=null);var C=R2(E);C&&["http","https","file"].indexOf(C)===-1?n(new ro("Unsupported protocol "+C+":",ro.ERR_BAD_REQUEST,e)):h.send(o)})},Ln=jn,zR=function(e,t){c2.forEach(e,function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])})},qR=Aa,I2=WR,C2={"Content-Type":"application/x-www-form-urlencoded"};function JR(e,t){!Ln.isUndefined(e)&&Ln.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var XR,nu={transitional:GR,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(XR=y2),XR),transformRequest:[function(e,t){if(zR(t,"Accept"),zR(t,"Content-Type"),Ln.isFormData(e)||Ln.isArrayBuffer(e)||Ln.isBuffer(e)||Ln.isStream(e)||Ln.isFile(e)||Ln.isBlob(e))return e;if(Ln.isArrayBufferView(e))return e.buffer;if(Ln.isURLSearchParams(e))return JR(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n,r=Ln.isObject(e),o=t&&t["Content-Type"];if((n=Ln.isFileList(e))||r&&o==="multipart/form-data"){var a=this.env&&this.env.FormData;return I2(n?{"files[]":e}:e,a&&new a)}return r||o==="application/json"?(JR(t,"application/json"),function(c,l,h){if(Ln.isString(c))try{return(l||JSON.parse)(c),Ln.trim(c)}catch(f){if(f.name!=="SyntaxError")throw f}return(h||JSON.stringify)(c)}(e)):e}],transformResponse:[function(e){var t=this.transitional||nu.transitional,n=t&&t.silentJSONParsing,r=t&&t.forcedJSONParsing,o=!n&&this.responseType==="json";if(o||r&&Ln.isString(e)&&e.length)try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?qR.from(a,qR.ERR_BAD_RESPONSE,this,null,this.response):a}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:null},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Ln.forEach(["delete","get","head"],function(e){nu.headers[e]={}}),Ln.forEach(["post","put","patch"],function(e){nu.headers[e]=Ln.merge(C2)});var sm=nu,A2=jn,O2=sm,QR=function(e){return!(!e||!e.__CANCEL__)},$R=jn,am=function(e,t,n){var r=this||O2;return A2.forEach(n,function(o){e=o.call(r,e,t)}),e},w2=QR,N2=sm,b2=tu;function cm(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new b2}var Pr=jn,ZR=function(e,t){t=t||{};var n={};function r(f,p){return Pr.isPlainObject(f)&&Pr.isPlainObject(p)?Pr.merge(f,p):Pr.isPlainObject(p)?Pr.merge({},p):Pr.isArray(p)?p.slice():p}function o(f){return Pr.isUndefined(t[f])?Pr.isUndefined(e[f])?void 0:r(void 0,e[f]):r(e[f],t[f])}function a(f){if(!Pr.isUndefined(t[f]))return r(void 0,t[f])}function c(f){return Pr.isUndefined(t[f])?Pr.isUndefined(e[f])?void 0:r(void 0,e[f]):r(void 0,t[f])}function l(f){return f in t?r(e[f],t[f]):f in e?r(void 0,e[f]):void 0}var h={url:a,method:a,data:a,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l};return Pr.forEach(Object.keys(e).concat(Object.keys(t)),function(f){var p=h[f]||o,E=p(f);Pr.isUndefined(E)&&p!==l||(n[f]=E)}),n},ey="0.27.2",D2=ey,Lo=Aa,dm={};["object","boolean","number","function","string","symbol"].forEach(function(e,t){dm[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});var ty={};dm.transitional=function(e,t,n){function r(o,a){return"[Axios v"+D2+"] Transitional option '"+o+"'"+a+(n?". "+n:"")}return function(o,a,c){if(e===!1)throw new Lo(r(a," has been removed"+(t?" in "+t:"")),Lo.ERR_DEPRECATED);return t&&!ty[a]&&(ty[a]=!0,console.warn(r(a," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(o,a,c)}};var ny=jn,P2=VR,ry=a2,iy=function(e){return cm(e),e.headers=e.headers||{},e.data=am.call(e,e.data,e.headers,e.transformRequest),e.headers=$R.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),$R.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||N2.adapter)(e).then(function(t){return cm(e),t.data=am.call(e,t.data,t.headers,e.transformResponse),t},function(t){return w2(t)||(cm(e),t&&t.response&&(t.response.data=am.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})},ru=ZR,L2=HR,oy={assertOptions:function(e,t,n){if(typeof e!="object")throw new Lo("options must be an object",Lo.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(e),o=r.length;o-- >0;){var a=r[o],c=t[a];if(c){var l=e[a],h=l===void 0||c(l,a,e);if(h!==!0)throw new Lo("option "+a+" must be "+h,Lo.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new Lo("Unknown option "+a,Lo.ERR_BAD_OPTION)}},validators:dm},Oa=oy.validators;function wa(e){this.defaults=e,this.interceptors={request:new ry,response:new ry}}wa.prototype.request=function(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},(t=ru(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;n!==void 0&&oy.assertOptions(n,{silentJSONParsing:Oa.transitional(Oa.boolean),forcedJSONParsing:Oa.transitional(Oa.boolean),clarifyTimeoutError:Oa.transitional(Oa.boolean)},!1);var r=[],o=!0;this.interceptors.request.forEach(function(E){typeof E.runWhen=="function"&&E.runWhen(t)===!1||(o=o&&E.synchronous,r.unshift(E.fulfilled,E.rejected))});var a,c=[];if(this.interceptors.response.forEach(function(E){c.push(E.fulfilled,E.rejected)}),!o){var l=[iy,void 0];for(Array.prototype.unshift.apply(l,r),l=l.concat(c),a=Promise.resolve(t);l.length;)a=a.then(l.shift(),l.shift());return a}for(var h=t;r.length;){var f=r.shift(),p=r.shift();try{h=f(h)}catch(E){p(E);break}}try{a=iy(h)}catch(E){return Promise.reject(E)}for(;c.length;)a=a.then(c.shift(),c.shift());return a},wa.prototype.getUri=function(e){e=ru(this.defaults,e);var t=L2(e.baseURL,e.url);return P2(t,e.params,e.paramsSerializer)},ny.forEach(["delete","get","head","options"],function(e){wa.prototype[e]=function(t,n){return this.request(ru(n||{},{method:e,url:t,data:(n||{}).data}))}}),ny.forEach(["post","put","patch"],function(e){function t(n){return function(r,o,a){return this.request(ru(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:o}))}}wa.prototype[e]=t(),wa.prototype[e+"Form"]=t(!0)});var k2=wa,M2=tu;function Na(e){if(typeof e!="function")throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(r){t=r});var n=this;this.promise.then(function(r){if(n._listeners){var o,a=n._listeners.length;for(o=0;o<a;o++)n._listeners[o](r);n._listeners=null}}),this.promise.then=function(r){var o,a=new Promise(function(c){n.subscribe(c),o=c}).then(r);return a.cancel=function(){n.unsubscribe(o)},a},e(function(r){n.reason||(n.reason=new M2(r),t(n.reason))})}Na.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Na.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},Na.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}},Na.source=function(){var e;return{token:new Na(function(t){e=t}),cancel:e}};var U2=Na,x2=jn,sy=jn,V2=kR,iu=k2,j2=ZR,fr=function e(t){var n=new iu(t),r=V2(iu.prototype.request,n);return sy.extend(r,iu.prototype,n),sy.extend(r,n),r.create=function(o){return e(j2(t,o))},r}(sm);fr.Axios=iu,fr.CanceledError=tu,fr.CancelToken=U2,fr.isCancel=QR,fr.VERSION=ey,fr.toFormData=WR,fr.AxiosError=Aa,fr.Cancel=fr.CanceledError,fr.all=function(e){return Promise.all(e)},fr.spread=function(e){return function(t){return e.apply(null,t)}},fr.isAxiosError=function(e){return x2.isObject(e)&&e.isAxiosError===!0},Xf.exports=fr,Xf.exports.default=fr;var mr=Xf.exports;class F2{constructor(t){_(this,"logger",void 0),_(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}class Et{constructor(){_(this,"_events",{}),_(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(n=>n.listener):[]}on(t,n){this._events[t]||(this._events[t]=[]);const r=this._events[t];this._indexOfListener(r,n)===-1&&r.push({listener:n,once:!1})}once(t,n){this._events[t]||(this._events[t]=[]);const r=this._events[t];this._indexOfListener(r,n)===-1&&r.push({listener:n,once:!0})}off(t,n){if(!this._events[t])return;const r=this._events[t],o=this._indexOfListener(r,n);o!==-1&&r.splice(o,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const n=this._events[t].map(c=>c);for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];for(let c=0;c<n.length;c+=1){const l=n[c];l.once&&this.off(t,l.listener),l.listener.apply(this,o||[])}}safeEmit(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];[...this._events[t]||[]].forEach(a=>{a.once&&this.off(t,a.listener);try{a.listener.apply(this,r)}catch(c){v.error("safeEmit event:".concat(t," error ").concat(c==null?void 0:c.toString()))}})}_indexOfListener(t,n){let r=t.length;for(;r--;)if(t[r].listener===n)return r;return-1}}const ou=new class extends Et{reportLogUploadError(e){this.emit("REPORT_LOG_UPLOAD",e)}};let I;(function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"})(I||(I={}));class N extends Error{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(n),_(this,"code",void 0),_(this,"message",void 0),_(this,"data",void 0),_(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=r}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return t==="error"&&v.error(this.toString()),t==="warning"&&v.warning(this.toString()),this}throw(){throw this.print(),this}}const Dt={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function lm(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function vi(e,t,n,r){const o=Object.assign({},Dt,r);let a=o.timeout;const c=async()=>{await function(f){return new se(p=>{window.setTimeout(p,f)})}(a),a*=o.timeoutFactor,a=Math.min(o.maxRetryTimeout,a)};let l=!1;const h=new se(async(f,p)=>{t=t||(()=>!1),n=n||(()=>!0);for(let E=0;E<o.maxRetryCount;E+=1){if(l)return p(new N(I.OPERATION_ABORTED));try{const T=await e();if(!t(T,E)||E+1===o.maxRetryCount)return f(T);await c()}catch(T){if(!n(T,E)||E+1===o.maxRetryCount)return p(T);await c()}}});return h.cancel=()=>l=!0,h}function um(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function ay(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Lr={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},su=Date.now(),Kc=e=>{for(const t in Lr)if(Object.prototype.hasOwnProperty.call(Lr,t)&&Lr[t]===e)return t;return"DEFAULT"},v=new class{constructor(){_(this,"proxyServerURL",void 0),_(this,"logLevel",Lr.DEBUG),_(this,"uploadState","collecting"),_(this,"uploadLogWaitingList",[]),_(this,"uploadLogUploadingList",[]),_(this,"uploadErrorCount",0),_(this,"currentLogID",0),_(this,"url",void 0),_(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Lr.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Lr.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Lr.WARNING].concat(t);this.log.apply(this,r)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Lr.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Lr.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){nt("UPLOAD_LOG",!0)}disableLogUpload(){nt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new F2(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-su<100)return void setTimeout(()=>{this.log(...t)},Date.now()-su);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=um()+" Agora-SDK [".concat(Kc(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const o=um()+" %cAgora-SDK [".concat(Kc(r),"]:");let a=[];if(!L("USE_NEW_LOG"))switch(r){case Lr.DEBUG:a=[o,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,a);break;case Lr.INFO:a=[o,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,a);break;case Lr.WARNING:a=[o,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,a);break;case Lr.ERROR:a=[o,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,a)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-su<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-su);const r=Math.max(0,Math.min(4,t[0]));t[0]=um()+" Agora-SDK [".concat(Kc(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!L("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=ay()+" Agora-SDK [".concat(Kc(e),"]:"):n[0]=ay()+" Agora-SDK [".concat(Kc(e),"]:");let o="";n.forEach(a=>{typeof a=="object"&&(a=JSON.stringify(a)),o+="".concat(a," ")}),this.uploadLogWaitingList.push({payload_str:o,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:kr,process_id:L("PROCESS_ID"),payload:JSON.stringify(e)};return vi(async()=>{const n=await mr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(L("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(L("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=n,r}},()=>(this.uploadLogUploadingList=[],!1),n=>(n.response?ou.reportLogUploadError({status:n.response.status,data:n.response.data,headers:n.response.headers,message:n.message}):n.request?ou.reportLogUploadError({status:n.request.status,message:n.message}):ou.reportLogUploadError({status:-1,message:n.message}),!0),{timeout:L("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:L("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,L("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),L("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),L("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),L("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}},hm="v4.18.1-0-ge3033d03-dirty(7/7/2023, 4:00:56 PM)",kr=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){const r=t[1],o=t[2];return"".concat(r,".").concat(o)}const n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(n&&n[1]&&n[2]){const r=n[1],o=n[2];return"".concat(r,".").concat(100*(Number(o)+1))}return"4.0.0.999"}("4.18.1"),pm=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),cy=["CHINA","GLOBAL"],Er=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),o=[];for(let l=0;l<6;l++)o.push("1");const a=o.join(""),c={};return c[e]=r,c[t]=a,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Er;const B2={"90p":ke(160,90),"90p_1":ke(160,90),"120p":ke(160,120,15,30,65),"120p_1":ke(160,120,15,30,65),"120p_3":ke(120,120,15,30,50),"120p_4":ke(212,120),"180p":ke(320,180,15,30,140),"180p_1":ke(320,180,15,30,140),"180p_3":ke(180,180,15,30,100),"180p_4":ke(240,180,15,30,120),"240p":ke(320,240,15,40,200),"240p_1":ke(320,240,15,40,200),"240p_3":ke(240,240,15,40,140),"240p_4":ke(424,240,15,40,220),"360p":ke(640,360,15,80,400),"360p_1":ke(640,360,15,80,400),"360p_3":ke(360,360,15,80,260),"360p_4":ke(640,360,30,80,600),"360p_6":ke(360,360,30,80,400),"360p_7":ke(480,360,15,80,320),"360p_8":ke(480,360,30,80,490),"360p_9":ke(640,360,15,80,800),"360p_10":ke(640,360,24,80,800),"360p_11":ke(640,360,24,80,1e3),"480p":ke(640,480,15,100,500),"480p_1":ke(640,480,15,100,500),"480p_2":ke(640,480,30,100,1e3),"480p_3":ke(480,480,15,100,400),"480p_4":ke(640,480,30,100,750),"480p_6":ke(480,480,30,100,600),"480p_8":ke(848,480,15,100,610),"480p_9":ke(848,480,30,100,930),"480p_10":ke(640,480,10,100,400),"720p":ke(1280,720,15,120,1130),"720p_1":ke(1280,720,15,120,1130),"720p_2":ke(1280,720,30,120,2e3),"720p_3":ke(1280,720,30,120,1710),"720p_5":ke(960,720,15,120,910),"720p_6":ke(960,720,30,120,1380),"1080p":ke(1920,1080,15,120,2080),"1080p_1":ke(1920,1080,15,120,2080),"1080p_2":ke(1920,1080,30,120,3e3),"1080p_3":ke(1920,1080,30,120,3150),"1080p_5":ke(1920,1080,60,120,4780),"1440p":ke(2560,1440,30,120,4850),"1440p_1":ke(2560,1440,30,120,4850),"1440p_2":ke(2560,1440,60,120,7350),"4k":ke(3840,2160,30,120,8910),"4k_1":ke(3840,2160,30,120,8910),"4k_3":ke(3840,2160,60,120,13500)},G2={"480p":Qr(640,480,5),"480p_1":Qr(640,480,5),"480p_2":Qr(640,480,30),"480p_3":Qr(640,480,15),"720p":Qr(1280,720,5),"720p_1":Qr(1280,720,5),"720p_2":Qr(1280,720,30),"720p_3":Qr(1280,720,15),"1080p":Qr(1920,1080,5),"1080p_1":Qr(1920,1080,5),"1080p_2":Qr(1920,1080,30),"1080p_3":Qr(1920,1080,15)},W2={"1SL1TL":mm(1,1),"3SL3TL":mm(3,3),"2SL3TL":mm(2,3)};function Ds(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},B2[e]):e}function fm(e){return typeof e=="string"?Object.assign({},G2[e]):e}function au(e){return typeof e=="string"?Object.assign({},W2[e]):e}const H2={speech_low_quality:ba(16e3,!1),speech_standard:ba(32e3,!1,18),music_standard:ba(48e3,!1),standard_stereo:ba(48e3,!0,56),high_quality:ba(48e3,!1,128),high_quality_stereo:ba(48e3,!0,192)};function cu(e){return typeof e=="string"?Object.assign({},H2[e]):e}function nt(e,t,n){Object.keys(Yn).includes(e)&&(!n&&Object.keys(Ps).includes(e)||(Yn[e]=t))}function L(e){return Yn[e]}const Yn={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:cy,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION:2e3,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}},Ps={};function ba(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function ke(e,t,n,r,o){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:o}}function Qr(e,t,n,r,o){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:o}}function mm(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}pm||(Yn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Yn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Yn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Yn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Yn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Yn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Yn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Yn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Yn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Yn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Yn.AREAS=["NORTH_AMERICA","OVERSEA"]);const K2=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Ls=[],Yc=[];function ks(e,t){return!!t&&Ls.some(n=>n.uid===e&&n.channelName===t)}var Y2=pl,z2=gi,q2=mi,Em=function(e,t,n){var r=Y2(t);r in e?z2.f(e,r,q2(0,n)):e[r]=n},dy=jp,J2=wo,X2=Em,Q2=j.Array,$2=Math.max,ly=function(e,t,n){for(var r=J2(e),o=dy(t,r),a=dy(n===void 0?r:n,r),c=Q2($2(a-o,0)),l=0;o<a;o++,l++)X2(c,l,e[o]);return c.length=l,c},uy=ly,Z2=Math.floor,_m=function(e,t){var n=e.length,r=Z2(n/2);return n<8?eV(e,t):tV(e,_m(uy(e,0,r),t),_m(uy(e,r),t),t)},eV=function(e,t){for(var n,r,o=e.length,a=1;a<o;){for(r=a,n=e[a];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==a++&&(e[r]=n)}return e},tV=function(e,t,n,r){for(var o=t.length,a=n.length,c=0,l=0;c<o||l<a;)e[c+l]=c<o&&l<a?r(t[c],n[l])<=0?t[c++]:n[l++]:c<o?t[c++]:n[l++];return e},nV=_m,hy=vs.match(/firefox\/(\d+)/i),rV=!!hy&&+hy[1],iV=/MSIE|Trident/.test(vs),py=vs.match(/AppleWebKit\/(\d+)\./),oV=!!py&&+py[1],sV=Vn,fy=B,aV=Zi,cV=Oo,dV=wo,my=fa,gm=m,lV=nV,uV=kp,Ey=rV,hV=iV,_y=la,gy=oV,ko=[],Sy=fy(ko.sort),pV=fy(ko.push),fV=gm(function(){ko.sort(void 0)}),mV=gm(function(){ko.sort(null)}),EV=uV("sort"),Ty=!gm(function(){if(_y)return _y<70;if(!(Ey&&Ey>3)){if(hV)return!0;if(gy)return gy<603;var e,t,n,r,o="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)ko.push({k:t+r,v:n})}for(ko.sort(function(a,c){return c.v-a.v}),r=0;r<ko.length;r++)t=ko[r].k.charAt(0),o.charAt(o.length-1)!==t&&(o+=t);return o!=="DGBEFHACIJK"}});sV({target:"Array",proto:!0,forced:fV||!mV||!EV||!Ty},{sort:function(e){e!==void 0&&aV(e);var t=cV(this);if(Ty)return e===void 0?Sy(t):Sy(t,e);var n,r,o=[],a=dV(t);for(r=0;r<a;r++)r in t&&pV(o,t[r]);for(lV(o,function(c){return function(l,h){return h===void 0?-1:l===void 0?1:c!==void 0?+c(l,h)||0:my(l)>my(h)?1:-1}}(e)),n=o.length,r=0;r<n;)t[r]=o[r++];for(;r<a;)delete t[r++];return t}});var _V=No("Array").sort,gV=z,SV=_V,Sm=Array.prototype,Tm=function(e){var t=e.sort;return e===Sm||gV(Sm,e)&&t===Sm.sort?SV:t};function Da(e,t){if(typeof e!="boolean")throw new N(I.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function $t(e,t,n){if(!n.includes(e))throw new N(I.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function it(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4,o=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e<n||e>r||o&&!TV(e))throw new N(I.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function vm(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new N(I.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&it(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&it(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&it(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&it(e.ideal,"".concat(t,".ideal"),1,1/0)}else it(e,t,1,1/0)}function fn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,o=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new N(I.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!vy(e,n,r,o))throw new N(I.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(o?" ASCII characters only.":""))}function io(e,t){if(!Array.isArray(e))throw new N(I.INVALID_PARAMS,"".concat(t," should be an array"))}function Rm(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw v.error("Invalid Channel Name ".concat(e)),new N(I.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function ym(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||vy(e,1,255)))throw v.error("Invalid UID ".concat(e," ").concat(typeof e)),new N(I.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&v.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function ut(e){return e==null}function vy(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!r||vV(e))}function TV(e){return typeof e=="number"&&e%1==0}function vV(e){if(typeof e!="string")return!1;for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}let Ry,yy,mn;(function(e){e.FREE="free",e.UPLOADING="uploading"})(Ry||(Ry={})),function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}(yy||(yy={})),function(e){e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata"}(mn||(mn={}));const Im={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};function RV(e){return fn(e.reportId,"params.reportId",0,100,!1),fn(e.category,"params.category",0,100,!1),fn(e.event,"params.event",0,100,!1),fn(e.label,"params.label",0,100,!1),it(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}const yV={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let on,_t,Iy,Cm,Pt,ft,Mo,oo,Pa,zc,_r,En,me,Am,Ke,De,Fn,Qe,he,Ee,ir,Ne,Cy,zn;function Ay(e){return it(e.timeout,"config.timeout",0,1e5),it(e.timeoutFactor,"config.timeoutFactor",0,100,!1),it(e.maxRetryCount,"config.maxRetryConfig",0,1/0),it(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function IV(e){return $t(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),$t(e.mode,"config.mode",["rtc","live"]),e.audioCodec!==void 0&&$t(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),e.proxyServer!==void 0&&fn(e.proxyServer,"config.proxyServer",1,1e4),e.turnServer!==void 0&&Oy(e.turnServer),e.httpRetryConfig!==void 0&&Ay(e.httpRetryConfig),e.websocketRetryConfig!==void 0&&Ay(e.websocketRetryConfig),!0}function qc(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function Oy(e){return fn(e.turnServerURL,"turnServerURL"),fn(e.username,"username"),fn(e.password,"password"),e.udpport&&it(e.udpport,"udpport",1,99999,!0),e.forceturn&&Da(e.forceturn,"forceturn"),e.security&&Da(e.security,"security"),e.tcpport&&it(e.tcpport,"tcpport",1,99999,!0),!0}function wy(e){return e.level!==void 0&&$t(e.level,"level",[1,2,3]),!0}(function(e){e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats"})(on||(on={})),function(e){e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats"}(_t||(_t={})),function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(Iy||(Iy={})),function(e){e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(Cm||(Cm={})),function(e){e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.DATACHANNEL_FAILBACK="Client._datachannelFailback",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",e.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload"}(Pt||(Pt={})),function(e){e.TRACER="tracer"}(ft||(ft={})),function(e){e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND"}(Mo||(Mo={})),function(e){e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(oo||(oo={})),function(e){e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(Pa||(Pa={})),function(e){e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(zc||(zc={})),function(e){e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(_r||(_r={})),function(e){e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(En||(En={})),function(e){e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(me||(me={})),function(e){e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(Am||(Am={})),function(e){e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.FALLBACK="FALLBACK",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL"}(Ke||(Ke={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(De||(De={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(Fn||(Fn={})),function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed"}(Qe||(Qe={})),function(e){e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback"}(he||(he={})),function(e){e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.SUBSCRIBE="subscribe",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter"}(Ee||(Ee={})),function(e){e.PUBLISH_STATS="publish_stats",e.PUBLISH_RELATED_STATS="publish_related_stats",e.SUBSCRIBE_STATS="subscribe_stats",e.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.TRANSPORT_STATS="transport_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats"}(ir||(ir={})),function(e){e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list"}(Ne||(Ne={})),function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.NEED_ANSWER="NEED_ANSWER",e.NEED_RENEGOTIATE="NEED_RENEGOTIATE",e.P2P_LOST="P2P_LOST",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NEED_UNPUB="NEED_UNPUB",e.NEED_UNSUB="NEED_UNSUB",e.NEED_UPLOAD="NEED_UPLOAD",e.NEED_CONTROL="NEED_CONTROL",e.START_RECONNECT="START_RECONNECT",e.END_RECONNECT="END_RECONNECT",e.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(Cy||(Cy={})),function(e){e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source"}(zn||(zn={}));const Om={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},wm={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Ny={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},CV={uplinkNetworkQuality:0,downlinkNetworkQuality:0},by={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let ve,jt,Uo;(function(e){e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"})(ve||(ve={})),function(e){e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming"}(jt||(jt={})),function(e){e[e.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",e[e.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",e[e.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",e[e.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",e[e.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",e[e.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",e[e.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",e[e.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",e[e.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(Uo||(Uo={}));const AV={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Nm={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function bm(e,t){fn(e.url,"".concat(t,".url"),1,1e3,!1),ut(e.x)||it(e.x,"".concat(t,".x"),0,1e4),ut(e.y)||it(e.y,"".concat(t,".y"),0,1e4),ut(e.width)||it(e.width,"".concat(t,".width"),0,1e4),ut(e.height)||it(e.height,"".concat(t,".height"),0,1e4),ut(e.zOrder)||it(e.zOrder,"".concat(t,".zOrder"),0,255),ut(e.alpha)||it(e.alpha,"".concat(t,".alpha"),0,1,!1)}const OV={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},wV={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};let $r,La,It,Dy,_n,Ri,kn,xo,Ft,mt,Lt,du,_e,Wt,ka,Dm,Pm,Jc,Vo,Ma,Me;function Py(e){if(!e.channelName)throw new N(I.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new N(I.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&fn(e.token,"info.token",1,2047),ym(e.uid),Rm(e.channelName),!0}function Ly(e){return $t(e,"mediaSource",["screen","window","application"]),!0}(function(e){e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address"})($r||($r={})),function(e){e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(La||(La={})),function(e){e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(It||(It={})),function(e){e.CONNECT_FAILED="connect failed",e.CONNECT_TIMEOUT="connect timeout",e.WS_DISCONNECTED="websocket disconnected",e.REQUEST_TIMEOUT="request timeout",e.REQUEST_FAILED="request failed",e.WAIT_STATUS_TIMEOUT="wait status timeout",e.WAIT_STATUS_ERROR="wait status error",e.BAD_STATE="bad state",e.WS_ABORT="ws abort",e.AP_REQUEST_TIMEOUT="AP request timeout",e.AP_JSON_PARSE_ERROR="AP json parse error",e.AP_REQUEST_ERROR="AP request error",e.AP_REQUEST_ABORT="AP request abort"}(Dy||(Dy={})),function(e){e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile"}(_n||(_n={})),function(e){e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(Ri||(Ri={})),function(e){e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(kn||(kn={})),function(e){e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(xo||(xo={})),function(e){e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low"}(Ft||(Ft={})),function(e){e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_FAILBACK="datachannel_failback",e.RESET_SIGNAL="reset-signal"}(mt||(mt={})),function(e){e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data"}(Lt||(Lt={})),function(e){e[e.websocket=0]="websocket",e[e.datachannel=1]="datachannel"}(du||(du={})),function(e){e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track"}(_e||(_e={})),function(e){e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream"}(Wt||(Wt={})),function(e){e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM"}(ka||(ka={})),function(e){e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM"}(Dm||(Dm={})),function(e){e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY"}(Pm||(Pm={})),function(e){e.TRANSCEIVER_UPDATED="transceiver-updated"}(Jc||(Jc={})),function(e){e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed"}(Vo||(Vo={})),function(e){e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(Ma||(Ma={})),function(e){e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS"}(Me||(Me={}));const NV=[Me.AFRICA,Me.ASIA,Me.CHINA,Me.EUROPE,Me.GLOBAL,Me.INDIA,Me.JAPAN,Me.NORTH_AMERICA,Me.OCEANIA,Me.OVERSEA,Me.SOUTH_AMERICA];let Zt;(function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL"})(Zt||(Zt={}));const lu={CHINA:{},ASIA:{CODE:Zt.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Zt.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Zt.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Zt.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Zt.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Zt.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Zt.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Zt.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Zt.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Zt.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Zt.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Zt.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Zt.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};let Xc,ky,Ce,sn,yi,ce,Ht,Ue,In,jo,gn,qn,gr,Sr,Bt,ji,St,Ii,My,or,Mr,Fo;pm&&(lu.CHINA={CODE:Zt.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(e){e.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(Xc||(Xc={}));class uu extends Et{constructor(t,n){super(),_(this,"onICEConnectionStateChange",void 0),_(this,"onConnectionStateChange",void 0),_(this,"onDTLSTransportStateChange",void 0),_(this,"onDTLSTransportError",void 0),_(this,"onICETransportStateChange",void 0),_(this,"onFirstAudioReceived",void 0),_(this,"onFirstVideoReceived",void 0),_(this,"onFirstAudioDecoded",void 0),_(this,"onFirstVideoDecoded",void 0),_(this,"onFirstVideoDecodedTimeout",void 0),_(this,"onSelectedLocalCandidateChanged",void 0),_(this,"onSelectedRemoteCandidateChanged",void 0),_(this,"establishPromise",void 0)}}(function(e){e.SEND="sendonly",e.RECV="recvonly",e.SENDRECV="sendrecv",e.INACTIVE="inactive"})(ky||(ky={})),function(e){e.VIDEO="video",e.AUDIO="audio"}(Ce||(Ce={})),function(e){e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY"}(sn||(sn={})),function(e){e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(yi||(yi={})),function(e){e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack"}(ce||(ce={})),function(e){e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected"}(Ht||(Ht={})),function(e){e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState"}(Ue||(Ue={})),function(e){e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(In||(In={})),function(e){e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(jo||(jo={})),function(e){e.ON_TRACK="on_track",e.ON_NODE="on_node"}(gn||(gn={})),function(e){e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints"}(qn||(qn={})),function(e){e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED"}(gr||(gr={})),function(e){e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED"}(Sr||(Sr={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Bt||(Bt={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(ji||(ji={})),function(e){e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback"}(St||(St={})),function(e){e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.SECURITY_POLICY_VIOLATION="security-policy-violation"}(Ii||(Ii={})),function(e){e[e.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",e[e.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",e[e.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",e[e.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",e[e.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",e[e.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",e[e.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",e[e.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",e[e.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",e[e.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",e[e.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",e[e.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",e[e.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",e[e.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",e[e.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",e[e.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",e[e.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",e[e.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",e[e.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",e[e.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(My||(My={})),function(e){e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED"}(or||(or={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Mr||(Mr={})),function(e){e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED"}(Fo||(Fo={}));const Cn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1};function Ot(){return Cn}let qt;(function(e){e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(qt||(qt={}));var bV=Fe,Qc=Array.isArray||function(e){return bV(e)=="Array"},DV=j,Uy=Qc,PV=cf,LV=Xr,kV=hn("species"),xy=DV.Array,MV=function(e){var t;return Uy(e)&&(t=e.constructor,(PV(t)&&(t===xy||Uy(t.prototype))||LV(t)&&(t=t[kV])===null)&&(t=void 0)),t===void 0?xy:t},Vy=function(e,t){return new(MV(e))(t===0?0:t)},UV=kc,xV=_i,VV=Oo,jV=wo,FV=Vy,jy=B([].push),Bo=function(e){var t=e==1,n=e==2,r=e==3,o=e==4,a=e==6,c=e==7,l=e==5||a;return function(h,f,p,E){for(var T,y,C=VV(h),A=xV(C),O=UV(f,p),M=jV(A),U=0,q=E||FV,ae=t?q(h,M):n||c?q(h,0):void 0;M>U;U++)if((l||U in A)&&(y=O(T=A[U],U,C),e))if(t)ae[U]=y;else if(y)switch(e){case 3:return!0;case 5:return T;case 6:return U;case 2:jy(ae,T)}else switch(e){case 4:return!1;case 7:jy(ae,T)}return a?-1:r||o?o:ae}},Fy={forEach:Bo(0),map:Bo(1),filter:Bo(2),some:Bo(3),every:Bo(4),find:Bo(5),findIndex:Bo(6),filterReject:Bo(7)},BV=Fy.forEach,By=kp("forEach")?[].forEach:function(e){return BV(this,e,arguments.length>1?arguments[1]:void 0)};Vn({target:"Array",proto:!0,forced:[].forEach!=By},{forEach:By});var GV=No("Array").forEach,WV=Do,HV=rr,KV=z,YV=GV,Lm=Array.prototype,zV={DOMTokenList:!0,NodeList:!0},qV=function(e){var t=e.forEach;return e===Lm||KV(Lm,e)&&t===Lm.forEach||HV(zV,WV(e))?YV:t},JV=Oo,Gy=Hp;Vn({target:"Object",stat:!0,forced:m(function(){Gy(1)})},{keys:function(e){return Gy(JV(e))}});var XV=Ao.Object.keys,QV=YS,$V=Vn,ZV=Qc,ej=B([].reverse),Wy=[1,2];$V({target:"Array",proto:!0,forced:String(Wy)===String(Wy.reverse())},{reverse:function(){return ZV(this)&&(this.length=this.length),ej(this)}});var tj=No("Array").reverse,nj=z,rj=tj,km=Array.prototype,ij=function(e){var t=e.reverse;return e===km||nj(km,e)&&t===km.reverse?rj:t},oj=m,sj=la,aj=hn("species"),Hy=function(e){return sj>=51||!oj(function(){var t=[];return(t.constructor={})[aj]=function(){return{foo:1}},t[e](Boolean).foo!==1})},cj=Vn,dj=j,Ky=Qc,lj=cf,uj=Xr,Yy=jp,hj=wo,pj=Co,fj=Em,mj=hn,Ej=df,_j=Hy("slice"),gj=mj("species"),Mm=dj.Array,Sj=Math.max;cj({target:"Array",proto:!0,forced:!_j},{slice:function(e,t){var n,r,o,a=pj(this),c=hj(a),l=Yy(e,c),h=Yy(t===void 0?c:t,c);if(Ky(a)&&(n=a.constructor,(lj(n)&&(n===Mm||Ky(n.prototype))||uj(n)&&(n=n[gj])===null)&&(n=void 0),n===Mm||n===void 0))return Ej(a,l,h);for(r=new(n===void 0?Mm:n)(Sj(h-l,0)),o=0;l<h;l++,o++)l in a&&fj(r,o,a[l]);return r.length=o,r}});var Tj=No("Array").slice,vj=z,Rj=Tj,Um=Array.prototype,yj=function(e){var t=e.slice;return e===Um||vj(Um,e)&&t===Um.slice?Rj:t};function K(e,t,n,r,o){var a,c,l,h={};return qV(a=XV(r)).call(a,function(f){h[f]=r[f]}),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=QV(c=ij(l=yj(n).call(n)).call(l)).call(c,function(f,p){return p(e,t,f)||f},h),o&&h.initializer!==void 0&&(h.value=h.initializer?h.initializer.call(o):void 0,h.initializer=void 0),h.initializer===void 0&&(LR(e,t,h),h=null),h}var Ij=No("Array").keys,Cj=Do,Aj=rr,Oj=z,wj=Ij,xm=Array.prototype,Nj={DOMTokenList:!0,NodeList:!0},Ms=function(e){var t=e.keys;return e===xm||Oj(xm,e)&&t===xm.keys||Aj(Nj,Cj(e))?wj:t};function zy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function qy(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zy(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zy(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let hu=0,Vm=0;function Zr(e,t,n,r){return new se((o,a)=>{t.timeout=t.timeout||L("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),hu+=Ba(t.data)):n&&(t.data.size?hu+=t.data.size:t.data instanceof FormData?hu+=function(c){let l=0;return/DingTalk/i.test(navigator.userAgent)&&c.realFormData&&(c=c.realFormData),c.forEach(h=>{l+=typeof h=="string"?Ba(h):h.size}),l+138}(t.data):hu+=Ba(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,mr.request(t).then(c=>{typeof c.data=="string"?Vm+=Ba(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?Vm+=c.data.byteLength:Vm+=Ba(JSON.stringify(c.data)),r&&o({data:c.data,headers:c.headers}),o(c.data)}).catch(c=>{mr.isCancel(c)?a(new N(I.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?a(new N(I.NETWORK_TIMEOUT,c.message)):c.response?a(new N(I.NETWORK_RESPONSE_ERROR,c.response.status)):a(new N(I.NETWORK_ERROR,c.message))})})}async function bj(e,t){const n=new Blob([t.data],{type:"buffer"});return await Zr(e,qy(qy({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const kt=new class extends Et{set networkState(e){v.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+e),this.emit(jo.NETWORK_STATE_CHANGE,e,this._networkState),e===In.ONLINE?this.emit(jo.ONLINE):e===In.OFFLINE&&(this.onlineWaiter=new se(t=>{this.once(jo.ONLINE,()=>{this.onlineWaiter=void 0,t(In.ONLINE)})}),this.emit(jo.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}constructor(){super(),_(this,"_moduleName","network-indicator"),_(this,"_networkState",In.ONLINE),_(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=In.ONLINE}),window.addEventListener("offline",()=>{this.networkState=In.OFFLINE})}};let jm=!1;const Tr=new class extends Et{constructor(){super(...arguments),_(this,"onAutoplayFailed",void 0),_(this,"onAudioAutoplayFailed",void 0)}};function Jy(){if(He(),!jm){const e=t=>{t.preventDefault(),jm=!1,Wc()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};jm=!0,Wc()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),v.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Tr.onAutoplayFailed?Tr.onAutoplayFailed():Tr.onAudioAutoplayFailed?v.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):v.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Tr.emit("autoplay-failed")}}function Fm(e){return new TextEncoder().encode(e)}const Xy=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},Dj=async e=>function(t,n){let r="";return new Uint8Array(t).forEach(o=>{r+=o.toString(n).padStart(2,"0")}),r}(await crypto.subtle.digest("SHA-256",Fm(e)),16);function Qy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Ae(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Qy(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qy(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function fe(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,r){const o=r.value;if(typeof o=="function"){const a=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];let f=l;if(e.argsMap)try{f=e.argsMap(this,...l)}catch(E){v.warning(E),f=[]}try{JSON.stringify(f)}catch{v.warning("arguments for method ".concat(a,".").concat(String(n)," not serializable for apiInvoke.")),f=[]}const p=(e.report||de).reportApiInvoke(this._sessionId||null,{name:"".concat(a,".").concat(String(n)),options:f,tag:ft.TRACER,reportResult:e.reportResult},e.throttleTime);try{const E=o.apply(this,l);return E instanceof se?E.then(T=>(p.onSuccess(e.reportResult&&T),T)).catch(T=>{throw p.onError(T),T}):(p.onSuccess(e.reportResult&&E),E)}catch(E){throw p.onError(E),E}}}return r}}const de=new class{constructor(){_(this,"baseInfoMap",new Map),_(this,"proxyServer",void 0),_(this,"clientList",Ls),_(this,"eventUploadTimer",void 0),_(this,"setSessionIdTimer",void 0),_(this,"url",void 0),_(this,"backupUrl",void 0),_(this,"_appId",void 0),_(this,"keyEventUploadPendingItems",[]),_(this,"normalEventUploadPendingItems",[]),_(this,"apiInvokeUploadPendingItems",[]),_(this,"apiInvokeCount",0),_(this,"ltsList",[]),_(this,"lastSendNormalEventTime",Date.now()),_(this,"customReportCounterTimer",void 0),_(this,"customReportCount",0),_(this,"extApiInvoke",async e=>{for(const t of e){const n=Ae(Ae({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:ft.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),L("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),L("EVENT_REPORT_SEND_INTERVAL"))}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void v.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));const t=this.baseInfoMap.get(e),n=Date.now(),r=t.startTime;t.startTime=n,v.debug("rewrite session ".concat(e," startTime: ").concat(n," , ").concat(n-r,"ms")),this.baseInfoMap.set(e,t)}setAppId(e){this._appId=e}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const o=this.apiInvokeCount,a=()=>({tag:t.tag,invokeId:o,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null}),c=!!L("SHOW_REPORT_INVOKER_LOG");c&&v.info("".concat(t.name," start"),t.options);let l=!1;Tn(t.timeout).then(()=>{l||(this.sendApiInvoke(Ae(Ae({},a()),{},{error:I.API_INVOKE_TIMEOUT,success:!1})),v.debug("".concat(t.name," timeout")))});const h=new N(I.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:f=>{const p=()=>{if(l)throw h;return l=!0,this.sendApiInvoke(Ae(Ae({},a()),{},{success:!0},t.reportResult&&{result:f})),c&&v.info("".concat(t.name," onSuccess")),f};return n?fC(p,t.name+"Success",n,()=>l=!0):p()},onError:f=>{const p=()=>{if(l)throw f;l=!0,this.sendApiInvoke(Ae(Ae({},a()),{},{success:!1,error:f})),c&&v.info("".concat(t.name," onFailure"),f.toString())};return n?fC(p,t.name+"Error",n,()=>l=!0):p()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const o=Object.assign({},{willUploadConsoleLog:L("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:pm?"global":"oversea",areas:L("AREAS")&&L("AREAS").join(",")},t.extend),a=Date.now(),c=Ae(Ae({},r),{},{eventType:on.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:hm,lts:a,elapse:a-n,extend:JSON.stringify(o),mode:t.mode,process:L("PROCESS_ID"),appType:L("APP_TYPE"),success:!0,version:kr});this.send({type:_t.SESSION,data:c},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=Ae(Ae({},r),{},{eventType:on.JOIN_CHOOSE_SERVER,lts:o,eventElapse:o-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:o-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3});this.send({type:_t.JOIN_CHOOSE_SERVER,data:a},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=Ae(Ae({},r),{},{eventType:on.REQ_USER_ACCOUNT,lts:o,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:o-n.startTime,eventElapse:o-t.lts,extend:JSON.stringify(t.extend)});this.send({type:_t.REQ_USER_ACCOUNT,data:a},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const o=Date.now(),{firstSuccess:a,avoidJoinStartTime:c,isProxy:l,addr:h}=t,f=o-(a&&c?c:n.startTime),p=Ae(Ae({},r),{},{eventType:on.JOIN_GATEWAY,lts:o,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:f,eventElapse:o-t.lts,firstSuccess:a,signalChannel:t.signalChannel}),E=p.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=o),a)this.send({type:_t.JOIN_GATEWAY,data:p},!0);else{let T;if(h)if(l){const C=h.match(/h=(\d{1,3}-){3}\d{1,3}/g),A=h.match(/p=[0-9]{1,6}/g);T={isSuccess:E,gatewayIp:C&&C.length?C[0].split("=")[1].replace(/-/g,"."):"",port:A&&A.length?A[0].split("=")[1]:"",isProxy:l?1:0}}else{const C=h.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),A=h.match(/:[0-9]{1,6}/g);T={isSuccess:E,gatewayIp:C&&C.length?C[0].split("//")[1].replace(/-/g,"."):"",port:A&&A.length?A[0].split(":")[1]:"",isProxy:l?1:0}}else T={isSuccess:E,gatewayIp:"",port:"",isProxy:l?1:0};delete p.success,delete p.eventType,delete p.firstSuccess,p.vid=Number(p.vid);const y=Object.assign({},p,T,{eventType:on.REJOIN_GATEWAY});this.send({type:_t.RE_JOIN_GATEWAY,data:y},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),o=Ae(Ae({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:_t.JOIN_CHANNEL_TIMEOUT,data:o},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=Ae(Ae({},r),{},{eventType:on.PUBLISH,lts:o,eventElapse:t.eventElapse,elapse:o-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:_t.PUBLISH,data:a},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,a=Date.now(),c=Ae(Ae({},o),{},{eventType:on.SUBSCRIBE,lts:a,eventElapse:t.eventElapse,elapse:a-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?c.peerSuid=t.peerid:c.peer=t.peerid,this.send({type:_t.SUBSCRIBE,data:c},!0)}wsCompressorInit(e){var t;const n=[...Ms(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",o=this.baseInfoMap.get(r);if(!o)return;const a=o.info,c=Date.now(),l=Ae(Ae({},a),{},{eventType:on.WS_COMPRESSOR_INIT,lts:c,eventElapse:e.eventElapse,elapse:c-o.startTime,status:e.status?1:2});this.send({type:_t.WS_COMPRESSOR_INIT,data:l},!0)}firstRemoteVideoDecode(e,t,n,r){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,c=Date.now(),l=Ae(Ae(Ae({},a),r),{},{elapse:c-o.startTime,eventType:t,lts:c,firstDecodeFrame:Math.max(c-o.startTime,0),apEnd:Math.max(r.apEnd-o.startTime,0),apStart:Math.max(r.apStart-o.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-o.startTime,0),joinGwStart:Math.max(r.joinGwStart-o.startTime,0),pcEnd:Math.max(r.pcEnd-o.startTime,0),pcStart:Math.max(r.pcStart-o.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-o.startTime,0),subscriberStart:Math.max(r.subscriberStart-o.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-o.startTime,0)});this.send({type:n,data:l},!0)}firstRemoteFrame(e,t,n,r){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,c=Date.now(),l=Ae(Ae(Ae({},a),r),{},{elapse:c-o.startTime,eventType:t,lts:c});this.send({type:n,data:l},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=Ae(Ae(Ae({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:o-n.startTime,eventType:on.PC_STATS,lts:o});this.send({type:_t.PC_STATS,data:a},!0)}onGatewayStream(e,t,n,r){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,c=Date.now(),l=Ae(Ae(Ae({},a),r),{},{eventType:t,lts:c});this.send({type:n,data:l},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=Ae(Ae({},r),{},{eventType:on.STREAM_SWITCH,lts:o,isDual:t.isdual,elapse:o-n.startTime,success:t.succ});this.send({type:_t.STREAM_SWITCH,data:a},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=Ae(Ae({},r),{},{eventType:on.REQUEST_PROXY_APPCENTER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:_t.REQUEST_PROXY_APPCENTER,data:a},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=Ae(Ae({},r),{},{eventType:on.REQUEST_PROXY_WORKER_MANAGER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:_t.REQUEST_PROXY_WORKER_MANAGER,data:a},!0)}setProxyServer(e){this.proxyServer=e,e?v.debug("reportProxyServerurl: ".concat(e)):v.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=Ae(Ae({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:o,elapse:o-n.startTime,joinChannelSuccessElapse:o-(n.lastJoinSuccessTime||o),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:_t.PEER_PUBLISH_STATUS,data:a},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now();(function(a,c,l){const h=a[c];if(!h||typeof h!="string")return[a];a[c]="";const f=Ba(JSON.stringify(a));let p=0;const E=[];let T=0;for(let y=0;y<h.length;y++)T+=h.charCodeAt(y)<=127?1:3,T<=l-f||(E[E.length]=Vs(Vs({},a),{},{[c]:h.substring(p,y)}),p=y,T=h.charCodeAt(y)<=127?1:3);return p!==h.length-1&&(E[E.length]=Vs(Vs({},a),{},{[c]:h.substring(p)})),E})(Ae(Ae(Ae({},r),t),{},{elapse:o-n.startTime,lts:o,productType:"WebRTC"}),"payload",1300).forEach(a=>this.send({type:_t.WORKER_EVENT,data:a},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=Ae(Ae(Ae({},r),t),{},{elapse:o-n.startTime,lts:o});this.send({type:_t.AP_WORKER_EVENT,data:a},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=Ae(Ae(Ae({},r),t),{},{elapse:o-n.startTime,lts:o,extend:t.extend||void 0});this.send({type:_t.JOIN_WEB_PROXY_AP,data:a},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=Ae(Ae(Ae({},r),t),{},{elapse:o-n.startTime,lts:o});this.send({type:_t.WEBSOCKET_QUIT,data:a},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>L("CUSTOM_REPORT_LIMIT"))throw new N(I.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),r=t.map(o=>({type:_t.USER_ANALYTICS,data:Ae(Ae({sid:e},o),{},{lts:n})}));try{L("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(o){throw v.error("send custom report message failed",o.toString()),new N(I.CUSTOM_REPORT_SEND_FAILED,o.message)}}autoplayFailed(e,t,n,r){if(!e)return;const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,c=Date.now(),l=Ae(Ae({},a),{},{vid:a.vid===void 0?0:Number(a.vid),lts:c,elapse:c-o.startTime,cbRegistered:Tr.onAutoplayFailed||Tr.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});this.send({type:_t.AUTOPLAY_FAILED,data:l},!0)}sendApiInvoke(e){const t=L("NOT_REPORT_EVENT");if(e.tag&&t.includes&&t.includes(e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:o,cid:a}=n.info;e.lts=e.lts||Date.now();let c;if(e.error)if(e.error instanceof N){const{code:h,message:f}=e.error;c=h||f||e.error.toString()}else c=e.error.toString();const l={invokeId:e.invokeId,sid:e.sid,cname:r,cid:a,uid:o,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?c:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:_t.API_INVOKE,data:l},!1),!0}appendSessionId(){this.clientList.forEach(e=>{if(e._sessionId){const t=this.apiInvokeUploadPendingItems.length;for(let n=0;n<t;n++){const r=this.apiInvokeUploadPendingItems.shift();r&&(r.sid=e._sessionId,this.sendApiInvoke(Object.assign({},r)))}}})}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>L("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const a=e.shift();n.length<20?n.push(a):r.push(a)}e.push(...r);for(const a of[...n]){var o;this.ltsList.indexOf(a.data.lts)!==-1?(a.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(a.data.lts)):(this.ltsList.push(a.data.lts),Tm(o=this.ltsList).call(o,(c,l)=>c-l))}return t||(this.lastSendNormalEventTime=Date.now()),L("ENABLE_EVENT_REPORT")&&n.length&&(L("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((a=>c=>{L("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(a):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(a),this.normalEventUploadPendingItems.length>L("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-L("NORMAL_EVENT_QUEUE_CAPACITY")),v.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){kt.networkState===In.OFFLINE&&await se.race([kt.onlineWaiter,Tn(2*Dt.maxRetryTimeout)]);const t=o=>{let a=new Uint8Array;return o.forEach(c=>{const l=Fm(JSON.stringify(c.data)),h=new ArrayBuffer(5),f=(E=>{let T=0;return Object.entries(_t).forEach(y=>{let[C,A]=y;A===E.type&&(T=Cm[C])}),T})(c),p=new DataView(h);p.setUint16(0,l.byteLength,!0),p.setUint8(2,255&f),p.setUint8(3,f>>>8&255),p.setUint8(4,f>>>16&255),a=Xy(a,new Uint8Array(h)),a=Xy(a,l)}),a},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(L("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(L("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let o=0;o<2;o+=1){o===1&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(L("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(L("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await Zr(r,{timeout:1e4,data:t(e),headers:Ae(Ae({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(a){if(o===1)throw a;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(a=>JSON.stringify(a)),vid:(a=>{const c=a&&a.data.sid&&this.baseInfoMap.get(a.data.sid);return c&&c.info.vid&&+c.info.vid||0})(e[0])};kt.networkState===In.OFFLINE&&await se.race([kt.onlineWaiter,Tn(2*Dt.maxRetryTimeout)]);const r=t?"/events/proto-raws":"/events/messages";let o=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(L("EVENT_REPORT_DOMAIN"),"&p=").concat(L("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(L("EVENT_REPORT_DOMAIN"),":").concat(L("STATS_COLLECTOR_PORT")).concat(r));for(let a=0;a<2;a+=1){a===1&&(o=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(L("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(L("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(L("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(L("STATS_COLLECTOR_PORT")).concat(r)));try{t?await bj(o,{timeout:1e4,data:n}):await Zr(o,{timeout:1e4,data:n})}catch(c){if(a===1)throw c;continue}return}}createBaseInfo(e,t){const n=Object.assign({},yV);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:ft.TRACER}).onSuccess()}};ou.on("REPORT_LOG_UPLOAD",e=>{e.networkState=kt.networkState,de.reportApiInvoke(null,{name:"logUploadError",options:e,tag:ft.TRACER})});class $y extends Et{constructor(t,n){super(),_(this,"trackMediaType",void 0),_(this,"_ID",void 0),_(this,"_rtpTransceiver",void 0),_(this,"_lowRtpTransceiver",void 0),_(this,"_hints",[]),_(this,"_isClosed",!1),_(this,"_originMediaStreamTrack",void 0),_(this,"_mediaStreamTrack",void 0),_(this,"_external",{}),this._ID=n||dt(8,"track-"),this._originMediaStreamTrack=t,this._mediaStreamTrack=t,function(r){Yc.includes(r)||Yc.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){if(!t){const n=de.reportApiInvoke(null,{name:Pt.GET_MEDIA_STREAM_TRACK,options:[],tag:ft.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?n.onSuccess(this._mediaStreamTrack.label):n.onSuccess("")}return this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===ka.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=Yc.indexOf(t);n!==-1&&Yc.splice(n,1)}(this),this.emit(Vo.CLOSED)}_updateRtpTransceiver(t,n){if(n===ka.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Jc.TRANSCEIVER_UPDATED,t,n)}}let Jt,Pj=1;class Mn{constructor(t){_(this,"lockingPromise",se.resolve()),_(this,"locks",0),_(this,"name",""),_(this,"lockId",void 0),this.lockId=Pj++,t&&(this.name=t),v.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(t){let n;this.locks+=1,v.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:""));const r=new se(a=>{n=()=>{this.locks-=1,v.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:"")),a()}}),o=this.lockingPromise.then(()=>n);return this.lockingPromise=this.lockingPromise.then(()=>r),o}}function Ua(e,t){return function(n,r,o){const a=o.value;if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const c=this[t];if(!c)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const l=await c.lock("From ".concat(e,".").concat(r));try{for(var h=arguments.length,f=new Array(h),p=0;p<h;p++)f[p]=arguments[p];return await a.apply(this,f)}finally{l()}},o}}class Bm extends $y{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}constructor(t,n){super(t,n),_(this,"_enabled",!0),_(this,"_muted",!1),_(this,"_isExternalTrack",!1),_(this,"_isClosed",!1),_(this,"_enabledMutex",void 0),_(this,"processor",void 0),_(this,"_processorContext",void 0),_(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Mn("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,v.debug("[".concat(this.getTrackId(),"] close")),this.emit(_e.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop(),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await vt(this,_e.NEED_REPLACE_TRACK,this),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Vo.TRACK_ENDED)}stateCheck(t,n){if(v.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),Da(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new N(I.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new N(I.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function Zy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}(function(e){e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change"})(Jt||(Jt={}));const eI=window.AudioContext||window.webkitAudioContext;let vr=null;const Ye=new class extends Et{constructor(){super(...arguments),_(this,"prevState",void 0),_(this,"curState",void 0),_(this,"currentTime",void 0),_(this,"currentTimeStuckAt",void 0),_(this,"interruptDetectorTrack",void 0),_(this,"onLocalAudioTrackMute",()=>{v.info("ios15-interruption-start"),this.emit(Jt.IOS_15_16_INTERRUPTION_START)}),_(this,"onLocalAudioTrackUnmute",async()=>{v.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?v.info("ios15-interruption-end-canceled"):(vr&&await vr.suspend(),this.emit(Jt.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){v.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){v.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Lj(){if(!eI)return void v.error("your browser is not support web audio");v.info("create audio context");const e=function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Zy(Object(r),!0).forEach(function(o){_(t,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Zy(Object(r)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(r,o))})}return t}({},L("WEBAUDIO_INIT_OPTIONS"));v.debug("audio context init option:",JSON.stringify(e)),vr=new eI(e),Ye.curState=vr.state,vr.onstatechange=()=>{Ye.prevState=Ye.curState,Ye.curState=vr?vr.state:void 0;const{prevState:t,curState:n}=Ye,r=n==="running",o=n==="interrupted",a=t==="running",c=t==="suspended",l=t==="interrupted",h=He().osVersion;(Pn()||Vi())&&a&&o&&(v.info("ios".concat(h,"-interruption-start")),Ye.emit(Jt.IOS_INTERRUPTION_START)),(Pn()||Vi())&&(c||l)&&r&&(v.info("ios".concat(h,"-interruption-end")),Ye.emit(Jt.IOS_INTERRUPTION_END)),t!==n&&(v.debug("AudioContext State Change","".concat(t,"=>").concat(n)),Ye.emit(Jt.STATE_CHANGE))},setInterval(()=>{var t;const n=(t=vr)===null||t===void 0?void 0:t.currentTime;Ye.currentTime!==n?(Ye.currentTimeStuckAt&&(v.debug("AudioContext current time resume at ".concat(n)),Ye.currentTimeStuckAt=void 0),Ye.currentTime=n):(n!==Ye.currentTimeStuckAt&&(de.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:ft.TRACER}).onSuccess(),v.warning("AudioContext current time stuck at ".concat(n))),Ye.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,o=!1,a=!1,c=!1;function l(O){t.state==="running"?h(!1):Pn()||Vi()?t.state==="suspended"&&(h(!0),O&&t.resume().then(p,p)):t.state!=="closed"&&(h(!0),O&&t.resume().then(p,p))}function h(O){if(o!==O){o=O;for(let M=0,U=n;M<U.length;M+=1){const q=U[M];O?window.addEventListener(q,E,{capture:!0,passive:!0}):window.removeEventListener(q,E,{capture:!0,passive:!0})}}}function f(){l(!0)}function p(){l(!1)}function E(){l(!0)}function T(O){if(!c)if(r.paused)if(O){y(!1),c=!0;let M;try{M=r.play(),M?M.then(C,C):(r.addEventListener("playing",C),r.addEventListener("abort",C),r.addEventListener("error",C))}catch{C()}}else y(!0);else y(!1)}function y(O){if(a!==O){a=O;for(let M=0,U=n;M<U.length;M++){const q=U[M];O?window.addEventListener(q,A,{capture:!0,passive:!0}):window.removeEventListener(q,A,{capture:!0,passive:!0})}}}function C(){r.removeEventListener("playing",C),r.removeEventListener("abort",C),r.removeEventListener("error",C),c=!1,T(!1)}function A(){T(!0)}if(Pn()){const O=t.createMediaStreamDestination(),M=document.createElement("div");M.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=M.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=O.stream,T(!0)}Ye.on(Jt.STATE_CHANGE,f),l(!1)}(vr)}function xa(){if(!vr){if(Lj(),!vr)throw new N(I.NOT_SUPPORTED,"can not create audio context");return vr}return vr}function tI(){return!!vr}function Us(e){if(function(){if(Gm!==null)return Gm;const r=xa(),o=r.createBufferSource(),a=r.createGain(),c=r.createGain();o.connect(a),o.connect(c),o.disconnect(a);let l=!1;try{o.disconnect(a)}catch{l=!0}return o.disconnect(),Gm=l,l}())return;const t=e.connect,n=e.disconnect;e.connect=(r,o,a)=>(e._inputNodes||(e._inputNodes=[]),e._inputNodes.includes(r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,o,a)):t.call(e,r,o)),e),e.disconnect=(r,o,a)=>{n.call(e),r?Qm(e._inputNodes,r):e._inputNodes=[];for(const c of e._inputNodes)t.call(e,c)}}let Gm=null;function nI(e,t){let n=!1;const r=1/t;if(L("DISABLE_WEBAUDIO")){const o=window.setInterval(()=>{n?window.clearInterval(o):e(performance.now()/1e3)},1e3*r)}else{const o=xa();let a=o.createGain();a.gain.value=0,a.connect(o.destination);const c=()=>{if(n)return void(a=null);const l=o.createOscillator();l.onended=c,l.connect(a),l.start(0),l.stop(o.currentTime+r),e(o.currentTime)};c()}return()=>{n=!0}}class rI{constructor(){_(this,"context",void 0),_(this,"analyserNode",void 0),_(this,"sourceNode",void 0),this.context=xa(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Pn()||Vi()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let o=0;o<t.length;++o)t[o]=r[o]/128-1}const n=bo(t).call(t,(r,o)=>r+o*o,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{v.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class iI extends Et{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),_(this,"outputNode",void 0),_(this,"outputTrack",void 0),_(this,"isPlayed",!1),_(this,"sourceNode",void 0),_(this,"context",void 0),_(this,"audioBufferNode",void 0),_(this,"destNode",void 0),_(this,"audioOutputLevel",0),_(this,"volumeLevelAnalyser",void 0),_(this,"_processedNode",void 0),_(this,"playNode",void 0),_(this,"isDestroyed",!1),_(this,"onNoAudioInput",void 0),_(this,"isNoAudioInput",!1),_(this,"_noAudioInputCount",0),this.context=xa(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Us(this.outputNode),this.volumeLevelAnalyser=new rI}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(zn.ON_AUDIO_BUFFER,function(r){for(let o=0;o<r.outputBuffer.numberOfChannels;o+=1){const a=r.outputBuffer.getChannelData(o);for(let c=0;c<a.length;c+=1)a[c]=0}return r.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ot().webAudioMediaStreamDest)throw new N(I.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&Ci(()=>{Ye.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Pn()||Vi()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let r;n.getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r));let o=!1;for(let a=0;a<r.length;a++)r[a]!==0&&(o=!0);return o?(this.isNoAudioInput=!1,!0):(await Tn(200),await this.checkHasAudioInput(t?t+1:1)&&o)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class Wm extends iI{get isFreeze(){return!1}constructor(t,n,r){var o;if(super(),_(this,"sourceNode",void 0),_(this,"track",void 0),_(this,"clonedTrack",void 0),_(this,"audioElement",void 0),_(this,"isCurrentTrackCloned",!1),_(this,"isRemoteTrack",!1),_(this,"originVolumeLevelAnalyser",void 0),_(this,"rebuildWebAudio",async()=>{if(v.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void v.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>v.info("resume success")),v.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const l=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?l.stop():this.isCurrentTrackCloned=!0;const h=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(h),Us(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const f=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(f,this.context.currentTime),Us(this.outputNode),this.emit(zn.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=h,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new N(I.UNEXPECTED_ERROR);this.track=t;const a=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(a),Us(this.sourceNode),r){const l=r.clone();l.enabled=!0,this.clonedTrack=l,v.debug("create an unmuted track ".concat(l.id," from the original track ").concat(r.id," to get the volume"));const h=this.context.createMediaStreamSource(new MediaStream([l]));Us(h),this.originVolumeLevelAnalyser=new rI,this.originVolumeLevelAnalyser.updateSource(h)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=a;const c=He();n&&c.os===pn.IOS&&Number((o=c.osVersion)===null||o===void 0?void 0:o.split(".")[0])<15&&(Ye.on(Jt.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(l=>{l||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Us(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(zn.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Ye.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),v.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([n]));Us(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function oI(e,t){const n=(o,a)=>o?typeof o!="number"?o.max||o.exact||o.ideal||o.min||a:o:a,r={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:n(t.height,1080),maxWidth:n(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(r.video.mandatory.maxFrameRate=t.frameRate.max,r.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(r.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function kj(e){const t=await sI(e.mediaSource),n=await function(r){return new se((o,a)=>{const c=document.createElement("div");c.innerText="share screen",c.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const l=document.createElement("div");l.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const h=document.createElement("div");h.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",h.setAttribute("style","height: 12%;");const f=document.createElement("div");f.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const p=document.createElement("div");p.setAttribute("style","text-align: right; padding: 16px 0;");const E=document.createElement("button");E.innerHTML="cancel",E.setAttribute("style","width: 85px;"),E.onclick=()=>{document.body.removeChild(T);const y=new Error("NotAllowedError");y.name="NotAllowedError",a(y)},p.appendChild(E),l.appendChild(h),l.appendChild(f),l.appendChild(p);const T=document.createElement("div");T.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),T.appendChild(c),T.appendChild(l),document.body.appendChild(T),r.map(y=>{if(y.id){const C=document.createElement("div");C.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let A=y.thumbnail;const{width:O}=A.getSize();O>1920&&(A=A.resize({width:1920})),C.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+A.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(y.name.replace(/[\u00A0-\u9999<>\&]/g,function(M){return"&#"+M.charCodeAt(0)+";"})+"</span>"),C.onclick=()=>{document.body.removeChild(T),o(y.id)},f.appendChild(C)}})})}(t);return await oI(n,e)}async function sI(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=aI();if(!n)throw new N(I.ELECTRON_IS_NULL);let r=null;try{var o;r=((o=n.desktopCapturer)===null||o===void 0?void 0:o.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new se((a,c)=>{n.desktopCapturer.getSources({types:t},(l,h)=>{l?c(l):a(h)})}));try{return await r}catch(a){throw new N(I.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,a.toString())}}let pu=null;function aI(){if(pu)return pu;try{return pu=window.require("electron"),pu}catch{return null}}function cI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}const Hm=new Mn("safari");let dI=!1,lI=!1;async function ei(e,t){let n=0,r=null;for(;n<2;)try{r=await Mj(e,t,n>0);break}catch(o){if(o instanceof N)throw v.error("[".concat(t,"] ").concat(o.toString())),o;const a=uI(o.name||o.code||o,o.message);if(a.code===I.MEDIA_OPTION_INVALID){v.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await Tn(500);continue}throw v.error("[".concat(t,"] ").concat(a.toString())),a}if(!r)throw new N(I.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function Mj(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new N(I.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=Ot(),o=new MediaStream;if(e.audioSource&&o.addTrack(e.audioSource),e.videoSource&&o.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return v.debug("Using Video Source/ Audio Source"),o;if(e.screen)if(aI())e.screen.sourceId?Va(o,await oI(e.screen.sourceId,e.screen)):Va(o,await kj(e.screen));else if(Yf()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new N(I.NOT_SUPPORTED,"This browser does not support screen sharing");v.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const T=await(c=e.screen.extensionId,l=t,new se((y,C)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},A=>{if(!A||!A.streamId)return v.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),A),void C(new N(I.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));y(A.streamId)})}catch(A){v.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),A.toString()),C(new N(I.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=T,Va(o,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var a;e.screen.mediaSource&&Ly(e.screen.mediaSource);const T={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(a=e.screen.displaySurface)!==null&&a!==void 0?a:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:y,surfaceSwitching:C,systemAudio:A}=e.screen,O={selfBrowserSurface:y,surfaceSwitching:C,systemAudio:A};!y&&delete O.selfBrowserSurface,!C&&delete O.surfaceSwitching,!A&&delete O.systemAudio,v.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:T,audio:!!e.screenAudio,controls:O})),Va(o,await navigator.mediaDevices.getDisplayMedia(function(M){for(var U=1;U<arguments.length;U++){var q=arguments[U]!=null?arguments[U]:{};U%2?cI(Object(q),!0).forEach(function(ae){_(M,ae,q[ae])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(q)):cI(Object(q)).forEach(function(ae){Object.defineProperty(M,ae,Object.getOwnPropertyDescriptor(q,ae))})}return M}({video:T,audio:!!e.screenAudio},O)))}else{if(!gt())throw v.error("[".concat(t,"] This browser does not support screenSharing")),new N(I.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&Ly(e.screen.mediaSource);const T={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};v.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(T))),Va(o,await navigator.mediaDevices.getUserMedia(T))}}var c,l;if(!e.video&&!e.audio)return o;let h={video:e.video,audio:e.audio},f=L("MEDIA_DEVICE_CONSTRAINTS");if(f)try{typeof f=="string"&&(f=JSON.parse(f)),h=function T(y,C){if(!mC(y)||!mC(C)||Array.isArray(y)&&!Array.isArray(C)||!Array.isArray(y)&&Array.isArray(C))return C;if(Array.isArray(C)&&Array.isArray(y)){const A=[...y];for(let O=0;O<C.length;O++)A[O]=T(y[O],C[O]);return A}{const A=Vs({},y);for(const O in C)Object.prototype.hasOwnProperty.call(C,O)&&(Object.prototype.hasOwnProperty.call(y,O)?A[O]=T(y[O],C[O]):A[O]=C[O]);return A}}(h,f)}catch{}v.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(h)),He();let p,E=null;(Dn()||Pn()||Jl())&&(E=await Hm.lock());try{p=await navigator.mediaDevices.getUserMedia(h)}catch(T){throw E&&E(),T}return h.audio&&(dI=!0),h.video&&(lI=!0),Va(o,p),E&&E(),o}function uI(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new N(I.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new N(I.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new N(I.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new N(I.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new N(I.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new N(I.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return v.error("getUserMedia unexpected error",e),new N(I.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Va(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],o=t.getVideoTracks()[0],a=t.getAudioTracks()[0];a&&(r&&e.removeTrack(r),e.addTrack(a)),o&&(n&&e.removeTrack(n),e.addTrack(o))}const Rr=new class extends Et{get state(){return this._state}set state(e){e!==this._state&&(this.emit(oo.STATE_CHANGE,e),this._state=e)}constructor(){super(),_(this,"_state",Mo.IDLE),_(this,"isAudioPermitted",!1),_(this,"isVideoPermitted",!1),_(this,"lastDeviceStatus",{audioPermitted:!1,videoPermitted:!1,hasVideoDevice:!1,hasAudioInputDevice:!1,hasAudioOutputDevice:!1}),_(this,"checkDeviceMatched",!1),_(this,"deviceInfoMap",new Map),this.init().then(()=>{var e,t;(e=navigator.mediaDevices)===null||e===void 0||(t=e.addEventListener)===null||t===void 0||t.call(e,"devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(L("ENUMERATE_DEVICES_INTERVAL")||(Xl()||vR()===pn.HARMONY_OS)&&Ns())&&this.updateDevicesInfo()},L("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>v.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new N(I.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),o=await this.checkMediaDeviceStatus(r);o.audioPermitted&&(this.isAudioPermitted=!0),o.videoPermitted&&(this.isVideoPermitted=!0);let a=e,c=t;(this.isAudioPermitted||!o.hasAudioInputDevice||this.lastDeviceStatus.hasAudioInputDevice)&&(a=!1),(this.isVideoPermitted||!o.hasVideoDevice||this.lastDeviceStatus.hasVideoDevice)&&(c=!1);let l=null;if(!n&&(a||c)){if(Hm.isLocked&&(v.debug("[device manager] wait GUM lock"),(await Hm.lock())(),v.debug("[device manager] GUM unlock")),dI&&(a=!1,this.isAudioPermitted=!0),lI&&(c=!1,this.isVideoPermitted=!0),v.debug("[device manager] check media device permissions",e,t,a,c),a||c){try{l=await navigator.mediaDevices.getUserMedia({audio:a,video:c})}catch(h){const f=uI(h.name||h.code||h,h.message);if(f.code===I.PERMISSION_DENIED)throw f;v.warning("getUserMedia failed in getDevices",f)}a&&(this.isAudioPermitted=!0),c&&(this.isVideoPermitted=!0)}v.debug("[device manager] mic permission",e,"cam permission",t)}l&&l.getTracks().forEach(h=>h.stop()),l=null;try{return navigator.mediaDevices.enumerateDevices()}catch(h){return new N(I.ENUMERATE_DEVICES_FAILED,h.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new N(I.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Mo.INITING;try{await this.updateDevicesInfo(),this.state=Mo.INITEND}catch(e){if(e instanceof N&&[I.DEVICE_NOT_FOUND,I.PERMISSION_DENIED].includes(e.code))return void(this.state=Mo.INITEND);throw v.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Mo.IDLE,!function(){return typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1"}()&&new N(I.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){let e=[];try{e=await this.enumerateDevices(!0,!0,this.lastDeviceStatus.audioPermitted&&this.lastDeviceStatus.videoPermitted)}catch(o){if(o instanceof N&&o.code===I.PERMISSION_DENIED){const a=await this.checkMediaDeviceStatus();this.lastDeviceStatus.hasAudioInputDevice=a.hasAudioInputDevice,this.lastDeviceStatus.hasAudioOutputDevice=a.hasAudioOutputDevice,this.lastDeviceStatus.hasVideoDevice=a.hasVideoDevice}throw o}const t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkDeviceMatched===!1){this.checkDeviceMatched=!0;const o=e.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),a=e.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");o&&a?a.groupId===o.groupId?v.debug("[device-check] default input ".concat(o.label," and output ").concat(a.label," is the same group")):v.warning("[device-check] default input ".concat(o.label," and output ").concat(a.label," is not the same group")):v.debug("[device-check] default input or output not found")}const r=await this.checkMediaDeviceStatus(e);e.forEach(o=>{if(!o.deviceId)return;const a=this.deviceInfoMap.get("".concat(o.kind,"_").concat(o.deviceId));if((a?a.state:"INACTIVE")!=="ACTIVE"){const c={initAt:t,updateAt:t,device:o,state:"ACTIVE"};this.deviceInfoMap.set("".concat(o.kind,"_").concat(o.deviceId),c),n.push(c)}a&&(a.updateAt=t)}),this.deviceInfoMap.forEach((o,a)=>{o.state==="ACTIVE"&&o.updateAt!==t&&(o.state="INACTIVE",n.push(o))}),this.state===Mo.INITEND&&n.forEach(o=>{switch(o.device.kind){case"audioinput":(this.lastDeviceStatus.audioPermitted||!this.lastDeviceStatus.hasAudioInputDevice)&&this.isAudioPermitted&&this.emit(oo.RECORDING_DEVICE_CHANGED,o);break;case"videoinput":(this.lastDeviceStatus.videoPermitted||!this.lastDeviceStatus.hasVideoDevice)&&this.isVideoPermitted&&this.emit(oo.CAMERA_DEVICE_CHANGED,o);break;case"audiooutput":(this.lastDeviceStatus.audioPermitted||!this.lastDeviceStatus.hasAudioOutputDevice)&&this.isAudioPermitted&&this.emit(oo.PLAYOUT_DEVICE_CHANGED,o)}}),r.audioPermitted&&(this.lastDeviceStatus.audioPermitted=!0,this.isAudioPermitted=!0),r.videoPermitted&&(this.lastDeviceStatus.videoPermitted=!0,this.isVideoPermitted=!0),this.lastDeviceStatus.hasAudioInputDevice=r.hasAudioInputDevice,this.lastDeviceStatus.hasAudioOutputDevice=r.hasAudioOutputDevice,this.lastDeviceStatus.hasVideoDevice=r.hasVideoDevice}async checkMediaDeviceStatus(e){if(!e)try{e=await navigator.mediaDevices.enumerateDevices()}catch(a){return new N(I.ENUMERATE_DEVICES_FAILED,a.toString()).throw()}const t=e.filter(a=>a.kind==="audioinput"),n=e.filter(a=>a.kind==="audiooutput"),r=e.filter(a=>a.kind==="audioinput"||a.kind==="audiooutput"),o=e.filter(a=>a.kind==="videoinput");return{audioPermitted:r.some(a=>a.label&&a.deviceId),videoPermitted:o.some(a=>a.label&&a.deviceId),hasAudioDevice:r.length>0,hasVideoDevice:o.length>0,hasAudioInputDevice:t.length>0,hasAudioOutputDevice:n.length>0}}},Uj=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],sr=new class{constructor(){_(this,"onAutoplayFailed",void 0),_(this,"elementMap",new Map),_(this,"elementStateMap",new Map),_(this,"elementsNeedToResume",[]),_(this,"sinkIdMap",new Map),_(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const r=this.elementStateMap.get(t),o=n.srcObject.getAudioTracks()[0];ya()?o&&o.readyState==="live"&&Ye.curState==="running"&&(v.debug("auto resume after interruption for iOS 15"),n.pause(),n.play()):r&&r==="paused"&&o&&o.readyState==="live"&&Ye.curState==="running"&&(v.debug("auto resume after interruption for iOS"),n.play())})}),_(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(v.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),Ye.on(Jt.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ye.on(Jt.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Ye.on(Jt.STATE_CHANGE,()=>{Pn()&&Ye.prevState==="suspended"&&Ye.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(r){throw new N(I.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const o=document.createElement("audio");o.autoplay=!0,o.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,o),this.elementMap.set(t,o),this.elementStateMap.set(t,mn.INIT),this.setVolume(t,n);const a=this.sinkIdMap.get(t);if(a)try{o.setSinkId(a).catch(l=>{v.warning("[".concat(t,"] set sink id failed"),l.toString())})}catch(l){v.warning("[".concat(t,"] set sink id failed"),l.toString())}const c=o.play();c&&c.then&&c.catch(l=>{r&&de.autoplayFailed(r,"audio",l.message,t),v.warning("audio element play warning",l.toString()),this.elementMap.has(t)&&l.name==="NotAllowedError"&&(v.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(o),Ci(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Jy()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){Uj.forEach(n=>{t.addEventListener(n,r=>{const o=this.elementStateMap.get(e),a=r.type==="pause"?"paused":r.type;if(v.debug("[".concat(e,"] audio-element-status change ").concat(o," => ").concat(a)),r.type==="error"){const c=t==null?void 0:t.error;c&&v.error("[".concat(e,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(e,a)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{v.debug("Auto resume audio element success")}).catch(n=>{v.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new se(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Wc()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Tt(){return function(e,t,n){const r=n.value;return typeof r=="function"&&(n.value=function(){this._isClosed&&new N(I.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];const l=r.apply(this,a);return l instanceof se?new se((h,f)=>{l.then(h).catch(f)}):l}),n}}var xj=No("Array").values,Vj=Do,jj=rr,Fj=z,Bj=xj,Km=Array.prototype,Gj={DOMTokenList:!0,NodeList:!0},Fi=function(e){var t=e.values;return e===Km||Fj(Km,e)&&t===Km.values||jj(Gj,Vj(e))?Bj:t};function hI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function fu(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?hI(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hI(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class pI extends Et{constructor(t){super(),_(this,"name","VideoProcessorDestination"),_(this,"ID","0"),_(this,"_source",void 0),_(this,"videoContext",void 0),_(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new N(I.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new N(I.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(gn.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(gn.ON_TRACK,void 0)}}class fI extends Et{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),_(this,"constraintsMap",new Map),_(this,"statsRegistry",[]),_(this,"usageRegistry",[]),_(this,"trackId",void 0),_(this,"direction",void 0),_(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await vn(this,qn.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var r;return v.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),vt(this,qn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fi(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return v.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),vt(this,qn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fi(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:o,cb:a}of this.statsRegistry)try{const c=a();t.push({processorID:n,processorName:r,type:o,stats:c})}catch(c){v.error(new N(I.UNEXPECTED_ERROR,c.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof se&&(r=await r),t.push(fu(fu({},r),{},{direction:this.direction}))}catch(r){v.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class mI extends Et{constructor(t){super(),_(this,"name","AudioProcessorDestination"),_(this,"ID","0"),_(this,"inputTrack",void 0),_(this,"inputNode",void 0),_(this,"audioProcessorContext",void 0),_(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new N(I.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new N(I.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(gn.ON_TRACK,void 0),this.emit(gn.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(gn.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(gn.ON_NODE,this.inputNode))}}class EI extends Et{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,r){super(),_(this,"constraintsMap",new Map),_(this,"statsRegistry",[]),_(this,"audioContext",void 0),_(this,"trackId",void 0),_(this,"direction",void 0),_(this,"usageRegistry",[]),_(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=r}async getConstraints(){return vn(this,qn.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var r;return v.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),vt(this,qn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fi(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),vt(this,qn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fi(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:o,cb:a}of this.statsRegistry)try{const c=a();t.push({processorID:n,processorName:r,type:o,stats:c})}catch(c){v.error(new N(I.UNEXPECTED_ERROR,c.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof se&&(r=await r),t.push(fu(fu({},r),{},{direction:this.direction}))}catch(r){v.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class Ym extends Et{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),_(this,"context",void 0),_(this,"processSourceNode",void 0),_(this,"outputTrack",void 0),_(this,"processedNode",void 0),_(this,"clonedTrack",void 0),_(this,"outputNode",void 0),this.outputNode=new Wj}setVolume(){}createOutputTrack(){throw new N(I.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Wj{disconnect(){}connect(){}}let mu,ja=null;class Hj{constructor(){_(this,"state","open"),_(this,"trigger",void 0),_(this,"tasks",[]),v.debug("[macro-task-queue] is created."),this.trigger=setTimeout(()=>{this.state="closed",v.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(t=>t.key),"]")),this.trigger=void 0,this.tasks.forEach(t=>{let{func:n}=t;return n()}),this.tasks.length=0,v.debug("[macro-task-queue] is closed.")})}enqueue(t,n){this.state!=="closed"&&(this.tasks.push({key:t,func:n}),v.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat(typeof t=="string"?t:"")))}runTask(t){if(this.state==="closed")return;const n=this.tasks.findIndex(r=>r.key===t);if(n!==-1){const r=this.tasks.splice(n,1);v.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat(typeof t=="string"?t:"")),r[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,v.debug("[macro-task-queue] is closed."))}}function zm(e){return function(t,n,r){var o;const a=(o=r.value)!==null&&o!==void 0?o:r.get,c=function(){ja&&ja.state==="open"&&ja.runTask(e);for(var l=arguments.length,h=new Array(l),f=0;f<l;f++)h[f]=arguments[f];return a==null?void 0:a.apply(this,...h)};return r.value?r.value=c:r.get=c,r}}var _I,gI,SI,TI,vI,RI,yI,II,CI,AI,OI,wI,NI,bI,DI,PI,LI,kI,MI,UI,xI,ze,VI,jI,FI,BI,GI,WI,Bi,HI,KI,YI,zI,qI,JI,XI,QI,$I,ZI,eC,tC,An;function nC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function qm(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nC(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})(mu||(mu={}));let Sn=(_I=zm("INIT_WEBAUDIO"),gI=zm("INIT_WEBAUDIO"),SI=zm("INIT_WEBAUDIO"),TI=fe({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),vI=fe({argsMap:(e,t)=>[e.getTrackId(),t]}),RI=Tt(),yI=Ua("LocalAudioTrack","_enabledMutex"),II=fe({argsMap:(e,t)=>[e.getTrackId(),t]}),CI=Tt(),AI=Ua("LocalAudioTrack","_enabledMutex"),OI=fe({argsMap:(e,t)=>[e.getTrackId(),t]}),wI=Tt(),NI=Tt(),bI=Tt(),DI=fe({argsMap:e=>[e.getTrackId()]}),PI=Tt(),LI=fe({argsMap:e=>[e.getTrackId()]}),kI=Tt(),MI=fe({argsMap:e=>[e.getTrackId()]}),UI=fe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),xI=fe({argsMap:e=>[e.getTrackId()]}),K((ze=class extends Bm{get _source(){return this._trackSource}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get processorDestination(){return this._processorDestination}set processorDestination(e){this._processorDestination=e}get isPlaying(){return this._useAudioElement?sr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r,o){super(e,n),_(this,"trackMediaType","audio"),_(this,"_encoderConfig",void 0),_(this,"_trackSource",void 0),_(this,"_enabled",!0),_(this,"_volume",100),_(this,"_useAudioElement",!1),_(this,"_bypassWebAudio",!1),_(this,"processor",void 0),_(this,"_processorContext",void 0),_(this,"_processorDestination",void 0),_(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r;const a=()=>{this.processorContext=new EI(this._source.context,this.getTrackId(),"local"),this.processorDestination=new mI(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(zn.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},c=o&&Dn()&&!tI();L("DISABLE_WEBAUDIO")?(this._source=new Ym,this._useAudioElement=!0,this._bypassWebAudio=!0):c?this._source=new Ym:(this._source=new Wm(e,!1,this._getOriginVolumeLevel?e:void 0),L("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),a(),!L("DISABLE_WEBAUDIO")&&c&&(ja||(ja=new Hj),ja).enqueue("INIT_WEBAUDIO",()=>{this._source=new Wm(e,!1,this._getOriginVolumeLevel?e:void 0),L("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),a(),this.emit(mu.UPDATE_TRACK_SOURCE)})}setVolume(e){it(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&sr.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void v.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,vt(this,_e.NEED_REPLACE_TRACK,this).then(()=>{v.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{v.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement)throw new N(I.NOT_SUPPORTED,"your browser does not support setting the audio output device");await sr.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await vt(this,_e.NEED_ENABLE_TRACK,this),v.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw n||(this._enabled=!1),v.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await vt(this,_e.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,v.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await vt(this,_e.NEED_MUTE_TRACK,this):await vt(this,_e.NEED_UNMUTE_TRACK,this))}getStats(){return $c(()=>{v.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),ti(this,_e.GET_STATS)||qm({},Om)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(zn.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(zn.ON_AUDIO_BUFFER),this._source.on(zn.ON_AUDIO_BUFFER,n=>e(n))}play(){v.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(v.debug("[".concat(this.getTrackId(),"] start audio playback in element")),sr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){v.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?sr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];v.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&sr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e.addEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:e,context:this.processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await vt(this,_e.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return se.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new N(I.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new N(I.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(gn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await vt(this,_e.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await vt(this,_e.NEED_REPLACE_TRACK,this))}),this.processorDestination.on(gn.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(gn.ON_TRACK),this.processorDestination.removeAllListeners(gn.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(qn.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(qn.REQUEST_CONSTRAINTS)}}).prototype,"_source",[_I],Object.getOwnPropertyDescriptor(ze.prototype,"_source"),ze.prototype),K(ze.prototype,"processorContext",[gI],Object.getOwnPropertyDescriptor(ze.prototype,"processorContext"),ze.prototype),K(ze.prototype,"processorDestination",[SI],Object.getOwnPropertyDescriptor(ze.prototype,"processorDestination"),ze.prototype),K(ze.prototype,"setVolume",[TI],Object.getOwnPropertyDescriptor(ze.prototype,"setVolume"),ze.prototype),K(ze.prototype,"setPlaybackDevice",[vI,RI],Object.getOwnPropertyDescriptor(ze.prototype,"setPlaybackDevice"),ze.prototype),K(ze.prototype,"setEnabled",[yI,II,CI],Object.getOwnPropertyDescriptor(ze.prototype,"setEnabled"),ze.prototype),K(ze.prototype,"setMuted",[AI,OI,wI],Object.getOwnPropertyDescriptor(ze.prototype,"setMuted"),ze.prototype),K(ze.prototype,"getStats",[NI],Object.getOwnPropertyDescriptor(ze.prototype,"getStats"),ze.prototype),K(ze.prototype,"setAudioFrameCallback",[bI],Object.getOwnPropertyDescriptor(ze.prototype,"setAudioFrameCallback"),ze.prototype),K(ze.prototype,"play",[DI,PI],Object.getOwnPropertyDescriptor(ze.prototype,"play"),ze.prototype),K(ze.prototype,"stop",[LI,kI],Object.getOwnPropertyDescriptor(ze.prototype,"stop"),ze.prototype),K(ze.prototype,"close",[MI],Object.getOwnPropertyDescriptor(ze.prototype,"close"),ze.prototype),K(ze.prototype,"pipe",[UI],Object.getOwnPropertyDescriptor(ze.prototype,"pipe"),ze.prototype),K(ze.prototype,"unpipe",[xI],Object.getOwnPropertyDescriptor(ze.prototype,"unpipe"),ze.prototype),ze),Eu=(VI=fe({argsMap:(e,t)=>[e.getTrackId(),t]}),jI=Tt(),FI=Ua("MicrophoneAudioTrack","_enabledMutex"),BI=fe({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),GI=Tt(),WI=fe({argsMap:e=>[e.getTrackId()]}),K((Bi=class extends Sn{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?cu(t.encoderConfig):{},r,L("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),_(this,"_config",void 0),_(this,"_deviceName","default"),_(this,"_constraints",void 0),_(this,"_originalConstraints",void 0),_(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(ya()||qf())&&Ye.bindInterruptDetectorTrack(this),this.on(mu.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),tI()&&this.bindProcessorContextEvents()}async setDevice(e){if(v.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await Rr.getDeviceById(e),n={};n.audio=qm({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await ei(n,this.getTrackId())}catch(o){throw v.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),r=await ei({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await Rr.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}v.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return v.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),n||(this._enabled=!1);try{await vt(this,_e.NEED_DISABLE_TRACK,this)}catch(c){throw v.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const o=qm({},this._constraints),a=Rr.searchDeviceIdByName(this._deviceName);a&&!o.deviceId&&(o.deviceId=a);try{n||(this._enabled=!0);const c=await ei({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await vt(this,_e.NEED_ENABLE_TRACK,this)}catch(c){throw n||(this._enabled=!1),v.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}v.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(ya()||qf())&&Ye.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Pn()||Vi())&&this._enabled&&!this._isClosed&&Ye.duringInterruption){const e=async()=>{Ye.off(Jt.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Ye.on(Jt.IOS_INTERRUPTION_END,e)}else v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Vo.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=Rr.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const r=await ei({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(){this.processorContext.on(qn.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),t()}catch(r){n(r)}}),this.processorContext.on(qn.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[VI,jI],Object.getOwnPropertyDescriptor(Bi.prototype,"setDevice"),Bi.prototype),K(Bi.prototype,"setEnabled",[FI,BI,GI],Object.getOwnPropertyDescriptor(Bi.prototype,"setEnabled"),Bi.prototype),K(Bi.prototype,"close",[WI],Object.getOwnPropertyDescriptor(Bi.prototype,"close"),Bi.prototype),Bi),Kj=(HI=fe({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),KI=Tt(),YI=fe({argsMap:e=>[e.getTrackId()]}),zI=Tt(),qI=fe({argsMap:e=>[e.getTrackId()]}),JI=Tt(),XI=fe({argsMap:e=>[e.getTrackId()]}),QI=Tt(),$I=fe({argsMap:e=>[e.getTrackId()]}),ZI=Tt(),eC=fe({argsMap:e=>[e.getTrackId()]}),tC=Tt(),K((An=class extends Sn{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),_(this,"source",void 0),_(this,"_bufferSource",void 0),this.source=e,this._bufferSource=t,this._bufferSource.on(zn.AUDIO_SOURCE_STATE_CHANGE,o=>{this.safeEmit(Vo.SOURCE_STATE_CHANGE,o)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}setAudioBufferPlaybackSpeed(e){it(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[HI,KI],Object.getOwnPropertyDescriptor(An.prototype,"startProcessAudioBuffer"),An.prototype),K(An.prototype,"pauseProcessAudioBuffer",[YI,zI],Object.getOwnPropertyDescriptor(An.prototype,"pauseProcessAudioBuffer"),An.prototype),K(An.prototype,"seekAudioBuffer",[qI,JI],Object.getOwnPropertyDescriptor(An.prototype,"seekAudioBuffer"),An.prototype),K(An.prototype,"resumeProcessAudioBuffer",[XI,QI],Object.getOwnPropertyDescriptor(An.prototype,"resumeProcessAudioBuffer"),An.prototype),K(An.prototype,"stopProcessAudioBuffer",[$I,ZI],Object.getOwnPropertyDescriptor(An.prototype,"stopProcessAudioBuffer"),An.prototype),K(An.prototype,"setAudioBufferPlaybackSpeed",[eC,tC],Object.getOwnPropertyDescriptor(An.prototype,"setAudioBufferPlaybackSpeed"),An.prototype),An);class Jn extends Sn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=xa().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,dt(8,"track-mix-")),_(this,"trackList",void 0),_(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(v.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):v.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){v.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}Qm(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof Jn?n.emit(Jc.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class Yj extends Et{constructor(){super(...arguments),_(this,"resultStorage",new Map)}setLocalAudioStats(t,n,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,n))}setLocalVideoStats(t,n,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r))}setRemoteAudioStats(t,n){const r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(n))}record(t,n,r){if(L("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const o=this.resultStorage.get(t);if(o&&(o.result.push(r),o.result.length>=5)){const a=o.result.includes(!0);o.isPrevNormal&&!a&&this.emit("exception",rC[t],t,n),!o.isPrevNormal&&a&&this.emit("exception",rC[t]+2e3,t+"_RECOVER",n),o.isPrevNormal=a,o.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof Jn&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let r=null;n._encoderConfig&&n._encoderConfig.frameRate&&(r=ao(n._encoderConfig.frameRate));const o=t.captureFrameRate;return!r||!o||!(r>10&&o<5||r<10&&r>=5&&o<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof Jn&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const rC={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ur=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function iC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function xs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?iC(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Fa{constructor(t){_(this,"store",void 0),_(this,"onStatsException",void 0),_(this,"onUploadPublishDuration",void 0),_(this,"onStatsChanged",void 0),_(this,"localStats",new Map),_(this,"remoteStats",new Map),_(this,"updateStatsInterval",void 0),_(this,"trafficStats",void 0),_(this,"trafficStatsPeerList",[]),_(this,"uplinkStats",void 0),_(this,"exceptionMonitor",void 0),_(this,"p2pChannel",void 0),_(this,"scalabilityMode",Hf.L1T1),_(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new Yj,this.exceptionMonitor.on("exception",(n,r,o)=>{this.onStatsException&&this.onStatsException(n,r,o)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ce.LocalAudioTrack)||xs({},Om)}getLocalVideoTrackStats(){return this.localStats.get(ce.LocalVideoTrack)||xs({},wm)}getRemoteAudioTrackStats(t){const n=(a,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(h=>h.peer_uid===a);return l&&(c.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},r={};if(t){var o;const a=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.audioStats;a&&(r[t]=n(t,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[c,{audioStats:l}]=a;l&&(r[c]=n(c,l))});return r}getRemoteNetworkQualityStats(t){const n={};if(t){var r;const o=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;o&&(n[t]=o)}else Array.from(this.remoteStats.entries()).forEach(o=>{let[a,{networkStats:c}]=o;c&&(n[a]=c)});return n}getRemoteVideoTrackStats(t){const n=(a,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(h=>h.peer_uid===a);return l&&(c.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},r={};if(t){var o;const a=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.videoStats;a&&(r[t]=n(t,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[c,{videoStats:l}]=a;l&&(r[c]=n(c,l))});return r}getRTCStats(){let t=0,n=0,r=0,o=0;const a=this.localStats.get(ce.LocalAudioTrack);a&&(t+=a.sendBytes,n+=a.sendBitrate);const c=this.localStats.get(ce.LocalVideoTrack);c&&(t+=c.sendBytes,n+=c.sendBitrate);const l=this.localStats.get(ce.LocalVideoLowTrack);l&&(t+=l.sendBytes,n+=l.sendBitrate),this.remoteStats.forEach(f=>{let{audioStats:p,videoStats:E}=f;p&&(r+=p.receiveBytes,o+=p.receiveBitrate),E&&(r+=E.receiveBytes,o+=E.receiveBitrate)});let h=1;return this.trafficStats&&(h+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:h,SendBitrate:n,SendBytes:t,RecvBytes:r,RecvBitrate:o,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var r;const o=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(n.peer_uid),a=o!=null&&o.videoSSRC?Ur.measureFromSubscribeStart(this.store.clientId,o.videoSSRC):0,c=o!=null&&o.audioSSRC?Ur.measureFromSubscribeStart(this.store.clientId,o.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,a>c?a:c),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&v.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,r){if(!t)return!1;const o=!!r&&n.framesDecodeFreezeTime>r.framesDecodeFreezeTime,a=!r||n.framesDecodeCount>r.framesDecodeCount;return o||!a}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[r,o]=n;switch(r){case ce.LocalVideoTrack:case ce.LocalVideoLowTrack:{const c=o,l=xs({},wm),h=t.getStats(),f=t.getLocalMedia(r);if(h){const p=h.videoSend.find(E=>E.ssrc===(f==null?void 0:f.ssrcs[0].ssrcId));if(p){const E=t.getLocalVideoSize(),T=t.getEncoderConfig(ce.LocalVideoTrack);p.codec!=="H264"&&p.codec!=="H265"&&p.codec!=="VP8"&&p.codec!=="VP9"&&p.codec!=="AV1X"&&p.codec!=="AV1"||(l.codecType=p.codec),l.sendBytes=p.bytes,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0,p.inputFrame?(l.captureFrameRate=p.inputFrame.frameRate,l.captureResolutionHeight=p.inputFrame.height,l.captureResolutionWidth=p.inputFrame.width):E&&(l.captureResolutionWidth=E.width,l.captureResolutionHeight=E.height),p.sentFrame?(l.sendFrameRate=p.sentFrame.frameRate,l.sendResolutionHeight=p.sentFrame.height,l.sendResolutionWidth=p.sentFrame.width):E&&(l.sendResolutionWidth=E.width,l.sendResolutionHeight=E.height),p.avgEncodeMs&&(l.encodeDelay=p.avgEncodeMs),T&&T.bitrateMax&&(l.targetSendBitrate=1e3*T.bitrateMax),l.sendPackets=p.packets,l.sendPacketsLost=p.packetsLost,l.totalDuration=c?c.totalDuration+1:1,l.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(p)&&(l.totalFreezeTime+=1),p.scalabilityMode&&this.scalabilityMode!==p.scalabilityMode&&(v.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(p.scalabilityMode)),this.scalabilityMode=p.scalabilityMode)}this.trafficStats&&(l.sendPacketsLost=this.trafficStats.B_pvlr4/100)}var a;this.localStats.set(r,l),((c==null?void 0:c.sendResolutionWidth)!==l.sendResolutionWidth||(c==null?void 0:c.sendResolutionHeight)!==l.sendResolutionHeight)&&((a=this.onStatsChanged)===null||a===void 0||a.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&f&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,f.track,l);break}case ce.LocalAudioTrack:{const c=o,l=xs({},Om),h=t.getStats(),f=t.getLocalMedia(r);if(h){const p=h.audioSend.find(E=>E.ssrc===(f==null?void 0:f.ssrcs[0].ssrcId));if(p){if(p.codec!=="opus"&&p.codec!=="aac"&&p.codec!=="PCMU"&&p.codec!=="PCMA"&&p.codec!=="G722"||(l.codecType=p.codec),p.inputLevel)l.sendVolumeLevel=Math.round(32767*p.inputLevel);else{const E=t.getLocalAudioVolume();E&&(l.sendVolumeLevel=Math.round(32767*E))}l.sendBytes=p.bytes,l.sendPackets=p.packets,l.sendPacketsLost=p.packetsLost,l.sendBitrate=c?8*Math.max(0,l.sendBytes-c.sendBytes):0}}this.trafficStats&&(l.sendPacketsLost=this.trafficStats.B_pvlr4/100),this.localStats.set(ce.LocalAudioTrack,l),l&&f&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,f.track,l);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{let[r,{videoStats:o,audioStats:a,videoPcStats:c}]=n;const l=a,h=o,f=c,p=xs({},Ny),E=xs({},by),T=xs({},CV),{audioTrack:y,videoTrack:C,audioSSRC:A,videoSSRC:O}=t.getRemoteMedia(r),M=t.getStats(),U=M==null?void 0:M.audioRecv.find(X=>X.ssrc===A),q=M==null?void 0:M.videoRecv.find(X=>X.ssrc===O),ae=this.trafficStats&&this.trafficStats.peer_delay.find(X=>X.peer_uid===r);if(U&&(U.codec!=="opus"&&U.codec!=="aac"&&U.codec!=="PCMU"&&U.codec!=="PCMA"&&U.codec!=="G722"||(p.codecType=U.codec),U.outputLevel?p.receiveLevel=Math.round(32767*U.outputLevel):y&&(p.receiveLevel=Math.round(32767*y.getVolumeLevel())),p.receiveBytes=U.bytes,p.receivePackets=U.packets,p.receivePacketsLost=U.packetsLost,p.packetLossRate=p.receivePacketsLost/(p.receivePackets+p.receivePacketsLost),p.receiveBitrate=l?8*Math.max(0,p.receiveBytes-l.receiveBytes):0,p.totalDuration=l?l.totalDuration+1:1,p.totalFreezeTime=l?l.totalFreezeTime:0,p.freezeRate=p.totalFreezeTime/p.totalDuration,p.receiveDelay=U.jitterBufferMs,p.totalDuration>10&&Fa.isRemoteAudioFreeze(y)&&(p.totalFreezeTime+=1)),q){q.codec!=="H264"&&q.codec!=="H265"&&q.codec!=="VP8"&&q.codec!=="VP9"&&q.codec!=="AV1X"&&q.codec!=="AV1"||(E.codecType=q.codec),E.receiveBytes=q.bytes,E.receiveBitrate=h?8*Math.max(0,E.receiveBytes-h.receiveBytes):0,E.decodeFrameRate=q.decodeFrameRate<0?0:q.decodeFrameRate,E.renderFrameRate=q.decodeFrameRate<0?0:q.decodeFrameRate,q.outputFrame&&(E.renderFrameRate=q.outputFrame.frameRate),q.receivedFrame?(E.receiveFrameRate=q.receivedFrame.frameRate,E.receiveResolutionHeight=q.receivedFrame.height,E.receiveResolutionWidth=q.receivedFrame.width):C&&(E.receiveResolutionHeight=C._videoHeight||0,E.receiveResolutionWidth=C._videoWidth||0),q.framesRateFirefox!==void 0&&(E.receiveFrameRate=Math.round(q.framesRateFirefox)),E.receivePackets=q.packets,E.receivePacketsLost=q.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.totalDuration=h?h.totalDuration+1:1,E.totalFreezeTime=h?h.totalFreezeTime:0,E.receiveDelay=q.jitterBufferMs||0;const X=!!O&&t.getRemoteVideoIsReady(O);C&&X&&Fa.isRemoteVideoFreeze(C,q,f)&&(E.totalFreezeTime+=1),E.freezeRate=E.totalFreezeTime/E.totalDuration}ae&&(p.end2EndDelay=ae.B_ad,E.end2EndDelay=ae.B_vd,p.transportDelay=ae.B_ed,E.transportDelay=ae.B_ed,p.currentPacketLossRate=ae.B_ealr4/100,E.currentPacketLossRate=ae.B_evlr4/100,T.uplinkNetworkQuality=ae.B_punq?ae.B_punq:0,T.downlinkNetworkQuality=ae.B_pdnq?ae.B_pdnq:0),this.remoteStats.set(r,{audioStats:p,videoStats:E,videoPcStats:q,networkStats:T}),y&&this.exceptionMonitor.setRemoteAudioStats(y,p),C&&this.exceptionMonitor.setRemoteVideoStats(C,E)})}}const so=new class extends Et{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),_(this,"_lastHiddenTime",0),_(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),v.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function oC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function _u(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?oC(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function gu(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(L("TURN_DOMAIN")):(v.info("Cannot recognized as IP address ".concat(e,". Used As Host instead")),e)}function sC(e,t){var n,r;const o=L("GATEWAY_DOMAINS");let a=o[1]&&t.indexOf(o[1])!==-1?1:0;e.addresses=e.addresses||[];const c=e.addresses.map(h=>h.domain_prefix?{address:"".concat(h.domain_prefix,".").concat(o[a++%o.length],":").concat(h.port)}:h.ip.match(/^[\.\:\d]+$/)?{ip:h.ip,port:h.port,address:"".concat(h.ip.replace(/[^\d]/g,"-"),".").concat(o[a++%o.length],":").concat(h.port)}:(v.info("Cannot recognized as IP address ".concat(h.ip,". Used As Host instead")),{ip:h.ip,port:h.port,address:"".concat(h.ip,":").concat(h.port)}));if((n=e.detail)!==null&&n!==void 0&&n[18]&&typeof((r=e.detail)===null||r===void 0?void 0:r[18])=="string"){const h=e.detail[18],f=h==null?void 0:h.split(";");for(let p=0;p<f.length;p++){var l;const E=to(l=f[p]).call(l);c[p]&&E&&(c[p].ip6=E)}}return{gatewayAddrs:c,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function ao(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function aC(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(ao(t.width),"x").concat(ao(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function cC(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Jm(e,t){let n,r,o;switch(t){case qt.CHOOSE_SERVER:n=4096,r="choose server";break;case qt.CLOUD_PROXY:n=1048576,r="proxy";break;case qt.CLOUD_PROXY_5:n=4194304,r="proxy5";break;case qt.CLOUD_PROXY_FALLBACK:n=4194310,r="proxy fallback";break;default:throw new N(I.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(a=>{a.buffer&&a.buffer.flag===n&&(o={code:a.buffer.code,addresses:(a.buffer.edges_services||[]).map(c=>_u(_u({},c),{},{ticket:a.buffer.cert})),server_ts:e.enter_ts,uid:a.buffer.uid,cid:a.buffer.cid,cname:a.buffer.cname,detail:_u(_u({},a.buffer.detail),e.detail),flag:a.buffer.flag,opid:e.opid,cert:a.buffer.cert})}),!o)throw new N(I.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return o}async function zj(e,t){return await se.all(e.addresses.map(async n=>({address:gu(n.ip),tcpport:n.port,udpport:n.port,username:t&&L("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Er.username,password:t&&L("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Dj(t.toString()):Er.password})))}function qj(e,t){const n=t._videoWidth||t.getMediaStreamTrack(!0).getSettings().width;return n||v.warning("cannot get original video track's width, default scale down 4 times for low stream"),n?n/ao(e.width):4}function Su(e){let{candidateType:t,relayProtocol:n,type:r,address:o,port:a,protocol:c}=e;return r==="local-candidate"?{candidateType:t,relayProtocol:n,protocol:c}:{candidateType:t,relayProtocol:n,address:o,port:a,protocol:c}}function dC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Vs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dC(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Ba(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function Tn(e){return new se(t=>{window.setTimeout(t,e)})}function Jj(e){const t=new N(I.TIMEOUT,"timeout");return new se((n,r)=>{window.setTimeout(()=>r(t),e)})}function dt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+dt(e-n.length,"")}function Xm(){return dt(32,"").toUpperCase()}const Tu=()=>{};function lC(e){return new se((t,n)=>{let r=!1;const o=document.createElement("video");o.setAttribute("autoplay",""),o.setAttribute("muted",""),o.muted=!0,o.autoplay=!0,o.setAttribute("playsinline",""),o.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(o);const a=Pn()?"canplay":"playing";o.addEventListener(a,()=>{const c=o.videoWidth,l=o.videoHeight;!c&&gt()||(r=!0,o.srcObject=null,o.remove(),t([c,l]))}),o.srcObject=new MediaStream([e]),o.play().catch(Tu),setTimeout(()=>{r||(o.srcObject=null,o.remove(),t([o.videoWidth,o.videoHeight]))},4e3)})}function Ga(e){return se.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}function vn(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return e.getListeners(t).length===0?se.reject(new N(I.UNEXPECTED_ERROR,"can not emit promise")):new se((a,c)=>{e.emit(t,...r,a,c)})}function vt(e,t){if(e.getListeners(t).length===0)return se.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return vn(e,t,...r)}function ti(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return js(e,t,...r)}function js(e,t){let n=null,r=null;for(var o=arguments.length,a=new Array(o>2?o-2:0),c=2;c<o;c++)a[c-2]=arguments[c];if(e.emit(t,...a,l=>{n=l},l=>{r=l}),r!==null)throw r;if(n===null)throw new N(I.UNEXPECTED_ERROR,"handler is not sync");return n}function Qm(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function uC(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function Ci(e){se.resolve().then(e)}function Mt(e){return JSON.parse(JSON.stringify(e))}const hC={};function $c(e,t){hC[t]||(hC[t]=!0,e())}function $m(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function vu(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}const pC=new class{constructor(){_(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var o=arguments.length,a=new Array(o>4?o-4:0),c=4;c<o;c++)a[c-4]=arguments[c];if(this.fnMap.has(t)){const l=this.fnMap.get(t);if(l.threshold!==n){l.fn(...l.args),clearTimeout(l.timer);const h=window.setTimeout(()=>{const f=this.fnMap.get(t);f&&f.fn(...f.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:h,args:a,skipFn:r})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(t,Vs(Vs({},l),{},{fn:e,args:a,skipFn:r}))}else{const l=window.setTimeout(()=>{const h=this.fnMap.get(t);h&&h.fn(...h.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:l,args:a,skipFn:r})}}},fC=pC.throttleByKey.bind(pC),Zc=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:o,promisesCollector:a}=e,c=0;const l=t;let h,f=0;const p=async()=>{const E=(()=>{const T=c*l,y=T+l;return n.slice(T,y).map(r)})();a&&a.push(...E);try{h=await Ga(E)}catch(T){if(f+=l,c++,!(f>=n.length))return void await p();o(T)}E.forEach(T=>T.cancel())};return await p(),h};function mC(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}const Xj={[Pa.ACCESS_POINT]:{[En.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[En.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[En.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[En.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[En.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[En.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[En.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[En.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[En.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[En.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[En.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[En.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[En.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[En.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[En.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[En.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[En.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[En.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Pa.UNILBS]:{[_r.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[_r.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[_r.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[_r.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[_r.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[_r.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[_r.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[_r.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[_r.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[_r.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[_r.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[_r.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Pa.STRING_UID_ALLOCATOR]:{[zc.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[zc.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[zc.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Ru(e){const t=Xj[Math.floor(e/1e4)];if(!t)return{desc:"unkonw error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===Pa.ACCESS_POINT){const r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return n}const Qj={[me.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[me.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[me.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[me.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[me.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[me.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[me.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[me.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[me.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[me.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[me.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[me.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[me.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[me.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[me.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[me.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[me.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[me.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[me.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[me.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[me.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[me.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[me.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[me.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[me.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[me.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[me.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[me.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[me.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[me.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[me.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[me.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[me.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[me.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[me.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[me.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[me.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[me.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[me.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[me.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[me.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[me.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[me.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[me.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[me.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[me.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[me.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[me.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[me.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[me.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[me.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[me.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[me.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[me.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[me.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[me.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[me.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[me.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[me.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[me.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[me.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[me.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[me.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[me.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function ed(e){return Qj[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function EC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}class Fs extends Et{get url(){return this.websocket?this.websocket.url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){["tryNext","recover"].includes(t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(ve.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(ve.CONNECTED):this._state==="closed"?this.emit(ve.CLOSED):this._state==="failed"&&this.emit(ve.FAILED))}resetReconnectCount(t){v.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=arguments.length>3&&arguments[3]!==void 0&&arguments[3],a=arguments.length>4?arguments[4]:void 0;super(),_(this,"connectionID",0),_(this,"currentURLIndex",0),_(this,"urls",void 0),_(this,"_reconnectMode","tryNext"),_(this,"reconnectReason",void 0),_(this,"_initMutex",new Mn("websocket")),_(this,"name",void 0),_(this,"_state","closed"),_(this,"reconnectInterrupter",void 0),_(this,"websocket",void 0),_(this,"retryConfig",void 0),_(this,"reconnectCount",0),_(this,"forceCloseTimeout",5e3),_(this,"onlineReconnectListener",void 0),_(this,"useCompress",void 0),_(this,"tryDoubleDomain",!1),_(this,"wsInflateLength",0),_(this,"wsDeflateLength",0),_(this,"closeEstablishingWs",()=>{}),_(this,"store",void 0),_(this,"joinChannelServiceRecordIndex",void 0),this.store=a,this.name=t,this.retryConfig=function(p){for(var E=1;E<arguments.length;E++){var T=arguments[E]!=null?arguments[E]:{};E%2?EC(Object(T),!0).forEach(function(y){_(p,y,T[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(T)):EC(Object(T)).forEach(function(y){Object.defineProperty(p,y,Object.getOwnPropertyDescriptor(T,y))})}return p}({},n),this.useCompress=r,this.tryDoubleDomain=o;const{timeout:c,timeoutFactor:l}=n,h=Math.max(300,Math.floor(3*c/5)),f=Math.max(1.2,Math.floor(8*l)/10);In.ONLINE&&(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=f),kt.on(jo.NETWORK_STATE_CHANGE,(p,E)=>{p!==E&&(this.resetReconnectCount("network state change: ".concat(E," -> ").concat(p)),p===In.ONLINE?(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=f):(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l))})}getConnection(){return this.websocket||void 0}init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this.forceCloseTimeout=n;const r=(o,a)=>{this.urls=t;const c=this.urls[this.currentURLIndex];this.state="connecting",this.createWebSocketConnection(c).then(o).catch(a),this.once(ve.CLOSED,()=>a(new N(I.WS_DISCONNECT))),this.once(ve.CONNECTED,()=>o())};return this._initMutex.lock().then(o=>new se((a,c)=>{r(a,c)}).then(()=>{o()}).catch(()=>{o()}))}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;n?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void v.warning("[".concat(this.name,"] can not reconnect, no websocket"));var r;t!==void 0&&(this.reconnectMode=t),v.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinChannelServiceRecordIndex=="number"&&((r=this.store)===null||r===void 0||r.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinChannelServiceRecordIndex));const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new N(I.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new N(I.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t,n){return this.connectionID+=1,this.connectionID,this.joinChannelServiceRecordIndex=void 0,new se((r,o)=>{var a;const c=p=>{var E;(E=this.store)===null||E===void 0||E.signalChannelOpen(),v.debug("[".concat(this.name,"] websocket opened:"),p),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r()},l=async p=>{if(v.debug("[".concat(this.name,"] websocket close ").concat(this.websocket&&this.websocket.url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");const E=ti(this,ve.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,T=await this.reconnectWithAction(E);if(this.state==="closed")return void v.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!T)return o(new N(I.WS_DISCONNECT,"websocket reconnect failed: ".concat(p.code))),void this.close(!0);r()}else o(new N(I.WS_DISCONNECT,"websocket close: ".concat(p.code))),this.close()},h=p=>{this.emit(ve.ON_MESSAGE,p)};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),L("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=L("GATEWAY_WSS_ADDRESS")),v.debug("[".concat(this.name,"] start connect, url: ").concat(t));const f=(a=this.store)===null||a===void 0?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});this.chooseBestWebsocketConnection(t,!!n,f).then(p=>{var E;this.websocket=p,c&&c(p.url),p.onclose=l,p.onmessage=h,(E=this.store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:"success"},f),this.joinChannelServiceRecordIndex=f}).catch(p=>{var E;if((E=this.store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:p instanceof N&&p.code===I.WS_ABORT?"aborted":"error",errors:[p]},f),this.state!=="closed"){if(p instanceof N&&p.code===I.WS_ERR){const T=new N(I.WS_ERR,"init websocket failed! Error: ".concat(p.toString()));return v.error("[".concat(this.name,"]").concat(T)),void o(T)}l&&l(p)}else o(new N(I.WS_DISCONNECT,"websocket is closed: ".concat(p.toString())))})})}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||!this.urls||this.state==="closed")return!1;this.onlineReconnectListener||kt.networkState!==In.OFFLINE||(this.onlineReconnectListener=kt.onlineWaiter&&kt.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>{r=!1},n){const c=lm(this.reconnectCount,this.retryConfig);v.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(t)),await se.race([Tn(c),this.onlineReconnectListener||new se(()=>{})])}if(this.state==="closed"||!r)return!1;this.reconnectCount+=1;const o=async(c,l)=>{this.emit(ve.RECONNECT_CREATE_CONNECTION,l),await this.createWebSocketConnection(c)};try{if(t==="retry"){const c=this.urls[this.currentURLIndex];this.emit(ve.RECONNECT_WAITTING_FINISH,t),await o(c,t)}else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover",!1);v.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex));const c=this.urls[this.currentURLIndex];this.emit(ve.RECONNECT_WAITTING_FINISH,t),await o(c,t)}else if(t==="recover"){v.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(ve.RECONNECT_WAITTING_FINISH,t),this.urls=await vn(this,ve.REQUEST_NEW_URLS),this.currentURLIndex=0;const c=this.urls[this.currentURLIndex];await o(c,t)}return!0}catch(c){var a;return v.error("[".concat(this.name,"] reconnect failed"),c.toString()),c!=null&&(a=c.data)!==null&&a!==void 0&&a.desc&&Array.isArray(c.data.desc)&&c.data.desc.length&&c.data.desc.includes("dynamic key expired")?(this.emit(ve.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,n)}}async chooseBestWebsocketConnection(t,n,r){return new se((o,a)=>{let c=!1;const l=[];this.closeEstablishingWs=()=>{v.debug("[choose-best-ws] close establishing websockets"),l.forEach(A=>{A.onclose=null,A.onopen=null,A.onmessage=null,A.close()}),a(new N(I.WS_ABORT,"choose best websocket aborted"))};const h=L("GATEWAY_DOMAINS");let f;const p=t.indexOf("?h="),E=h.find(A=>p!==-1?t.includes(A,p):t.includes(A));v.debug("[choose-best-ws] currentDomain: ",E,", domains: ",h);let T=!this.tryDoubleDomain||n||!E;if(!T&&E){var y;const A=Date.now();try{h.forEach(O=>{const M=p===-1?t.replace(E,O):t.substr(0,p)+t.substr(p).replace(E,O),U=new WebSocket(M);U.binaryType="arraybuffer",l.push(U),v.debug("[choose-best-ws] ws is connecting:",U.url)})}catch{for(v.debug("[choose-best-ws] ws create failed, fallback to single url"),l.forEach(M=>M.close());l.length;)l.pop();T=!0}(y=this.store)===null||y===void 0||y.recordJoinChannelService({urls:l.map(O=>O.url),service:"gateway"},r),l.forEach(O=>{O.onopen=()=>{if(c)return;const M=Date.now()-A;v.debug("[choose-best-ws] ws open cost ".concat(M,"ms")),l.filter(U=>U!==O).forEach(U=>{v.debug("[choose-best-ws]close backup websocket: ".concat(U.url)),U.close()}),c=!0,o(O)},O.onclose=M=>{f=M,!c&&(l.find(U=>!(U.readyState===WebSocket.CLOSED||U.readyState===WebSocket.CLOSING))||(v.debug("[choose-best-ws] all websocket is closed"),c=!0,a(f)))},O.onmessage=M=>{v.debug("[choose-best-ws]".concat(O.url," onmessage: ").concat(M.data))}}),Tn(this.forceCloseTimeout).then(()=>{l.forEach(O=>{O.readyState!==WebSocket.OPEN&&O.close()})})}if(T){var C;let A;v.debug("[choose-best-ws] use single url: ",t),(C=this.store)===null||C===void 0||C.recordJoinChannelService({urls:[t],service:"gateway"},r);try{A=new WebSocket(t),l.push(A),A.binaryType="arraybuffer"}catch(O){const M=new N(I.WS_ERR,"init websocket failed! Error: ".concat(O.toString()));return v.error("[".concat(this.name,"]").concat(M)),void a(M)}A.onopen=()=>{o(A)},A.onclose=O=>{a(O)},A.onmessage=O=>{v.debug("[choose-best-ws]".concat(A.url," onmessage: ").concat(O.data))},Tn(this.forceCloseTimeout).then(()=>{A&&A.readyState!==WebSocket.OPEN&&A.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class _C{constructor(t){_(this,"input",[]),_(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:bo(t=this.input).call(t,(n,r)=>n+r)/this.input.length}}class gC extends Et{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Qe.CONNECTED?this.emit(he.WS_CONNECTED):t===Qe.RECONNECTING?this.emit(he.WS_RECONNECTING,this._websocketReconnectReason):t===Qe.CLOSED&&this.emit(he.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),_(this,"_disconnectedReason",void 0),_(this,"_websocketReconnectReason",void 0),_(this,"_connectionState",Qe.CLOSED),_(this,"reconnectToken",void 0),_(this,"websocket",void 0),_(this,"openConnectionTime",void 0),_(this,"clientId",void 0),_(this,"lastMsgTime",Date.now()),_(this,"uploadCache",[]),_(this,"uploadCacheInterval",void 0),_(this,"rttRolling",new _C(5)),_(this,"pingpongTimer",void 0),_(this,"wsInflateDataTimer",void 0),_(this,"pingpongTimeoutCount",0),_(this,"joinResponse",void 0),_(this,"multiIpOption",void 0),_(this,"initError",void 0),_(this,"spec",void 0),_(this,"store",void 0),_(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(he.ON_BINARY_DATA,r.data);const o=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const a="res-@".concat(o._id);this.emit(a,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){if(this.emit(o._type,o._message),o._type===Ne.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===Ne.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(Ke.UID_BANNED);break;case 15:this.close(Ke.IP_BANNED);break;case 16:this.close(Ke.CHANNEL_BANNED)}if(o._type===Ne.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case me.ERR_LICENSE_MISSING:this.close(Ke.LICENSE_MISSING);break;case me.ERR_LICENSE_EXPIRED:this.close(Ke.LICENSE_EXPIRED);break;case me.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ke.LICENSE_MINUTES_EXCEEDED);break;case me.ERR_LICENSE_PERIOD_INVALID:this.close(Ke.LICENSE_PERIOD_INVALID);break;case me.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ke.LICENSE_MULTIPLE_SDK_SERVICE);break;case me.ERR_LICENSE_ILLEGAL:this.close(Ke.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new Fs("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Qe.CONNECTED&&this.reconnect("retry",Fn.OFFLINE)})}async request(t,n,r,o){const a=dt(6,""),c={_id:a,_type:t,_message:n},l=this.websocket.connectionID,h=()=>new se((C,A)=>{if(this.connectionState===Qe.CONNECTED)return C();const O=()=>{this.off(he.WS_CLOSED,M),C()},M=()=>{this.off(he.WS_CONNECTED,O),A(new N(I.WS_ABORT))};this.once(he.WS_CONNECTED,O),this.once(he.WS_CLOSED,M),t!==Ee.PUBLISH&&t!==Ee.SUBSCRIBE&&t!==Ee.UNSUBSCRIBE&&t!==Ee.UNPUBLISH&&t!==Ee.CONTROL&&t!==Ee.RESTART_ICE||this.once(he.DISCONNECT_P2P,()=>{A(new N(I.DISCONNECT_P2P))}),t!==Ee.PUBLISH&&t!==Ee.RESTART_ICE||this.once(he.ABORT_P2P_EXECUTION,()=>{A(new N(I.DISCONNECT_P2P))})});if(this.connectionState!==Qe.CONNECTING&&this.connectionState!==Qe.RECONNECTING||t===Ee.JOIN||t===Ee.REJOIN||await h(),this.websocket.sendMessage(c,!0),o)return;const f=new se((C,A)=>{let O=!1;const M=(q,ae)=>{O=!0,C({isSuccess:q==="success",message:ae||{}}),this.off(he.WS_CLOSED,U),this.off(he.WS_RECONNECTING,U),this.emit(he.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(a),M);const U=()=>{A(new N(I.WS_ABORT,"type: ".concat(t))),this.off(he.WS_CLOSED,U),this.off(he.WS_RECONNECTING,U),this.off("res-@".concat(a),M)};this.once(he.WS_CLOSED,U),this.once(he.WS_RECONNECTING,U),Tn(L("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||O||(v.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(he.REQUEST_TIMEOUT,t,n))})});let p=null;try{p=await f}catch(C){if(this.connectionState===Qe.CLOSED||t===Ee.LEAVE)throw new N(I.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?C.throw():t===Ee.JOIN||t===Ee.REJOIN?null:(await h(),await this.request(t,n))}if(p.isSuccess)return p.message;const E=Number(p.message.error_code||p.message.code),T=ed(E),y=new N(I.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(p.message.error_str),{code:E,data:p.message});return T.action==="success"?p.message:(v.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(T.desc,", action: ").concat(T.action)),E===me.ERR_TOO_MANY_BROADCASTERS?((t===Ee.JOIN||t===Ee.REJOIN)&&(this.initError=y,this.close()),y.throw()):T.action==="failed"?y.throw():T.action==="quit"?(this.initError=y,this.close(),y.throw()):(E===me.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Fn.MULTI_IP)):this.reconnect(T.action,Fn.SERVER_ERROR),t===Ee.JOIN||t===Ee.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new se(r=>{const o=a=>{(!n||n(a))&&(this.off(t,o),r(a))};this.on(t,o)})}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const a=L("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Qe.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},L("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new se((r,o)=>{this.once(he.WS_CONNECTED,()=>r(this.joinResponse)),this.once(he.WS_CLOSED,()=>o(this.initError||new N(I.WS_ABORT))),this.connectionState=Qe.CONNECTING,this.websocket.init(t).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4),setTimeout(()=>{n&&this.openConnectionTime===void 0&&(v.debug("[".concat(this.clientId,"] init websocket timeout while join with fallback to proxy")),o(new N(I.INIT_WEBSOCKET_TIMEOUT)))},L("JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Ke.LEAVE,this.connectionState=Qe.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===Ke.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Fs("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(he.ABORT_P2P_EXECUTION);const t=await vn(this,he.REQUEST_JOIN_INFO),n=await this.request(Ee.JOIN,t);if(!n)return this.emit(he.REPORT_JOIN_GATEWAY,I.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(he.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Qe.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new N(I.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=js(this,he.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(Ee.REJOIN,t);return!!n&&(this.connectionState=Qe.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(Ne.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Ne.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Ne.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Ne.MUTE_AUDIO,{uid:r.uid}):this.emit(Ne.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Ne.MUTE_VIDEO,{uid:r.uid}):this.emit(Ne.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Ne.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Ne.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Ne.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Ne.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Ne.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){v.debug("[".concat(this.clientId,"] receive notification: "),t);const n=ed(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ke.UID_BANNED),void this.close()):void this.reconnect(n.action,Fn.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=L("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(v.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>L("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Fn.TIMEOUT):this.request(Ee.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),L("REPORT_STATS")&&this.send(Ee.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(ir.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(ve.RECONNECT_WAITTING_FINISH,t=>{this.emit(he.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(ve.RECONNECT_CREATE_CONNECTION,t=>{this.emit(he.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(ve.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ve.CLOSED,()=>{this.connectionState=Qe.CLOSED}),this.websocket.on(ve.FAILED,()=>{this._disconnectedReason=Ke.NETWORK_ERROR,this.connectionState=Qe.CLOSED}),this.websocket.on(ve.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Qe.CONNECTED?this.connectionState=Qe.RECONNECTING:this.connectionState=Qe.CONNECTING}),this.websocket.on(ve.WILL_RECONNECT,(t,n)=>{if(js(this,he.IS_P2P_DISCONNECTED)&&t==="retry")return v.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(v.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P)),n(t)}),this.websocket.on(ve.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{v.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Fn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(he.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof N&&t.code===I.UNEXPECTED_RESPONSE&&t.data.code===me.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Fn.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Fn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(ve.REQUEST_NEW_URLS,(t,n)=>{vn(this,he.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(ve.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function SC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}class $j extends Et{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){["tryNext","recover"].includes(t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(St.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(St.CONNECTED):this._state==="closed"?this.emit(St.CLOSED):this._state==="failed"&&this.emit(St.FAILED))}constructor(t,n,r,o){super(),_(this,"connectionID",0),_(this,"currentURLIndex",0),_(this,"reconnectReason",void 0),_(this,"_reconnectMode","tryNext"),_(this,"_initMutex",void 0),_(this,"_name",void 0),_(this,"_state","closed"),_(this,"_reconnectInterrupter",void 0),_(this,"_url",void 0),_(this,"_retryConfig",void 0),_(this,"_reconnectCount",0),_(this,"_forceCloseTimeout",5e3),_(this,"_onlineReconnectListener",void 0),_(this,"_closeEstablishingTransmitter",()=>{}),_(this,"_store",void 0),_(this,"_joinChannelServiceRecordIndex",void 0),_(this,"_transmitter",void 0),_(this,"_useCompress",void 0),_(this,"_inflateLength",0),_(this,"_deflateLength",0),this._store=o,this._name=t,this._retryConfig=function(a){for(var c=1;c<arguments.length;c++){var l=arguments[c]!=null?arguments[c]:{};c%2?SC(Object(l),!0).forEach(function(h){_(a,h,l[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(l)):SC(Object(l)).forEach(function(h){Object.defineProperty(a,h,Object.getOwnPropertyDescriptor(l,h))})}return a}({},n),this._useCompress=r}resetReconnectCount(t){v.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const r=this._transmitter;n?setTimeout(()=>r.close(),500):r.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,n){if(!this._transmitter)return void v.warning("[".concat(this._name,"] can not reconnect, no websocket"));var r;t!==void 0&&(this.reconnectMode=t),v.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((r=this._store)===null||r===void 0||r.recordJoinChannelService({status:"error",errors:[new Error(n)]},this._joinChannelServiceRecordIndex));const o=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),o&&o.bind(this._transmitter)({code:9999,reason:n})}getInflateData(){const t=this._inflateLength,n=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:n}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}function TC(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);const r=e.getUint32(t,n),o=e.getUint32(t+4,n),a=+!!n,c=+!n;return BigInt(r*c+o*a)<<BigInt(32)|BigInt(r*a+o*c)}function vC(e,t,n,r){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,r);const o=Number(n>>BigInt(32)),a=Number(n&BigInt(4294967295));r?(e.setUint32(t+4,o,r),e.setUint32(t,a,r)):(e.setUint32(t,o,r),e.setUint32(t+4,a,r))}let xr;(function(e){e[e.Default=0]="Default",e[e.Ack=1]="Ack"})(xr||(xr={}));class Zj{constructor(t,n,r){_(this,"version",1),_(this,"initialRTO",void 0),_(this,"maxBatchAckCount",void 0),_(this,"maxRTO",void 0),_(this,"initialRTT",void 0),_(this,"ID",void 0),_(this,"rtt",void 0),_(this,"packetNumber",1),_(this,"rtoRatioMap",new Map),_(this,"timeoutMap",new Map),_(this,"unorderedPacketQueue",[]),_(this,"batchAckPacketQueue",[]),_(this,"lastOrderedPacketNumber",0),_(this,"batchAckTimer",void 0),_(this,"sendImpl",void 0),_(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=n,this.ID=dt(7,"transmitter-"),this.initialRTO=(r==null?void 0:r.initialRTO)!==void 0?r.initialRTO:L("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(r==null?void 0:r.initialRTT)!==void 0?r.initialRTT:L("TRANSMITTER_INITIAL_RTT"),this.rtt=(r==null?void 0:r.initialRTT)!==void 0?r.initialRTT:L("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(r==null?void 0:r.maxBatchAckCount)!==void 0?r.maxBatchAckCount:L("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(r==null?void 0:r.maxRTO)!==void 0?r.maxRTO:L("TRANSMITTER_MAX_RTO")}packetize(t,n){return{type:xr.Default,version:this.version,packetNumber:n,payload:t}}serialize(t){switch(t.type){case xr.Default:{let n;typeof t.payload=="string"?n=new TextEncoder().encode(t.payload):n=t.payload;const r=new ArrayBuffer(n.length+15),o=new DataView(r);return o.setUint16(0,t.version),o.setUint8(2,t.type),o.setUint32(3,t.packetNumber),vC(o,7,BigInt(t.sendTs)),new Uint8Array(o.buffer).set(n,15),r}case xr.Ack:{const n=new ArrayBuffer(16),r=new DataView(n);return r.setUint16(0,t.version),r.setUint8(2,t.type),r.setUint32(3,t.maxAckPacketNumber),r.setUint8(7,t.shift),vC(r,8,BigInt(t.ackSendTs)),n}}}deserialize(t){const n=new DataView(t),r=n.getUint16(0),o=n.getUint8(2);switch(o){case xr.Default:{const a=n.getUint32(3),c=TC(n,7),l=t.slice(15),h=new TextDecoder().decode(l);return{version:r,type:o,packetNumber:a,sendTs:Number(c),payload:h}}case xr.Ack:{const a=n.getUint32(3),c=n.getUint8(7),l=TC(n,8);return{version:r,type:o,maxAckPacketNumber:a,shift:c,ackSendTs:Number(l)}}default:throw v.error("[".concat(this.ID,"] Unrecognized packet type ").concat(o)),new Error("Unrecognized packet type ".concat(o))}}sendMessage(t){const n=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const r=this.calculateRTO(n),o=window.setTimeout(()=>{this.resendMessage(n)},r);this.timeoutMap.set(n.packetNumber,o),this.sendPacket(n)}onData(t){const n=this.deserialize(t);n.type===xr.Default?this.ack(n):n.type===xr.Ack&&(this.updateRTT(n,Math.round(performance.now())),this.clearRTO(n))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[n,r]=t;window.clearTimeout(r)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const n=this.calculateRTO(t),r=window.setTimeout(()=>{this.resendMessage(t)},n);this.timeoutMap.set(t.packetNumber,r),this.sendPacket(t)}calculateRTO(t){const n=this.rtoRatioMap.get(t.packetNumber);if(n===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const r=9*this.rtt/8*n;return this.rtoRatioMap.set(t.packetNumber,n+1),r>this.maxRTO?this.maxRTO:r}}updateRTT(t,n){const r=t.ackSendTs;this.rtt=this.rtt*(7/8)+(n-r-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const n=this.unorderedPacketQueue[0];if(!n){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(n.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:xr.Ack,version:this.version};this.sendPacket(n)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:xr.Ack,version:this.version};this.sendPacket(n)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:xr.Ack,version:this.version};this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===xr.Default&&(t.sendTs=Math.round(performance.now()));const n=this.serialize(t);this.sendImpl(n)}clearRTO(t){for(let n=t.maxAckPacketNumber-t.shift;n<=t.maxAckPacketNumber;n++){const r=this.timeoutMap.get(n);r!==void 0&&window.clearTimeout(r),this.timeoutMap.delete(n),this.rtoRatioMap.delete(n)}}}class RC extends $j{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),_(this,"_initMutex",void 0),_(this,"_reconnectInterrupter",void 0),_(this,"_url",void 0),_(this,"_transmitter",void 0),_(this,"_addresses",void 0),_(this,"_reliableTransmission",void 0),this._initMutex=new Mn("datachannel");const{timeout:r,timeoutFactor:o}=n,a=Math.max(300,Math.floor(3*r/5)),c=Math.max(1.2,Math.floor(8*o)/10);In.ONLINE&&(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=c),kt.on(jo.NETWORK_STATE_CHANGE,(l,h)=>{l!==h&&(this.resetReconnectCount("network state change: ".concat(h," -> ").concat(l)),l===In.ONLINE?(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=c):(this._retryConfig.timeout=r,this._retryConfig.timeoutFactor=o))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=n;const r=(o,a)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(l=>l.fingerprint||L("FINGERPRINT"));const c=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(c).then(o).catch(a),this.once(St.CLOSED,()=>a(new N(I.WS_DISCONNECT))),this.once(St.CONNECTED,()=>o())};return this._initMutex.lock().then(o=>new se((a,c)=>{r(a,c)}).then(()=>{o()}).catch(()=>{o()}))}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new N(I.WS_ABORT,"datachannel is not ready");try{n||(t=JSON.stringify(t)),this._reliableTransmission.sendMessage(t)}catch(r){throw new N(I.WS_ERR,"send datachannel signal message error"+r.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const n=JSON.stringify(t);return{compressed:n,compressedLength:n.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new se((n,r)=>{var o;const a=()=>{v.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n()},c=async p=>{var E;if((E=this._closeEstablishingTransmitter)===null||E===void 0||E.call(this),v.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");const T=ti(this,St.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,y=await this.reconnectWithAction(T);if(this.state==="closed")return void v.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!y)return r(new N(I.WS_DISCONNECT,"datachannel reconnect failed: ".concat(p.code))),void this.close(!0);n()}else r(new N(I.WS_DISCONNECT,"datachannel close: ".concat(p.code))),this.close()},l=p=>{var E;(E=this._reliableTransmission)===null||E===void 0||E.onData(p.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),v.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const h=(o=this._store)===null||o===void 0?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),f=Date.now();vn(this,St.TO_CONNECT_DATACHANNEL,t).then(p=>{var E,T;if(!p)throw new Error("transmissonInfo not exist yet");const{transmitter:y,close:C}=p;this._transmitter=y,(E=this._store)===null||E===void 0||E.signalChannelOpen();const A=Date.now()-f;v.debug("[choose dc] dc open cost ".concat(A,"ms")),this._reliableTransmission=new Zj(O=>{var M;this._transmitter&&this._transmitter.readyState==="open"&&((M=this._transmitter)===null||M===void 0||M.send(O))},O=>{typeof O=="string"&&this.emit(St.ON_MESSAGE,O)}),this._closeEstablishingTransmitter=()=>{var O;(O=this._reliableTransmission)===null||O===void 0||O.close(),this._reliableTransmission=void 0,C()},a&&a(),y.onclose=c,y.onmessage=l,(T=this._store)===null||T===void 0||T.recordJoinChannelService({endTs:Date.now(),status:"success"},h),this._joinChannelServiceRecordIndex=h}).catch(p=>{var E;if((E=this._store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:p instanceof N&&p.code===I.WS_ABORT?"aborted":"error",errors:[p]},h),this.state!=="closed"){if(p instanceof N&&p.code===I.WS_ERR){const T=new N(I.WS_ERR,"init datachannel failed! Error: ".concat(p.toString()));return v.error("[".concat(this._name,"]").concat(T)),void r(T)}c&&c(p)}else r(new N(I.WS_DISCONNECT,"datachannel is closed: ".concat(p.toString())))})})}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||kt.networkState!==In.OFFLINE||(this._onlineReconnectListener=kt.onlineWaiter&&kt.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let r=!0;if(this._reconnectInterrupter=()=>{r=!1},n){const c=lm(this._reconnectCount,this._retryConfig);v.debug("[".concat(this._name,"] wait ").concat(c,"ms to reconnect datachannel, mode: ").concat(t)),await se.race([Tn(c),this._onlineReconnectListener||new se(()=>{})])}if(this.state==="closed"||!r)return!1;this._reconnectCount+=1;const o=async(c,l)=>{this.emit(St.RECONNECT_CREATE_CONNECTION,l),await this.createTransmitterConnection(c)};try{if(t==="retry"){const c=this._addresses[this.currentURLIndex];this.emit(St.RECONNECT_WAITTING_FINISH,t),await o(c,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let l=this.currentURLIndex;l<this._addresses.length;l++){if(this._addresses[l].fingerprint||L("FINGERPRINT")){this.currentURLIndex=l;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return v.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);v.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const c=this._addresses[this.currentURLIndex];this.emit(St.RECONNECT_WAITTING_FINISH,t),await o(c,t)}else t==="recover"&&(v.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(St.RECONNECT_WAITTING_FINISH,t),this.emit(St.FAILBACK));return!0}catch(c){var a;return v.error("[".concat(this._name,"] reconnect failed"),c.toString()),c!=null&&(a=c.data)!==null&&a!==void 0&&a.desc&&Array.isArray(c.data.desc)&&c.data.desc.length&&c.data.desc.includes("dynamic key expired")?(this.emit(St.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,n)}}}class co extends Et{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Qe.CONNECTED?this.emit(he.WS_CONNECTED):t===Qe.RECONNECTING?this.emit(he.WS_RECONNECTING,this._websocketReconnectReason):t===Qe.CLOSED&&this.emit(he.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),_(this,"_disconnectedReason",void 0),_(this,"_websocketReconnectReason",void 0),_(this,"_connectionState",Qe.CLOSED),_(this,"reconnectToken",void 0),_(this,"websocket",void 0),_(this,"openConnectionTime",void 0),_(this,"clientId",void 0),_(this,"lastMsgTime",Date.now()),_(this,"uploadCache",[]),_(this,"uploadCacheInterval",void 0),_(this,"rttRolling",new _C(5)),_(this,"pingpongTimer",void 0),_(this,"inflateDataTimer",void 0),_(this,"pingpongTimeoutCount",0),_(this,"joinResponse",void 0),_(this,"multiIpOption",void 0),_(this,"initError",void 0),_(this,"spec",void 0),_(this,"store",void 0),_(this,"onWebsocketMessage",r=>{if(r instanceof ArrayBuffer)return void this.emit(he.ON_BINARY_DATA,r);const o=JSON.parse(r);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const a="res-@".concat(o._id);this.emit(a,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")&&(this.emit(o._type,o._message),o._type===Ne.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===Ne.ON_USER_BANNED))switch(o._message.error_code){case 14:this.close(Ke.UID_BANNED);break;case 15:this.close(Ke.IP_BANNED);break;case 16:this.close(Ke.CHANNEL_BANNED)}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new RC("gateway-".concat(this.clientId),this.spec.retryConfig,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Qe.CONNECTED&&this.reconnect("retry",ji.OFFLINE)})}async request(t,n,r,o){const a=dt(6,""),c={_id:a,_type:t,_message:n},l=this.websocket.connectionID,h=()=>new se((C,A)=>{if(this.connectionState===Qe.CONNECTED)return C();const O=()=>{this.off(he.WS_CLOSED,M),C()},M=()=>{this.off(he.WS_CONNECTED,O),A(new N(I.WS_ABORT))};this.once(he.WS_CONNECTED,O),this.once(he.WS_CLOSED,M),t!==Ee.PUBLISH&&t!==Ee.SUBSCRIBE&&t!==Ee.UNSUBSCRIBE&&t!==Ee.UNPUBLISH&&t!==Ee.CONTROL&&t!==Ee.RESTART_ICE||this.once(he.DISCONNECT_P2P,()=>{A(new N(I.DISCONNECT_P2P))}),t!==Ee.PUBLISH&&t!==Ee.RESTART_ICE||this.once(he.ABORT_P2P_EXECUTION,()=>{A(new N(I.DISCONNECT_P2P))})});if(this.connectionState!==Qe.CONNECTING&&this.connectionState!==Qe.RECONNECTING||t===Ee.JOIN||t===Ee.REJOIN||await h(),t===Ee.LEAVE&&(this.websocket.unbindDcCloseEventListener(),o=!0),this.websocket.sendMessage(c,!0,!1),o)return;const f=new se((C,A)=>{let O=!1;const M=(q,ae)=>{O=!0,C({isSuccess:q==="success",message:ae||{}}),this.off(he.WS_CLOSED,U),this.off(he.WS_RECONNECTING,U),this.emit(he.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(a),M);const U=()=>{A(new N(I.WS_ABORT,"type: ".concat(t))),this.off(he.WS_CLOSED,U),this.off(he.WS_RECONNECTING,U),this.off("res-@".concat(a),M)};this.once(he.WS_CLOSED,U),this.once(he.WS_RECONNECTING,U),Tn(L("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||O||(v.warning("dc request timeout, type: ".concat(t)),this.emit(he.REQUEST_TIMEOUT,t,n))})});let p=null;try{p=await f}catch(C){if(this.connectionState===Qe.CLOSED||t===Ee.LEAVE)throw new N(I.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?C.throw():t===Ee.JOIN||t===Ee.REJOIN?null:(await h(),await this.request(t,n))}if(p.isSuccess)return p.message;const E=Number(p.message.error_code||p.message.code),T=ed(E),y=new N(I.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(p.message.error_str),{code:E,data:p.message});return T.action==="success"?p.message:(v.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(T.desc,", action: ").concat(T.action)),E===me.ERR_TOO_MANY_BROADCASTERS?((t===Ee.JOIN||t===Ee.REJOIN)&&(this.initError=y,this.close()),y.throw()):T.action==="failed"?y.throw():T.action==="quit"?(this.initError=y,this.close(),y.throw()):(E===me.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",ji.MULTI_IP)):this.reconnect(T.action,ji.SERVER_ERROR),t===Ee.JOIN||t===Ee.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new se(r=>{const o=a=>{(!n||n(a))&&(this.off(t,o),r(a))};this.on(t,o)})}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const a=L("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Qe.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},L("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new se((r,o)=>{this.once(he.WS_CONNECTED,()=>r(this.joinResponse)),this.once(he.WS_CLOSED,()=>o(this.initError||new N(I.WS_ABORT))),this.connectionState=Qe.CONNECTING,this.websocket.init(t).catch(o),this.websocket.once(St.FAILBACK,()=>{this.openConnectionTime===void 0&&o(new N(I.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{n&&this.openConnectionTime===void 0&&(v.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),o(new N(I.INIT_DATACHANNEL_TIMEOUT)))},L("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Ke.LEAVE,this.connectionState=Qe.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===Ke.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new RC("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(he.ABORT_P2P_EXECUTION);const t=await vn(this,he.DATACHANNEL_CONNECTING),n=await this.request(Ee.JOIN,t);if(!n)return this.emit(he.REPORT_JOIN_GATEWAY,I.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(he.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Qe.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new N(I.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=js(this,he.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(Ee.REJOIN,t);return!!n&&(this.connectionState=Qe.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(Ne.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Ne.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Ne.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Ne.MUTE_AUDIO,{uid:r.uid}):this.emit(Ne.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Ne.MUTE_VIDEO,{uid:r.uid}):this.emit(Ne.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Ne.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Ne.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Ne.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Ne.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Ne.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){v.debug("[".concat(this.clientId,"] receive notification: "),t);const n=ed(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ke.UID_BANNED),void this.close()):void this.reconnect(n.action,ji.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=L("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(v.warning("PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>L("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",ji.TIMEOUT):this.request(Ee.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),L("REPORT_STATS")&&this.send(Ee.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleInflateData(){const{inflateLength:t,deflateLength:n}=this.websocket.getInflateData();t!==0&&n!==0&&this.upload(ir.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(St.RECONNECT_WAITTING_FINISH,t=>{this.emit(he.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(St.RECONNECT_CREATE_CONNECTION,t=>{this.emit(he.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(St.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(St.CLOSED,()=>{this.connectionState=Qe.CLOSED}),this.websocket.on(St.FAILED,()=>{this._disconnectedReason=Ke.NETWORK_ERROR,this.connectionState=Qe.CLOSED}),this.websocket.on(St.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Qe.CONNECTED?this.connectionState=Qe.RECONNECTING:this.connectionState=Qe.CONNECTING}),this.websocket.on(St.WILL_RECONNECT,(t,n)=>{if(js(this,he.IS_P2P_DISCONNECTED)&&t==="retry")return v.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(v.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(he.NEED_RENEW_SESSION),this.emit(he.DISCONNECT_P2P)),n(t)}),this.websocket.on(St.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{v.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",ji.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(he.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof N&&t.code===I.UNEXPECTED_RESPONSE&&t.data.code===me.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",ji.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",ji.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(St.REQUEST_NEW_URLS,(t,n)=>{vn(this,he.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(St.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(St.TO_CONNECT_DATACHANNEL,async(t,n,r)=>vn(this,he.DATACHANNEL_PRECONNECT,t).then(n).catch(r)),this.websocket.on(St.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(he.DATACHANNEL_FAILBACK)})}}function yC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Gi(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yC(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const Zm=new Map;class eF extends Et{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(mt.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(mt.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){v.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){super(),_(this,"store",void 0),_(this,"joinInfo",void 0),_(this,"key",void 0),_(this,"signal",void 0),_(this,"role",void 0),_(this,"inChannelInfo",{joinAt:null,duration:0}),_(this,"spec",void 0),_(this,"_state","DISCONNECTED"),_(this,"_statsCollector",void 0),_(this,"_disconnectedReason",void 0),_(this,"isSignalRecover",!1),_(this,"hasChangeBGPAddress",!1),_(this,"trafficStatsInterval",void 0),_(this,"networkQualityInterval",void 0),_(this,"_joinGatewayStartTime",0),_(this,"_signalTimeout",!1),_(this,"_clientRoleOptions",void 0),_(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useDataChannel?new co(Gi(Gi({},n),{},{retryConfig:n.websocketRetryConfig}),t):new gC(Gi(Gi({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,r){if(this.signal instanceof co){let h=!1;t.cloudProxyServer!=="disabled"?(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),h=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),h=!0):t.apResponse.addresses.some(f=>f.fingerprint)||L("FINGERPRINT")||(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),h=!0),h&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const o=Date.now();let a=Zm.get(t.cname);if(a||(a=new Map,Zm.set(t.cname,a)),this._isProactiveJoin=!0,a.has(t.uid)){const h=new N(I.UID_CONFLICT);throw de.joinGateway(t.sid,{lts:o,succ:!1,ec:h.message,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:this.signal instanceof co?"1":"0"}),this._isProactiveJoin=!1,h}a.set(t.uid,!0),this.joinInfo=t,this.key=n;let c=0;this.joinGatewayStartTime=o;const l=t.proxyServer;try{let h;if(v.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof co?"datachannel":"websocket"," join uid ").concat(c)),this.signal instanceof co)h=await this.signal.init(t.apResponse.addresses,r);else{const f=t.proxyServer,p=f?t.gatewayAddrs.map(E=>{const T=E.address.split(":");return"wss://".concat(f,"/ws/?h=").concat(T[0],"&p=").concat(T[1])}):t.gatewayAddrs.map(E=>"wss://".concat(E.address));h=await this.signal.init(p,r)}c=h.uid,v.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof co?"datachannel":"websocket"," join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(h){throw h&&h.code===I.INIT_WEBSOCKET_TIMEOUT?(v.warning("[".concat(this.store.clientId,"] User join failed"),h.toString()),h):h&&h.code===I.INIT_DATACHANNEL_TIMEOUT?(v.warning("[".concat(this.store.clientId,"] User join datachannel failed"),h.toString()),this.resetSignal(),h):(v.error("[".concat(this.store.clientId,"] User join failed"),h.toString()),de.joinGateway(t.sid,{lts:o,succ:!1,ec:h.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!l,signalChannel:this.signal instanceof co?"1":"0"}),this._isProactiveJoin=!1,a.delete(t.uid),this.signal.close(),h)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),v.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(h=>{v.warning("[".concat(this.store.clientId,"] get traffic stats error"),h.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(mt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(mt.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(mt.NETWORK_QUALITY,{uplinkNetworkQuality:cC(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:cC(this._statsCollector.trafficStats.B_dnq)}):this.emit(mt.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),c}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Ke.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Qe.CONNECTED||await function(r,o){return o===1/0?r:se.race([r,Jj(o)])}(this.signal.request(Ee.LEAVE,void 0,!0),3e3)}catch(r){v.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(n),n!==Ke.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new N(I.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:L("PUB_EXTEND"),twcc:!!L("PUBLISH_TWCC"),rtx:!!L("USE_PUB_RTX")};try{return(await this.signal.request(Ee.PUBLISH,o,!0))._message}catch(a){if(r&&a.data&&a.data.code===me.ERR_PUBLISH_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),a.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw a}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new N(I.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Ee.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(r){v.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async subscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new N(I.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const o={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!L("SUBSCRIBE_TWCC"),rtx:!!L("USE_SUB_RTX"),extend:L("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(L("SVC"))&&L("SVC").length!==0?L("SVC"):void 0};try{return(await this.signal.request(Ee.SUBSCRIBE,o,!0))._message}catch(a){if(r&&a.data&&a.data.code===me.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),a.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw a}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new N(I.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!L("USE_SUB_RTX")};try{return await this.signal.request(Ee.SUBSCRIBE_STREAMS,r,!0)}catch(o){if(n&&o.data&&o.data.code===me.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),o.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw o}}async setVideoProfile(t){const n=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let o=r.frameRate,a=r.width,c=r.height,l=!0;return typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(l=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(l=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,o||(l=!1)),l?{stream_type:0,width:a,height:c,fps:o,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(t);if(n)return this.signal.request(Ee.SET_VIDEO_PROFILE,n);v.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(Ee.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(r){v.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async massUnsubscribe(t){try{await this.signal.request(Ee.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){v.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:r,rtpCapabilities:o}=t;return{gatewayEstablishParams:await this.signal.request(Ee.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:o}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Ee.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Ee.RENEW_TOKEN,t),this.key=t.token}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),this.state!=="CONNECTED")return void(this.role=t);let r;r=t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0,await this.signal.request(Ee.SET_CLIENT_ROLE,{role:t,level:r,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(Ee.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Ee.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(Ee.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(Ee.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Gi({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Ee.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=Zm.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let r;return r=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:Er.username,password:Er.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Gi(Gi({},Er),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(Ee.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.peer_delay.forEach(n=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(o=>o.peer_uid===n.peer_uid);r&&r.B_st!==n.B_st&&Ci(()=>{this.emit(mt.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new N(I.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let r=L("REPORT_APP_SCENARIO");if(typeof r!="string")try{r=JSON.stringify(r)}catch{r=void 0}r&&r.length>128&&(r=void 0);const o=Gi({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:kr,browser:navigator.userAgent,process_id:L("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:L("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:r,attributes:{userAttributes:{enablePublishedUserList:L("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:L("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof L("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?L("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof L("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?L("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof L("ENABLE_USER_LICENSE_CHECK")=="boolean"?L("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:L("USE_PUB_RTX")===!0||L("USE_SUB_RTX")===!0||void 0}},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(o.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(o.aes_mode=this.joinInfo.aesmode,L("ENCRYPT_AES")?(o.aes_secret=this.joinInfo.aespassword,o.aes_encrypt=!0):o.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(o.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(o.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(o.default_video_stream=this.joinInfo.defaultVideoStream),o}getRejoinMessage(){if(!this.joinInfo)throw new N(I.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(he.WS_RECONNECT_WAITTING_FINISH,t=>{["tryNext","recover"].includes(t)&&this.joinInfo&&de.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(he.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(he.WS_RECONNECTING,t=>{this.joinInfo&&de.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Fn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",de.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(he.WS_CLOSED,t=>{let n;switch(t){case Ke.LEAVE:n=Fn.LEAVE;break;case Ke.UID_BANNED:case Ke.IP_BANNED:case Ke.CHANNEL_BANNED:case Ke.SERVER_ERROR:n=Fn.SERVER_ERROR;break;case Ke.FALLBACK:n=Fn.FALLBACK;break;case Ke.LICENSE_MISSING:case Ke.LICENSE_EXPIRED:case Ke.LICENSE_MINUTES_EXCEEDED:case Ke.LICENSE_PERIOD_INVALID:case Ke.LICENSE_MULTIPLE_SDK_SERVICE:case Ke.LICENSE_ILLEGAL:n=t;break;default:n=Fn.NETWORK_ERROR}v.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Fn.NETWORK_ERROR)),this.joinInfo&&de.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Ke.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==Ke.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(he.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&this._clientRoleOptions.level&&(v.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),de.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof co?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void v.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));nt("EVENT_REPORT_DOMAIN",t[1]),nt("EVENT_REPORT_BACKUP_DOMAIN",t[1]),nt("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}),this.signal.on(Ne.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(he.REQUEST_RECOVER,(t,n,r)=>{if(!this.joinInfo)return r(new N(I.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,vn(this,mt.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)}),this.signal.on(he.REQUEST_JOIN_INFO,async t=>{var n;this.updateTurnConfigFromSignal();const{iceParameters:r,dtlsParameters:o,rtpCapabilities:a}=await vn(this,mt.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(n=this.joinInfo)===null||n===void 0?void 0:n.turnServer});t(this.getJoinMessage({ortc:{iceParameters:r,dtlsParameters:o,rtpCapabilities:a,version:"2"}}))}),this.signal.on(he.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(he.REPORT_JOIN_GATEWAY,(t,n)=>{this.joinInfo&&(de.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof co?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(he.IS_P2P_DISCONNECTED,t=>{t(js(this,mt.IS_P2P_DISCONNECTED))}),this.signal.on(he.DISCONNECT_P2P,()=>{this.emit(mt.DISCONNECT_P2P)}),this.signal.on(he.NEED_RENEW_SESSION,()=>{this.emit(mt.NEED_RENEW_SESSION)}),this.signal.on(he.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(he.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(he.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(mt.JOIN_RESPONSE,t,n)}),this.signal.on(he.DATACHANNEL_PRECONNECT,async(t,n,r)=>{this.updateTurnConfigFromSignal();const o=this.getCurrentGatewayAddress();return vn(this,mt.DATACHANNEL_PRECONNECT,t,o).then(n).catch(r)}),this.signal.on(he.DATACHANNEL_CONNECTING,async t=>{const{iceParameters:n,dtlsParameters:r,rtpCapabilities:o}=await vn(this,mt.REQUEST_DC_CONNECTION_PARAMS);t(this.getJoinMessage({ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:o,version:"2"}}))}),this.signal.on(he.DATACHANNEL_FAILBACK,()=>{v.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(mt.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(Ee.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(r){throw v.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(Ee.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(r){throw v.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryMassUnsubBeforeResub(t){const n={users:t.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(Ee.UNSUBSCRIBE_STREAMS,n,!0)}catch(r){throw v.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(t,n){const r={action:t.find(o=>o.stream_type===Ft.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Ee.CONTROL,r,!0,!0)}catch(o){throw v.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),o),o}}async unmuteLocal(t,n){const r={action:t.find(o=>o.stream_type===Ft.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Ee.CONTROL,r,!0,!0)}catch(o){throw v.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),o),o}}uploadStats(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Ee.RESTART_ICE,n,!0)}catch(r){throw v.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,Fn.P2P_FAILED)}getCurrentGatewayAddress(){var t;if(!L("GATEWAY_WSS_ADDRESS"))return(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Ee.SET_PARAMETER,{enablePublishAudioFilter:t})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Ke.FALLBACK)),this.store.useDataChannel=!1,this.signal=new gC(Gi(Gi({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(mt.RESET_SIGNAL,du.websocket)}}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(F){var J=0;return function(){return J<F.length?{done:!1,value:F[J++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(F,J,re){return F==Array.prototype||F==Object.prototype||(F[J]=re.value),F},r,o=function(F){F=[typeof globalThis=="object"&&globalThis,F,typeof window=="object"&&window,typeof self=="object"&&self,typeof u=="object"&&u];for(var J=0;J<F.length;++J){var re=F[J];if(re&&re.Math==Math)return re}throw Error("Cannot find global object")}(this);function a(F,J){if(J)e:{var re=o;F=F.split(".");for(var ge=0;ge<F.length-1;ge++){var Ve=F[ge];if(!(Ve in re))break e;re=re[Ve]}(J=J(ge=re[F=F[F.length-1]]))!=ge&&J!=null&&n(re,F,{configurable:!0,writable:!0,value:J})}}function c(F){return(F={next:F})[Symbol.iterator]=function(){return this},F}function l(F){var J=typeof Symbol<"u"&&Symbol.iterator&&F[Symbol.iterator];return J?J.call(F):{next:t(F)}}if(a("Symbol",function(F){function J(Ve,$){this.A=Ve,n(this,"description",{configurable:!0,writable:!0,value:$})}if(F)return F;J.prototype.toString=function(){return this.A};var re="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ge=0;return function Ve($){if(this instanceof Ve)throw new TypeError("Symbol is not a constructor");return new J(re+($||"")+"_"+ge++,$)}}),a("Symbol.iterator",function(F){if(F)return F;F=Symbol("Symbol.iterator");for(var J="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),re=0;re<J.length;re++){var ge=o[J[re]];typeof ge=="function"&&typeof ge.prototype[F]!="function"&&n(ge.prototype,F,{configurable:!0,writable:!0,value:function(){return c(t(this))}})}return F}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var h;e:{var f={};try{f.__proto__={a:!0},h=f.a;break e}catch{}h=!1}r=h?function(F,J){if(F.__proto__=J,F.__proto__!==J)throw new TypeError(F+" is not extensible");return F}:null}var p=r;function E(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function T(F){if(F.m)throw new TypeError("Generator is already running");F.m=!0}function y(F,J){return F.h=3,{value:J}}function C(F){this.g=new E,this.G=F}function A(F,J,re,ge){try{var Ve=J.call(F.g.j,re);if(!(Ve instanceof Object))throw new TypeError("Iterator result "+Ve+" is not an object");if(!Ve.done)return F.g.m=!1,Ve;var $=Ve.value}catch(S){return F.g.j=null,F.g.s(S),O(F)}return F.g.j=null,ge.call(F.g,$),O(F)}function O(F){for(;F.g.h;)try{var J=F.G(F.g);if(J)return F.g.m=!1,{value:J.value,done:!1}}catch(re){F.g.v=void 0,F.g.s(re)}if(F.g.m=!1,F.g.l){if(J=F.g.l,F.g.l=null,J.F)throw J.D;return{value:J.return,done:!0}}return{value:void 0,done:!0}}function M(F){this.next=function(J){return F.o(J)},this.throw=function(J){return F.s(J)},this.return=function(J){return function(re,ge){T(re.g);var Ve=re.g.j;return Ve?A(re,"return"in Ve?Ve.return:function($){return{value:$,done:!0}},ge,re.g.return):(re.g.return(ge),O(re))}(F,J)},this[Symbol.iterator]=function(){return this}}function U(F,J){return J=new M(new C(J)),p&&F.prototype&&p(J,F.prototype),J}if(E.prototype.o=function(F){this.v=F},E.prototype.s=function(F){this.l={D:F,F:!0},this.h=this.C||this.u},E.prototype.return=function(F){this.l={return:F},this.h=this.u},C.prototype.o=function(F){return T(this.g),this.g.j?A(this,this.g.j.next,F,this.g.o):(this.g.o(F),O(this))},C.prototype.s=function(F){return T(this.g),this.g.j?A(this,this.g.j.throw,F,this.g.o):(this.g.s(F),O(this))},a("Array.prototype.entries",function(F){return F||function(){return function(J,re){J instanceof String&&(J+="");var ge=0,Ve=!1,$={next:function(){if(!Ve&&ge<J.length){var S=ge++;return{value:re(S,J[S]),done:!1}}return Ve=!0,{done:!0,value:void 0}}};return $[Symbol.iterator]=function(){return $},$}(this,function(J,re){return[J,re]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var q=function(F,J){for(var re=0;re<F.length;re++)J(F[re])},ae=function(F){return F.replace(/\r?\n|\r/g,`\r
`)},X=function(F,J,re){return J instanceof Blob?(re=re!==void 0?re+"":typeof J.name=="string"?J.name:"blob",J.name===re&&Object.prototype.toString.call(J)!=="[object Blob]"||(J=new File([J],re)),[String(F),J]):[String(F),String(J)]},Q=function(F,J){if(F.length<J)throw new TypeError(J+" argument required, but only "+F.length+" present.")},Y=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Z=Y.FormData,Ge=Y.XMLHttpRequest&&Y.XMLHttpRequest.prototype.send,pe=Y.Request&&Y.fetch,st=Y.navigator&&Y.navigator.sendBeacon,$e=Y.Element&&Y.Element.prototype,Nt=Y.Symbol&&Symbol.toStringTag;Nt&&(Blob.prototype[Nt]||(Blob.prototype[Nt]="Blob"),"File"in Y&&!File.prototype[Nt]&&(File.prototype[Nt]="File"));try{new File([],"")}catch{Y.File=function(J,re,ge){return J=new Blob(J,ge||{}),Object.defineProperties(J,{name:{value:re},lastModified:{value:+(ge&&ge.lastModified!==void 0?new Date(ge.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Nt&&Object.defineProperty(J,Nt,{value:"File"}),J}}var cn=function(F){return F.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Ct=function(F){this.i=[];var J=this;F&&q(F.elements,function(re){if(re.name&&!re.disabled&&re.type!=="submit"&&re.type!=="button"&&!re.matches("form fieldset[disabled] *"))if(re.type==="file"){var ge=re.files&&re.files.length?re.files:[new File([],"",{type:"application/octet-stream"})];q(ge,function(Ve){J.append(re.name,Ve)})}else re.type==="select-multiple"||re.type==="select-one"?q(re.options,function(Ve){!Ve.disabled&&Ve.selected&&J.append(re.name,Ve.value)}):re.type==="checkbox"||re.type==="radio"?re.checked&&J.append(re.name,re.value):(ge=re.type==="textarea"?ae(re.value):re.value,J.append(re.name,ge))})};if((e=Ct.prototype).append=function(F,J,re){Q(arguments,2),this.i.push(X(F,J,re))},e.delete=function(F){Q(arguments,1);var J=[];F=String(F),q(this.i,function(re){re[0]!==F&&J.push(re)}),this.i=J},e.entries=function F(){var J,re=this;return U(F,function(ge){if(ge.h==1&&(J=0),ge.h!=3)return J<re.i.length?ge=y(ge,re.i[J]):(ge.h=0,ge=void 0),ge;J++,ge.h=2})},e.forEach=function(F,J){Q(arguments,1);for(var re=l(this),ge=re.next();!ge.done;ge=re.next()){var Ve=l(ge.value);ge=Ve.next().value,Ve=Ve.next().value,F.call(J,Ve,ge,this)}},e.get=function(F){Q(arguments,1);var J=this.i;F=String(F);for(var re=0;re<J.length;re++)if(J[re][0]===F)return J[re][1];return null},e.getAll=function(F){Q(arguments,1);var J=[];return F=String(F),q(this.i,function(re){re[0]===F&&J.push(re[1])}),J},e.has=function(F){Q(arguments,1),F=String(F);for(var J=0;J<this.i.length;J++)if(this.i[J][0]===F)return!0;return!1},e.keys=function F(){var J,re,ge,Ve,$=this;return U(F,function(S){if(S.h==1&&(J=l($),re=J.next()),S.h!=3)return re.done?void(S.h=0):(ge=re.value,Ve=l(ge),y(S,Ve.next().value));re=J.next(),S.h=2})},e.set=function(F,J,re){Q(arguments,2),F=String(F);var ge=[],Ve=X(F,J,re),$=!0;q(this.i,function(S){S[0]===F?$&&($=!ge.push(Ve)):ge.push(S)}),$&&ge.push(Ve),this.i=ge},e.values=function F(){var J,re,ge,Ve,$=this;return U(F,function(S){if(S.h==1&&(J=l($),re=J.next()),S.h!=3)return re.done?void(S.h=0):(ge=re.value,(Ve=l(ge)).next(),y(S,Ve.next().value));re=J.next(),S.h=2})},Ct.prototype._asNative=function(){for(var F=new Z,J=l(this),re=J.next();!re.done;re=J.next()){var ge=l(re.value);re=ge.next().value,ge=ge.next().value,F.append(re,ge)}return F},Ct.prototype._blob=function(){var F="----formdata-polyfill-"+Math.random(),J=[],re="--"+F+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ge,Ve){return typeof ge=="string"?J.push(re+cn(ae(Ve))+`"\r
\r
`+ae(ge)+`\r
`):J.push(re+cn(ae(Ve))+'"; filename="'+cn(ge.name)+`"\r
Content-Type: `+(ge.type||"application/octet-stream")+`\r
\r
`,ge,`\r
`)}),J.push("--"+F+"--"),new Blob(J,{type:"multipart/form-data; boundary="+F})},Ct.prototype[Symbol.iterator]=function(){return this.entries()},Ct.prototype.toString=function(){return"[object FormData]"},$e&&!$e.matches&&($e.matches=$e.matchesSelector||$e.mozMatchesSelector||$e.msMatchesSelector||$e.oMatchesSelector||$e.webkitMatchesSelector||function(F){for(var J=(F=(this.document||this.ownerDocument).querySelectorAll(F)).length;0<=--J&&F.item(J)!==this;);return-1<J}),Nt&&(Ct.prototype[Nt]="FormData"),Ge){var Qn=Y.XMLHttpRequest.prototype.setRequestHeader;Y.XMLHttpRequest.prototype.setRequestHeader=function(F,J){Qn.call(this,F,J),F.toLowerCase()==="content-type"&&(this.B=!0)},Y.XMLHttpRequest.prototype.send=function(F){F instanceof Ct?(F=F._blob(),this.B||this.setRequestHeader("Content-Type",F.type),Ge.call(this,F)):Ge.call(this,F)}}pe&&(Y.fetch=function(F,J){return J&&J.body&&J.body instanceof Ct&&(J.body=J.body._blob()),pe.call(this,F,J)}),st&&(Y.navigator.sendBeacon=function(F,J){return J instanceof Ct&&(J=J._asNative()),st.call(this,F,J)}),Y.FormData=Ct}})();const yu=()=>{const e=L("AREAS");return e.length===0&&e.push(Me.GLOBAL),bo(e).call(e,(t,n,r)=>{const o=IC(n);return o?r===0?o:"".concat(t,",").concat(o):t},"")},IC=e=>e===Me.OVERSEA?"".concat(Zt.ASIA,",").concat(Zt.EUROPE,",").concat(Zt.AFRICA,",").concat(Zt.NORTH_AMERICA,",").concat(Zt.SOUTH_AMERICA,",").concat(Zt.OCEANIA):Zt[e],tF=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const r=lu[n],o=Object.keys(r);o&&o.map(a=>{a!=="CODE"&&(t[a]=t[a].concat(r[a]))})}),t},Iu={GLOBAL:{ASIA:[Me.CHINA,Me.JAPAN,Me.INDIA,Me.KOREA,Me.HKMC],EUROPE:[],NORTH_AMERICA:[Me.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},eE=Object.keys(Iu[Me.GLOBAL]),CC=[Me.CHINA,Me.NORTH_AMERICA,Me.EUROPE,Me.ASIA,Me.JAPAN,Me.INDIA,Me.OCEANIA,Me.SOUTH_AMERICA,Me.AFRICA,Me.KOREA,Me.HKMC,Me.US],nF=function(e,t){let n=[];if(e.includes(Me.GLOBAL)){const a=[Me.GLOBAL,Me.OVERSEA],c=Object.keys(lu);if(t===Me.GLOBAL)throw new N(I.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Me.CHINA)n=[Me.OVERSEA];else if(o=t,eE.includes(o)){const l=(r=t,Iu[Me.GLOBAL][r]||[]),h=[...a,t,...l];n=c.filter(f=>!h.includes(f))}else if(function(l){let h=!1;return eE.forEach(f=>{Iu[Me.GLOBAL][f].includes(l)&&(h=!0)}),h}(t)){const l=function(f){let p;return eE.forEach(E=>{Iu[Me.GLOBAL][E].includes(f)&&(p=E)}),p}(t),h=[...a,l,t];n=c.filter(f=>!h.includes(f))}else n=e;n=function(l){const h=[];return CC.forEach(f=>{l.includes(f)&&h.push(f)}),h.concat(l.filter(f=>!CC.includes(f)))}(n)}else n=e;var r,o;return n};function AC(e){if(!e&&L("AREAS").includes(Me.EXTENSIONS))return v.debug("update area from ap : reset"),void tE(cy,!0);if(!L("AREAS").includes(Me.GLOBAL)||!e)return;let t=lu.EXTENSIONS;t&&(t={CODE:IC(Me.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},v.debug("update area from ap success: ".concat(e,",config is "),t),nt("AREAS",[Me.EXTENSIONS],!0),Object.keys(t).map(n=>{n==="LOG_UPLOAD_SERVER"||n==="EVENT_REPORT_DOMAIN"||n==="EVENT_REPORT_BACKUP_DOMAIN"||n==="PROXY_SERVER_TYPE3"?nt(n,t[n][0]):nt(n,t[n])}))}function tE(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=de.reportApiInvoke(null,{name:Pt.SET_AREA,options:e,tag:ft.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach(a=>{if(!NV.includes(a))throw new N(I.INVALID_PARAMS,"invalid area code")}),r=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:a,excludedArea:c}=e;if(!a)throw new N(I.INVALID_PARAMS,"area code is needed");let l=a;typeof a=="string"&&(l=[a]),r=c?nF(l,c):l}if(!t){if(Ps.AREAS){const a=new N(I.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(a),void v.warning("setArea is prohibited because of config-distribute")}if(r.includes(Me.GLOBAL)&&L("AREAS")===Me.EXTENSIONS){const a=new N(I.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(a),void v.warning("setArea is prohibited because of ap extensions")}}nt("AREAS",r,t);const o=tF(r);Object.keys(o).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?nt(a,o[a][0]):nt(a,o[a])}),v.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function OC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function wC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?OC(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):OC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let nE=1;function rF(e,t,n,r,o){nE+=1;const a={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:nE,requestId:nE,version:kr,cname:n.cname},c={service_name:t,json_body:JSON.stringify(a)};let l,h,f=e[0];return vi(async()=>{l=Date.now();const p=await Zr(f,{data:c,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(h=Date.now()-l,p.code!==0){const y=new N(I.UNEXPECTED_RESPONSE,"live streaming ap error, code"+p.code,{retry:!0,responseTime:h});throw v.error(y.toString()),y}const E=JSON.parse(p.json_body);if(E.code!==200){const y=new N(I.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(E.code,", reason: ").concat(E.reason),{code:E.code,responseTime:h});throw v.error(y.toString()),y}if(!E.servers||E.servers.length===0){const y=new N(I.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:E.code,responseTime:h});throw v.error(y.toString()),y}const T=function(y,C){return{addressList:y.servers.map(A=>"wss://".concat(A.address.replace(/\./g,"-"),".").concat(L("WORKER_DOMAIN"),":").concat(A.wss,"?serviceName=").concat(encodeURIComponent(C))),workerToken:y.workerToken,vid:y.vid}}(E,t);return L("LIVE_STREAMING_ADDRESS")&&(T.addressList=L("LIVE_STREAMING_ADDRESS")instanceof Array?L("LIVE_STREAMING_ADDRESS"):[L("LIVE_STREAMING_ADDRESS")]),wC(wC({},T),{},{responseTime:h})},(p,E)=>(de.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(p.addressList),firstSuccess:E===0,responseTime:h,serverIp:e[E%e.length]}),!1),(p,E)=>(de.apworkerEvent(n.sid,{success:!1,sc:p.data&&p.data.code||200,serviceName:t,responseTime:h,serverIp:e[E%e.length]}),!!(p.code!==I.OPERATION_ABORTED&&p.code!==I.UNEXPECTED_RESPONSE||p.data&&p.data.retry)&&(f=e[(E+1)%e.length],!0)),o)}let rE=1;function NC(e,t,n,r){let{url:o,areaCode:a}=e;const c=Date.now();let l;const[h,f]=LC(t,a,[qt.CHOOSE_SERVER]);let p=kt.networkState;return vi(async()=>{p&&kt.networkState===In.OFFLINE&&kt.onlineWaiter&&await se.race([kt.onlineWaiter,Tn(r&&r.maxRetryTimeout||Dt.maxRetryTimeout)]),p=kt.networkState;const{data:E,headers:T}=await Zr(o,{data:h,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=T.http3==="1"?1:-1,de.reportResourceTiming(o,t.sid),DC(E,o,t,c,[qt.CHOOSE_SERVER],l);const y=Jm(E,qt.CHOOSE_SERVER);return PC(y),sC(y,o)},E=>(E&&de.joinChooseServer(t.sid,{lts:c,succ:!0,csAddr:o,opid:f,serverList:E.gatewayAddrs.map(T=>T.address),ec:null,cid:E.cid.toString(),uid:E.uid.toString(),csIp:E.csIp,unilbsServerIds:[qt.CHOOSE_SERVER].toString(),isHttp3:l}),!1),E=>E.code!==I.OPERATION_ABORTED&&(E.code===I.CAN_NOT_GET_GATEWAY_SERVER?E.data.retry:(de.joinChooseServer(t.sid,{lts:c,succ:!1,csAddr:o,serverList:null,opid:f,ec:E.code,csIp:E.data&&E.data.csIp,unilbsServerIds:[qt.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:p}),isHttp3:l}),v.warning("[".concat(t.clientId,"] Choose server network error, retry"),E),!0)),r)}function bC(e,t,n,r){let o,{url:a,areaCode:c,serviceIds:l}=e;const h=Date.now(),[f,p]=LC(t,c,l);let E;return vi(async()=>{E&&kt.networkState===In.OFFLINE&&kt.onlineWaiter&&await se.race([kt.onlineWaiter,Tn(r&&r.maxRetryTimeout||Dt.maxRetryTimeout)]),E=kt.networkState;const{data:T,headers:y}=await Zr(a,{data:f,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);o=y.http3==="1"?1:-1,de.reportResourceTiming(a,t.sid),DC(T,a,t,h,l,o);const C=Jm(T,qt.CHOOSE_SERVER),A=Jm(T,t.cloudProxyServer==="proxy5"?qt.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?qt.CLOUD_PROXY:qt.CLOUD_PROXY_FALLBACK);return PC(C),{gatewayInfo:sC(C,a),proxyInfo:A,url:a}},T=>(T.gatewayInfo&&de.joinChooseServer(t.sid,{lts:h,succ:!0,csAddr:a,serverList:T.gatewayInfo.gatewayAddrs.map(y=>y.address),ec:null,opid:p,cid:T.gatewayInfo.cid.toString(),uid:T.gatewayInfo.uid.toString(),csIp:T.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:o}),T.proxyInfo&&de.joinWebProxyAP(t.sid,{lts:h,sucess:1,apServerAddr:a,turnServerAddrList:T.proxyInfo.addresses.map(y=>y.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:l.toString()}),!1),T=>T.code!==I.OPERATION_ABORTED&&(T.code===I.CAN_NOT_GET_GATEWAY_SERVER?T.data.retry:(de.joinWebProxyAP(t.sid,{lts:h,sucess:0,apServerAddr:a,turnServerAddrList:null,errorCode:T.code,eventType:t.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:E})}),v.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),T),!0)),r)}const DC=(e,t,n,r,o,a)=>{const c=[],l=h=>{h.flag===4096?de.joinChooseServer(n.sid,{lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:h.error.message,csIp:h.error.data&&h.error.data.csIp,unilbsServerIds:o.toString(),isHttp3:a}):h.flag!==1048576&&h.flag!==4194304&&h.flag!==4194310||de.joinWebProxyAP(n.sid,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:h.error.code,eventType:n.cloudProxyServer,unilbsServerIds:o.toString()})};if(e.response_body.forEach(h=>{const f=h.buffer.code;if(h.uri===23&&f===0&&!h.buffer.edges_services)if(h.buffer.flag===4194310)v.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),h.buffer.edges_services=[];else{const p={error:new N(I.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:h.buffer.flag};c.push(p),l(p)}if(f!==0){const p=Ru(f),E={error:new N(I.CAN_NOT_GET_GATEWAY_SERVER,p.desc,{desc:p.desc,retry:p.retry,csIp:e.detail[502]}),flag:h.buffer.flag};h.buffer.flag===4194310?v.warning(E.error.toString()):c.push(E),l(E)}}),c.length)throw v.warning("[".concat(n.clientId,"] multi unilbs ").concat(t," failed, ").concat(c.map(h=>"flag: ".concat(h.flag,", message: ").concat(h.error.message,", retry: ").concat(h.error.data.retry)).join(" | "))),new N(I.CAN_NOT_GET_GATEWAY_SERVER,c.map(h=>"flag: ".concat(h.flag,", message: ").concat(h.error.message)).join(" | "),{retry:!!c.find(h=>h.error.data.retry),csIp:e.detail[502],desc:[...new Set(c.map(h=>{var f,p;return h==null||(f=h.error)===null||f===void 0||(p=f.data)===null||p===void 0?void 0:p.desc}).filter(h=>!!h))]})},PC=e=>{var t,n,r,o;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new N(I.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(L("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((o=e.detail)===null||o===void 0?void 0:o[23])=="string"?AC(e.detail[23].toLowerCase()):AC()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const c=e.detail[19],l=c==null?void 0:c.split(";");for(let h=0;h<l.length;h++){var a;const f=to(a=l[h]).call(a);e.addresses[h]&&l&&(e.addresses[h].fingerprint=f)}}if(L("GATEWAY_ADDRESS")&&L("GATEWAY_ADDRESS").length>0){v.debug("assign gateway address to",L("GATEWAY_ADDRESS"));const c=L("GATEWAY_ADDRESS").map(l=>{var h,f;const p=(h=(f=e.addresses.find(E=>E.ip===l.ip&&E.port===l.port))===null||f===void 0?void 0:f.fingerprint)!==null&&h!==void 0?h:"";return{ip:l.ip,port:l.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:p}});e.addresses=c}},iF=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const r=Ru(n.buffer.code);throw new N(I.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw v.debug("update ticket request received ap response without response body:",t),new N(I.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},LC=(e,t,n)=>{const r=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:{6:e.stringUid,11:t,12:L("USE_NEW_TOKEN")?"1":void 0,22:t},key:e.token,service_ids:n,uid:e.uid||0}}]};o.request_bodies.forEach(c=>{e.multiIP&&e.multiIP.gateway_ip&&(c.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const a=new FormData;return a.append("request",JSON.stringify(o)),[a,r]},oF=(e,t)=>{const n=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(a=>({ip:a.ip,port:a.port}))}}]},o=new FormData;return o.append("request",JSON.stringify(r)),[o,n]};let Wa=0;async function iE(e,t,n,r){return{gatewayInfo:await async function(a,c,l,h){let f=null;const p=[],E=async()=>{const y=L("WEBCS_DOMAIN").slice(0,L("AJAX_REQUEST_CONCURRENT")).map(O=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:yu()})),C=h.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(O=>O.url)}),A=await Zc({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:O=>(v.debug("[".concat(a.clientId,"] Connect to choose_server:"),O.url),NC(O,a,c,l)),allFailedhandler:O=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},C),O[0]},promisesCollector:p});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},C),A},T=async()=>{if(await Tn(1e3),f!==null)return f;const y=L("WEBCS_DOMAIN_BACKUP_LIST").map(O=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:yu()})),C=h.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(O=>O.url)}),A=await Zc({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:O=>(v.debug("[".concat(a.clientId,"] Connect to backup choose_server:"),O.url),NC(O,a,c,l)),allFailedhandler:O=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},C),O[0]},promisesCollector:p});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},C),A};try{return f=await Ga([E(),T()]),p.length&&p.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),f}catch(y){throw y[0]}}(e,t,n,r)}}async function kC(e,t,n,r,o){const a=e.cloudProxyServer;if(a==="disabled"){if(!r)return;if(e.useLocalAccessPoint)return await iE(e,t,n,o);if(L("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:f,proxyInfo:p}=await UC(e,t,n,o);return e.turnServer&&e.turnServer.mode!=="auto"||(e.turnServer={mode:"manual",servers:p.map(E=>({turnServerURL:E.address,tcpport:E.tcpport||Er.tcpport,udpport:E.udpport||Er.udpport,username:E.username||Er.username,password:E.password||Er.password,forceturn:!1,security:!0}))}),{gatewayInfo:f}}return await iE(e,t,n,o)}const{proxyInfo:c,gatewayInfo:l}=await UC(e,t,n,o),h={gatewayInfo:l};return e.turnServer={mode:"manual",servers:c.map(f=>({turnServerURL:f.address,tcpport:a==="proxy3"?void 0:f.tcpport?f.tcpport:Er.tcpport,udpport:a==="proxy4"?void 0:f.udpport?f.udpport:Er.udpport,username:f.username||Er.username,password:f.password||Er.password,forceturn:a!=="proxy4",security:a==="proxy5"}))},v.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(a)),h}async function MC(e,t,n,r,o){const a=L("ACCOUNT_REGISTER").slice(0,L("AJAX_REQUEST_CONCURRENT"));let c=[];c=t.proxyServer?a.map(h=>"https://".concat(t.proxyServer,"/ap/?url=").concat(h+"/api/v1")):a.map(h=>"https://".concat(h,"/api/v1"));const l=o==null?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{const h=await async function(f,p,E,T,y){const C=Date.now(),A={sid:E.sid,opid:10,appid:E.appId,string_uid:p};let O=f[0];const M=await vi(()=>Zr(O+"".concat(O.indexOf("?")===-1?"?":"&","action=stringuid"),{data:A,cancelToken:T,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(U,q)=>{if(U.code===0){if(U.uid<=0||U.uid>=Math.pow(2,32))throw v.error("Invalid Uint Uid ".concat(p," => ").concat(U.uid),U),de.reqUserAccount(A.sid,{lts:C,success:!1,serverAddr:O,stringUid:A.string_uid,uid:U.uid,errorCode:I.INVALID_UINT_UID_FROM_STRING_UID,extend:A}),new N(I.INVALID_UINT_UID_FROM_STRING_UID);return de.reqUserAccount(A.sid,{lts:C,success:!0,serverAddr:O,stringUid:A.string_uid,uid:U.uid,errorCode:null,extend:A}),!1}const ae=Ru(U.code);return ae.retry&&(O=f[(q+1)%f.length]),de.reqUserAccount(A.sid,{lts:C,success:!1,serverAddr:O,stringUid:A.string_uid,uid:U.uid,errorCode:ae.desc,extend:A}),ae.retry},(U,q)=>U.code!==I.OPERATION_ABORTED&&(de.reqUserAccount(A.sid,{lts:C,success:!1,serverAddr:O,stringUid:A.string_uid,uid:null,errorCode:U.code,extend:A}),O=f[(q+1)%f.length],!0),y);if(M.code!==0){const U=Ru(M.code);throw new N(I.UNEXPECTED_RESPONSE,U.desc)}return M}(c,e,t,n,r);return o==null||o.recordJoinChannelService({status:"success",endTs:Date.now()},l),h.uid}catch(h){throw o==null||o.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[h]},l),h}}async function sF(e,t,n){const r=L("CDS_AP").slice(0,L("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1"):"https://".concat(l,"/api/v1?action=config")).map(l=>function(h,f,p,E){const T=He(),y={flag:64,cipher_method:0,features:{device:T.name,system:T.os,system_general:navigator.userAgent,vendor:f.appId,version:kr,cname:f.cname,sid:f.sid,session_id:f.sid,detail:"",proxyServer:f.proxyServer}};return vi(()=>Zr(h,{data:y,timeout:1e3,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,C=>C.code!==I.OPERATION_ABORTED,E)}(l,e,t,n));let o=null,a=null,c={};try{o=await Ga(r)}catch(l){if(l.code===I.OPERATION_ABORTED)throw l;a=l}if(r.forEach(l=>l.cancel()),de.reportApiInvoke(e.sid,{name:Pt.REQUEST_CONFIG_DISTRIBUTE,options:{error:a,res:o}}).onSuccess(),o&&o.test_tags)try{c=function(l){if(!l.test_tags)return{};const h=l.test_tags,f=Object.keys(h),p={};return f.forEach(E=>{var T;const y=to(T=E.slice(4)).call(T),C=JSON.parse(h[E])[1];p[y]=C}),p}(o)}catch{}return c}async function UC(e,t,n,r){const o=L("PROXY_SERVER_TYPE3"),a=(y,C,A)=>{let O=A||o;return Array.isArray(O)&&(O=C%2==0?o[1]:o[0]),"https://".concat(O,"/ap/?url=").concat(y)};let c=null;const l=[],h=async()=>{const y=L("WEBCS_DOMAIN").slice(0,L("AJAX_REQUEST_CONCURRENT")).map((O,M)=>{let U;return U=e.cloudProxyServer==="disabled"&&e.proxyServer?a("".concat(O,"/api/v2/transpond/webrtc?v=2"),M,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):a("".concat(O,"/api/v2/transpond/webrtc?v=2"),M),{url:U,areaCode:yu(),serviceIds:[qt.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?qt.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?qt.CLOUD_PROXY:qt.CLOUD_PROXY_FALLBACK]}}),C=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(O=>O.url)}),A=await Zc({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:O=>(v.debug("[".concat(e.clientId,"] Connect to choose_server:"),O.url),bC(O,e,t,n)),allFailedhandler:O=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},C),O[0]},promisesCollector:l});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},C),A},f=async()=>{if(await Tn(1e3),c!==null)return c;const y=L("WEBCS_DOMAIN_BACKUP_LIST").map((O,M)=>{let U;return U=e.cloudProxyServer==="disabled"&&e.proxyServer?a("".concat(O,"/api/v2/transpond/webrtc?v=2"),M,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):a("".concat(O,"/api/v2/transpond/webrtc?v=2"),M),{url:U,areaCode:yu(),serviceIds:[qt.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?qt.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?qt.CLOUD_PROXY:qt.CLOUD_PROXY_FALLBACK]}}),C=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:y.map(O=>O.url)}),A=await Zc({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:y,asyncMapHandler:O=>(v.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),O.url),bC(O,e,t,n)),allFailedhandler:O=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},C),O[0]},promisesCollector:l});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},C),A};let p,E,T;try{({gatewayInfo:p,proxyInfo:E,url:T}=await Ga([h(),f()]))}catch(y){throw y[0]}if(l.length&&l.forEach(y=>y.cancel&&typeof y.cancel=="function"&&y.cancel()),!p||!E)throw new N(I.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=T,e.cloudProxyServer!=="disabled"&&Array.isArray(o)&&T){const y=/^https?:\/\/(.+?)(\/.*)?$/.exec(T)[1];o.includes(y)&&(e.proxyServer=y,v.setProxyServer(y),de.setProxyServer(y))}return c={gatewayInfo:p,proxyInfo:await zj(E,p.uid)},c}async function xC(e,t,n,r){const o=L("UAP_AP").slice(0,L("AJAX_REQUEST_CONCURRENT")).map(a=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(a+"/api/v1?action=uap"):"https://".concat(a,"/api/v1?action=uap"));return await rF(o,e,t,n,r)}async function aF(e,t,n){const r=L("UAP_AP").slice(0,L("AJAX_REQUEST_CONCURRENT")).map(o=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(o+"/api/v1?action=uap"):"https://".concat(o,"/api/v1?action=uap")).map(o=>function(a,c,l,h){const f={command:"convergeAllocateEdge",sid:c.sid,appId:c.appId,token:c.token,ts:Date.now(),version:kr,cname:c.cname,uid:c.uid.toString(),requestId:rE,seq:rE};rE+=1;const p={service_name:"tele_channel",json_body:JSON.stringify(f)};return vi(async()=>{const E=await Zr(a,{data:p,cancelToken:l,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(E.code!==0){const y=new N(I.UNEXPECTED_RESPONSE,"cross channel ap error, code"+E.code,{retry:!0});throw v.error(y.toString()),y}const T=JSON.parse(E.json_body);if(T.code!==200){const y=new N(I.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(T.code,", reason: ").concat(T.reason));throw v.error(y.toString()),y}if(!T.servers||T.servers.length===0){const y=new N(I.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw v.error(y.toString()),y}return{vid:T.vid,workerToken:T.workerToken,addressList:(L("CHANNEL_MEDIA_RELAY_SERVERS")||T.servers).map(y=>"wss://".concat(y.address.replace(/\./g,"-"),".").concat(L("WORKER_DOMAIN"),":").concat(y.wss))}},void 0,E=>!!(E.code!==I.OPERATION_ABORTED&&E.code!==I.UNEXPECTED_RESPONSE||E.data&&E.data.retry),h)}(o,e,t,n));try{const o=await Ga(r);return r.forEach(a=>a.cancel()),o}catch(o){throw o[0]}}async function cF(e,t,n){let r=null;const o=[],a=async c=>{const l=L(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(h=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(h+"/api/v2/transpond/webrtc?v=2"):"https://".concat(h,"/api/v2/transpond/webrtc?v=2"));return c&&(await Tn(1e3),r!==null)?r:await Zc({fragementLength:L("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:h=>(v.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),h),function(f,p,E,T){const[y]=oF(p,[qt.CHOOSE_SERVER]);let C=kt.networkState;return vi(async()=>{C&&kt.networkState===In.OFFLINE&&kt.onlineWaiter&&await se.race([kt.onlineWaiter,Tn(T&&T.maxRetryTimeout||Dt.maxRetryTimeout)]),C=kt.networkState;const A=await Zr(f,{data:y,cancelToken:E,headers:{"Content-Type":"multipart/form-data;"}},!0);return iF(A,f)},()=>!1,A=>A.code!==I.OPERATION_ABORTED&&(A.code===I.UPDATE_TICKET_FAILED?A.data.retry:(v.warning("[".concat(p.clientId,"] update ticket network error, retry"),A),!0)),T)}(h,e,t,n)),allFailedhandler:h=>{throw h[0]},promisesCollector:o})};try{return r=await Ga([a(!1),a(!0)]),o.length&&o.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),r}catch(c){throw c[0]}}function VC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function jC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?VC(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class dF extends Et{constructor(){super(),_(this,"configs",void 0),_(this,"joinInfo",void 0),_(this,"cancelToken",void 0),_(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),_(this,"interval",void 0),_(this,"mutex",new Mn("config-distribute")),_(this,"mutableParamsRead",!1)}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),L("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},L("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,de.reportApiInvoke(null,{options:void 0,name:Pt.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:ft.TRACER}).onSuccess(JSON.stringify(Ps))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void v.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await sF(this.joinInfo,this.cancelToken,this.retryConfig),v.debug("[config-distribute] get config distribute",JSON.stringify(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(r){const o=new N(I.NETWORK_RESPONSE_ERROR,r);v.warning("[config-distribute] ".concat(o.toString()))}finally{n()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var n;(n=t)&&n.uplink&&n.id&&n.uplink.max_bitrate!==void 0&&n.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(Xc.UPDATE_BITRATE_LIMIT,t):this.emit(Xc.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&jC({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var n;const r=Tm(n=Object.keys(t).filter(a=>/^webrtc_ng_global_parameter/.test(a))).call(n);for(let a=0;a<r.length;a++)for(let c=r.length-1;c>a;c--){const l=r[c];if(typeof t[l].__priority=="number"){const h=t[l].__priority,f=r[c-1];if(typeof t[f].__priority=="number"){if(!(h>t[f].__priority))continue;{const p=l;r[c]=r[c-1],r[c-1]=p}}else{const p=l;r[c]=r[c-1],r[c-1]=p}}}const o={};r.forEach(a=>{const c=t[a],l=c.__expires;Object.keys(c).forEach(h=>{h==="__priority"||h==="__expires"||Object.prototype.hasOwnProperty.call(o,h)||(o[h]=jC({value:c[h]},l&&{expires:l}))})});try{const a=JSON.stringify(o),c=window.btoa(a);window.localStorage.setItem("websdk_ng_global_parameter",c),v.debug("Caching global parameters ".concat(a))}catch(a){v.error("Error caching global parameters:",a.message)}}}function FC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function td(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?FC(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class lF extends Et{constructor(t,n,r,o){super(),_(this,"spec",void 0),_(this,"token",void 0),_(this,"websocket",void 0),_(this,"pingpongTimer",void 0),_(this,"reconnectMode","retry"),_(this,"serviceMode",void 0),_(this,"reqId",0),_(this,"commandReqId",0),_(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),_(this,"handleWebSocketMessage",a=>{if(!a.data)return;const c=JSON.parse(a.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):this.serviceMode===jt.INJECT?this.emit($r.INJECT_STREAM_STATUS,c):(de.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===jt.TRANSCODE?1:2}),this.emit($r.PUBLISH_STREAM_STATUS,c))}),this.spec=n,this.token=t,this.serviceMode=o,this.websocket=new Fs("live-streaming",r),this.websocket.on(ve.CONNECTED,this.handleWebSocketOpen),this.websocket.on(ve.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(ve.REQUEST_NEW_URLS,(a,c)=>{vn(this,$r.REQUEST_NEW_ADDRESS).then(a).catch(c)}),this.websocket.on(ve.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,r,o){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const a=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new N(I.UNEXPECTED_ERROR);const l=td({command:t,sdkVersion:kr==="4.18.1"?"0.0.1":kr,seq:c,requestId:c,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new N(I.WS_DISCONNECT);const h=()=>new se((T,y)=>{this.websocket.once(ve.CLOSED,()=>y(new N(I.WS_ABORT))),this.websocket.once(ve.CONNECTED,T)});this.websocket.state!=="connected"&&await h(),l.clientRequest&&(l.clientRequest.workerToken=this.token);const f=new se((T,y)=>{const C=()=>{y(new N(I.WS_ABORT))};this.websocket.once(ve.RECONNECTING,C),this.websocket.once(ve.CLOSED,C),this.once("@".concat(c,"-").concat(this.spec.sid),A=>{T(A)})});o&&de.workerEvent(this.spec.sid,td(td({},o),{},{requestId:a,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const p=Date.now();this.websocket.sendMessage(l);let E=null;try{E=await f}catch(T){if(this.websocket.state==="closed")throw T;return await h(),await this.request(t,n,r)}return o&&de.workerEvent(this.spec.sid,td(td({},o),{},{requestId:a,actionType:"response",payload:JSON.stringify(E.serverResponse),serverCode:E.code,success:E.code===200,responseTime:Date.now()-p})),E.code!==200&&this.handleResponseError(E),E}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=kr==="4.18.1"?"0.0.1":kr;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case It.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void v.warning("live stream response already exists stream");case It.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case It.LIVE_STREAM_RESPONSE_BAD_STREAM:case It.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new N(I.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case It.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new N(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case It.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new N(I.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case It.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new N(I.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit($r.WARNING,n,t.serverResponse.url)}case It.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new N(I.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit($r.WARNING,n,t.serverResponse.url)}case It.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new N(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case It.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new N(I.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case It.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new N(I.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit($r.WARNING,n,t.serverResponse.url)}case It.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new N(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case It.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new N(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case It.LIVE_STREAM_RESPONSE_WORKER_LOST:case It.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new N(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case It.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new N(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new N(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case It.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case It.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case It.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case It.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new N(I.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Tu)},6e3)}}function BC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Bn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?BC(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class uF extends Et{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Dt,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Dt;super(),_(this,"onLiveStreamWarning",void 0),_(this,"onLiveStreamError",void 0),_(this,"onInjectStatusChange",void 0),_(this,"spec",void 0),_(this,"retryTimeout",1e4),_(this,"connection",void 0),_(this,"httpRetryConfig",void 0),_(this,"wsRetryConfig",void 0),_(this,"streamingTasks",new Map),_(this,"isStartingStreamingTask",!1),_(this,"taskMutex",new Mn("live-streaming")),_(this,"cancelToken",mr.CancelToken.source()),_(this,"transcodingConfig",void 0),_(this,"injectConfig",Bn({},wV)),_(this,"injectLoopTimes",0),_(this,"uapResponse",void 0),_(this,"lastTaskId",1),_(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=Bn(Bn({},OV),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(v.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(c=>Bn(Bn(Bn({},AV),c),{},{zOrder:c.zOrder?c.zOrder+1:1}))),function(c){ut(c.width)||it(c.width,"config.width",0,1e4),ut(c.height)||it(c.height,"config.height",0,1e4),ut(c.videoBitrate)||it(c.videoBitrate,"config.videoBitrate",1,1e6),ut(c.videoFrameRate)||it(c.videoFrameRate,"config.videoFrameRate"),ut(c.lowLatency)||Da(c.lowLatency,"config.lowLatency"),ut(c.audioSampleRate)||$t(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),ut(c.audioBitrate)||it(c.audioBitrate,"config.audioBitrate",1,128),ut(c.audioChannels)||$t(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),ut(c.videoGop)||it(c.videoGop,"config.videoGop"),ut(c.videoCodecProfile)||$t(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),ut(c.userCount)||it(c.userCount,"config.userCount",0,17),ut(c.backgroundColor)||it(c.backgroundColor,"config.backgroundColor",0,16777215),ut(c.userConfigExtraInfo)||fn(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!ut(c.transcodingUsers)&&(io(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach((l,h)=>{ym(l.uid),ut(l.x)||it(l.x,"transcodingUser[".concat(h,"].x"),0,1e4),ut(l.y)||it(l.y,"transcodingUser[".concat(h,"].y"),0,1e4),ut(l.width)||it(l.width,"transcodingUser[".concat(h,"].width"),0,1e4),ut(l.height)||it(l.height,"transcodingUser[".concat(h,"].height"),0,1e4),ut(l.zOrder)||it(l.zOrder-1,"transcodingUser[".concat(h,"].zOrder"),0,100),ut(l.alpha)||it(l.alpha,"transcodingUser[".concat(h,"].alpha"),0,1,!1)})),ut(c.watermark)||bm(c.watermark,"watermark"),ut(c.backgroundImage)||bm(c.backgroundImage,"backgroundImage"),c.images&&!ut(c.images)&&(io(c.images,"config.images"),c.images.forEach((l,h)=>{bm(l,"images[".concat(h,"]"))}))}(n);const r=[];n.images&&r.push(...n.images.map(c=>Bn(Bn(Bn({},Nm),c),{},{zOrder:255}))),n.backgroundImage&&(r.push(Bn(Bn(Bn({},Nm),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(Bn(Bn(Bn({},Nm),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(c=>Bn({},c)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const o=(n.userConfigs||[]).map(c=>typeof c.uid=="number"?se.resolve(c.uid):MC(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await se.all(o)).forEach((c,l)=>{n.userConfigs&&n.userConfigs[l]&&(n.userConfigs[l].uid=c)}),this.transcodingConfig=n,this.connection)try{var a;const c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Fi(a=this.streamingTasks).call(a)).map(l=>l.taskId).join("#")});v.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(l=>{v.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,c).then(()=>{v.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(l.url," success"))}).catch(h=>{v.error("[".concat(this.spec.clientId,"] live streaming republish failed"),l.url,h.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,h)})})}}setInjectStreamConfig(t,n){this.injectConfig=Object.assign({},this.injectConfig,t),this.injectLoopTimes=n}async startLiveStreamingTask(t,n,r){var o;if(Array.from(Fi(o=this.streamingTasks).call(o)).find(h=>h.mode===jt.INJECT)&&n===jt.INJECT)return new N(I.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&n===jt.TRANSCODE)throw new N(I.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let a={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};v.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const c=await this.taskMutex.lock();if(!this.connection&&r)return void c();if(this.streamingTasks.get(t)&&!r)return c(),new N(I.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(h){throw c(),h}switch(n){case jt.TRANSCODE:a.transcodingConfig=Bn({},this.transcodingConfig);break;case jt.RAW:break;case jt.INJECT:a={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(a.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const l=this.lastTaskId++;try{const h=new se((p,E)=>{Tn(this.retryTimeout).then(()=>{if(r)return E(r);const T=this.statusError.get(t);return T?(this.statusError.delete(t),E(T)):void 0})}),f=await se.race([this.connection.request("request",{clientRequest:a},!0,{url:t,command:"PublishStream",workerType:n===jt.TRANSCODE?1:2,requestByUser:!r,tid:l.toString()}),h]);this.isStartingStreamingTask=!1,v.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(f.code)),this.streamingTasks.set(t,{clientRequest:a,mode:n,url:t,taskId:l}),c()}catch(h){if(c(),this.isStartingStreamingTask=!1,!h.data||!h.data.retry||r)throw h;return h.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,h)):await this.startLiveStreamingTask(t,n,h)}}stopLiveStreamingTask(t){return new se((n,r)=>{const o=this.streamingTasks.get(t);if(!o||!this.connection)return new N(I.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const a=o.mode;o.abortTask=()=>{v.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:a===jt.INJECT?"UninjectStream":"UnpublishStream",url:o.url}},!1,{url:t,command:"UnPublishStream",workerType:a===jt.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(c=>{v.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&a!==jt.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),n(),a===jt.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(Uo.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,t)}).catch(r)})}async controlInjectStream(t,n,r,o){const a=this.streamingTasks.get(t);if(!a||!this.connection||a.mode!==jt.INJECT)throw new N(I.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:n,audioVolume:r,position:o}})).serverResponse}resetAllTask(){var t;const n=Array.from(Fi(t=this.streamingTasks).call(t));this.terminate();for(const r of n)this.startLiveStreamingTask(r.url,r.mode).catch(o=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,o)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=mr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new N(I.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await vn(this,La.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new lF(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on($r.WARNING,(r,o)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(o,r)),this.connection.on($r.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on($r.INJECT_STREAM_STATUS,r=>this.handleInjectStreamServerStatus(r)),this.connection.on($r.REQUEST_NEW_ADDRESS,(r,o)=>{if(!this.connection)return o(new N(I.UNEXPECTED_ERROR,"can not get new live streaming address list"));vn(this,La.REQUEST_WORKER_MANAGER_LIST,t).then(a=>{this.uapResponse=a,r(a.addressList)}).catch(o)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),o=t.reason;switch(t.code){case It.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case It.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case It.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case It.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const c=new N(I.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return v.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,c);if(!this.isStartingStreamingTask)return;this.statusError.set(n,c)}case It.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const c=new N(I.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,o);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,c)}case It.LIVE_STREAM_RESPONSE_WORKER_LOST:case It.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var a;if(!this.connection)return;this.connection.tryNextAddress();const c=Array.from(Fi(a=this.streamingTasks).call(a));for(const l of c)l.abortTask?l.abortTask():(v.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,new N(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{v.debug("[".concat(this.spec.clientId,"] republish live stream success"),l.url)}).catch(h=>{v.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,h)}));return}}}handleInjectStreamServerStatus(t){const n=Number(t.uid),r=t.serverStatus&&t.serverStatus.url;switch(t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(Uo.INJECT_STREAM_STATUS_START_SUCCESS,n,r));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(Uo.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,n,r),void this.streamingTasks.delete(r);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(Uo.INJECT_STREAM_STATUS_START_UNAUTHORIZED,n,r),void this.streamingTasks.delete(r);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(Uo.INJECT_STREAM_STATUS_BROKEN,n,r),void this.streamingTasks.delete(r);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(Uo.INJECT_STREAM_STATUS_START_TIMEOUT,n,r),void this.streamingTasks.delete(r);default:return void v.debug("inject stream server status",t)}}hasUrl(t){return this.streamingTasks.has(t)}}class GC{constructor(){_(this,"destChannelMediaInfos",new Map),_(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){Py(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){Py(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){Rm(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function WC(e){if(!(e instanceof GC))return new N(I.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new N(I.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new N(I.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class hF extends Et{constructor(t,n,r){super(),_(this,"ws",void 0),_(this,"requestId",1),_(this,"heartBeatTimer",void 0),_(this,"joinInfo",void 0),_(this,"clientId",void 0),_(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),_(this,"onClose",o=>{this.emit("close"),this.dispose()}),_(this,"onMessage",o=>{const a=JSON.parse(o.data);if(!a||a.command!=="serverResponse"||!a.requestId)return a&&a.command==="serverStatus"&&a.serverStatus&&a.serverStatus.command?(this.emit("status",a.serverStatus),void this.emit(a.serverStatus.command,a.serverStatus)):void 0;this.emit("req_".concat(a.requestId),a)}),this.joinInfo=t,this.clientId=n,this.ws=new Fs("cross-channel-".concat(this.clientId),r),this.ws.on(ve.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(ve.CONNECTED,this.onOpen),this.ws.on(ve.ON_MESSAGE,this.onMessage),this.ws.on(ve.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new se((n,r)=>{const o=window.setTimeout(()=>{r(new N(I.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,a=>{window.clearTimeout(o),a.state&&a.state!==0?r(new N(I.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(o),r(new N(I.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new N(I.WS_DISCONNECT);const n=()=>new se((c,l)=>{this.ws.once(ve.CLOSED,()=>l(new N(I.WS_ABORT))),this.ws.once(ve.CONNECTED,c)});this.ws.state!=="connected"&&await n();const r=this.sendMessage(t),o=new se((c,l)=>{const h=()=>{l(new N(I.WS_ABORT))};this.ws.once(ve.RECONNECTING,h),this.ws.once(ve.CLOSED,h),this.once("req_".concat(r),c),Tn(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(ve.RECONNECTING,h),this.ws.off(ve.CLOSED,h),l(new N(I.TIMEOUT,"cross channel ws request timeout"))})}),a=await o;if(!a||a.code!==200)throw new N(I.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(a)));return a}async connect(t){this.ws.removeAllListeners(ve.REQUEST_NEW_URLS),this.ws.on(ve.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class pF extends Et{set state(t){t!==this._state&&(t!==kn.RELAY_STATE_FAILURE&&(this.errorCode=xo.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,r,o,a){super(),_(this,"joinInfo",void 0),_(this,"sid",void 0),_(this,"clientId",void 0),_(this,"cancelToken",mr.CancelToken.source()),_(this,"workerToken",void 0),_(this,"requestId",0),_(this,"signal",void 0),_(this,"prevChannelMediaConfig",void 0),_(this,"httpRetryConfig",void 0),_(this,"_resolution",void 0),_(this,"_state",kn.RELAY_STATE_IDLE),_(this,"errorCode",xo.RELAY_OK),_(this,"onStatus",c=>{v.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(c))),c&&c.command&&(c.command==="onAudioPacketReceived"&&this.emit("event",Ri.PACKET_RECEIVED_AUDIO_FROM_SRC),c.command==="onVideoPacketReceived"&&this.emit("event",Ri.PACKET_RECEIVED_VIDEO_FROM_SRC),c.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=xo.SRC_TOKEN_EXPIRED,this.state=kn.RELAY_STATE_FAILURE),c.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=xo.DEST_TOKEN_EXPIRED,this.state=kn.RELAY_STATE_FAILURE))}),_(this,"onReconnect",async()=>{v.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Ri.NETWORK_DISCONNECTED),this.state=kn.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(c=>{this.state!==kn.RELAY_STATE_IDLE&&(v.error("auto restart channel media relay failed",c.toString()),this.errorCode=xo.SERVER_CONNECTION_LOST,this.state=kn.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=Xm(),this.signal=new hF(this.joinInfo,this.clientId,r),this.httpRetryConfig=o,this._resolution=a}async startChannelMediaRelay(t){if(this.state!==kn.RELAY_STATE_IDLE)throw new N(I.INVALID_OPERATION);this.state=kn.RELAY_STATE_CONNECTING,await this.connect(),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new N(I.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new N(I.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new N(I.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==kn.RELAY_STATE_RUNNING)throw new N(I.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==kn.RELAY_STATE_RUNNING)throw new N(I.INVALID_OPERATION);const n=this.genMessage(_n.SetVideoProfile);await this.signal.request(n),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),v.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=kn.RELAY_STATE_IDLE,this.dispose()}dispose(){v.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=mr.CancelToken.source(),this.state=kn.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await aF(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Ri.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(_n.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const r=this.genMessage(_n.SetSdkProfile,t);await this.signal.request(r),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const o=this.genMessage(_n.SetSourceChannel,t);await this.signal.request(o),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Ri.PACKET_JOINED_SRC_CHANNEL),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const a=this.genMessage(_n.SetSourceUserId,t);await this.signal.request(a),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const c=this.genMessage(_n.SetDestChannel,t);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Ri.PACKET_JOINED_DEST_CHANNEL),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const l=this.genMessage(_n.StartPacketTransfer,t);await this.signal.request(l),this.emit("event",Ri.PACKET_SENT_TO_DEST_CHANNEL),this.state=kn.RELAY_STATE_RUNNING,v.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(_n.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",Ri.PACKET_UPDATE_DEST_CHANNEL),v.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(_n.StopPacketTransfer);await this.signal.request(t),v.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const r=[],o=[],a=[];this.requestId+=1;const c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:kr,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.18.1"&&(c.sdkVersion="0.0.1");let l=null,h=null;switch(t){case _n.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case _n.SetSourceChannel:if(h=n&&n.getSrcChannelMediaInfo(),!h)throw new N(I.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:h.channelName,token:h.token||this.joinInfo.appId},c;case _n.SetSourceUserId:if(h=n&&n.getSrcChannelMediaInfo(),!h)throw new N(I.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:h.uid+""},c;case _n.SetDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new N(I.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(f=>{r.push(f.channelName),o.push(f.uid+""),a.push(f.token||this.joinInfo.appId)}),c.clientRequest={command:"SetDestChannel",channelName:r,uid:o,token:a},c;case _n.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case _n.Reconnect:return c.clientRequest={command:"Reconnect"},c;case _n.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case _n.UpdateDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new N(I.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(f=>{r.push(f.channelName),o.push(f.uid+""),a.push(f.token||this.joinInfo.appId)}),c.clientRequest={command:"UpdateDestChannel",channelName:r,uid:o,token:a},c;case _n.SetVideoProfile:c.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return c}}const oE=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new se((n,r)=>{t.toBlob(async o=>{if(t.remove(),o){const a=await HC(o);n({buffer:a,width:t.width,height:t.height})}else r(new N(I.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},HC=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};function KC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function YC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?KC(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class sE{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(v.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}constructor(t){_(this,"trackId",void 0),_(this,"config",void 0),_(this,"onFirstVideoFrameDecoded",void 0),_(this,"freezeTimeCounterList",[]),_(this,"renderFreezeAccTime",0),_(this,"isKeepLastFrame",!1),_(this,"timeUpdatedCount",0),_(this,"freezeTime",0),_(this,"playbackTime",0),_(this,"lastTimeUpdatedTime",0),_(this,"autoplayFailed",!1),_(this,"videoTrack",void 0),_(this,"videoElement",void 0),_(this,"cacheVideoElement",void 0),_(this,"videoElementCheckInterval",void 0),_(this,"_videoElementStatus",mn.NONE),_(this,"isGettingVideoDimensions",!1),_(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return v.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),_(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Ye.curState==="running"&&(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(RR())),OR()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),_(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=mn.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=mn.CANPLAY;break;case"stalled":this.videoElementStatus=mn.STALLED;break;case"suspend":this.videoElementStatus=mn.SUSPEND;break;case"pause":this.videoElementStatus=mn.PAUSED,Pn()||Vi()||Dn()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=mn.WAITING;break;case"abort":this.videoElementStatus=mn.ABORT;break;case"ended":this.videoElementStatus=mn.ENDED;break;case"emptied":this.videoElementStatus=mn.EMPTIED;break;case"error":{this.videoElementStatus=mn.ERROR;const r=this.videoElement.error;r&&v.error("[".concat(this.trackId,"] media error, code: ").concat(r.code,", message: ").concat(r.message));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const o=r-this.lastTimeUpdatedTime,a=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,so.lastVisibleTime<so.lastHiddenTime||a<so.lastHiddenTime||a<so.lastVisibleTime)return;for(o>L("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=o),this.playbackTime+=o;this.playbackTime>=6e3;){this.playbackTime-=6e3;const c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),_(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(RR())),OR()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Ye.on(Jt.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ye.on(Jt.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(o=>{t&&de.autoplayFailed(t,"video",o.message,this.trackId),o.name==="NotAllowedError"?(v.warning("detected video element autoplay failed",o),this.autoplayFailed=!0,this.handleAutoPlayFailed()):v.warning("[".concat(this.trackId,"] play warning: "),o)});const r=He();if((r.name==="Safari"&&Number(r.version)===15||ya())&&n&&n.then&&n.catch){const o=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(o).catch(o)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return v.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height);return t.remove(),r}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const o=r.getContext("2d");return o?(o.drawImage(this.videoElement,0,0,r.width,r.height),new se((a,c)=>{r.toBlob(async l=>{if(r.remove(),l){const h=await HC(l);a({buffer:h,width:r.width,height:r.height})}else c(new N(I.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await oE(t)}destroy(){Ye.off(Jt.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ye.off(Jt.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=mn.INIT,!this.videoElementCheckInterval&&(zC.forEach(a=>{this.videoElement.addEventListener(a,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(a){return a!==document.body&&document.body.contains(a)})(this.videoElement)||(this.videoElementStatus=mn.DESTROYED)},1e3),L("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let a;const c=(l,h)=>{if(this.videoElementStatus===mn.PLAYING){if(a){const E=h.presentationTime-a.presentationTime;E>L("VIDEO_FREEZE_DURATION")&&so.lastVisibleTime>=so.lastHiddenTime&&a.timestamp>so.lastVisibleTime&&a.timestamp>so.lastHiddenTime&&(this.renderFreezeAccTime+=E)}a=YC(YC({},h),{},{timestamp:l})}var f,p;L("ENABLE_VIDEO_FRAME_CALLBACK")&&((f=(p=this.videoElement).requestVideoFrameCallback)===null||f===void 0||f.call(p,c))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,c)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Xl()&&(this.videoElement.poster="noposter");const r=He();r.name==="Safari"&&Number(r.version)===15||ya()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,gt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,gt()&&this.videoElement.load());const o=this.videoElement.play();o!==void 0&&o.catch(a=>{v.debug("[".concat(this.trackId,"] playback interrupted"),a.toString())})}resetVideoElement(){zC.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=mn.NONE}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{v.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{v.error(r)}),this.autoplayFailed=!1,Wc()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Wc()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),Jy()}}const zC=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class qC extends sE{constructor(t){super(t),_(this,"container",void 0),_(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,r):await oE(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",L("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function Cu(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=Ds(e.encoderConfig);return t.width=n.width,t.height=n.height,!NR()&&n.frameRate&&(t.frameRate=n.frameRate),He().name===Xe.EDGE&&typeof t.frameRate=="object"&&(t.frameRate.max=60),gt()&&(t.frameRate={ideal:30,max:30}),t}function fF(e){const t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&Yf()&&(t.extensionId=e.extensionId);const{displaySurface:n,selfBrowserSurface:r,surfaceSwitching:o,systemAudio:a}=e;(zf(107)||yR(107)||IR(93))&&(n&&($t(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),r?($t(r,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=r):t.selfBrowserSurface="include",o&&($t(o,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=o)),(zf(105)||yR(105)||IR(91))&&a&&($t(a,"systemAudio",["exclude","include"]),t.systemAudio=a),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);const c=e.encoderConfig?fm(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:c?c.width:void 0,maxHeight:c?c.height:void 0},c&&(c.frameRate&&(typeof c.frameRate=="number"?(t.mandatory.maxFrameRate=c.frameRate,t.mandatory.minFrameRate=c.frameRate):(t.mandatory.maxFrameRate=c.frameRate.max||c.frameRate.ideal||c.frameRate.exact||void 0,t.mandatory.minFrameRate=c.frameRate.min||c.frameRate.ideal||c.frameRate.exact||void 0),t.frameRate=c.frameRate),c.width&&(t.width=c.width),c.height&&(t.height=c.height)),t}function JC(e){const t={};if(NR()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Yf()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){const n=cu(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),Xl()&&(t.sampleRate=void 0),t}var Ha,Au;(function(e){e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE"})(Ha||(Ha={})),function(e){e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(Au||(Au={}));var XC,QC,$C,ZC,eA,tA,nA,rA,iA,oA,sA,aA,cA,dA,lA,uA,hA,pA,fA,mA,EA,_A,gA,SA,Pe,TA,vA,RA,yA,IA,CA,AA,OA,Vr,wA=new class{constructor(){_(this,"_clientSize",null),_(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),_(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),_(this,"getStyle",e=>window.getComputedStyle(e,null)),_(this,"checkCssVisibleProperty",e=>{let t=!0;const n=this.getStyle(e),{display:r,visibility:o,opacity:a,filter:c}=n;return(r==="none"||["hidden","collapse"].includes(o)||Number(a)<.1)&&(t=!1),t?(c&&c.split(" ").filter(l=>{const h=l.split("(")[0];return["brightness","blur","opacity"].includes(h)}).map(l=>{const[h,f]=l.split(/\(|\)/);return[h,Number(f.match(/^[0-9\.]+/))]}).forEach(l=>{const[h,f]=l;switch(h){case"brightness":(f<.1||f>3)&&(t=!1);break;case"blur":f>3&&(t=!1);break;case"opacity":f<.1&&(t=!1)}}),t):!1}),_(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,r=!0;const o=c=>t(c);let a=e;for(;a&&r;)o(a)||(n=!1,r=!1),a=a.parentElement,a||(r=!1);return n}),_(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),_(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:r,right:o,top:a,bottom:c}=e.getBoundingClientRect(),l=this.getClientWidth(),h=this.getClientHeight();return{width:t,height:n,left:r,right:o,top:a,bottom:c,clientWidth:l,clientHeight:h,clientMin:Math.min(l,h)}}),_(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),_(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),_(this,"checkCoverForAPoint",(e,t,n)=>{const r=this.elementFromPoint(e,t);return r!==null&&r!==n}),_(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,o=e/6,a=t/6,c=[],l=10**6;for(let h=0;h<5;h++)for(let f=0;f<5;f++){const p=(n*l+(h===0?.1:h===4?(o*h*l-1e5)/l:o*h)*l)/l,E=(r*l+(f===0?.1:f===4?(a*f*l-1e5)/l:a*f)*l)/l;c.push({x:p,y:E})}return[...c]}),_(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),_(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),_(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:o,clientWidth:a,clientMin:c}=this._clientSize;let l,h,f,p;if(e<0)l=0;else{if(!(e<a))return!1;l=e}if(t<0)return!1;if(h=t<a?t:a,n<0)f=0;else{if(!(n<o))return!1;f=n}if(r<0)return!1;p=r<o?r:o;const E=h-l,T=p-f;return this.checkSizeIsVisible(E,T,c)}),_(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),_(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Ha.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(Ha.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Ha.SIZE)}}return this.returnHiddenResult(Ha.STYLE)}return this.returnHiddenResult(Au.UNMOUNTED)}return this.returnHiddenResult(Au.INVALID_HTML_ELEMENT)}),_(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function NA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function nd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?NA(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NA(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Ut=(XC=fe({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),QC=Tt(),$C=fe({argsMap:e=>[e.getTrackId()]}),ZC=Ua("LocalVideoTrack","_enabledMutex"),eA=fe({argsMap:(e,t)=>[e.getTrackId(),t]}),tA=Tt(),nA=Ua("LocalVideoTrack","_enabledMutex"),rA=fe({argsMap:(e,t)=>[e.getTrackId(),t]}),iA=Tt(),oA=fe({argsMap:(e,t)=>[e.getTrackId(),t]}),sA=Tt(),aA=Tt(),cA=fe({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),dA=Tt(),lA=Tt(),uA=Tt(),hA=Tt(),pA=Tt(),fA=Tt(),mA=Tt(),EA=fe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),_A=fe({argsMap:e=>[e.getTrackId()]}),gA=fe({argsMap:e=>[e.getTrackId()]}),SA=fe({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),K((Pe=class QD extends Bm{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==mn.PLAYING)}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,r,o,a,c){if(super(t,a),_(this,"trackMediaType","video"),_(this,"_player",void 0),_(this,"_videoVisibleTimer",null),_(this,"_previousVideoVisibleStatus",void 0),_(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),_(this,"_encoderConfig",void 0),_(this,"_scalabiltyMode",{numSpatialLayers:1,numTemporalLayers:1}),_(this,"_optimizationMode",void 0),_(this,"_videoHeight",void 0),_(this,"_videoWidth",void 0),_(this,"_forceBitrateLimit",void 0),_(this,"_enabled",!0),_(this,"processorDestination",void 0),_(this,"_processorContext",void 0),Dn()){const{width:l,height:h}=t.getSettings();this._videoWidth=l,this._videoHeight=h}else this.updateMediaStreamTrackResolution();this._encoderConfig=n,this._scalabiltyMode=r,this._optimizationMode=o,this._hints=c||[],this._hints.indexOf(Wt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile(),n&&this._hints.indexOf(Wt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this.processorContext=new fI(this.getTrackId(),"local"),this.processorDestination=new pI(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const o=document.getElementById(t);o?t=o:(v.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}v.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const r=nd(nd(nd({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new sE(r):this._player=new qC(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(Vo.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},L("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,v.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await vt(this,_e.NEED_DISABLE_TRACK,this)}catch(r){throw v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(this._enabled=!1),void v.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await vt(this,_e.NEED_ENABLE_TRACK,this)}catch(r){throw v.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}v.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,v.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await vt(this,_e.NEED_MUTE_TRACK,this):await vt(this,_e.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,n){if(!this._enabled)throw new N(I.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Ds(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const r=Cu({encoderConfig:t});(Dn()||Pn()||Vi())&&(r.deviceId=void 0),v.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(o){const a=new N(I.UNEXPECTED_ERROR,o.toString());throw v.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}}this._encoderConfig=t,this._hints.indexOf(Wt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await vt(this,_e.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw()}}getStats(){return $c(()=>{v.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),ti(this,_e.GET_STATS)||nd({},wm)}async setBeautyEffect(t){v.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await oE(t)}clone(t,n,r,o){const a=this._mediaStreamTrack.clone();return new QD(a,t,n,r,o)}async setBitrateLimit(t){if(v.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await vt(this,_e.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw()}}}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void v.error(I.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await vt(this,_e.SET_OPTIMIZATION_MODE,this)}catch(r){throw this._optimizationMode=n,v.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}v.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return v.error(I.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=t,v.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){lC(this._originMediaStreamTrack).then(t=>{let[n,r]=t;this._videoHeight=r,this._videoWidth=n}).catch(Tu)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!n||!r)return;const[o,a]=function(c,l,h){const f=L("BITRATE_ADAPTER_TYPE");let p;const E=200*Math.pow(h/15,.6)*Math.pow(c*l/640/360,.75),T=E;if(f==="STANDARD_BITRATE")p=4*E;else{if(f!=="COMPATIABLE_BITRATE")return;p=2*E}return[Math.floor(p),Math.floor(T)]}(t,n,r)||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=o,v.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(o,", brMin: ").concat(a,"]")))}getVideoElementVisibleStatus(){try{var t,n;const r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:a,slot:c}=o;if(this.isPlaying&&a instanceof HTMLVideoElement&&c instanceof HTMLElement){const l=wA.checkOneElementVisible(a),h=Object.assign({},l);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;const f=de.reportApiInvoke(null,{tag:ft.TRACER,name:Pt.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?f.onSuccess("Video is visible"):f.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(r){throw new N(I.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new N(I.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new N(I.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new N(I.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}bindProcessorDestinationEvents(){this.processorDestination.on(gn.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await vt(this,_e.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await vt(this,_e.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(gn.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(qn.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(qn.REQUEST_CONSTRAINTS)}}).prototype,"play",[XC,QC],Object.getOwnPropertyDescriptor(Pe.prototype,"play"),Pe.prototype),K(Pe.prototype,"stop",[$C],Object.getOwnPropertyDescriptor(Pe.prototype,"stop"),Pe.prototype),K(Pe.prototype,"setEnabled",[ZC,eA,tA],Object.getOwnPropertyDescriptor(Pe.prototype,"setEnabled"),Pe.prototype),K(Pe.prototype,"setMuted",[nA,rA,iA],Object.getOwnPropertyDescriptor(Pe.prototype,"setMuted"),Pe.prototype),K(Pe.prototype,"setEncoderConfiguration",[oA,sA],Object.getOwnPropertyDescriptor(Pe.prototype,"setEncoderConfiguration"),Pe.prototype),K(Pe.prototype,"getStats",[aA],Object.getOwnPropertyDescriptor(Pe.prototype,"getStats"),Pe.prototype),K(Pe.prototype,"setBeautyEffect",[cA,dA],Object.getOwnPropertyDescriptor(Pe.prototype,"setBeautyEffect"),Pe.prototype),K(Pe.prototype,"getCurrentFrameData",[lA],Object.getOwnPropertyDescriptor(Pe.prototype,"getCurrentFrameData"),Pe.prototype),K(Pe.prototype,"getCurrentFrameImage",[uA],Object.getOwnPropertyDescriptor(Pe.prototype,"getCurrentFrameImage"),Pe.prototype),K(Pe.prototype,"setBitrateLimit",[hA],Object.getOwnPropertyDescriptor(Pe.prototype,"setBitrateLimit"),Pe.prototype),K(Pe.prototype,"setOptimizationMode",[pA],Object.getOwnPropertyDescriptor(Pe.prototype,"setOptimizationMode"),Pe.prototype),K(Pe.prototype,"setScalabiltyMode",[fA],Object.getOwnPropertyDescriptor(Pe.prototype,"setScalabiltyMode"),Pe.prototype),K(Pe.prototype,"updateMediaStreamTrackResolution",[mA],Object.getOwnPropertyDescriptor(Pe.prototype,"updateMediaStreamTrackResolution"),Pe.prototype),K(Pe.prototype,"pipe",[EA],Object.getOwnPropertyDescriptor(Pe.prototype,"pipe"),Pe.prototype),K(Pe.prototype,"unpipe",[_A],Object.getOwnPropertyDescriptor(Pe.prototype,"unpipe"),Pe.prototype),K(Pe.prototype,"close",[gA],Object.getOwnPropertyDescriptor(Pe.prototype,"close"),Pe.prototype),K(Pe.prototype,"replaceTrack",[SA],Object.getOwnPropertyDescriptor(Pe.prototype,"replaceTrack"),Pe.prototype),Pe),bA=(TA=fe({argsMap:(e,t)=>[e.getTrackId(),t]}),vA=Tt(),RA=Ua("CameraVideoTrack","_enabledMutex"),yA=fe({argsMap:(e,t)=>[e.getTrackId(),t]}),IA=Tt(),CA=fe({argsMap:(e,t)=>[e.getTrackId(),t]}),AA=Tt(),OA=fe({argsMap:e=>[e.getTrackId()]}),K((Vr=class extends Ut{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,r,o,a){super(e,Ds(t.encoderConfig),r,o,a),_(this,"_config",void 0),_(this,"_originalConstraints",void 0),_(this,"_constraints",void 0),_(this,"_enabled",!0),_(this,"_deviceName","default"),_(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(ya()||qf())&&!function(){const c=He();if(c.os!==pn.IOS||!c.osVersion)return!1;const l=c.osVersion.split(".");return Number(l[0])===15&&Number(l[1])>=2}()&&wR()&&this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=Ds(this._config.encoderConfig),Ye.on(Jt.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Ye.on(Jt.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){if(v.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await Rr.getDeviceById(e),n={};n.video=nd({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await ei(n,this.getTrackId())}catch(o){throw v.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),r=await ei({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await Rr.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}v.info("[".concat(this.getTrackId(),"] setDevice success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const n=await ei({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1)}await vt(this,_e.NEED_ENABLE_TRACK,this)}catch(n){throw v.error("[".concat(this.getTrackId(),"] setEnabled true error"),n.toString()),n}this.updateMediaStreamTrackResolution(),v.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await vt(this,_e.NEED_DISABLE_TRACK,this)}catch(n){throw v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}v.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new N(I.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=Ds(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin);const n=Mt(this._config);n.encoderConfig=e;const r=Cu(n);(Dn()||Pn()||Vi())&&(r.deviceId=void 0),v.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(o){const a=new N(I.UNEXPECTED_ERROR,o.toString());throw v.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}this._config=n,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,this._hints.indexOf(Wt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await vt(this,_e.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw()}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Pn()||Vi())&&this._enabled&&!this._isClosed&&Ye.duringInterruption){const e=async()=>{Ye.off(Jt.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Ye.on(Jt.IOS_INTERRUPTION_END,e)}else v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Vo.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=Rr.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){const r=await ei({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Ye.off(Jt.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Ye.off(Jt.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}bindProcessorContextEvents(){this.processorContext.on(qn.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),t()}catch(r){n(r)}}),this.processorContext.on(qn.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[TA,vA],Object.getOwnPropertyDescriptor(Vr.prototype,"setDevice"),Vr.prototype),K(Vr.prototype,"setEnabled",[RA,yA,IA],Object.getOwnPropertyDescriptor(Vr.prototype,"setEnabled"),Vr.prototype),K(Vr.prototype,"setEncoderConfiguration",[CA,AA],Object.getOwnPropertyDescriptor(Vr.prototype,"setEncoderConfiguration"),Vr.prototype),K(Vr.prototype,"close",[OA],Object.getOwnPropertyDescriptor(Vr.prototype,"close"),Vr.prototype),Vr);class aE{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}constructor(t,n){_(this,"uid",void 0),_(this,"_uintid",void 0),_(this,"_trust_in_room_",!0),_(this,"_trust_audio_enabled_state_",!0),_(this,"_trust_video_enabled_state_",!0),_(this,"_trust_audio_mute_state_",!0),_(this,"_trust_video_mute_state_",!0),_(this,"_audio_muted_",!1),_(this,"_video_muted_",!1),_(this,"_audio_enabled_",!0),_(this,"_video_enabled_",!0),_(this,"_audio_added_",!1),_(this,"_video_added_",!1),_(this,"_trust_video_stream_added_state_",!0),_(this,"_trust_audio_stream_added_state_",!0),_(this,"_audioTrack",void 0),_(this,"_videoTrack",void 0),_(this,"_audioSSRC",void 0),_(this,"_videoSSRC",void 0),_(this,"_audioOrtc",void 0),_(this,"_videoOrtc",void 0),_(this,"_cname",void 0),_(this,"_rtxSsrcId",void 0),this.uid=t,this._uintid=n}}var mF=Fv,EF=ga,_F=xl;Vn({target:"Promise",stat:!0},{try:function(e){var t=EF.f(this),n=_F(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var cE=mF,gF=Vn,SF=j,TF=m,vF=Qc,RF=Xr,yF=Oo,IF=wo,DA=Em,CF=Vy,AF=Hy,OF=la,PA=hn("isConcatSpreadable"),LA=9007199254740991,kA="Maximum allowed index exceeded",MA=SF.TypeError,wF=OF>=51||!TF(function(){var e=[];return e[PA]=!1,e.concat()[0]!==e}),NF=AF("concat"),bF=function(e){if(!RF(e))return!1;var t=e[PA];return t!==void 0?!!t:vF(e)};gF({target:"Array",proto:!0,forced:!wF||!NF},{concat:function(e){var t,n,r,o,a,c=yF(this),l=CF(c,0),h=0;for(t=-1,r=arguments.length;t<r;t++)if(bF(a=t===-1?c:arguments[t])){if(h+(o=IF(a))>LA)throw MA(kA);for(n=0;n<o;n++,h++)n in a&&DA(l,h,a[n])}else{if(h>=LA)throw MA(kA);DA(l,h++,a)}return l.length=h,l}});var UA={},DF=Fe,PF=Co,xA=Sl.f,LF=ly,VA=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];UA.f=function(e){return VA&&DF(e)=="Window"?function(t){try{return xA(t)}catch{return LF(VA)}}(e):xA(PF(e))};var rd={},kF=hn;rd.f=kF;var jA=Ao,MF=rr,UF=rd,xF=gi.f,an=function(e){var t=jA.Symbol||(jA.Symbol={});MF(t,e)||xF(t,e,{value:UF.f(e)})},Ka=Vn,dE=j,VF=Mi,jF=G,id=lt,FF=B,Ya=Te,Bs=Rp,lE=m,Rn=rr,BF=Qc,GF=ne,WF=Xr,HF=z,uE=yp,hE=Si,KF=Oo,Ou=Co,pE=pl,FA=fa,fE=mi,od=yl,BA=Hp,YF=Sl,GA=UA,mE=Gp,WA=Se,HA=gi,zF=Wp,KA=tt,qF=df,EE=Ll,sd=hl.exports,YA=Tl,zA=Np,qA=hn,JF=rd,XF=an,QF=xc,JA=Pl,wu=Fy.forEach,yr=gl("hidden"),Nu="Symbol",XA=qA("toPrimitive"),$F=JA.set,QA=JA.getterFor(Nu),Ai=Object.prototype,Go=dE.Symbol,Gs=Go&&Go.prototype,$A=dE.TypeError,_E=dE.QObject,ad=VF("JSON","stringify"),ZA=WA.f,Wo=HA.f,eO=GA.f,ZF=KA.f,tO=FF([].push),lo=sd("symbols"),cd=sd("op-symbols"),gE=sd("string-to-symbol-registry"),SE=sd("symbol-to-string-registry"),eB=sd("wks"),TE=!_E||!_E.prototype||!_E.prototype.findChild,vE=Ya&&lE(function(){return od(Wo({},"a",{get:function(){return Wo(this,"a",{value:7}).a}})).a!=7})?function(e,t,n){var r=ZA(Ai,t);r&&delete Ai[t],Wo(e,t,n),r&&e!==Ai&&Wo(Ai,t,r)}:Wo,RE=function(e,t){var n=lo[e]=od(Gs);return $F(n,{type:Nu,tag:e,description:t}),Ya||(n.description=t),n},bu=function(e,t,n){e===Ai&&bu(cd,t,n),hE(e);var r=pE(t);return hE(n),Rn(lo,r)?(n.enumerable?(Rn(e,yr)&&e[yr][r]&&(e[yr][r]=!1),n=od(n,{enumerable:fE(0,!1)})):(Rn(e,yr)||Wo(e,yr,fE(1,{})),e[yr][r]=!0),vE(e,r,n)):Wo(e,r,n)},yE=function(e,t){hE(e);var n=Ou(t),r=BA(n).concat(IE(n));return wu(r,function(o){Ya&&!id(nO,n,o)||bu(e,o,n[o])}),e},nO=function(e){var t=pE(e),n=id(ZF,this,t);return!(this===Ai&&Rn(lo,t)&&!Rn(cd,t))&&(!(n||!Rn(this,t)||!Rn(lo,t)||Rn(this,yr)&&this[yr][t])||n)},rO=function(e,t){var n=Ou(e),r=pE(t);if(n!==Ai||!Rn(lo,r)||Rn(cd,r)){var o=ZA(n,r);return!o||!Rn(lo,r)||Rn(n,yr)&&n[yr][r]||(o.enumerable=!0),o}},iO=function(e){var t=eO(Ou(e)),n=[];return wu(t,function(r){Rn(lo,r)||Rn(YA,r)||tO(n,r)}),n},IE=function(e){var t=e===Ai,n=eO(t?cd:Ou(e)),r=[];return wu(n,function(o){!Rn(lo,o)||t&&!Rn(Ai,o)||tO(r,lo[o])}),r};if(Bs||(EE(Gs=(Go=function(){if(HF(Gs,this))throw $A("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?FA(arguments[0]):void 0,t=zA(e),n=function(r){this===Ai&&id(n,cd,r),Rn(this,yr)&&Rn(this[yr],t)&&(this[yr][t]=!1),vE(this,t,fE(1,r))};return Ya&&TE&&vE(Ai,t,{configurable:!0,set:n}),RE(t,e)}).prototype,"toString",function(){return QA(this).tag}),EE(Go,"withoutSetter",function(e){return RE(zA(e),e)}),KA.f=nO,HA.f=bu,zF.f=yE,WA.f=rO,YF.f=GA.f=iO,mE.f=IE,JF.f=function(e){return RE(qA(e),e)},Ya&&Wo(Gs,"description",{configurable:!0,get:function(){return QA(this).description}})),Ka({global:!0,wrap:!0,forced:!Bs,sham:!Bs},{Symbol:Go}),wu(BA(eB),function(e){XF(e)}),Ka({target:Nu,stat:!0,forced:!Bs},{for:function(e){var t=FA(e);if(Rn(gE,t))return gE[t];var n=Go(t);return gE[t]=n,SE[n]=t,n},keyFor:function(e){if(!uE(e))throw $A(e+" is not a symbol");if(Rn(SE,e))return SE[e]},useSetter:function(){TE=!0},useSimple:function(){TE=!1}}),Ka({target:"Object",stat:!0,forced:!Bs,sham:!Ya},{create:function(e,t){return t===void 0?od(e):yE(od(e),t)},defineProperty:bu,defineProperties:yE,getOwnPropertyDescriptor:rO}),Ka({target:"Object",stat:!0,forced:!Bs},{getOwnPropertyNames:iO,getOwnPropertySymbols:IE}),Ka({target:"Object",stat:!0,forced:lE(function(){mE.f(1)})},{getOwnPropertySymbols:function(e){return mE.f(KF(e))}}),ad&&Ka({target:"JSON",stat:!0,forced:!Bs||lE(function(){var e=Go();return ad([e])!="[null]"||ad({a:e})!="{}"||ad(Object(e))!="{}"})},{stringify:function(e,t,n){var r=qF(arguments),o=t;if((WF(t)||e!==void 0)&&!uE(e))return BF(t)||(t=function(a,c){if(GF(o)&&(c=id(o,this,a,c)),!uE(c))return c}),r[1]=t,jF(ad,null,r)}}),!Gs[XA]){var tB=Gs.valueOf;EE(Gs,XA,function(e){return id(tB,this)})}QF(Go,Nu),YA[yr]=!0,an("asyncIterator"),an("hasInstance"),an("isConcatSpreadable"),an("iterator"),an("match"),an("matchAll"),an("replace"),an("search"),an("species"),an("split"),an("toPrimitive"),an("toStringTag"),an("unscopables"),xc(j.JSON,"JSON",!0);var nB=Ao.Symbol;an("asyncDispose"),an("dispose"),an("matcher"),an("metadata"),an("observable"),an("patternMatch"),an("replaceAll");var oO=nB,sO=rd.f("asyncIterator"),rB=sO;function aO(e){this.wrapped=e}function dd(e){var t,n;function r(a,c){try{var l=e[a](c),h=l.value,f=h instanceof aO;cE.resolve(f?h.wrapped:h).then(function(p){f?r(a==="return"?"return":"next",p):o(l.done?"return":"normal",p)},function(p){r("throw",p)})}catch(p){o("throw",p)}}function o(a,c){switch(a){case"return":t.resolve({value:c,done:!0});break;case"throw":t.reject(c);break;default:t.resolve({value:c,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(a,c){return new cE(function(l,h){var f={key:a,arg:c,resolve:l,reject:h,next:null};n?n=n.next=f:(t=n=f,r(a,c))})},typeof e.return!="function"&&(this.return=void 0)}function ni(e){return function(){return new dd(e.apply(this,arguments))}}function Le(e){return new aO(e)}dd.prototype[typeof oO=="function"&&rB||"@@asyncIterator"]=function(){return this},dd.prototype.next=function(e){return this._invoke("next",e)},dd.prototype.throw=function(e){return this._invoke("throw",e)},dd.prototype.return=function(e){return this._invoke("return",e)};var iB=rd.f("iterator");function Du(e,t){var n={},r=!1;function o(a,c){return r=!0,c=new cE(function(l){l(e[a](c))}),{done:!1,value:t(c)}}return n[oO!==void 0&&iB||"@@iterator"]=function(){return this},n.next=function(a){return r?(r=!1,a):o("next",a)},typeof e.throw=="function"&&(n.throw=function(a){if(r)throw r=!1,a;return o("throw",a)}),typeof e.return=="function"&&(n.return=function(a){return r?(r=!1,a):o("return",a)}),n}var cO=sO,xt={exports:{}};function dO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function lO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dO(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function CE(e,t,n,r,o,a,c){let l=[],h=[],f=[],p=[],E=!1,T=!1;if(xt.exports.parse(e).mediaDescriptions.forEach(y=>{c&&c!==y.attributes.direction||(y.media.mediaType!=="video"||E||(h=y.attributes.payloads,p=y.attributes.extmaps,E=!0),y.media.mediaType!=="audio"||T||(l=y.attributes.payloads,f=y.attributes.extmaps,T=!0))}),!p||h.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!f||l.length===0)throw new Error("Cannot get audio capabilities from SDP.");return h.forEach(y=>{var C;(C=y.rtpMap)!==null&&C!==void 0&&C.clockRate&&(y.rtpMap.clockRate=parseInt(y.rtpMap.clockRate))}),l.forEach(y=>{var C;(C=y.rtpMap)!==null&&C!==void 0&&C.clockRate&&(y.rtpMap.clockRate=parseInt(y.rtpMap.clockRate))}),t&&(l=l.filter(y=>{var C;return((C=y.rtpMap)===null||C===void 0?void 0:C.encodingName.toLowerCase())!=="rtx"}),h=h.filter(y=>{var C;return((C=y.rtpMap)===null||C===void 0?void 0:C.encodingName.toLowerCase())!=="rtx"})),n&&(h=h.filter(y=>{var C;return!/(red)|(ulpfec)|(flexfec)/i.test(((C=y.rtpMap)===null||C===void 0?void 0:C.encodingName)||"")})),r&&(l=l.filter(y=>{var C;return!/(red)|(ulpfec)|(flexfec)/i.test(((C=y.rtpMap)===null||C===void 0?void 0:C.encodingName)||"")})),o&&(o==null?void 0:o.length)>0&&(l=l.filter(y=>{var C;return o.includes(((C=y.rtpMap)===null||C===void 0?void 0:C.encodingName.toLowerCase())||"")})),a&&(a==null?void 0:a.length)>0&&(h=h.filter(y=>{var C;return a.includes(((C=y.rtpMap)===null||C===void 0?void 0:C.encodingName.toLowerCase())||"")})),{audioCodecs:l,videoCodecs:h,audioExtensions:f,videoExtensions:p}}function Ws(e){const t=xt.exports.parse(e);let n,r;for(const o of t.mediaDescriptions){if(!n){const a=o.attributes.iceUfrag,c=o.attributes.icePwd;if(!a||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:a,icePwd:c}}if(!r){const a=o.attributes.fingerprints;a.length>0&&(r={fingerprints:a})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function uO(e,t){const n=[],r=e.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),o=e.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),a=e.attributes.ssrcs;if(o)o.ssrcIds.forEach(c=>{var l;const h=(l=r.find(f=>f.ssrcIds[0]===c))===null||l===void 0?void 0:l.ssrcIds[1];n.push({ssrcId:c,rtx:t?h:void 0})});else if(r.length>0){const c=r[0].ssrcIds[0],l=r[0].ssrcIds[1];n.push({ssrcId:c,rtx:t?l:void 0})}else{if(a.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:a[0].ssrcId})}return n}function hO(e,t){const{cname:n}=e;let r;t&&t.ip&&typeof t.port=="number"?(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],v.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),v.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):r=e.iceParameters.candidates.map(l=>({foundation:l.foundation,componentId:"1",transport:l.protocol,priority:l.priority.toString(),connectionAddress:l.ip,port:l.port.toString(),type:l.type,extension:{}}));const o={fingerprints:e.dtlsParameters.fingerprints.map(l=>({hashFunction:l.algorithm,fingerprint:l.fingerprint}))},a={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let c;switch(e.dtlsParameters.role){case"server":c="passive";break;case"client":c="active";break;case"auto":c="actpass"}return{dtlsParameters:o,iceParameters:a,candidates:r,rtpCapabilities:wE(e.rtpCapabilities),setup:c,cname:n}}function jr(e,t,n){const r=[],o=[];return e.forEach(a=>{let{ssrcId:c,rtx:l}=a;const h=dt(8,"track-"),f={ssrcId:c,attributes:lO({label:h,mslabel:n=n||dt(10,""),msid:"".concat(n," ").concat(h)},t&&{cname:t})};if(r.push(f),l!==void 0){const p={ssrcId:l,attributes:lO({label:h,mslabel:n,msid:"".concat(n," ").concat(h)},t&&{cname:t})};r.push(p),o.push({semantic:"FID",ssrcIds:[c,l]})}}),e.length>1&&o.push({semantic:"SIM",ssrcIds:e.map(a=>{let{ssrcId:c}=a;return c})}),{ssrcs:r,ssrcGroups:o}}function za(e,t){t instanceof Sn&&e.attributes.payloads.forEach(n=>{var r;const o=(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!o||["opus","pcmu","pcma","g722"].indexOf(o)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const a=t._encoderConfig;a&&o!=="pcmu"&&o!=="pcma"&&o!=="g722"&&(a.bitrate&&!gt()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*a.bitrate))),a.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(a.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(a.sampleRate)),a.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function AE(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function OE(e,t){if(!(t instanceof Ut&&t._encoderConfig&&t._hints.indexOf(Wt.SCREEN_TRACK)===-1))return;const n=t._encoderConfig;Ot().supportMinBitrate&&n.bitrateMin&&e.attributes.payloads.forEach(r=>{var o;["h264","h265","vp8","vp9","av1"].includes(((o=r.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-min-bitrate"]="".concat(n.bitrateMin))}),Ot().supportMinBitrate&&!t._hints.includes(Wt.LOW_STREAM)&&n.bitrateMax&&e.attributes.payloads.forEach(r=>{var o;["h264","h265","vp8","vp9","av1"].includes(((o=r.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-start-bitrate"]="".concat(L("X_GOOGLE_START_BITRATE")||Math.floor(n.bitrateMax)))})}function pO(e){if(e.media.mediaType!=="video")return;const t=He();if(t.name!==Xe.SAFARI&&t.os!==pn.IOS)return;const n=e.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function Pu(e,t,n){if(!t)return;let r,o;if(e.media.mediaType==="video"?(r=n.videoExtensions,o=n.videoCodecs):(r=n.audioExtensions,o=n.audioCodecs),t.twcc===!0){const a=r.find(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a&&(e.attributes.extmaps.find(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(c,l){return l.filter(h=>!!c.find(f=>f.payloadType===h.payloadType&&!!f.rtcpFeedbacks.find(p=>p.type==="transport-cc")))}(o,e.attributes.payloads).forEach(c=>{c.rtcpFeedbacks.find(l=>l.type==="transport-cc")||c.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t.twcc===!1){const a=e.attributes.extmaps.findIndex(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a!==-1&&e.attributes.extmaps.splice(a,1),e.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}if(t.remb===!0){const a=r.find(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");a&&(e.attributes.extmaps.find(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(c,l){return l.filter(h=>!!c.find(f=>f.payloadType===h.payloadType&&!!f.rtcpFeedbacks.find(p=>p.type==="goog-remb")))}(o,e.attributes.payloads).forEach(c=>{c.rtcpFeedbacks.find(l=>l.type==="goog-remb")||c.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t.remb===!1){const a=e.attributes.extmaps.findIndex(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");a!==-1&&e.attributes.extmaps.splice(a,1),e.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(h=>h.type==="goog-remb");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}}function fO(e,t,n){if(gt()||e.media.mediaType!=="video"||!(t instanceof Ut)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!L("SIMULCAST")||t._scalabiltyMode===void 0||t._scalabiltyMode.numSpatialLayers<=1)return;const r=n==="vp8"?2:t._scalabiltyMode.numSpatialLayers,o=e.attributes.ssrcs[0],a=e.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===o.ssrcId),c={semantic:"SIM",ssrcIds:[o.ssrcId]};for(let l=1;l<r;l++)e.attributes.ssrcs.push({ssrcId:o.ssrcId+l,attributes:Mt(o.attributes)}),c.ssrcIds.push(o.ssrcId+l),a&&(e.attributes.ssrcs.push({ssrcId:a.ssrcIds[1]+l,attributes:Mt(o.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[o.ssrcId+l,a.ssrcIds[1]+l]}));e.attributes.ssrcGroups.unshift(c)}async function mO(e,t,n,r,o){const a=new RTCPeerConnection;a.addTransceiver("video",{direction:"sendonly"}),a.addTransceiver("audio",{direction:"sendonly"}),a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"});const c=(await a.createOffer()).sdp,l=CE(c,e,t,n,r,o,"sendonly"),h=CE(c,e,t,n,r,o,"recvonly"),f={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Lu(l,h,"videoExtensions",f,p,E),Lu(l,h,"videoCodecs",f,p,E),Lu(l,h,"audioExtensions",f,p,E),Lu(l,h,"audioCodecs",f,p,E),L("RAISE_H264_BASELINE_PRIORITY")){const T=E.videoCodecs.findIndex(y=>{var C,A;return((C=y.rtpMap)===null||C===void 0?void 0:C.encodingName.toLocaleLowerCase())==="h264"&&((A=y.fmtp)===null||A===void 0?void 0:A.parameters["profile-level-id"])==="42001f"});if(T!==-1){const y=E.videoCodecs.findIndex(C=>{var A;return((A=C.rtpMap)===null||A===void 0?void 0:A.encodingName.toLocaleLowerCase())==="h264"});if(y<T){v.debug("raising H264 baseline profile priority");const C=E.videoCodecs[T];E.videoCodecs.splice(T,1),E.videoCodecs.splice(y,0,C)}y!==-1&&(p.videoCodecs=p.videoCodecs.filter(C=>{var A,O;return!(((A=C.rtpMap)===null||A===void 0?void 0:A.encodingName.toLocaleLowerCase())==="h264"&&((O=C.fmtp)===null||O===void 0?void 0:O.parameters["profile-level-id"])!=="42001f")})),y!==-1&&L("FILTER_SEND_H264_BASELINE")&&(f.videoCodecs=f.videoCodecs.filter(C=>{var A,O;return!(((A=C.rtpMap)===null||A===void 0?void 0:A.encodingName.toLocaleLowerCase())==="h264"&&((O=C.fmtp)===null||O===void 0?void 0:O.parameters["profile-level-id"])!=="42001f")}))}}try{a.close()}catch{}return{send:f,recv:p,sendrecv:E}}function Lu(e,t,n,r,o,a){if(n==="videoExtensions"||n==="audioExtensions"){const c=[];return e[n].forEach(l=>{t[n].some((h,f)=>{if(l.entry===h.entry&&l.extensionName===h.extensionName)return c.push(f),!0})?a[n].push(l):r[n].push(l)}),void t[n].forEach((l,h)=>{c.indexOf(h)===-1&&o[n].push(l)})}if(n==="videoCodecs"||n==="audioCodecs"){const c=[];return e[n].forEach(l=>{t[n].some((h,f)=>{if(l.payloadType===h.payloadType&&JSON.stringify(l)===JSON.stringify(h))return c.push(f),!0})?a[n].push(l):r[n].push(l)}),void t[n].forEach((l,h)=>{c.indexOf(h)===-1&&o[n].push(l)})}}function wE(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let o,a;return t?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...t.audioCodecs,...r.audioCodecs],o.videoCodecs=[...t.videoCodecs,...r.videoCodecs],o.audioExtensions=[...t.audioExtensions,...r.audioExtensions],o.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):o=r,n?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...n.audioCodecs,...r.audioCodecs],a.videoCodecs=[...n.videoCodecs,...r.videoCodecs],a.audioExtensions=[...n.audioExtensions,...r.audioExtensions],a.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):a=r,{send:o,recv:a}}function Ho(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function EO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function _O(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?EO(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):EO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}(function(e,t){e.exports=(()=>{var n={8:(a,c,l)=>{l.r(c),l.d(c,{Parser:()=>st,Printer:()=>Qn,parse:()=>ge,print:()=>Ve});const h=`
`,f="".concat("\r").concat(h),p=" ";let E;function T($){return $>="0"&&$<="9"}function y($){return $>="!"&&$<="~"}function C($){return y($)||$>=""&&$<=""}function A($){return $==="!"||$>="#"&&$<="'"||$>="*"&&$<="+"||$>="-"&&$<="."||$>="0"&&$<="9"||$>="A"&&$<="Z"||$>="^"&&$<="~"}function O($){return $>="1"&&$<="9"}function M($){return $>="A"&&$<="Z"||$>="a"&&$<="z"}function U($){return $==="d"||$==="h"||$==="m"||$==="s"}function q($){return $>""&&$<"	"||$>"\v"&&$<"\f"||$>""&&$<""}function ae($){return M($)||T($)||$==="+"||$==="/"}function X($){return T($)||M($)||$==="+"||$==="/"||$==="-"||$==="_"}function Q($){return M($)||T($)||$==="+"||$==="/"}function Y($,S){var w=Object.keys($);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols($);S&&(D=D.filter(function(W){return Object.getOwnPropertyDescriptor($,W).enumerable})),w.push.apply(w,D)}return w}function Z($){for(var S=1;S<arguments.length;S++){var w=arguments[S]!=null?arguments[S]:{};S%2?Y(Object(w),!0).forEach(function(D){Ge($,D,w[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(w)):Y(Object(w)).forEach(function(D){Object.defineProperty($,D,Object.getOwnPropertyDescriptor(w,D))})}return $}function Ge($,S,w){return S in $?Object.defineProperty($,S,{value:w,enumerable:!0,configurable:!0,writable:!0}):$[S]=w,$}(function($){$.VERSION="v",$.ORIGIN="o",$.SESSION_NAME="s",$.INFORMATION="i",$.URI="u",$.EMAIL="e",$.PHONE="p",$.CONNECTION="c",$.BANDWIDTH="b",$.TIME="t",$.REPEAT="r",$.ZONE_ADJUSTMENTS="z",$.KEY="k",$.ATTRIBUTE="a",$.MEDIA="m"})(E||(E={}));class pe{consumeText(S,w){let D=w;for(;D<S.length;){const W=S[D];if(W==="\0"||W==="\r"||W===h)break;D+=1}if(D-w==0)throw new Error("Invalid text, at ".concat(S));return D}consumeUnicastAddress(S,w,D){return this.consumeTill(S,w,p)}consumeOneOrMore(S,w,D){let W=w;for(;D(S[W]);)W++;if(W-w==0)throw new Error("Invalid rule at ".concat(w,"."));return W}consumeSpace(S,w){if(S[w]===p)return w+1;throw new Error("Invalid space at ".concat(w,"."))}consumeIP4Address(S,w){let D=w;for(let W=0;W<4;W++)if(D=this.consumeDecimalUChar(S,D),W!==3){if(S[D]!==".")throw new Error("Invalid IP4 address.");D++}return D}consumeDecimalUChar(S,w){let D=w;for(let Re=0;Re<3&&T(S[D]);Re++,D++);if(D-w==0)throw new Error("Invalid decimal uchar.");const W=parseInt(S.slice(w,D));if(W>=0&&W<=255)return D;throw new Error("Invalid decimal uchar")}consumeIP6Address(S,w){let D=this.consumeHexpart(S,w);return S[D]===":"&&(D+=1,D=this.consumeIP4Address(S,D)),D}consumeHexpart(S,w){let D=w;if(S[D]===":"&&S[D+1]===":"){D+=2;try{D=this.consumeHexseq(S,D)}catch{}return D}if(D=this.consumeHexseq(S,D),S[D]===":"&&S[D+1]===":"){D+=2;try{D=this.consumeHexseq(S,D)}catch{}return D}return D}consumeHexseq(S,w){let D=w;for(;D=this.consumeHex4(S,D),S[D]===":"&&S[D+1]!==":";)D+=1;return D}consumeHex4(S,w){let D=0;for(;D<4;D++)if(!((W=S[w+D])>="0"&&W<="9"||W>="a"&&W<="f"||W>="A"&&W<="F")){if(D===0)throw new Error("Invalid hex 4");break}var W;return w+D}consumeFQDN(S,w){let D=w;for(;T(S[D])||M(S[D])||S[D]==="-"||S[D]===".";)D+=1;if(D-w<4)throw new Error("Invalid FQDN");return D}consumeExtnAddr(S,w){return this.consumeOneOrMore(S,w,C)}consumeMulticastAddress(S,w,D){switch(D){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(S,w);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(S,w);default:try{return this.consumeFQDN(S,w)}catch{return this.consumeExtnAddr(S,w)}}}consumeIP6MulticastAddress(S,w){const D=this.consumeHexpart(S,w);return S[D]==="/"?this.consumeInteger(S,D+1):D}consumeIP4MulticastAddress(S,w){let D=w+3;const W=S.slice(w,D),Re=parseInt(W);if(Re<224||Re>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let at=0;at<3;at++){if(S[D]!==".")throw new Error("Invalid IP4 multicast address.");D+=1,D=this.consumeDecimalUChar(S,D)}return S[D]==="/"&&(D+=1),D=this.consumeTTL(S,D),S[D]==="/"&&(D=this.consumeInteger(S,D)),D}consumeInteger(S,w){if(!O(S[w]))throw new Error("Invalid integer.");for(w+=1;T(S[w]);)w+=1;return w}consumeTTL(S,w){if(S[w]==="0")return w+1;if(!O(S[w]))throw new Error("Invalid TTL.");w+=1;for(let D=0;D<2&&T(S[w]);D++)w+=1;return w}consumeToken(S,w){return this.consumeOneOrMore(S,w,A)}consumeTime(S,w){let D=w;if(S[D]==="0")return D+1;for(O(S[D])&&(D+=1);T(S[D]);)D++;if(D-w<10)throw new Error("Invalid time");return D}consumeAddress(S,w){return this.consumeTill(S,w,p)}consumeTypedTime(S,w){let D=w;return D=this.consumeOneOrMore(S,D,T),U(S[D])?D+1:D}consumeRepeatInterval(S,w){if(!O(S[w]))throw new Error("Invalid repeat interval");for(w+=1;T(S[w]);)w+=1;return U(S[w])&&(w+=1),w}consumePort(S,w){return this.consumeOneOrMore(S,w,T)}consume(S,w,D){for(let W=0;W<D.length;W++){if(w+W>=S.length)throw new Error("consume exceeding value length");if(S[w+W]!==D[W])throw new Error("consume ".concat(D," failed at ").concat(W))}return w+D.length}consumeTill(S,w,D){let W=w;for(;W<S.length&&(typeof D!="string"||S[W]!==D)&&(typeof D!="function"||!D(S[W]));)W++;return W}}class st extends pe{constructor(){super(),Ge(this,"records",[]),Ge(this,"currentLine",0)}parse(S){const w=this.probeEOL(S);this.records=S.split(w).filter(Gn=>!!Gn.trim()).map(this.parseLine),this.currentLine=0;const D=this.parseVersion(),W=this.parseOrigin(),Re=this.parseSessionName(),at=this.parseInformation(),dn=this.parseUri(),si=this.parseEmail(),Xo=this.parsePhone(),Wr=this.parseConnection(),Qo=this.parseBandWidth(),Za=this.parseTimeFields(),Rt=this.parseKey(),Vt=this.parseSessionAttribute(),rt=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:D,origin:W,sessionName:Re,information:at,uri:dn,emails:si,phones:Xo,connection:Wr,bandwidths:Qo,timeFields:Za,key:Rt,attributes:Vt,mediaDescriptions:rt}}getCurrentRecord(){const S=this.records[this.currentLine];if(!S)throw new Error("Record doesn't exit.");return S}probeEOL(S){for(let w=0;w<S.length;w++)if(S[w]===h)return S[w-1]==="\r"?f:h;throw new Error("Invalid newline character.")}parseLine(S,w){if(S.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const D=S[0];if(S[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:D,value:S.slice(2),line:w,cur:0}}parseSessionAttribute(){const S=new Nt;for(;this.currentLine<this.records.length;){const w=this.getCurrentRecord();if(w.type!==E.ATTRIBUTE)break;const D={attField:this.extractOneOrMore(w,W=>A(W)&&W!==":"),_cur:0};w.value[w.cur]===":"&&(w.cur+=1,D.attValue=this.extractOneOrMore(w,q)),S.parse(D),this.currentLine++}return S.digest()}parseMediaAttributes(S){const w=new cn(S);for(;this.currentLine<this.records.length;){const D=this.getCurrentRecord();if(D.type!==E.ATTRIBUTE)break;const W={attField:this.extractOneOrMore(D,Re=>A(Re)&&Re!==":"),_cur:0};D.value[D.cur]===":"&&(D.cur+=1,W.attValue=this.extractOneOrMore(D,q)),w.parse(W),this.currentLine++}return w.digest()}parseKey(){const S=this.getCurrentRecord();if(S.type===E.KEY){if(S.value==="prompt"||S.value==="clear:"||S.value==="base64:"||S.value==="uri:")return S.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const S=this.getCurrentRecord();if(S.type===E.ZONE_ADJUSTMENTS){const w=[];for(;;)try{const D=this.extract(S,this.consumeTime);this.consumeSpaceForRecord(S);let W=!1;S.value[S.cur]==="-"&&(W=!0,S.cur+=1);const Re=this.extract(S,this.consumeTypedTime);w.push({time:D,typedTime:Re,back:W})}catch{break}if(w.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,w}return[]}parseRepeat(){const S=[];for(;;){const w=this.getCurrentRecord();if(w.type!==E.REPEAT)break;{const D=this.extract(w,this.consumeRepeatInterval),W=this.parseTypedTime(w);S.push({repeatInterval:D,typedTimes:W}),this.currentLine++}}return S}parseTypedTime(S){const w=[];for(;;)try{this.consumeSpaceForRecord(S),w.push(this.extract(S,this.consumeTypedTime))}catch{break}if(w.length===0)throw new Error("Invalid typed time.");return w}parseTime(){const S=this.getCurrentRecord(),w=this.extract(S,this.consumeTime);this.consumeSpaceForRecord(S);const D=this.extract(S,this.consumeTime);return this.currentLine++,{startTime:w,stopTime:D}}parseBandWidth(){const S=[];for(;this.currentLine<this.records.length;){const w=this.getCurrentRecord();if(w.type!==E.BANDWIDTH)break;{const D=this.extractOneOrMore(w,A);if(w.value[w.cur]!==":")throw new Error("Invalid bandwidth field.");w.cur++;const W=this.extractOneOrMore(w,T);S.push({bwtype:D,bandwidth:W}),this.currentLine++}}return S}parseVersion(){const S=this.getCurrentRecord();if(S.type!==E.VERSION)throw new Error("first sdp record must be version");const w=S.value.slice(0,this.consumeOneOrMore(S.value,0,T));if(w.length!==S.value.length)throw new Error('invalid proto version, "v='.concat(S.value,'"'));return this.currentLine++,w}parseOrigin(){const S=this.getCurrentRecord();if(S.type!==E.ORIGIN)throw new Error("second line of sdp must be origin");const w=this.extractOneOrMore(S,C);this.consumeSpaceForRecord(S);const D=this.extractOneOrMore(S,T);this.consumeSpaceForRecord(S);const W=this.extractOneOrMore(S,T);this.consumeSpaceForRecord(S);const Re=this.extractOneOrMore(S,A);this.consumeSpaceForRecord(S);const at=this.extractOneOrMore(S,A);this.consumeSpaceForRecord(S);const dn=this.extract(S,this.consumeUnicastAddress);return this.currentLine++,{username:w,sessId:D,sessVersion:W,nettype:Re,addrtype:at,unicastAddress:dn}}parseSessionName(){const S=this.getCurrentRecord();if(S.type===E.SESSION_NAME){const w=this.extract(S,this.consumeText);return this.currentLine++,w}}parseInformation(){const S=this.getCurrentRecord();if(S.type!==E.INFORMATION)return;const w=this.extract(S,this.consumeText);return this.currentLine++,w}parseUri(){const S=this.getCurrentRecord();if(S.type===E.URI)return this.currentLine++,S.value}parseEmail(){const S=[];for(;;){const w=this.getCurrentRecord();if(w.type!==E.EMAIL)break;S.push(w.value),this.currentLine++}return S}parsePhone(){const S=[];for(;;){const w=this.getCurrentRecord();if(w.type!==E.PHONE)break;S.push(w.value),this.currentLine++}return S}parseConnection(){const S=this.getCurrentRecord();if(S.type===E.CONNECTION){const w=this.extractOneOrMore(S,A);this.consumeSpaceForRecord(S);const D=this.extractOneOrMore(S,A);this.consumeSpaceForRecord(S);const W=this.extract(S,this.consumeAddress);return this.currentLine++,{nettype:w,addrtype:D,address:W}}}parseMedia(){const S=this.getCurrentRecord(),w=this.extract(S,this.consumeToken);this.consumeSpaceForRecord(S);let D=this.extract(S,this.consumePort);S.value[S.cur]==="/"&&(S.cur+=1,D+=this.extract(S,this.consumeInteger)),this.consumeSpaceForRecord(S);const W=[];for(W.push(this.extract(S,this.consumeToken));S.value[S.cur]==="/";)S.cur+=1,W.push(this.extract(S,this.consumeToken));if(W.length===0)throw new Error("Invalid proto");const Re=this.parseFmt(S);return this.currentLine++,{mediaType:w,port:D,protos:W,fmts:Re}}parseTimeFields(){const S=[];for(;this.getCurrentRecord().type===E.TIME;){const w=this.parseTime(),D=this.parseRepeat(),W=this.parseZone();S.push({time:w,repeats:D,zones:W})}return S}parseMediaDescription(){const S=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.MEDIA;){const w=this.parseMedia(),D=this.parseInformation(),W=this.parseConnections(),Re=this.parseBandWidth(),at=this.parseKey(),dn=this.parseMediaAttributes(w);S.push({media:w,information:D,connections:W,bandwidths:Re,key:at,attributes:dn})}return S}parseConnections(){const S=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.CONNECTION;)S.push(this.parseConnection());return S}parseFmt(S){const w=[];for(;;)try{this.consumeSpaceForRecord(S),w.push(this.extract(S,this.consumeToken))}catch{break}if(w.length===0)throw new Error("Invalid fmts");return w}extract(S,w,...D){const W=w.call(this,S.value,S.cur,...D),Re=S.value.slice(S.cur,W);return S.cur=W,Re}extractOneOrMore(S,w){const D=this.consumeOneOrMore(S.value,S.cur,w),W=S.value.slice(S.cur,D);return S.cur=D,W}consumeSpaceForRecord(S){if(S.value[S.cur]!==p)throw new Error("Invalid space at ".concat(S.cur,"."));S.cur+=1}}class $e extends pe{constructor(...S){super(...S),Ge(this,"attributes",void 0),Ge(this,"digested",!1)}extractOneOrMore(S,w,D){const W=this.consumeOneOrMore(S.attValue,S._cur,w),Re=S.attValue.slice(S._cur,W),[at,dn]=D||[];if(typeof at=="number"&&Re.length<at)throw new Error("error in length, should be more or equal than ".concat(at," characters."));if(typeof dn=="number"&&Re.length>dn)throw new Error("error in length, should be less or equal than ".concat(dn," characters."));return S._cur=W,Re}consumeAttributeSpace(S){if(S.attValue[S._cur]!==p)throw new Error("Invalid space at ".concat(S._cur,"."));S._cur+=1}extract(S,w,...D){if(!S.attValue)throw new Error("Nothing to extract from attValue.");const W=w.call(this,S.attValue,S._cur,...D),Re=S.attValue.slice(S._cur,W);return S._cur=W,Re}atEnd(S){if(!S.attValue)throw new Error;return S._cur>=S.attValue.length}peekChar(S){if(!S.attValue)throw new Error;return S.attValue[S._cur]}peek(S,w){if(!S.attValue)throw new Error;for(let D=0;D<w.length;D++)if(w[D]!==S.attValue[S._cur+D])return!1;return!0}parseIceUfrag(S){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(S,ae,[4,256])}parseIcePwd(S){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(S,ae,[22,256])}parseIceOptions(S){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const w=[];for(;!this.atEnd(S);){w.push(this.extractOneOrMore(S,ae));try{this.consumeAttributeSpace(S)}catch(D){if(this.atEnd(S))break;throw D}}this.attributes.iceOptions=w}parseFingerprint(S){const w=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S);const D=this.extract(S,this.consumeTill);this.attributes.fingerprints.push({hashFunction:w,fingerprint:D})}parseExtmap(S){const w=this.extractOneOrMore(S,T);let D;this.peekChar(S)==="/"&&(this.extract(S,this.consume,"/"),D=this.extract(S,this.consumeToken)),this.consumeAttributeSpace(S);const W=this.extract(S,this.consumeTill,p),Re=Z(Z({entry:parseInt(w,10)},D&&{direction:D}),{},{extensionName:W});this.peekChar(S)===p&&(this.consumeAttributeSpace(S),Re.extensionAttributes=this.extract(S,this.consumeTill)),this.attributes.extmaps.push(Re)}parseSetup(S){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const w=this.extract(S,this.consumeTill);if(w!=="active"&&w!=="passive"&&w!=="actpass"&&w!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=w}}class Nt extends $e{constructor(...S){super(...S),Ge(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(S){if(this.digested)throw new Error("already digested");try{switch(S.attField){case"group":this.parseGroup(S);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(S);break;case"ice-pwd":this.parseIcePwd(S);break;case"ice-options":this.parseIceOptions(S);break;case"fingerprint":this.parseFingerprint(S);break;case"setup":this.parseSetup(S);break;case"tls-id":this.parseTlsId(S);break;case"identity":this.parseIdentity(S);break;case"extmap":this.parseExtmap(S);break;case"msid-semantic":this.parseMsidSemantic(S);break;default:S.ignored=!0,this.attributes.unrecognized.push(S)}}catch(w){throw console.error("parsing session attribute ".concat(S.attField,' error, "a=').concat(S.attField,":").concat(S.attValue,'"')),w}if(!S.ignored&&S.attValue&&!this.atEnd(S))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(S){const w=this.extract(S,this.consumeToken),D=[];for(;!this.atEnd(S)&&this.peekChar(S)===p;)this.consumeAttributeSpace(S),D.push(this.extract(S,this.consumeToken));this.attributes.groups.push({semantic:w,identificationTag:D})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(S){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(S,X)}parseIdentity(S){const w=this.extractOneOrMore(S,Q),D=[];for(;!this.atEnd(S)&&this.peekChar(S)===p;){this.consumeAttributeSpace(S);const W=this.extract(S,this.consumeToken);this.extract(S,this.consume,"=");const Re=this.extractOneOrMore(S,at=>at!==p&&q(at));D.push({name:W,value:Re})}this.attributes.identities.push({assertionValue:w,extensions:D})}parseMsidSemantic(S){this.peekChar(S)===p&&this.consumeAttributeSpace(S);const w={semantic:this.extract(S,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(S)}catch{break}if(this.peekChar(S)==="*"){this.extract(S,this.consume,"*"),w.applyForAll=!0;break}{const D=this.extract(S,this.consumeTill,p);w.identifierList.push(D)}}this.attributes.msidSemantic=w}}class cn extends $e{constructor(S){super(),Ge(this,"attributes",void 0),S.protos.indexOf("RTP")!==-1||S.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(S){if(this.digested)throw new Error("already digested");try{switch(S.attField){case"extmap":this.parseExtmap(S);break;case"setup":this.parseSetup(S);break;case"ice-ufrag":this.parseIceUfrag(S);break;case"ice-pwd":this.parseIcePwd(S);break;case"ice-options":this.parseIceOptions(S);break;case"candidate":this.parseCandidate(S);break;case"remote-candidate":this.parseRemoteCandidate(S);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(S);break;case"rtpmap":this.parseRtpmap(S);break;case"ptime":this.parsePtime(S);break;case"maxptime":this.parseMaxPtime(S);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(S);break;case"ssrc":this.parseSSRC(S);break;case"fmtp":this.parseFmtp(S);break;case"rtcp-fb":this.parseRtcpFb(S);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(S);break;case"mid":this.parseMid(S);break;case"msid":this.parseMsid(S);break;case"imageattr":this.parseImageAttr(S);break;case"rid":this.parseRid(S);break;case"simulcast":this.parseSimulcast(S);break;case"sctp-port":this.parseSctpPort(S);break;case"max-message-size":this.parseMaxMessageSize(S);break;case"ssrc-group":this.parseSSRCGroup(S);break;default:S.ignored=!0,this.attributes.unrecognized.push(S)}}catch(w){throw console.error("parsing media attribute ".concat(S.attField,' error, "a=').concat(S.attField,":").concat(S.attValue,'"')),w}if(!S.ignored&&S.attValue&&!this.atEnd(S))throw new Error("attribute parsing error")}parseCandidate(S){const w=this.extractOneOrMore(S,ae,[1,32]);this.consumeAttributeSpace(S);const D=this.extractOneOrMore(S,T,[1,5]);this.consumeAttributeSpace(S);const W=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S);const Re=this.extractOneOrMore(S,T,[1,10]);this.consumeAttributeSpace(S);const at=this.extract(S,this.consumeAddress);this.consumeAttributeSpace(S);const dn=this.extract(S,this.consumePort);this.consumeAttributeSpace(S),this.extract(S,this.consume,"typ"),this.consumeAttributeSpace(S);const si={foundation:w,componentId:D,transport:W,priority:Re,connectionAddress:at,port:dn,type:this.extract(S,this.consumeToken),extension:{}};for(this.peek(S," raddr")&&(this.extract(S,this.consume," raddr"),this.consumeAttributeSpace(S),si.relAddr=this.extract(S,this.consumeAddress)),this.peek(S," rport")&&(this.extract(S,this.consume," rport"),this.consumeAttributeSpace(S),si.relPort=this.extract(S,this.consumePort));this.peekChar(S)===p;){this.consumeAttributeSpace(S);const Xo=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S),si.extension[Xo]=this.extractOneOrMore(S,y)}this.attributes.candidates.push(si)}parseRemoteCandidate(S){const w=[];for(;;){const D=this.extractOneOrMore(S,T,[1,5]);this.consumeAttributeSpace(S);const W=this.extract(S,this.consumeAddress);this.consumeAttributeSpace(S);const Re=this.extract(S,this.consumePort);w.push({componentId:D,connectionAddress:W,port:Re});try{this.consumeAttributeSpace(S)}catch{break}}this.attributes.remoteCandidatesList.push(w)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(S){const w=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S);const D=this.extract(S,this.consumeTill,"/");this.extract(S,this.consume,"/");const W={encodingName:D,clockRate:this.extractOneOrMore(S,T)};this.atEnd(S)||this.peekChar(S)!=="/"||(this.extract(S,this.consume,"/"),W.encodingParameters=parseInt(this.extract(S,this.consumeTill),10));const Re=this.attributes.payloads.find(at=>at.payloadType===parseInt(w,10));Re?Re.rtpMap=W:this.attributes.payloads.push({payloadType:parseInt(w,10),rtpMap:W,rtcpFeedbacks:[]})}parsePtime(S){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(S,this.consumeTill)}parseMaxPtime(S){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(S,this.consumeTill)}parseDirection(S){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=S.attField}parseSSRC(S){const w=this.extractOneOrMore(S,T);this.consumeAttributeSpace(S);const D=this.extract(S,this.consumeTill,":");let W;this.peekChar(S)===":"&&(this.extract(S,this.consume,":"),W=this.extract(S,this.consumeTill));const Re=this.attributes.ssrcs.find(at=>at.ssrcId===parseInt(w,10));Re?Re.attributes[D]=W:this.attributes.ssrcs.push({ssrcId:parseInt(w,10),attributes:{[D]:W}})}parseFmtp(S){const w=this.extract(S,this.consumeTill,p);this.consumeAttributeSpace(S);const D=this.extract(S,this.consumeTill),W={};D.split(";").forEach(at=>{let[dn,si]=at.split("=");dn=dn.trim();const Xo=typeof si=="string"?si.trim():null;typeof dn=="string"&&dn.length>0&&(W[dn]=Xo)});const Re=this.attributes.payloads.find(at=>at.payloadType===parseInt(w,10));Re?Re.fmtp={parameters:W}:this.attributes.payloads.push({payloadType:parseInt(w,10),rtcpFeedbacks:[],fmtp:{parameters:W}})}parseFmtParameters(S){const w={},D=this.extract(S,this.consumeTill,"=");S._cur++;const W=this.extract(S,this.consumeTill,";");for(w[D]=W;S.attValue[S._cur]===";";){const Re=this.extract(S,this.consumeTill,"=");S._cur++;const at=this.extract(S,this.consumeTill,";");w[Re]=at}return w}parseRtcpFb(S){let w="";w=this.peekChar(S)==="*"?this.extract(S,this.consume,"*"):this.extract(S,this.consumeTill,p),this.consumeAttributeSpace(S);const D=this.extract(S,this.consumeTill,p);let W;switch(D){case"trr-int":W={type:D,interval:this.extract(S,this.consumeTill)};break;case"ack":case"nack":default:{const Re={type:D};this.peekChar(S)===p&&(this.consumeAttributeSpace(S),Re.parameter=this.extract(S,this.consumeToken),this.peekChar(S)===p&&(Re.additional=this.extract(S,this.consumeTill))),W=Re}}if(w==="*")this.attributes.rtcpFeedbackWildcards.push(W);else{const Re=this.attributes.payloads.find(at=>at.payloadType===parseInt(w,10));Re?Re.rtcpFeedbacks.push(W):this.attributes.payloads.push({payloadType:parseInt(w,10),rtcpFeedbacks:[W]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(S){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const w={port:this.extract(S,this.consumePort)};this.peekChar(S)===p&&(this.consumeAttributeSpace(S),w.netType=this.extractOneOrMore(S,A),this.consumeAttributeSpace(S),w.addressType=this.extractOneOrMore(S,A),this.consumeAttributeSpace(S),w.address=this.extract(S,this.consumeAddress)),this.attributes.rtcp=w}parseMsid(S){const w={id:this.extractOneOrMore(S,A,[1,64])};this.peekChar(S)===p&&(this.consumeAttributeSpace(S),w.appdata=this.extractOneOrMore(S,A,[1,64])),this.attributes.msids.push(w)}parseImageAttr(S){this.attributes.imageattr.push(S.attValue)}parseRid(S){const w=this.extractOneOrMore(S,W=>M(W)||T(W)||W==="_"||W==="-");this.consumeAttributeSpace(S);const D={id:w,direction:this.extract(S,this.consumeToken),params:[]};if(this.peekChar(S)===p){if(this.consumeAttributeSpace(S),this.peek(S,"pt=")){this.extract(S,this.consume,"pt=");const W=[];for(;;){const Re=this.extract(S,this.consumeToken);W.push(Re);try{this.extract(S,this.consume,",")}catch{break}}D.payloads=W,this.peekChar(S)===p&&this.extract(S,this.consume,p)}for(;;){const W=this.extract(S,this.consumeToken);switch(W){case"depend":{const Re={type:W,rids:this.extract(S,this.consume,"=").split(",")};D.params.push(Re);break}case"max-width":case"height-width":case"max-fps":case"max-fs":case"max-br":case"max-pps":case"max-bpp":default:{const Re={type:W};this.peekChar(S)==="="&&(this.extract(S,this.consume,"="),Re.val=this.extract(S,this.consumeTill,";")),D.params.push(Re)}}try{this.extract(S,this.consume,";")}catch{break}}}this.attributes.rids.push(D)}parseSimulcast(S){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=S.attValue,this.extract(S,this.consumeTill)}parseSctpPort(S){this.attributes.sctpPort=this.extractOneOrMore(S,T,[1,5])}parseMaxMessageSize(S){this.attributes.maxMessageSize=this.extractOneOrMore(S,T,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(S){this.attributes.mid=this.extract(S,this.consumeToken)}parseSSRCGroup(S){const w=this.extract(S,this.consumeToken),D=[];for(;;)try{this.consumeAttributeSpace(S);const W=this.extract(S,this.consumeInteger);D.push(parseInt(W,10))}catch{break}this.attributes.ssrcGroups.push({semantic:w,ssrcIds:D})}}function Ct($,S,w){return S in $?Object.defineProperty($,S,{value:w,enumerable:!0,configurable:!0,writable:!0}):$[S]=w,$}class Qn{constructor(){Ct(this,"eol",f)}print(S,w){let D="";return w&&(this.eol=w),D+=this.printVersion(S.version),D+=this.printOrigin(S.origin),D+=this.printSessionName(S.sessionName),D+=this.printInformation(S.information),D+=this.printUri(S.uri),D+=this.printEmail(S.emails),D+=this.printPhone(S.phones),D+=this.printConnection(S.connection),D+=this.printBandwidth(S.bandwidths),D+=this.printTimeFields(S.timeFields),D+=this.printKey(S.key),D+=this.printSessionAttributes(S.attributes),D+=this.printMediaDescription(S.mediaDescriptions),D}printVersion(S){return"v=".concat(S).concat(this.eol)}printOrigin(S){return"o=".concat(S.username," ").concat(S.sessId," ").concat(S.sessVersion," ").concat(S.nettype," ").concat(S.addrtype," ").concat(S.unicastAddress).concat(this.eol)}printSessionName(S){return S?"s=".concat(S).concat(this.eol):""}printInformation(S){return S?"i=".concat(S).concat(this.eol):""}printUri(S){return S?"u=".concat(S).concat(this.eol):""}printEmail(S){let w="";for(const D of S)w+="e=".concat(D).concat(this.eol);return w}printPhone(S){let w="";for(const D of S)w+="e=".concat(D).concat(this.eol);return w}printConnection(S){return S?"c=".concat(S.nettype," ").concat(S.addrtype," ").concat(S.address).concat(this.eol):""}printBandwidth(S){let w="";for(const D of S)w+="b=".concat(D.bwtype,":").concat(D.bandwidth).concat(this.eol);return w}printTimeFields(S){let w="";for(const D of S){w+="t=".concat(D.time.startTime," ").concat(D.time.startTime).concat(this.eol);for(const W of D.repeats)w+="r=".concat(W.repeatInterval," ").concat(W.typedTimes.join(" ")).concat(this.eol);D.zoneAdjustments&&(w+="z=",w+="z=".concat(D.zoneAdjustments.map(W=>"".concat(W.time," ").concat(W.back?"-":""," ").concat(W.typedTime)).join(" ")).concat(this.eol),w+=this.eol)}return w}printKey(S){return S?"k=".concat(S).concat(this.eol):""}printAttributes(S){let w="";for(const D of S)w+="a=".concat(D.attField).concat(D.attValue?":".concat(D.attValue):"").concat(this.eol);return w}printMediaDescription(S){let w="";for(const D of S)w+=this.printMedia(D.media),w+=this.printInformation(D.information),w+=this.printConnections(D.connections),w+=this.printBandwidth(D.bandwidths),w+=this.printKey(D.key),w+=this.printMediaAttributes(D);return w}printConnections(S){let w="";for(const D of S)w+=this.printConnection(D);return w}printMedia(S){return"m=".concat(S.mediaType," ").concat(S.port," ").concat(S.protos.join("/")," ").concat(S.fmts.join(" ")).concat(this.eol)}printSessionAttributes(S){return new J(this.eol).print(S)}printMediaAttributes(S){return new re(this.eol).print(S)}}class F{constructor(S){Ct(this,"eol",void 0),this.eol=S}printIceUfrag(S){return S===void 0?"":"a=ice-ufrag:".concat(S).concat(this.eol)}printIcePwd(S){return S===void 0?"":"a=ice-pwd:".concat(S).concat(this.eol)}printIceOptions(S){return S===void 0?"":"a=ice-options:".concat(S.join(p)).concat(this.eol)}printFingerprints(S){return S.length>0?S.map(w=>"a=fingerprint:".concat(w.hashFunction).concat(p).concat(w.fingerprint)).join(this.eol)+this.eol:""}printExtmap(S){return S.map(w=>"a=extmap:".concat(w.entry).concat(w.direction?"/".concat(w.direction):"").concat(p).concat(w.extensionName).concat(w.extensionAttributes?"".concat(p).concat(w.extensionAttributes):"").concat(this.eol)).join("")}printSetup(S){return S===void 0?"":"a=setup:".concat(S).concat(this.eol)}printUnrecognized(S){return S.map(w=>"a=".concat(w.attField).concat(w.attValue?":".concat(w.attValue):"").concat(this.eol)).join("")}}class J extends F{print(S){let w="";return w+=this.printGroups(S.groups),w+=this.printMsidSemantic(S.msidSemantic),w+=this.printIceLite(S.iceLite),w+=this.printIceUfrag(S.iceUfrag),w+=this.printIcePwd(S.icePwd),w+=this.printIceOptions(S.iceOptions),w+=this.printFingerprints(S.fingerprints),w+=this.printSetup(S.setup),w+=this.printTlsId(S.tlsId),w+=this.printIdentity(S.identities),w+=this.printExtmap(S.extmaps),w+=this.printUnrecognized(S.unrecognized),w}printGroups(S){let w="";return S.length>0&&(w+=S.map(D=>"a=group:".concat(D.semantic).concat(D.identificationTag.map(W=>"".concat(p).concat(W)).join("")).concat(this.eol)).join("")),w}printIceLite(S){return S===void 0?"":"a=ice-lite"+this.eol}printTlsId(S){return S?"a=tls-id:".concat(S).concat(this.eol):""}printIdentity(S){return S.length===0?"":S.map(w=>"a=identity:".concat(w.assertionValue).concat(w.extensions.map(D=>"".concat(p).concat(D.name).concat(D.value?"=".concat(D.value):"")))).join(this.eol)+this.eol}printMsidSemantic(S){if(!S)return"";let w="a=msid-semantic:".concat(S.semantic);return S.applyForAll?w+="".concat(p,"*"):S.identifierList.length>0&&(w+=S.identifierList.map(D=>"".concat(p).concat(D))),w+this.eol}}class re extends F{print(S){const w=S.attributes;let D="";return D+=this.printRTCP(w.rtcp),D+=this.printIceUfrag(w.iceUfrag),D+=this.printIcePwd(w.icePwd),D+=this.printIceOptions(w.iceOptions),D+=this.printCandidates(w.candidates),D+=this.printRemoteCandidatesList(w.remoteCandidatesList),D+=this.printEndOfCandidates(w.endOfCandidates),D+=this.printFingerprints(w.fingerprints),D+=this.printSetup(w.setup),D+=this.printMid(w.mid),D+=this.printExtmap(w.extmaps),D+=this.printRTPRelated(w),D+=this.printPtime(w.ptime),D+=this.printMaxPtime(w.maxPtime),D+=this.printDirection(w.direction),D+=this.printSSRCGroups(w.ssrcGroups),D+=this.printSSRC(w.ssrcs),D+=this.printRTCPMux(w.rtcpMux),D+=this.printRTCPMuxOnly(w.rtcpMuxOnly),D+=this.printRTCPRsize(w.rtcpRsize),D+=this.printMSId(w.msids),D+=this.printImageattr(w.imageattr),D+=this.printRid(w.rids),D+=this.printSimulcast(w.simulcast),D+=this.printSCTPPort(w.sctpPort),D+=this.printMaxMessageSize(w.maxMessageSize),D+=this.printUnrecognized(w.unrecognized),D}printCandidates(S){return S.map(w=>"a=candidate:".concat(w.foundation).concat(p).concat(w.componentId).concat(p).concat(w.transport).concat(p).concat(w.priority).concat(p).concat(w.connectionAddress).concat(p).concat(w.port).concat(p,"typ").concat(p).concat(w.type).concat(w.relAddr?"".concat(p,"raddr").concat(p).concat(w.relAddr):"").concat(w.relPort?"".concat(p,"rport").concat(p).concat(w.relPort):"").concat(Object.keys(w.extension).map(D=>"".concat(p).concat(D).concat(p).concat(w.extension[D])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(S){return S.map(w=>"a=remote-candidates:".concat(w.join(p)).concat(this.eol)).join("")}printEndOfCandidates(S){return S===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(S){if(!S.payloads)return"";const w=S.payloads;let D="";D+=S.rtcpFeedbackWildcards.map(W=>this.printRTCPFeedback("*",W)).join("");for(const W of w)D+=this.printRtpMap(W.payloadType,W.rtpMap),D+=this.printFmtp(W.payloadType,W.fmtp),D+=W.rtcpFeedbacks.map(Re=>this.printRTCPFeedback(W.payloadType,Re)).join("");return D}printFmtp(S,w){if(!w)return"";const D=Object.keys(w.parameters);return D.length===1&&w.parameters[D[0]]===null?"a=fmtp:".concat(S).concat(p).concat(D[0]).concat(this.eol):"a=fmtp:".concat(S).concat(p).concat(Object.keys(w.parameters).map(W=>"".concat(W,"=").concat(w.parameters[W])).join(";")).concat(this.eol)}printRtpMap(S,w){return w?"a=rtpmap:".concat(S).concat(p).concat(w.encodingName,"/").concat(w.clockRate).concat(w.encodingParameters?"/".concat(w.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(S,w){let D="a=rtcp-fb:".concat(S).concat(p),W=w;switch(W.type){case"trr-int":D+="ttr-int".concat(p).concat(W.interval);break;case"ack":case"nack":default:W=W,D+="".concat(W.type),W.parameter&&(D+="".concat(p).concat(W.parameter),W.additional&&(D+="".concat(p).concat(W.additional)))}return D+this.eol}printPtime(S){return S===void 0?"":"a=ptime:".concat(S).concat(this.eol)}printMaxPtime(S){return S===void 0?"":"a=maxptime:".concat(S).concat(this.eol)}printDirection(S){return S===void 0?"":"a=".concat(S).concat(this.eol)}printSSRC(S){return S.map(w=>Object.keys(w.attributes).map(D=>"a=ssrc:".concat(w.ssrcId.toString(10)).concat(p).concat(D).concat(w.attributes[D]?":".concat(w.attributes[D]):"").concat(this.eol)).join("")).join("")}printRTCPMux(S){return S===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(S){return S===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(S){return S===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(S){if(S===void 0)return"";let w="a=rtcp:".concat(S.port);return S.netType&&(w+="".concat(p).concat(S.netType)),S.addressType&&(w+="".concat(p).concat(S.addressType)),S.address&&(w+="".concat(p).concat(S.address)),w+this.eol}printMSId(S){return S.map(w=>"a=msid:".concat(w.id).concat(w.appdata?"".concat(p).concat(w.appdata):"").concat(this.eol)).join("")}printImageattr(S){return S.map(w=>"a=imageattr:".concat(w).concat(this.eol)).join("")}printRid(S){return S.map(w=>{let D="a=rid:".concat(w.id).concat(p).concat(w.direction);return w.payloads&&(D+="".concat(p,"pt=").concat(w.payloads.join(","))),w.params.length>0&&(D+="".concat(p).concat(w.params.map(W=>W.type==="depend"?"depend=".concat(W.rids.join(",")):"".concat(W.type,"=").concat(W.val)).join(";"))),D+this.eol}).join("")}printSimulcast(S){return S===void 0?"":"a=simulcast:".concat(S).concat(this.eol)}printSCTPPort(S){return S===void 0?"":"a=sctp-port:".concat(S).concat(this.eol)}printMaxMessageSize(S){return S===void 0?"":"a=max-message-size:".concat(S).concat(this.eol)}printMid(S){return S===void 0?"":"a=mid:".concat(S).concat(this.eol)}printSSRCGroups(S){return S.map(w=>"a=ssrc-group:".concat(w.semantic).concat(w.ssrcIds.map(D=>"".concat(p).concat(D.toString(10))).join("")).concat(this.eol)).join("")}}function ge($){return new st().parse($)}function Ve($,S){return new Qn().print($,S)}}},r={};function o(a){if(r[a])return r[a].exports;var c=r[a]={exports:{}};return n[a](c,c.exports,o),c.exports}return o.d=(a,c)=>{for(var l in c)o.o(c,l)&&!o.o(a,l)&&Object.defineProperty(a,l,{enumerable:!0,get:c[l]})},o.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),o.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},o(8)})()})(xt);class oB{constructor(t){_(this,"sessionDesc",void 0),_(this,"localCapabilities",void 0),_(this,"rtpCapabilities",void 0),_(this,"candidates",void 0),_(this,"iceParameters",void 0),_(this,"dtlsParameters",void 0),_(this,"setup",void 0),_(this,"currentMidIndex",void 0),_(this,"cname",void 0),t=Mt(t);const{remoteIceParameters:n,remoteDtlsParameters:r,candidates:o,remoteRTPCapabilities:a,remoteSetup:c,localCapabilities:l,sdkCodec:h,cname:f}=t,p=xt.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=a,this.candidates=o,this.iceParameters=n,this.dtlsParameters=r,this.setup=c,this.localCapabilities=l,this.cname=f;for(let E=0;E<p.mediaDescriptions.length;E++){const T=p.mediaDescriptions[E];T.attributes.iceUfrag=n.iceUfrag,T.attributes.icePwd=n.icePwd,T.attributes.fingerprints=r.fingerprints,T.attributes.candidates=o,T.attributes.setup=c,T.media.mediaType==="video"&&(T.media.fmts=a.videoCodecs.map(y=>y.payloadType.toString(10)),T.attributes.payloads=a.videoCodecs,T.attributes.extmaps=a.videoExtensions),T.media.mediaType==="audio"&&(T.media.fmts=a.audioCodecs.map(y=>y.payloadType.toString(10)),T.attributes.payloads=a.audioCodecs,T.attributes.extmaps=a.audioExtensions),p.mediaDescriptions[E]=this.mungMediaDesc(T)}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return xt.exports.print(this.sessionDesc)}send(t,n,r){const{ssrcs:o,ssrcGroups:a}=jr(n,this.cname),c=this.sessionDesc.mediaDescriptions.find(f=>t===Ce.VIDEO?f.media.mediaType==="video":f.media.mediaType==="audio"),l=o[0].attributes.label,h=o[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(o),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(a),{id:l,mslabel:h}}batchSend(t){return t.map(n=>{let{kind:r,ssrcMsg:o}=n;return this.send(r,o,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const r=[],o=[],a=[];n.attributes.ssrcs.forEach(c=>{t.includes(c.attributes.label||"")?a.push(c):r.push(c)}),n.attributes.ssrcGroups.forEach(c=>{a.map(l=>l.ssrcId).includes(c.ssrcIds[0])||o.push(c)}),n.attributes.ssrcs=r,n.attributes.ssrcGroups=o})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,r){t.forEach((o,a)=>{const c=o._mediaStreamTrack,l=this.sessionDesc.mediaDescriptions.findIndex(f=>f.attributes.mid===c.kind),h=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],o);this.sessionDesc.mediaDescriptions[l]=h})}stopReceiving(t){}updateCandidates(t){t===sn.TCP?this.candidates.forEach(n=>{this.candidates.findIndex(r=>r.transport==="tcp"&&r.connectionAddress===n.connectionAddress&&r.port===n.port)===-1&&this.candidates.push(_O(_O({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}):this.candidates=this.candidates.filter(n=>n.transport!=="tcp");for(const n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(t){t=Mt(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}mungRecvMediaDsec(t,n){const r=Mt(t);return za(r,n),OE(r,n),r}updateRecvMedia(t,n){const r=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(r!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=o}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,r){const o=this.sessionDesc.mediaDescriptions.find(c=>t===Ce.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(o){const c=o.attributes.ssrcs.find(l=>l.attributes.label===n);var a;c&&(c.attributes.label=r,(a=c.attributes.msid)===null||a===void 0||a.replace(n,r))}}mungMediaDesc(t){const n=Mt(t);return AE(n),function(r){const o=r.attributes.extmaps.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o&&r.attributes.extmaps.splice(r.attributes.extmaps.indexOf(o),1),r.attributes.payloads.forEach(a=>{const c=a.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&a.rtcpFeedbacks.splice(c,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const r of n.attributes.ssrcs)if(r.attributes.label===t)return[r]}}function ri(e){if(Array.isArray(e))return e.map(n=>n);if(!gO(e))return e;const t={};for(const n in e)gO(e[n])||Array.isArray(e[n])?t[n]=ri(e[n]):t[n]=e[n];return t}function gO(e){return!(typeof e!="object"||Array.isArray(e)||!e)}function sB(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}function aB(e){return window.RTCStatsReport?e.getStats()instanceof se:!1}class NE{constructor(t){_(this,"input",[]),_(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const Ko={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},ld={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Ko,remoteCandidate:Ko}},SO={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},TO={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,qpSumPerFrame:0},vO={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},RO={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function yO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function IO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?yO(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class bE{constructor(t,n){_(this,"onFirstVideoReceived",void 0),_(this,"onFirstVideoDecoded",void 0),_(this,"onFirstAudioReceived",void 0),_(this,"onFirstVideoDecodedTimeout",void 0),_(this,"onFirstAudioDecoded",void 0),_(this,"onSelectedLocalCandidateChanged",void 0),_(this,"onSelectedRemoteCandidateChanged",void 0),_(this,"videoIsReady",!1),_(this,"videoIsReady2",{}),_(this,"pc",void 0),_(this,"options",void 0),_(this,"intervalTimer",void 0),_(this,"stats",ri(ld)),_(this,"isFirstVideoReceived",{}),_(this,"isFirstVideoDecoded",{}),_(this,"isFirstAudioReceived",{}),_(this,"isFirstAudioDecoded",{}),_(this,"isFirstVideoDecodedTimeout",{}),_(this,"lossRateWindowStats",[]),this.pc=t,this.options=n,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new se(t=>{t({local:IO({},Ko),remote:IO({},Ko)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,n){this.videoIsReady2[t]=n}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,a=0,c=0,l=0;for(const h of r)t[h].forEach((f,p)=>{if(!this.lossRateWindowStats[n-1][h][p]||!this.lossRateWindowStats[0][h][p])return;const E=this.lossRateWindowStats[n-1][h][p].packets-this.lossRateWindowStats[0][h][p].packets,T=this.lossRateWindowStats[n-1][h][p].packetsLost-this.lossRateWindowStats[0][h][p].packetsLost;h==="videoSend"||h==="audioSend"?(o+=E,c+=T):(a+=E,l+=T),Number.isNaN(E)||Number.isNaN(E)?f.packetLostRate=0:f.packetLostRate=E<=0||T<=0?0:T/(E+T)});t.sendPacketLossRate=o<=0||c<=0?0:c/(o+c),t.recvPacketLossRate=a<=0||l<=0?0:l/(a+l)}}function CO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function cB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?CO(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class dB extends bE{constructor(){super(...arguments),_(this,"_stats",ld),_(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),n=this.statsResponsesToObjects(t);this._stats=ri(ld);const r=n.filter(a=>a.type==="ssrc");this.processSSRCStats(r);const o=n.find(a=>a.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(n=>{const r=n.id.includes("send");switch("".concat(n.mediaType,"_").concat(r?"send":"recv")){case"video_send":{const o=ri(TO);o.codec=n.googCodecName,o.adaptionChangeReason="none",n.googCpuLimitedResolution&&(o.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(o.adaptionChangeReason="bandwidth"),o.avgEncodeMs=Number(n.googAvgEncodeMs),o.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},o.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},o.firsCount=Number(n.googFirReceived),o.nacksCount=Number(n.googNacksReceived),o.plisCount=Number(n.googPlisReceived),o.frameCount=Number(n.framesEncoded),o.bytes=Number(n.bytesSent),o.packets=Number(n.packetsSent),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(o),this._stats.rtt=o.rttMs;break}case"video_recv":{const o=ri(SO),a=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(o.codec=n.googCodecName,o.targetDelayMs=Number(n.googTargetDelayMs),o.renderDelayMs=Number(n.googRenderDelayMs),o.currentDelayMs=Number(n.googCurrentDelayMs),o.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),o.decodeMs=Number(n.googDecodeMs),o.maxDecodeMs=Number(n.googMaxDecodeMs),o.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},o.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},o.decodeFrameRate=Number(n.googFrameRateDecoded),o.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},o.jitterBufferMs=Number(n.googJitterBufferMs),o.firsCount=Number(n.googFirsSent),o.nacksCount=Number(n.googNacksSent),o.plisCount=Number(n.googPlisSent),o.framesDecodeCount=Number(n.framesDecoded),o.bytes=Number(n.bytesReceived),o.packets=Number(n.packetsReceived),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,o.decodedFrame.width,o.decodedFrame.height),this.isFirstVideoDecoded[o.ssrc]=!0),a){const c=a.stats,l=Date.now()-a.lts;o.framesDecodeFreezeTime=c.framesDecodeFreezeTime,o.framesDecodeInterval=c.framesDecodeInterval,o.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[o.ssrc]?(a.lts=Date.now(),o.framesDecodeInterval=l,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):o.framesDecodeCount<a.stats.framesDecodeCount&&(o.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:cB({},o),lts:Date.now()}),this._stats.videoRecv.push(o);break}case"audio_recv":{const o=ri(RO);o.codec=n.googCodecName,o.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,o.decodingCNG=Number(n.googDecodingCNG),o.decodingCTN=Number(n.googDecodingCTN),o.decodingCTSG=Number(n.googDecodingCTSG),o.decodingNormal=Number(n.googDecodingNormal),o.decodingPLC=Number(n.googDecodingPLC),o.decodingPLCCNG=Number(n.googDecodingPLCCNG),o.expandRate=Number(n.googExpandRate),o.accelerateRate=Number(n.googAccelerateRate),o.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),o.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),o.speechExpandRate=Number(n.googSpeechExpandRate),o.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),o.jitterBufferMs=Number(n.googJitterBufferMs),o.jitterMs=Number(n.googJitterReceived),o.bytes=Number(n.bytesReceived),o.packets=Number(n.packetsReceived),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),o.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.decodingNormal>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0),this._stats.audioRecv.push(o);break}case"audio_send":{const o=ri(vO);o.codec=n.googCodecName,o.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,o.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),o.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),o.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),o.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),o.bytes=Number(n.bytesSent),o.packets=Number(n.packetsSent),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.rttMs=Number(n.googRtt||0),this._stats.rtt=o.rttMs,this._stats.audioSend.push(o);break}}})}_getStats(){return new se((t,n)=>{this.pc.getStats(t,n)})}statsResponsesToObjects(t){const n=[];return t.result().forEach(r=>{const o={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach(a=>{o[a]=r.stat(a)}),n.push(o)}),n}}function AO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Hs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?AO(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class OO extends bE{constructor(){super(...arguments),_(this,"_stats",ld),_(this,"report",void 0),_(this,"lastDecodeVideoReceiverStats",new Map),_(this,"lastVideoFramesRecv",new Map),_(this,"lastVideoFramesSent",new Map),_(this,"lastVideoFramesDecode",new Map),_(this,"lastVideoJBDelay",new Map),_(this,"lastAudioJBDelay",new Map),_(this,"mediaBytesSent",new Map),_(this,"mediaBytesRetransmit",new Map),_(this,"mediaBytesTargetEncode",new Map),_(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ri(ld),this.report.forEach(t=>{switch(t.type){case pr.OUTBOUND:t.mediaType==="audio"?this.processAudioOutboundStats(t):t.mediaType==="video"&&this.processVideoOutboundStats(t);break;case pr.INBOUND:t.mediaType==="audio"?this.processAudioInboundStats(t):t.mediaType==="video"&&this.processVideoInboundStats(t);break;case pr.TRANSPORT:{const n=this.report.get(t.selectedCandidatePairId);n&&this.processCandidatePairStats(n);break}case pr.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),n={local:Hs({},Ko),remote:Hs({},Ko)};return t.forEach(r=>{let o;if(r.type===pr.TRANSPORT&&(o=t.get(r.selectedCandidatePairId)),r.type===pr.CANDIDATE_PAIR&&r.selected&&(o=r),o){const a=(c,l)=>{c.type=l.type,c.id=l.id,l.address&&(c.address=l.address),l.candidateType&&(c.candidateType=l.candidateType),l.port&&(c.port=l.port),l.priority&&(c.priority=l.priority),l.protocol&&(c.protocol=l.protocol),l.relayProtocol&&(c.relayProtocol=l.relayProtocol)};if(o.localCandidateId){const c=t.get(o.localCandidateId);c&&a(n.local,c)}if(o.remoteCandidateId){const c=t.get(o.remoteCandidateId);c&&a(n.remote,c)}}}),n}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(n=>{t.currentRoundTripTime&&(n.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{t.currentRoundTripTime&&(n.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const n=this.report.get(t.localCandidateId);n&&this.processCandidateStats(n)}if(t.remoteCandidateId){const n=this.report.get(t.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(t){let n;t.type===pr.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),t.type===pr.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=t.type,n.id=t.id,t.address&&(n.address=t.address),t.candidateType&&(n.candidateType=t.candidateType),t.port&&(n.port=t.port),t.priority&&(n.priority=t.priority),t.protocol&&(n.protocol=t.protocol),t.relayProtocol&&(n.relayProtocol=t.relayProtocol),t.type===pr.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Hs({},n),Hs({},this.stats.selectedCandidatePair.localCandidate)),t.type===pr.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Hs({},n),Hs({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let n=this._stats.audioRecv.find(r=>r.ssrc===t.ssrc);n||(n=ri(RO),this._stats.audioRecv.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsReceived,n.packetsLost=t.packetsLost,n.bytes=t.bytesReceived,n.jitterMs=1e3*t.jitter,this.processAudioTrackReceiverStats(t,t.trackId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),n.receivedFrames||(n.receivedFrames=t.packetsReceived),n.droppedFrames||(n.droppedFrames=t.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),typeof t.concealedSamples=="number"&&(n.concealedSamples=t.concealedSamples)}processVideoInboundStats(t){let n=this._stats.videoRecv.find(c=>c.ssrc===t.ssrc);n||(n=ri(SO),this._stats.videoRecv.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsReceived,n.packetsLost=t.packetsLost,n.bytes=t.bytesReceived,n.firsCount=t.firCount,n.nacksCount=t.nackCount,n.plisCount=t.pliCount,n.framesDecodeCount=t.framesDecoded,n.totalInterFrameDelay=t.totalInterFrameDelay,n.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay;const r=this.lastDecodeVideoReceiverStats.get(n.ssrc),o=this.lastVideoFramesDecode.get(n.ssrc),a=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]){const c=n.decodedFrame?n.decodedFrame.width:0,l=n.decodedFrame?n.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,c,l),this.isFirstVideoDecoded[n.ssrc]=!0}if(r){const c=r.stats,l=a-r.lts;n.framesDecodeFreezeTime=c.framesDecodeFreezeTime,n.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&l>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(r.lts=Date.now(),n.framesDecodeInterval=l,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):n.framesDecodeCount<c.framesDecodeCount&&(n.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(r.stats.framesDecodeCount>t.framesDecoded?n.qpSumPerFrame=t.qpSum/t.framesDecoded:n.qpSumPerFrame=(t.qpSum-r.qpSum)/(t.framesDecoded-r.stats.framesDecodeCount))}o&&a-o.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-o.count)/((a-o.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:a,rate:n.decodeFrameRate})):o?n.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:a,rate:0}),t.totalDecodeTime&&(n.decodeMs=1e3*t.totalDecodeTime),this.processVideoTrackReceiverStats(t,t.trackId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(n.framesRateFirefox=t.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:Hs({},n),lts:r?r.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let n=this._stats.videoSend.find(o=>o.ssrc===t.ssrc);n||(n=ri(TO),this._stats.videoSend.push(n));const r=this.mediaBytesSent.get(t.ssrc);if(r)r.add(t.bytesSent);else{const o=new NE(10);o.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,o)}if(t.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(t.ssrc);if(o)o.add(t.retransmittedBytesSent);else{const a=new NE(10);a.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,a)}}if(t.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(t.ssrc);if(o)o.add(t.totalEncodedBytesTarget);else{const a=new NE(10);a.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,a)}}if(n.ssrc=t.ssrc,n.bytes=t.bytesSent,n.packets=t.packetsSent,n.firsCount=t.firCount,n.nacksCount=t.nackCount,n.plisCount=t.pliCount,n.frameCount=t.framesEncoded,n.adaptionChangeReason=t.qualityLimitationReason,n.scalabilityMode=t.scalabilityMode,t.totalEncodeTime&&t.framesEncoded){const o=this.lastEncoderMs.get(t.ssrc);if(!o||o.lastFrameCount>t.framesEncoded)n.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const a=t.framesEncoded-o.lastFrameCount,c=t.totalEncodeTime-o.lastEncoderTime;n.avgEncodeMs=1e3*c/a}}if(t.framesEncoded&&t.qpSum){const o=this.lastEncoderMs.get(t.ssrc);!o||o.lastFrameCount>t.framesEncoded?n.qpSumPerFrame=t.qpSum/t.framesEncoded:n.qpSumPerFrame=(t.qpSum-o.lastQpSum)/(t.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,n),this.processVideoTrackSenderStats(t,t.trackId,n),t.remoteId)this.processRemoteInboundStats(t.remoteId,n);else{const o=this.findRemoteStatsId(t.ssrc,pr.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,n)}}processAudioOutboundStats(t){let n=this._stats.audioSend.find(r=>r.ssrc===t.ssrc);if(n||(n=ri(vO),this._stats.audioSend.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsSent,n.bytes=t.bytesSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,n),t.remoteId)this.processRemoteInboundStats(t.remoteId,n);else{const r=this.findRemoteStatsId(t.ssrc,pr.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,n)}}findRemoteStatsId(t,n){var r;const o=Array.from(Fi(r=this.report).call(r)).find(a=>a.type===n&&a.ssrc===t);return o?o.id:null}processVideoMediaSource(t,n){const r=this.report.get(t);r&&r.width&&r.height&&r.framesPerSecond&&(n.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(t,n){const r=this.report.get(t);r&&(n.inputLevel=r.audioLevel)}processVideoTrackSenderStats(t,n,r){var o,a,c;const l=n?this.report.get(n):void 0,h=(o=l==null?void 0:l.framesSent)!==null&&o!==void 0?o:t.framesSent;let f=(a=l==null?void 0:l.frameWidth)!==null&&a!==void 0?a:t.frameWidth,p=(c=l==null?void 0:l.frameHeight)!==null&&c!==void 0?c:t.frameHeight;if(typeof h!="number")return;typeof f=="number"&&typeof p=="number"||(f=0,p=0);let E=0;const T=Date.now(),y=this.lastVideoFramesSent.get(r.ssrc);y&&T-y.lts>=800?(E=Math.round((h-y.count)/((T-y.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:h,lts:T,rate:E})):y?E=y.rate:this.lastVideoFramesSent.set(r.ssrc,{count:h,lts:T,rate:0}),r.sentFrame={width:f,height:p,frameRate:Math.max(0,E)}}processVideoTrackReceiverStats(t,n,r){var o,a,c,l,h;const f=n?this.report.get(n):void 0,p=(o=f==null?void 0:f.framesReceived)!==null&&o!==void 0?o:t.framesReceived,E=(a=f==null?void 0:f.frameWidth)!==null&&a!==void 0?a:t.frameWidth,T=(c=f==null?void 0:f.frameHeight)!==null&&c!==void 0?c:t.frameHeight,y=(l=f==null?void 0:f.jitterBufferDelay)!==null&&l!==void 0?l:t.jitterBufferDelay,C=(h=f==null?void 0:f.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount;if(typeof p=="number"){const A=this.lastVideoFramesRecv.get(r.ssrc),O=Date.now();r.framesReceivedCount=p;let M=0;A&&O-A.lts>=800?(M=Math.round((p-A.count)/((O-A.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:p,lts:O,rate:M})):A?M=A.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:p,lts:O,rate:0}),r.receivedFrame={width:E||0,height:T||0,frameRate:M||0},r.decodedFrame={width:E||0,height:T||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:E||0,height:T||0,frameRate:r.decodeFrameRate||0}}if(y&&C){let A=this.lastVideoJBDelay.get(r.ssrc);this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:y,jitterBufferEmittedCount:C}),A||(A={jitterBufferDelay:0,jitterBufferEmittedCount:0});const O=1e3*(y-A.jitterBufferDelay)/(C-A.jitterBufferEmittedCount);r.jitterBufferMs=O,r.currentDelayMs=Math.round(O)}}processAudioTrackSenderStats(t,n,r){var o,a,c,l;const h=n?this.report.get(n):void 0,f=(o=(a=h==null?void 0:h.echoReturnLoss)!==null&&a!==void 0?a:t.echoReturnLoss)!==null&&o!==void 0?o:0,p=(c=(l=h==null?void 0:h.echoReturnLossEnhancement)!==null&&l!==void 0?l:t.echoReturnLossEnhancement)!==null&&c!==void 0?c:0;r.aecReturnLoss=f,r.aecReturnLossEnhancement=p}processAudioTrackReceiverStats(t,n,r){var o,a,c,l,h,f,p;const E=n?this.report.get(n):void 0,T=(o=E==null?void 0:E.removedSamplesForAcceleration)!==null&&o!==void 0?o:t.removedSamplesForAcceleration,y=(a=E==null?void 0:E.totalSamplesReceived)!==null&&a!==void 0?a:t.totalSamplesReceived,C=(c=E==null?void 0:E.jitterBufferDelay)!==null&&c!==void 0?c:t.jitterBufferDelay,A=(l=E==null?void 0:E.jitterBufferEmittedCount)!==null&&l!==void 0?l:t.jitterBufferEmittedCount,O=(h=E==null?void 0:E.audioLevel)!==null&&h!==void 0?h:t==null?void 0:t.audioLevel,M=(f=E==null?void 0:E.totalSamplesDuration)!==null&&f!==void 0?f:t==null?void 0:t.totalSamplesDuration,U=(p=E==null?void 0:E.concealedSamples)!==null&&p!==void 0?p:t.concealedSamples;if(T&&y&&(r.accelerateRate=T/y),C&&A){let ae=this.lastAudioJBDelay.get(r.ssrc);this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:C,jitterBufferEmittedCount:A}),ae||(ae={jitterBufferDelay:0,jitterBufferEmittedCount:0});const X=1e3*(C-ae.jitterBufferDelay)/(A-ae.jitterBufferEmittedCount);r.jitterBufferMs=Math.round(X)}r.outputLevel=O;let q=1920;M&&y&&(q=y/M/50,r.receivedFrames=Math.round(y/q)),U&&(r.droppedFrames=Math.round(U/q))}processRemoteInboundStats(t,n){const r=this.report.get(t);r&&(n.packetsLost=r.packetsLost,r.roundTripTime&&(n.rttMs=1e3*r.roundTripTime))}getCodecFromCodecStats(t){const n=this.report.get(t);if(!n)return"";const r=n.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let t=0,n=null,r=null;this.mediaBytesSent.forEach(a=>{t+=a.diffMean()}),this.mediaBytesRetransmit.forEach(a=>{n=n===null?a.diffMean():n+a.diffMean()}),this.mediaBytesTargetEncode.forEach(a=>{r=r===null?a.diffMean():r+a.diffMean()});const o=n!==null?t-n:t;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},n!==null&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}}class lB extends bE{updateStats(){return se.resolve()}}function DE(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const a=sB();return a?a<76?new dB(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:o}):new OO(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:o}):aB(e)?new OO(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:o}):new lB(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:o})}var Ze;function wO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function NO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?wO(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let ud=(K((Ze=class wd extends uu{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(t,n){super(t,n),_(this,"store",void 0),_(this,"peerConnection",void 0),_(this,"remoteSDP",void 0),_(this,"initialOffer",void 0),_(this,"statsFilter",void 0),_(this,"useRTX",!1),_(this,"localCapabilities",void 0),_(this,"localCandidateCount",0),_(this,"allCandidatesReceived",!1),_(this,"establishPromise",void 0),_(this,"mutex",new Mn("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(wd.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=DE(this.peerConnection,L("STATS_UPDATE_INTERVAL"),void 0,gt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Ws(t.sdp),r=CE(t.sdp,!this.useRTX,L("FILTER_VIDEO_FEC"),L("FILTER_AUDIO_FEC"),["opus"]);return this.localCapabilities=r,this.initialOffer=t,NO(NO({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new N(I.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,n,r,o,a,c){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new oB({remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:o.send,remoteSetup:a,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:c});const l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(l){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(l.toString()))}}send(t,n){var r=this;return ni(function*(){const o=yield Le(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=t.map(T=>r.peerConnection.addTrack(T._mediaStreamTrack)),c=yield Le(r.peerConnection.createOffer()),l=xt.exports.parse(c.sdp),h=t.map(T=>{const y=T._mediaStreamTrack,C=l.mediaDescriptions.find(A=>A.attributes.mid===y.kind);if(!C)throw new Error("Cannot extract ssrc from mediaDescription.");return function(A,O,M){const U=A.attributes.ssrcs.filter(ae=>ae.attributes.label===O),q=A.attributes.ssrcGroups;if(U.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(q&&U.length>1){const ae=q.find(X=>X.ssrcIds.indexOf(U[0].ssrcId)!==-1);return ae?[{ssrcId:ae.ssrcIds[0],rtx:M?ae.ssrcIds[1]:void 0}]:[{ssrcId:U[0].ssrcId}]}return[{ssrcId:U[0].ssrcId}]}(C,y.id,r.useRTX)});let f;try{f=yield h}catch(T){throw a.forEach(y=>{Dn()&&y.replaceTrack(null),r.peerConnection.removeTrack(y)}),T}const p=r.mungSendOfferSDP(c.sdp,t);r.remoteSDP.receive(t,n,f);const E=r.remoteSDP.toString();return yield Le(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield Le(r.applySendEncodings(a,t)),yield Le(r.peerConnection.setRemoteDescription({type:"answer",sdp:E})),t.map((T,y)=>{const C=T._mediaStreamTrack.id;return{localSSRC:h[y],id:C}})}catch(a){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{o()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(a=>{var c;return t.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(a=>{Dn()&&a.replaceTrack(null),this.peerConnection.removeTrack(a)});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,r,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:a,mslabel:c}=this.remoteSDP.send(t,n,o),l=new se((p,E)=>{const T=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(a)))},1e4),y=C=>{const A=He();if((A.name==="Safari"&&Number(A.version)===11||Pn())&&C.track.id!==a&&C.streams[0].id===c){var O;const M=C.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(t,a,C.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(T),void p(M)}if(C.track.id===a)return this.peerConnection.removeEventListener("track",y),clearTimeout(T),void p(C.track)};this.peerConnection.addEventListener("track",y)}),h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const f=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(f),{track:await l,id:a}}catch(a){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(r=>{var o;return t.indexOf(((o=r.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(r=>{if(Dn()&&r.track)r.track.enabled=!1;else{const o=r.getParameters();o.encodings.forEach(a=>a.active=!1),r.setParameters(o)}})}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(a=>{var c;return t.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async a=>{if(Dn()&&a.track)a.track.enabled=!0;else{const c=a.getParameters();c.encodings.forEach(l=>l.active=!0),await a.setParameters(c)}});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return ni(function*(){const r=yield Le(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ot().supportPCSetConfiguration){const h=n.peerConnection.getConfiguration(),f=t===sn.RELAY?"relay":"all";h.iceTransportPolicy!==f&&(v.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(f,"]")),h.iceTransportPolicy=f,n.peerConnection.setConfiguration(h))}else if(t===sn.RELAY)return;t!==sn.RELAY&&n.remoteSDP.updateCandidates(t);const o=yield Le(n.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=Ws(o.sdp),{remoteIceParameters:c}=yield a.iceParameters;n.remoteSDP.restartICE(c);const l=n.remoteSDP.toString();yield Le(n.peerConnection.setLocalDescription(o)),yield Le(n.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(o){v.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(r.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const a=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(r){throw new N(I.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getSenders().filter(o=>{var a;return((a=o.track)===null||a===void 0?void 0:a.id)===t});r.length===1&&await this.applySendEncodings(r,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getSenders().find(o=>{var a;return((a=o.track)===null||a===void 0?void 0:a.id)===n});r&&await r.replaceTrack(t._mediaStreamTrack)}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},L("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(qc(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...wd.turnServerConfigToIceServers(t.turnServer.servers)),L("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...wd.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}async applySendEncodings(t,n){try{if(!Ot().supportSetRtpSenderParameters||t.length!==n.length)return;for(let o=0;o<t.length;o++){var r;const a=t[o],c=n[o];if(!c)continue;const l={},h={};if(c instanceof Ut)switch(c._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;default:l.degradationPreference="balanced"}if(L("DSCP_TYPE")&&Ns()){const E=L("DSCP_TYPE");["very-low","low","medium","high"].includes(E)&&(h.networkPriority=E)}const f=a.getParameters(),p=(r=f.encodings)===null||r===void 0?void 0:r[0];p&&Object.assign(p,h),Object.assign(f,l),await a.setParameters(f)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const r=xt.exports.parse(t);return n.forEach((o,a)=>{const c=o._mediaStreamTrack,l=r.mediaDescriptions.find(h=>h.attributes.mid===c.kind);l&&za(l,o)}),xt.exports.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((a,c)=>{let{id:l,mslabel:h}=a;const{kind:f}=t[c];return new se((p,E)=>{const T=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(l)))},1e4),y=C=>{const A=He();if(A.name==="Safari"&&Number(A.version)===11&&C.track.id!==l&&C.streams[0].id===h){var O;const M=C.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(f,l,C.track.id),this.peerConnection.removeEventListener("track",y),clearTimeout(T),void p({track:M,id:l})}if(C.track.id===l)return this.peerConnection.removeEventListener("track",y),clearTimeout(T),void p({track:C.track,id:l})};this.peerConnection.addEventListener("track",y)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const o=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(o),await se.all(n)}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Ot().supportPCSetConfiguration){const n=wd.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[Fr],Object.getOwnPropertyDescriptor(Ze.prototype,"connect"),Ze.prototype),K(Ze.prototype,"stopSending",[Fr],Object.getOwnPropertyDescriptor(Ze.prototype,"stopSending"),Ze.prototype),K(Ze.prototype,"receive",[Fr],Object.getOwnPropertyDescriptor(Ze.prototype,"receive"),Ze.prototype),K(Ze.prototype,"stopReceiving",[Fr],Object.getOwnPropertyDescriptor(Ze.prototype,"stopReceiving"),Ze.prototype),K(Ze.prototype,"muteRemote",[Fr],Object.getOwnPropertyDescriptor(Ze.prototype,"muteRemote"),Ze.prototype),K(Ze.prototype,"unmuteRemote",[Fr],Object.getOwnPropertyDescriptor(Ze.prototype,"unmuteRemote"),Ze.prototype),K(Ze.prototype,"muteLocal",[Fr],Object.getOwnPropertyDescriptor(Ze.prototype,"muteLocal"),Ze.prototype),K(Ze.prototype,"unmuteLocal",[Fr],Object.getOwnPropertyDescriptor(Ze.prototype,"unmuteLocal"),Ze.prototype),K(Ze.prototype,"close",[Fr],Object.getOwnPropertyDescriptor(Ze.prototype,"close"),Ze.prototype),K(Ze.prototype,"updateEncoderConfig",[Fr],Object.getOwnPropertyDescriptor(Ze.prototype,"updateEncoderConfig"),Ze.prototype),K(Ze.prototype,"updateSendParameters",[Fr],Object.getOwnPropertyDescriptor(Ze.prototype,"updateSendParameters"),Ze.prototype),K(Ze.prototype,"replaceTrack",[Fr],Object.getOwnPropertyDescriptor(Ze.prototype,"replaceTrack"),Ze.prototype),K(Ze.prototype,"getRemoteSSRC",[Fr],Object.getOwnPropertyDescriptor(Ze.prototype,"getRemoteSSRC"),Ze.prototype),Ze);function Fr(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("Locking from P2PConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];return await r.apply(this,l)}finally{a()}},n}function bO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function DO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bO(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const ku="9",PO=4e4;class uB{get localCapabilities(){return Mt(this._localCapabilities)}get rtpCapabilities(){return Mt(this._rtpCapabilities)}get candidates(){return Mt(this._candidates)}get iceParameters(){return Mt(this._iceParameters)}get dtlsParameters(){return Mt(this._dtlsParameters)}constructor(t){_(this,"sessionDesc",void 0),_(this,"_localCapabilities",void 0),_(this,"_rtpCapabilities",void 0),_(this,"_candidates",void 0),_(this,"_iceParameters",void 0),_(this,"_dtlsParameters",void 0),_(this,"setup",void 0),_(this,"currentMidIndex",void 0),_(this,"cname",void 0),_(this,"firefoxSsrcMidMap",new Map),t=Mt(t);const{remoteIceParameters:n,remoteDtlsParameters:r,candidates:o,remoteRTPCapabilities:a,remoteSetup:c,localCapabilities:l,cname:h}=t,f=xt.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=a,this._candidates=o,this._iceParameters=n,this._dtlsParameters=r,this._localCapabilities=l,this.setup=c,this.cname=h;const p=this.rtpCapabilities.send;for(const E of f.mediaDescriptions){if(E.attributes.iceUfrag=n.iceUfrag,E.attributes.icePwd=n.icePwd,E.attributes.fingerprints=r.fingerprints,E.attributes.candidates=o,E.attributes.setup=c,E.media.mediaType==="video"&&(E.media.fmts=p.videoCodecs.map(T=>T.payloadType.toString(10)),E.attributes.payloads=p.videoCodecs,E.attributes.extmaps=p.videoExtensions,L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:T,ssrcGroups:y}=jr([{ssrcId:PO,rtx:L("USE_SUB_RTX")?40001:void 0}],this.cname);E.attributes.ssrcs=T,E.attributes.ssrcGroups=y}if(E.media.mediaType==="audio"&&(E.media.fmts=p.audioCodecs.map(T=>T.payloadType.toString(10)),E.attributes.payloads=p.audioCodecs,E.attributes.extmaps=p.audioExtensions,Ho(E),L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:T,ssrcGroups:y}=jr([{ssrcId:2e4}],this.cname);E.attributes.ssrcs=T,E.attributes.ssrcGroups=y}}this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}preloadRemoteMedia(){const t=L("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const n=this.candidates,r=this.dtlsParameters,o=this.iceParameters,a=this.rtpCapabilities.send;for(let c=1;c<t;c++){const l=2*c+2e4,h=2*c+PO,{ssrcs:f,ssrcGroups:p}=jr([{ssrcId:l}],this.cname),{ssrcs:E,ssrcGroups:T}=jr([{ssrcId:h,rtx:L("USE_SUB_RTX")?h+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:ku,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.videoCodecs.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:n,extmaps:a.videoExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:T,rtcpFeedbackWildcards:[],payloads:a.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*c)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:ku,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.audioCodecs.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:n,extmaps:a.audioExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:f,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:a.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*c+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return xt.exports.print(this.sessionDesc)}send(t,n,r,o){const{ssrcs:a,ssrcGroups:c}=jr(n,this.cname,L("SYNC_GROUP")?r:void 0),l=this.findPreloadMediaDesc(a);if(l){if(gt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,l.attributes.mid),o&&(o.twcc||o.remb)){const h=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(l,o),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const h=this.findAvailableMediaIndex(t,a);let f;return h===-1||h===1&&(Dn()||CR())||h===0&&L("USE_SUB_RTX")||AR()?(f=this.createOrRecycleSendMedia(t,a,c,"sendonly",o),this.updateBundleMids()):(f=Mt(this.sessionDesc.mediaDescriptions[h]),f.attributes.direction="sendonly",f.attributes.ssrcs=a,f.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(f,o)),gt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,f.attributes.mid),{mid:f.attributes.mid,needExchangeSDP:!0}}}batchSend(t){const n=t.map(a=>{let{kind:c,ssrcMsg:l,mslabel:h}=a;return this.send(c,l,h)}),r=[];let o=!1;return n.forEach(a=>{let{mid:c,needExchangeSDP:l}=a;l&&(o=!0),r.push(c)}),{mids:r,needExchangeSDP:o}}stopSending(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&t.indexOf(r.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(r=>{r.attributes.mid==="0"||gt()||AR()?r.attributes.ssrcs=[]:(r.attributes.ssrcs=[],r.attributes.direction="inactive",r.media.port="0")}),this.updateBundleMids()}mute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>t.includes(r.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>t.includes(r.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(r=>{r.attributes.direction="recvonly"})}receive(t,n,r,o){t.forEach((a,c)=>{this.createOrRecycleRecvMedia(a,[],"recvonly",n,r,o[c])}),this.updateBundleMids()}stopReceiving(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>t.indexOf(r.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(t){t===sn.TCP?this._candidates.forEach(n=>{this._candidates.findIndex(r=>r.transport==="tcp"&&r.connectionAddress===n.connectionAddress&&r.port===n.port)===-1&&this._candidates.push(DO(DO({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}):this._candidates=this._candidates.filter(n=>n.transport!=="tcp");for(const n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(t){t=Mt(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}findAvailableMediaIndex(t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const o=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(gt()){if(o){const a=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(a||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!a||a!==r.attributes.mid)}return!1}return o})}createOrRecycleRecvMedia(t,n,r,o,a,c){const l=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,f=this.localCapabilities.send;let p=[];if(l===Ce.VIDEO){var E,T;if(L("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(p=h.videoCodecs.filter(M=>{var U,q;return(((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())||"").includes(o)&&(M==null||(q=M.fmtp)===null||q===void 0?void 0:q.parameters["profile-level-id"])===L("H264_PROFILE_LEVEL_ID")})),!p||((E=p)===null||E===void 0?void 0:E.length)===0){const M=f.videoCodecs.filter(U=>{var q;return(((q=U.rtpMap)===null||q===void 0?void 0:q.encodingName.toLowerCase())||"").includes(o)});M.length!==0&&(p=h.videoCodecs.filter(U=>M.some(q=>q.payloadType===U.payloadType)))}if(L("USE_PUB_RTX")){const M=p.map(q=>q.payloadType.toString()),U=h.videoCodecs.filter(q=>{var ae,X;return((ae=q.rtpMap)===null||ae===void 0?void 0:ae.encodingName)==="rtx"&&M.includes(((X=q.fmtp)===null||X===void 0?void 0:X.parameters.apt)||"")});p=[...p,...U]}p.length===0&&(v.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat((T=h.videoCodecs[0].rtpMap)===null||T===void 0?void 0:T.encodingName)),p=h.videoCodecs)}else p=h.audioCodecs.filter(M=>{var U;return(((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())||"").includes(a)}),p.length===0&&(v.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),p=h.audioCodecs.filter(M=>{var U;return(((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())||"").includes("opus")}));const y=l===Ce.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const C="".concat(this.currentMidIndex);let A={media:{mediaType:l,port:ku,protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(M=>M.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(C)}};A=this.mungRecvMediaDsec(A,t,c);const O=this.findFirstClosedMedia(l);if(O){const M=this.sessionDesc.mediaDescriptions.indexOf(O);this.sessionDesc.mediaDescriptions[M]=A}else this.sessionDesc.mediaDescriptions.push(A);return A}createOrRecycleSendMedia(t,n,r,o,a){const c=this.rtpCapabilities.send,l=t===Ce.VIDEO?c.videoCodecs:c.audioCodecs,h=t===Ce.VIDEO?c.videoExtensions:c.audioExtensions;this.currentMidIndex+=1;const f="".concat(this.currentMidIndex);let p={media:{mediaType:t,port:ku,protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};p=this.mungSendMediaDesc(p,a);const E=this.findFirstClosedMedia(t);if(E){const T=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[T]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,n,r){const o=Mt(t);return AE(o),za(o,n),OE(o,n),pO(o),Pu(o,r,this.localCapabilities.send),o}mungSendMediaDesc(t,n){const r=Mt(t);return Pu(r,n,this.localCapabilities.recv),Ho(r),r}updateRecvMedia(t,n){const r=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(r!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=o}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(n=>gt()?n.media.port==="0"&&n.media.mediaType===t:n.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(n=>{var r,o;return((r=n.attributes)===null||r===void 0||(o=r.ssrcs[0])===null||o===void 0?void 0:o.ssrcId)===t[0].ssrcId})}getSSRC(t){var n;return(n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t))===null||n===void 0?void 0:n.attributes.ssrcs}}var et;function LO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function qa(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?LO(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):LO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let uo=(K((et=class Nd extends uu{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n,r;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(r=n.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}constructor(t,n){super(t,n),_(this,"store",void 0),_(this,"peerConnection",void 0),_(this,"remoteSDP",void 0),_(this,"initialOffer",void 0),_(this,"transportEventReceiver",void 0),_(this,"statsFilter",void 0),_(this,"localCapabilities",void 0),_(this,"localCandidateCount",0),_(this,"allCandidatesReceived",!1),_(this,"selectedCandidatePairTimer",void 0),_(this,"establishPromise",void 0),_(this,"mutex",new Mn("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(Nd.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=DE(this.peerConnection,L("STATS_UPDATE_INTERVAL"),void 0,gt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Ws(t.sdp),r=await mO(!L("USE_PUB_RTX")&&!L("USE_SUB_RTX"),L("FILTER_VIDEO_FEC"),L("FILTER_AUDIO_FEC"));return this.localCapabilities=wE(r),this.initialOffer=t,qa(qa({},n),{},{rtpCapabilities:r,offerSDP:t.sdp})}catch(t){throw new N(I.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,n,r,o,a,c){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new uB({remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:o,remoteSetup:a,localCapabilities:this.localCapabilities,cname:c});const l=this.remoteSDP.toString(),h=xt.exports.parse(this.initialOffer.sdp),f=h.mediaDescriptions.find(y=>y.media.mediaType==="audio");f&&Ho(f);const p=xt.exports.print(h),E=this.logSDPExchange(p||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:p}),E==null||E(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l});const T=this.peerConnection.getTransceivers()[0];if(T!=null&&T.receiver&&this.tryBindTransportEvents(T.receiver),L("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const C=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(C)}}catch(l){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(l.toString()))}}send(t,n,r){var o=this;return ni(function*(){const a=yield Le(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[];t.forEach(A=>{const O=o.peerConnection.addTransceiver(A._mediaStreamTrack,{direction:"sendonly"});c.push(O),A._updateRtpTransceiver(O)}),gt()&&L("SIMULCAST")===!0&&(yield Le(o.applySimulcastForFirefox(c,t)));const l=yield Le(o.peerConnection.createOffer()),h=o.remoteSDP.predictReceivingMids(t.length),f=o.mungSendOfferSDP(l.sdp,t,h),p=xt.exports.parse(f),E=h.map(A=>{const O=p.mediaDescriptions.find(M=>M.attributes.mid===A);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return uO(O,L("USE_PUB_RTX"))});let T;try{T=yield E}catch(A){T=[],o.remoteSDP.receive(t,n,r,T);const O=o.remoteSDP.toString();throw yield Le(o.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Le(o.peerConnection.setRemoteDescription({type:"answer",sdp:O})),yield Le(o.stopSending(h,!0)),A}o.remoteSDP.receive(t,n,r,T);const y=o.remoteSDP.toString(),C=o.logSDPExchange(f,"offer","local","send");return yield Le(o.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Le(o.applySimulcastEncodings(c,t)),yield Le(o.applySendEncodings(c,t)),C==null||C(y),yield Le(o.peerConnection.setRemoteDescription({type:"answer",sdp:y})),c.map((A,O)=>{const M=h[O];return{localSSRC:E[O],id:M,transceiver:A}})}catch(c){throw c instanceof N?c:new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");o.map(h=>{var f;h.direction="inactive",(f=h.stop)===null||f===void 0||f.call(h)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(o){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{r&&r()}}async receive(t,n,r,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(t,n,r,o);if(c){const h=this.remoteSDP.toString(),f=this.logSDPExchange(h,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(p.sdp,a,t);f==null||f(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(h=>h.mid===a);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:a,transceiver:l}}catch(a){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);if(r){const o=this.remoteSDP.toString(),a=this.logSDPExchange(o,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c),v.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return n.map(o=>{const a=this.peerConnection.getTransceivers().find(c=>c.mid===o);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:o,transceiver:a}})}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();r==null||r(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();r==null||r(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();r==null||r(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const r=await this.peerConnection.createOffer(),o=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,l)=>{c.direction="sendonly"});const r=await this.peerConnection.createOffer(),o=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return ni(function*(){const r=yield Le(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ot().supportPCSetConfiguration){const f=n.peerConnection.getConfiguration(),p=t===sn.RELAY?"relay":"all";f.iceTransportPolicy!==p&&(v.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(f.iceTransportPolicy,"] to [").concat(p,"]")),f.iceTransportPolicy=p,n.peerConnection.setConfiguration(f))}else if(t===sn.RELAY)return;t!==sn.RELAY&&n.remoteSDP.updateCandidates(t);const o=yield Le(n.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=Ws(o.sdp),{remoteIceParameters:c}=yield a.iceParameters;n.remoteSDP.restartICE(c);const l=n.remoteSDP.toString(),h=n.logSDPExchange(o.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Le(n.peerConnection.setLocalDescription(o)),h==null||h(l),yield Le(n.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(o){v.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const a=this.remoteSDP.toString(),c=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(r){throw new N(I.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(o=>o.mid===t);r.length===1&&(this.isVP8Simulcast(n)?gt()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(o=>o.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:o}=n.getSelectedCandidatePair();return{local:qa(qa({},Ko),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:qa(qa({},Ko),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},L("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(qc(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...Nd.turnServerConfigToIceServers(t.turnServer.servers)),L("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Nd.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),L("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),L("ENABLE_ENCODED_TRANSFORM")&&Ot().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(gu(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!L("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var o;n!=null&&n.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,n.state))},n.onerror=o=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in o?o.error:o)};const r=n.iceTransport;r&&(r.onstatechange=()=>{const o=n==null?void 0:n.iceTransport.state;var a;o&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,o))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:o,remote:a}=r.getSelectedCandidatePair();v.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async applySendEncodings(t,n){try{if(!Ot().supportSetRtpSenderParameters||t.length!==n.length)return;for(let f=0;f<t.length;f++){const p=t[f],E=n[f];if(E&&E instanceof Ut){var r,o;if(this.isVP8Simulcast(E))continue;const T={},y={};switch(E._optimizationMode){case"motion":T.degradationPreference="maintain-framerate";break;case"detail":T.degradationPreference="maintain-resolution";break;default:T.degradationPreference="balanced"}var a,c,l,h;if((r=E._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&(y.maxBitrate=1e3*((a=E._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)),E._hints.includes(Wt.LOW_STREAM)&&((c=E._encoderConfig)!==null&&c!==void 0&&c.frameRate&&(y.maxFramerate=ao(E._encoderConfig.frameRate)),(l=E._encoderConfig)!==null&&l!==void 0&&l.scaleResolutionDownBy&&((h=E._encoderConfig)===null||h===void 0?void 0:h.scaleResolutionDownBy)>1&&(y.scaleResolutionDownBy=E._encoderConfig.scaleResolutionDownBy)),L("DSCP_TYPE")&&Ns()){const O=L("DSCP_TYPE");["very-low","low","medium","high"].includes(O)&&(y.networkPriority=O)}const C=p.sender.getParameters(),A=(o=C.encodings)===null||o===void 0?void 0:o[0];gt()&&!A&&(T.encodings=[y]),A&&Object.assign(A,y),Object.assign(C,T),await p.sender.setParameters(C)}}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const o=xt.exports.parse(t);return n.forEach((a,c)=>{const l=r[c],h=o.mediaDescriptions.find(f=>f.attributes.mid===l);h&&(za(h,a),fO(h,a,this.store.codec))}),xt.exports.print(o)}mungReceiveAnswerSDP(t,n,r){const o=xt.exports.parse(t),a=o.mediaDescriptions.find(c=>c.attributes.mid===n);return a&&r===Ce.AUDIO&&a.media.mediaType==="audio"&&Ho(a),xt.exports.print(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var r,o,a,c;const h=t[l],f=n[l];if(f instanceof Ut&&!f._hints.includes(Wt.LOW_STREAM)&&(r=f._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((o=f._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(a=f._scalabiltyMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=f._scalabiltyMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const p={},E={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const T=h.sender.getParameters();await h.sender.setParameters(Object.assign(T,p))}}}async applySimulcastEncodings(t,n){if(!gt()&&t.length===n.length)for(let r=0;r<t.length;r++){const o=n[r];if(o instanceof Ut&&this.isVP8Simulcast(o)){const a=t[r],c={},l={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const h=a.sender.getParameters();await a.sender.setParameters(Object.assign(h,c))}}}isVP8Simulcast(t){var n,r,o,a;return!!(t instanceof Ut&&L("SIMULCAST")&&this.store.codec==="vp8"&&!t._hints.includes(Wt.LOW_STREAM)&&(n=t._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((r=t._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(o=t._scalabiltyMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=t._scalabiltyMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,n,r,o){if(L("SDP_LOGGING"))return v.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(o,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",r==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Ot().supportPCSetConfiguration){const n=Nd.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[Br],Object.getOwnPropertyDescriptor(et.prototype,"connect"),et.prototype),K(et.prototype,"receive",[Br],Object.getOwnPropertyDescriptor(et.prototype,"receive"),et.prototype),K(et.prototype,"batchReceive",[Br],Object.getOwnPropertyDescriptor(et.prototype,"batchReceive"),et.prototype),K(et.prototype,"stopReceiving",[Br],Object.getOwnPropertyDescriptor(et.prototype,"stopReceiving"),et.prototype),K(et.prototype,"muteRemote",[Br],Object.getOwnPropertyDescriptor(et.prototype,"muteRemote"),et.prototype),K(et.prototype,"unmuteRemote",[Br],Object.getOwnPropertyDescriptor(et.prototype,"unmuteRemote"),et.prototype),K(et.prototype,"muteLocal",[Br],Object.getOwnPropertyDescriptor(et.prototype,"muteLocal"),et.prototype),K(et.prototype,"unmuteLocal",[Br],Object.getOwnPropertyDescriptor(et.prototype,"unmuteLocal"),et.prototype),K(et.prototype,"close",[Br],Object.getOwnPropertyDescriptor(et.prototype,"close"),et.prototype),K(et.prototype,"updateEncoderConfig",[Br],Object.getOwnPropertyDescriptor(et.prototype,"updateEncoderConfig"),et.prototype),K(et.prototype,"updateSendParameters",[Br],Object.getOwnPropertyDescriptor(et.prototype,"updateSendParameters"),et.prototype),K(et.prototype,"replaceTrack",[Br],Object.getOwnPropertyDescriptor(et.prototype,"replaceTrack"),et.prototype),K(et.prototype,"getRemoteSSRC",[Br],Object.getOwnPropertyDescriptor(et.prototype,"getRemoteSSRC"),et.prototype),et);function Br(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("From P2PConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];return await r.apply(this,l)}finally{a()}},n}function kO(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=ao(t.width),r.height=ao(t.height);const o=ao(t.framerate||15);document.body.append(n),document.body.append(r);let a=e._mediaStreamTrack;n.srcObject=new MediaStream([a]),n.play();const c=r.getContext("2d");if(!c)throw new N(I.UNEXPECTED_ERROR,"can not get canvas context");const l=Ot(),h=r.captureStream(l.supportRequestFrame?0:o).getVideoTracks()[0],f=nI(()=>(()=>{if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const E=n.videoWidth,T=n.videoHeight/E,y=r.width*T;Math.abs(y-r.height)>=2&&(v.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(y)),r.height=y)}c.drawImage(n,0,0,r.width,r.height),h.requestFrame&&h.requestFrame(),a!==e._mediaStreamTrack&&(a=e._mediaStreamTrack,n.srcObject=new MediaStream([a]))})(),o),p=h.stop;return h.stop=()=>{p.call(h),f(),n&&(n.remove(),n=null),r&&(r.width=0,r.remove(),r=null),v.debug("clean low stream renderer")},h}var MO,UO,xO,VO,Gr,jO,FO,BO,GO,WO,HO,On;function KO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Mu(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?KO(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class YO extends $y{getUserId(){return this._userId}constructor(t,n,r,o){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(o.clientId,"_").concat(dt(5,""))),_(this,"_userId",void 0),_(this,"_uintId",void 0),_(this,"_isDestroyed",!1),_(this,"store",void 0),_(this,"processor",void 0),_(this,"processorContext",void 0),this._userId=n,this._uintId=r,this.store=o}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,v.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Uu=(MO=fe({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),UO=fe({argsMap:e=>[e.getTrackId()]}),xO=fe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),VO=fe({argsMap:e=>[e.getTrackId()]}),K((Gr=class extends YO{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==mn.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r){super(e,t,n,r),_(this,"_videoVisibleTimer",null),_(this,"_previousVideoVisibleStatus",void 0),_(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),_(this,"trackMediaType","video"),_(this,"_videoWidth",void 0),_(this,"_videoHeight",void 0),_(this,"_player",void 0),_(this,"processorDestination",void 0),_(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new fI(this.getTrackId(),"remote"),this.processorDestination=new pI(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return $c(()=>{v.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),ti(this,_e.GET_STATS)||Mu({},by)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const r=document.getElementById(e);r?e=r:(v.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}v.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=Mu(Mu({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new sE(n):this._player=new qC(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Ma.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(Ma.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},L("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,v.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){lC(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(Tu)}_updatePlayerSource(){v.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:o,slot:a}=r;if(this.isPlaying&&o instanceof HTMLVideoElement&&a instanceof HTMLElement){const c=wA.checkOneElementVisible(o),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const h=de.reportApiInvoke(null,{tag:ft.TRACER,name:Pt.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(n){throw new N(I.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new N(I.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(gn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(gn.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}).prototype,"play",[MO],Object.getOwnPropertyDescriptor(Gr.prototype,"play"),Gr.prototype),K(Gr.prototype,"stop",[UO],Object.getOwnPropertyDescriptor(Gr.prototype,"stop"),Gr.prototype),K(Gr.prototype,"pipe",[xO],Object.getOwnPropertyDescriptor(Gr.prototype,"pipe"),Gr.prototype),K(Gr.prototype,"unpipe",[VO],Object.getOwnPropertyDescriptor(Gr.prototype,"unpipe"),Gr.prototype),Gr),xu=(jO=fe({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),FO=fe({argsMap:(e,t)=>[e.getTrackId(),t]}),BO=fe({argsMap:e=>[e.getTrackId()]}),GO=fe({argsMap:e=>[e.getTrackId()]}),WO=fe({argsMap:(e,t)=>[e.getTrackId(),t.name]}),HO=fe({argsMap:e=>[e.getTrackId()]}),K((On=class extends YO{get isPlaying(){return this._useAudioElement?sr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),_(this,"trackMediaType","audio"),_(this,"_source",void 0),_(this,"_useAudioElement",!0),_(this,"_volume",100),_(this,"processorContext",void 0),_(this,"processorDestination",void 0),_(this,"_played",!1),_(this,"_bypassWebAudio",!1),L("DISABLE_WEBAUDIO")?(this._source=new Ym,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new Wm(e,!0),L("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(zn.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Ma.FIRST_FRAME_DECODED)}),this.processorContext=new EI(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new mI(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(zn.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(zn.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(zn.ON_AUDIO_BUFFER),this._source.on(zn.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?sr.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement)throw new N(I.NOT_SUPPORTED,"your browser does not support setting the audio output device");await sr.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return $c(()=>{v.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),ti(this,_e.GET_STATS)||Mu({},Ny)}play(){v.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(v.debug("[".concat(this.getTrackId(),"] use audio element to play")),sr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){v.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?sr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];v.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&sr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new N(I.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new N(I.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new N(I.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(gn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(gn.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(gn.ON_TRACK),this.processorDestination.removeAllListeners(gn.ON_NODE)}}).prototype,"setVolume",[jO],Object.getOwnPropertyDescriptor(On.prototype,"setVolume"),On.prototype),K(On.prototype,"setPlaybackDevice",[FO],Object.getOwnPropertyDescriptor(On.prototype,"setPlaybackDevice"),On.prototype),K(On.prototype,"play",[BO],Object.getOwnPropertyDescriptor(On.prototype,"play"),On.prototype),K(On.prototype,"stop",[GO],Object.getOwnPropertyDescriptor(On.prototype,"stop"),On.prototype),K(On.prototype,"pipe",[WO],Object.getOwnPropertyDescriptor(On.prototype,"pipe"),On.prototype),K(On.prototype,"unpipe",[HO],Object.getOwnPropertyDescriptor(On.prototype,"unpipe"),On.prototype),On);function zO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function qO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zO(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class hB extends Et{constructor(){super(),_(this,"uplinkStatsUploadInterval",void 0),_(this,"uplinkRelatedStatsUploadInterval",void 0),_(this,"uplinkDenoiserStatsUploadInterval",void 0),_(this,"transportStatsUploadInterval",void 0),_(this,"uplinkExtensionStatsUploadInterval",void 0),_(this,"downlinkExtensionStatsUploadInterval",void 0),_(this,"extensionUsageStatsUploadInterval",void 0),_(this,"downlinkStatsUploadInterval",void 0),_(this,"downlinkRelatedStatsUploadInterval",void 0),_(this,"lastStats",void 0),_(this,"uploadUnplinkStarted",!1),_(this,"uploadDownlinkStarted",!1),_(this,"uploadTransportStarted",!1),_(this,"uploadExtensionUsageStarted",!1),_(this,"requestStats",void 0),_(this,"requestLocalMedia",void 0),_(this,"requestRemoteMedia",void 0),_(this,"requestAllTracks",void 0),_(this,"requestVideoIsReady",void 0),_(this,"requestUpload",void 0)}startUploadTransportStats(){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&this.uploadTransportStats(n)},1e3))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const t=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(async()=>{var n,r,o;const a=Date.now(),c={connectionInterval:L("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:a};let l=[];const h=((n=this.requestAllTracks)===null||n===void 0?void 0:n.call(this))||[];for(const T of h)!T.muted&&T.enabled&&(l=l.concat(await T.getProcessorUsage()));const f=((r=this.requestRemoteMedia)===null||r===void 0?void 0:r.call(this))||[];for(const[T,y]of f)y.has(Ce.VIDEO)&&T.videoTrack&&(l=l.concat(await T.videoTrack.getProcessorUsage())),y.has(Ce.AUDIO)&&T.audioTrack&&(l=l.concat(await T.audioTrack.getProcessorUsage()));if(l.length===0)return;c.details=function(T,y){const C={};for(const{id:U,value:q,level:ae,direction:X}of T){var A;const Q=(A=y.get(U))!==null&&A!==void 0?A:0,Y=q===2?Q+L("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:Q;var O,M;y.set(U,Y),C[U]?(q===2&&(C[U].value=q),ae>C[U].level&&(C[U].level=ae),X==="remote"&&(C[U].remoteUidCount+=1),C[U].totalTs=(O=y.get(U))!==null&&O!==void 0?O:0):C[U]={value:q,level:ae,remoteUidCount:X==="local"?0:1,totalTs:(M=y.get(U))!==null&&M!==void 0?M:0}}return Object.keys(C).map(U=>{const{level:q,value:ae,totalTs:X}=C[U];return{id:U,level:q,value:ae,totalTs:X}})}(l,t);const p=Date.now(),E=p>a?p:a+1;(o=this.requestUpload)===null||o===void 0||o.call(this,ir.EXTENSION_USAGE_STATS,{usageStats:c,sendTs:E})},L("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&(this.uploadUplinkStats(n),this.lastStats=n)},3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&this.uploadRelatedUplinkStats(n,this.lastStats),this.lastStats=n},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestAllTracks)===null||t===void 0?void 0:t.call(this);n&&this.uploadDenoiserStats(n)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestAllTracks)===null||t===void 0?void 0:t.call(this);n&&this.uploadExtensionStats(n)},2e3))}uploadTransportStats(t){Ci(()=>{var n;(n=this.requestUpload)===null||n===void 0||n.call(this,ir.TRANSPORT_STATS,function(r){const o={connectionType:100,googRtt:r.rtt};if(r.selectedCandidatePair.localCandidate.candidateType==="relay"){const a=r.selectedCandidatePair.localCandidate.relayProtocol;a==="udp"&&(o.connectionType=101),a==="tcp"&&(o.connectionType=103),a==="tls"&&(o.connectionType=104)}return o}(t))})}uploadUplinkStats(t){var n;(((n=this.requestLocalMedia)===null||n===void 0?void 0:n.call(this))||[]).forEach(r=>{let[o,{track:a,ssrcs:c}]=r;switch(o){case ce.LocalVideoLowTrack:case ce.LocalVideoTrack:{const l=function(p,E,T){var y;const C=E.videoSend.find(O=>O.ssrc===p);if(!C)return null;const A={id:dt(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:C.ssrc.toString()};switch(A.A_vstd=T._originMediaStreamTrack&&!T._originMediaStreamTrack.enabled||T._mediaStreamTrack&&!T._mediaStreamTrack.enabled?"1":"0",C.sentFrame&&(A.A_fhs=C.sentFrame.height.toString(),A.A_frs=C.sentFrame.frameRate.toString(),A.A_fws=C.sentFrame.width.toString()),C.adaptionChangeReason){case"none":A.A_ac="0";break;case"cpu":A.A_ac="1";break;case"bandwidth":A.A_ac="2";break;case"other":A.A_ac="3"}return A.A_lvps=Im[T._player?T._player.videoElementStatus:"uninit"].toString(),A.A_nr=(y=C.nacksCount)===null||y===void 0?void 0:y.toString(),C.avgEncodeMs&&(A.A_aem=C.avgEncodeMs.toFixed(0).toString()),A}(c[0].ssrcId,t,a),h=o===ce.LocalVideoTrack?function(p,E,T){var y,C,A,O,M,U,q,ae;const X=E.videoSend.find(pe=>pe.ssrc===p);if(!X)return null;const Q={id:dt(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:X.ssrc.toString()},Y=(y=(C=(A=X.inputFrame)===null||A===void 0?void 0:A.height)!==null&&C!==void 0?C:T==null?void 0:T._videoHeight)!==null&&y!==void 0?y:0,Z=(O=(M=(U=X.inputFrame)===null||U===void 0?void 0:U.width)!==null&&M!==void 0?M:T==null?void 0:T._videoWidth)!==null&&O!==void 0?O:0,Ge=(q=(ae=X.inputFrame)===null||ae===void 0?void 0:ae.frameRate)!==null&&q!==void 0?q:0;return Y&&(Q.A_fhi=Y+""),Z&&(Q.A_fwi=Z+""),Ge&&(Q.A_fri=Ge+""),Q}(c[0].ssrcId,t,a):null;l&&Ci(()=>{var p;return(p=this.requestUpload)===null||p===void 0?void 0:p.call(this,ir.PUBLISH_STATS,{stream_type:o===ce.LocalVideoLowTrack?"low":"high",stats:qO(qO({},l),h)})});const f=function(p){const E={id:"bweforvideo",timestamp:new Date(p.timestamp).toISOString(),type:"VideoBwe"};return p.bitrate.retransmit&&(E.A_rb=p.bitrate.retransmit.toString()),p.bitrate.targetEncoded&&(E.A_teb=p.bitrate.targetEncoded.toString()),E.A_aeb=p.bitrate.actualEncoded.toString(),E.A_tb=p.bitrate.transmit.toString(),p.sendBandwidth!==void 0&&(E.A_asb=p.sendBandwidth.toString()),E}(t);f&&setTimeout(()=>{var p;return(p=this.requestUpload)===null||p===void 0?void 0:p.call(this,ir.PUBLISH_STATS,{stream_type:o===ce.LocalVideoLowTrack?"low":"high",stats:f})},1e3);break}case ce.LocalAudioTrack:{const l=function(h,f,p){const E=f.audioSend.find(y=>y.ssrc===h);if(!E)return null;const T={id:dt(10,""),timestamp:new Date(f.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:E.ssrc.toString()};return T.A_astd=p._originMediaStreamTrack&&!p._originMediaStreamTrack.enabled||p._mediaStreamTrack&&!p._mediaStreamTrack.enabled?"1":"0",E.inputLevel?T.A_ail=Math.round(100*E.inputLevel).toString():T.A_ail=Math.round(100*p._source.getAccurateVolumeLevel()).toString(),T.A_apil=Math.round(100*p._source.getAccurateVolumeLevel()).toString(),E.aecReturnLoss&&(T.A_ecrl=Math.round(E.aecReturnLoss).toString()),E.aecReturnLossEnhancement&&(T.A_ecrle=Math.round(E.aecReturnLossEnhancement).toString()),T}(c[0].ssrcId,t,a);l&&Ci(()=>{var h;return(h=this.requestUpload)===null||h===void 0?void 0:h.call(this,ir.PUBLISH_STATS,{stream_type:"high",stats:l})});break}}})}uploadRelatedUplinkStats(t,n){var r;(((r=this.requestLocalMedia)===null||r===void 0?void 0:r.call(this))||[]).filter(o=>{let[a]=o;return a===ce.LocalVideoLowTrack||a===ce.LocalVideoTrack}).forEach(o=>{let[a,{ssrcs:c}]=o;const l=function(h,f){const p=f.videoSend.find(E=>E.ssrc===h);return p?{mediaType:"video",isVideoMute:!1,frameRateInput:p.inputFrame&&p.inputFrame.frameRate.toString(),frameRateSent:p.sentFrame&&p.sentFrame.frameRate.toString(),googRtt:p.rttMs.toString(),qpSumPerFrame:Math.floor(p.qpSumPerFrame).toString()}:null}(c[0].ssrcId,t);l&&Ci(()=>{var h;(h=this.requestUpload)===null||h===void 0||h.call(this,ir.PUBLISH_RELATED_STATS,{stream_type:a===ce.LocalVideoLowTrack?"low":"high",stats:l})})})}uploadDenoiserStats(t){for(let a=0;a<t.length;a++){const c=t[a];if(c instanceof Eu){var n,r,o;const l=(n=(r=c._external).getDenoiserStats)===null||n===void 0?void 0:n.call(r);return void(l&&((o=this.requestUpload)===null||o===void 0||o.call(this,ir.DENOISER_STATS,l)))}}}uploadExtensionStats(t){for(let n=0;n<t.length;n++)t[n].getProcessorStats().forEach(r=>{var o;(o=this.requestUpload)===null||o===void 0||o.call(this,r.type,r.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let t;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let n=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var r;const o=(r=this.requestStats)===null||r===void 0?void 0:r.call(this);o&&(this.uploadDownlinkStats(o,n,t),t=o),n=!n},3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var r;const o=(r=this.requestStats)===null||r===void 0?void 0:r.call(this);o&&(this.uploadRelatedDownlinkStats(o,this.lastStats),this.lastStats=o)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var r;const o=(r=this.requestRemoteMedia)===null||r===void 0?void 0:r.call(this);o&&this.uploadDownlinkExtensionStats(o)},2e3)}uploadDownlinkStats(t,n,r){var o;(((o=this.requestRemoteMedia)===null||o===void 0?void 0:o.call(this))||[]).forEach(a=>{let[c,l]=a;if(l.has(Ce.VIDEO)&&c.videoTrack){const h=c.videoTrack?function(f,p,E,T,y){const C=p.videoRecv.find(U=>U.ssrc===f);if(!C)return null;const A={id:dt(10,""),timestamp:new Date(p.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:C.ssrc.toString()};var O,M;if(A.bytesReceived=C.bytes.toString(),A.packetsLost=C.packetsLost.toString(),A.packetsReceived=C.packets.toString(),C.framesRateFirefox&&(A.A_frr=C.framesRateFirefox.toString()),C.receivedFrame?(A.A_frr=C.receivedFrame.frameRate.toString(),A.A_fhr=C.receivedFrame.height.toString(),A.A_fwr=C.receivedFrame.width.toString()):(A.A_fhr=(O=T._videoHeight)===null||O===void 0?void 0:O.toString(),A.A_fwr=(M=T._videoWidth)===null||M===void 0?void 0:M.toString()),A.A_frd=C.decodeFrameRate.toString(),C.outputFrame&&(A.A_fro=C.outputFrame.frameRate.toString()),C.jitterBufferMs!==void 0&&(A.A_jbm=Math.floor(C.jitterBufferMs).toString()),C.currentDelayMs!==void 0&&(A.A_cdm=Math.floor(C.currentDelayMs).toString()),A.A_fs=C.firsCount.toString(),A.A_ns=C.nacksCount.toString(),A.A_ps=C.plisCount.toString(),T&&(A.A_vrtd=T._originMediaStreamTrack.enabled&&T._mediaStreamTrack.enabled?"0":"1"),T._player&&T._player.freezeTimeCounterList.length>0&&(A.A_vrft=Math.round(T._player.freezeTimeCounterList.splice(0,1)[0]).toString()),y&&T._player&&so.visibility==="visible"){const U=Math.min(6e3,T._player.renderFreezeAccTime);A.A_vrrft=Math.round(U).toString(),T._player.renderFreezeAccTime=Math.max(0,T._player.renderFreezeAccTime-U)}if(A.A_rvps=Im[T._player?T._player.videoElementStatus:"uninit"].toString(),E){const U=E.videoRecv.find(q=>q.ssrc===f);if(U&&C.totalInterFrameDelay!==void 0&&C.totalSquaredInterFrameDelay!==void 0&&U.totalInterFrameDelay!==void 0&&U.totalSquaredInterFrameDelay!==void 0){const q=C.totalInterFrameDelay-U.totalInterFrameDelay,ae=C.totalSquaredInterFrameDelay-U.totalSquaredInterFrameDelay,X=C.framesDecodeCount-U.framesDecodeCount,Q=q/X*1e3,Y=Math.round(1e3*Math.sqrt((ae-Math.pow(q,2)/X)/X));!isNaN(Y)&&Q+Y>Math.max(3*Q,Q+150)&&(A.A_ifdsd=Y.toString())}}return A}(c._videoSSRC,t,r,c.videoTrack,n):void 0;h&&Ci(()=>{var f;return(f=this.requestUpload)===null||f===void 0?void 0:f.call(this,ir.SUBSCRIBE_STATS,{stream_id:c.uid,stats:h})})}if(l.has(Ce.AUDIO)&&c.audioTrack){const h=c.audioTrack?function(f,p,E,T){const y=p.audioRecv.find(A=>A.ssrc===f);if(!y)return null;const C={id:dt(10,""),timestamp:new Date(p.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:y.ssrc.toString()};if(C.bytesReceived=y.bytes.toString(),C.packetsLost=y.packetsLost.toString(),C.packetsReceived=y.packets.toString(),y.outputLevel?C.A_aol=Math.round(100*y.outputLevel).toString():C.A_aol=Math.round(100*T._source.getAccurateVolumeLevel()).toString(),C.A_apol=Math.round(100*T._source.getAccurateVolumeLevel()).toString(),T&&(C.A_artd=T._originMediaStreamTrack.enabled&&T._mediaStreamTrack.enabled?"0":"1"),C.A_jr=y.jitterMs.toString(),C.A_jbm=Math.floor(y.jitterBufferMs).toString(),C.A_cdm=Math.floor(y.jitterBufferMs).toString(),C.A_raps=Im[sr.getPlayerState(T.getTrackId())].toString(),E){const A=E.audioRecv.find(O=>O.ssrc===f);if(A){const O=y.concealedSamples-A.concealedSamples;O>0&&(C.A_cs=Math.round(O).toString())}}return C}(c._audioSSRC,t,r,c.audioTrack):void 0;h&&Ci(()=>{var f;return(f=this.requestUpload)===null||f===void 0?void 0:f.call(this,ir.SUBSCRIBE_STATS,{stream_id:c.uid,stats:h})})}})}uploadRelatedDownlinkStats(t,n){var r;(((r=this.requestRemoteMedia)===null||r===void 0?void 0:r.call(this))||[]).forEach(o=>{let[a,c]=o;if(c.has(Ce.VIDEO)&&a.videoTrack){var l;const h=(a._videoSSRC&&((l=this.requestVideoIsReady)===null||l===void 0?void 0:l.call(this,a._videoSSRC))||!1)===!0,f=function(p,E,T,y,C,A){const O=T.videoRecv.find(ae=>ae.ssrc===p),M=C?C.videoRecv.find(ae=>ae.ssrc===p):void 0;if(!O)return null;const U=Fa.isRemoteVideoFreeze(A,O,M)&&E,q={mediaType:"video",isVideoMute:!1,peerId:y,frameRateReceived:O.receivedFrame&&O.receivedFrame.frameRate.toString(),frameRateDecoded:O.decodedFrame&&O.decodedFrame.frameRate.toString(),isFreeze:U,bytesReceived:O.bytes.toString(),packetsReceived:O.packets.toString(),packetsLost:O.packetsLost.toString(),qpSumPerFrame:Math.floor(O.qpSumPerFrame).toString()};return O.framesRateFirefox&&(q.frameRateDecoded=O.framesRateFirefox.toString(),q.frameRateReceived=O.framesRateFirefox.toString()),q}(a._videoSSRC,h,t,a.uid,n,a.videoTrack);f&&Ci(()=>{var p;(p=this.requestUpload)===null||p===void 0||p.call(this,ir.SUBSCRIBE_RELATED_STATS,{stream_id:a.uid,stats:f})})}if(c.has(Ce.AUDIO)&&a.audioTrack){const h=function(f,p,E,T){const y=p.audioRecv.find(A=>A.ssrc===f);if(!y)return null;const C=Fa.isRemoteAudioFreeze(T);return{mediaType:"audio",isAudioMute:!1,peerId:E,googJitterReceived:y.jitterMs.toString(),isFreeze:C,bytesReceived:y.bytes.toString(),packetsReceived:y.packets.toString(),packetsLost:y.packetsLost.toString(),frameReceived:y.receivedFrames.toString(),frameDropped:y.droppedFrames.toString()}}(a._audioSSRC,t,a.uid,a.audioTrack);h&&Ci(()=>{var f;(f=this.requestUpload)===null||f===void 0||f.call(this,ir.SUBSCRIBE_RELATED_STATS,{stream_id:a.uid,stats:h})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(t){t.forEach(n=>{let[r,o]=n;o.has(Ce.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach(a=>{var c;(c=this.requestUpload)===null||c===void 0||c.call(this,a.type,a.stats)}),o.has(Ce.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach(a=>{var c;(c=this.requestUpload)===null||c===void 0||c.call(this,a.type,a.stats)})})}}function JO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function XO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?JO(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const QO=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,Vu="9",PE=2e4,LE=4e4;class pB{get localCapabilities(){return Mt(this._localCapabilities)}get rtpCapabilities(){return Mt(this._rtpCapabilities)}get candidates(){return Mt(this._candidates)}get iceParameters(){return Mt(this._iceParameters)}get dtlsParameters(){return Mt(this._dtlsParameters)}constructor(t){_(this,"sessionDesc",void 0),_(this,"_localCapabilities",void 0),_(this,"_rtpCapabilities",void 0),_(this,"_candidates",void 0),_(this,"_iceParameters",void 0),_(this,"_dtlsParameters",void 0),_(this,"setup",void 0),_(this,"currentMidIndex",void 0),_(this,"cname",void 0),_(this,"firefoxSsrcMidMap",new Map),t=Mt(t);const{remoteIceParameters:n,remoteDtlsParameters:r,candidates:o,remoteRTPCapabilities:a,remoteSetup:c,localCapabilities:l,cname:h}=t,f=xt.exports.parse(QO);this._rtpCapabilities=a,this._candidates=o,this._iceParameters=n,this._dtlsParameters=r,this._localCapabilities=l,this.setup=c,this.cname=h;const p=this.rtpCapabilities.send;for(const E of f.mediaDescriptions){if(E.attributes.iceUfrag=n.iceUfrag,E.attributes.icePwd=n.icePwd,E.attributes.fingerprints=r.fingerprints,E.attributes.candidates=o,E.attributes.setup=c,E.media.mediaType==="application"&&(E.attributes.sctpPort="5000"),E.media.mediaType==="video"&&(E.media.fmts=p.videoCodecs.map(T=>T.payloadType.toString(10)),E.attributes.payloads=p.videoCodecs,E.attributes.extmaps=p.videoExtensions,L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:T,ssrcGroups:y}=jr([{ssrcId:LE,rtx:L("USE_SUB_RTX")?40001:void 0}],this.cname);E.attributes.ssrcs=T,E.attributes.ssrcGroups=y}if(E.media.mediaType==="audio"&&(E.media.fmts=p.audioCodecs.map(T=>T.payloadType.toString(10)),E.attributes.payloads=p.audioCodecs,E.attributes.extmaps=p.audioExtensions,Ho(E),L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:T,ssrcGroups:y}=jr([{ssrcId:PE}],this.cname);E.attributes.ssrcs=T,E.attributes.ssrcGroups=y}}this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}updateRemoteRTPCapabilities(t){const n=xt.exports.parse(QO);this._rtpCapabilities=t;const r=this.rtpCapabilities.send;for(const o of n.mediaDescriptions){if(o.attributes.iceUfrag=this._iceParameters.iceUfrag,o.attributes.icePwd=this._iceParameters.icePwd,o.attributes.fingerprints=this._dtlsParameters.fingerprints,o.attributes.candidates=this._candidates,o.attributes.setup=this.setup,o.media.mediaType==="application"&&(o.attributes.sctpPort="5000"),o.media.mediaType==="video"&&(o.media.fmts=r.videoCodecs.map(a=>a.payloadType.toString(10)),o.attributes.payloads=r.videoCodecs,o.attributes.extmaps=r.videoExtensions,L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:a,ssrcGroups:c}=jr([{ssrcId:LE,rtx:L("USE_SUB_RTX")?40001:void 0}],this.cname);o.attributes.ssrcs=a,o.attributes.ssrcGroups=c}if(o.media.mediaType==="audio"&&(o.media.fmts=r.audioCodecs.map(a=>a.payloadType.toString(10)),o.attributes.payloads=r.audioCodecs,o.attributes.extmaps=r.audioExtensions,L("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:a,ssrcGroups:c}=jr([{ssrcId:PE}],this.cname);o.attributes.ssrcs=a,o.attributes.ssrcGroups=c}}this.sessionDesc=n,this.currentMidIndex=n.mediaDescriptions.length-1}preloadRemoteMedia(t){this.rtpCapabilities;const n=this.candidates,r=this.dtlsParameters,o=this.iceParameters,a=this.rtpCapabilities.send;for(let c=1;c<t;c++){const l=2*c+PE,h=2*c+LE,{ssrcs:f,ssrcGroups:p}=jr([{ssrcId:l}],this.cname),{ssrcs:E,ssrcGroups:T}=jr([{ssrcId:h,rtx:L("USE_SUB_RTX")?h+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Vu,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.videoCodecs.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:n,extmaps:a.videoExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:T,rtcpFeedbackWildcards:[],payloads:a.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*c-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Vu,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.audioCodecs.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:n,extmaps:a.audioExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:f,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:a.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*c)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return xt.exports.print(this.sessionDesc)}send(t,n,r,o){const{ssrcs:a,ssrcGroups:c}=jr(n,this.cname,L("SYNC_GROUP")?r:void 0),l=this.findPreloadMediaDesc(a);if(l){if(gt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,l.attributes.mid),o&&(o.twcc||o.remb)){const h=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(l,o),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const h=this.findAvailableMediaIndex(t,a);let f;return h===-1||Dn()||Pn()||CR()||h===0&&L("USE_SUB_RTX")?(f=this.createOrRecycleSendMedia(t,a,c,"sendonly",o),this.updateBundleMids()):(f=Mt(this.sessionDesc.mediaDescriptions[h]),f.attributes.direction="sendonly",f.attributes.ssrcs=a,f.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(f,o)),gt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,f.attributes.mid),{mid:f.attributes.mid,needExchangeSDP:!0}}}batchSend(t){const n=t.map(a=>{let{kind:c,ssrcMsg:l,mslabel:h}=a;return this.send(c,l,h)}),r=[];let o=!1;return n.forEach(a=>{let{mid:c,needExchangeSDP:l}=a;l&&(o=!0),r.push(c)}),{mids:r,needExchangeSDP:o}}stopSending(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&t.indexOf(r.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(r=>{r.attributes.mid==="0"||gt()||Dn()||Pn()?r.attributes.ssrcs=[]:(r.attributes.ssrcs=[],r.attributes.direction="inactive",r.media.port="0")}),this.updateBundleMids()}mute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>t.includes(r.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>t.includes(r.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(r=>{r.attributes.direction="recvonly"})}receive(t,n,r,o){t.forEach((a,c)=>{this.createOrRecycleRecvMedia(a,[],"recvonly",n,r,o[c])}),this.updateBundleMids()}stopReceiving(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>t.indexOf(r.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(t){t===sn.TCP?this._candidates.forEach(n=>{this._candidates.findIndex(r=>r.transport==="tcp"&&r.connectionAddress===n.connectionAddress&&r.port===n.port)===-1&&this._candidates.push(XO(XO({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}):this._candidates=this._candidates.filter(n=>n.transport!=="tcp");for(const n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(t){t=Mt(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}findAvailableMediaIndex(t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const o=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(gt()){if(o){const a=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(a||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!a||a!==r.attributes.mid)}return!1}return o})}createOrRecycleRecvMedia(t,n,r,o,a,c){const l=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,f=this.localCapabilities.send;let p=[];if(l===Ce.VIDEO){var E,T;if(L("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(p=h.videoCodecs.filter(M=>{var U,q;return(((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())||"").includes(o)&&(M==null||(q=M.fmtp)===null||q===void 0?void 0:q.parameters["profile-level-id"])===L("H264_PROFILE_LEVEL_ID")})),!p||((E=p)===null||E===void 0?void 0:E.length)===0){const M=f.videoCodecs.filter(U=>{var q;return(((q=U.rtpMap)===null||q===void 0?void 0:q.encodingName.toLowerCase())||"").includes(o)});M.length!==0&&(p=h.videoCodecs.filter(U=>M.some(q=>q.payloadType===U.payloadType)))}if(L("USE_PUB_RTX")){const M=p.map(q=>q.payloadType.toString()),U=h.videoCodecs.filter(q=>{var ae,X;return((ae=q.rtpMap)===null||ae===void 0?void 0:ae.encodingName)==="rtx"&&M.includes(((X=q.fmtp)===null||X===void 0?void 0:X.parameters.apt)||"")});p=[...p,...U]}p.length===0&&(v.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat((T=h.videoCodecs[0].rtpMap)===null||T===void 0?void 0:T.encodingName)),p=h.videoCodecs)}else p=h.audioCodecs.filter(M=>{var U;return(((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())||"").includes(a)}),p.length===0&&(v.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),p=h.audioCodecs.filter(M=>{var U;return(((U=M.rtpMap)===null||U===void 0?void 0:U.encodingName.toLowerCase())||"").includes("opus")}));const y=l===Ce.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const C="".concat(this.currentMidIndex);let A={media:{mediaType:l,port:Vu,protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(M=>M.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(C)}};A=this.mungRecvMediaDsec(A,t,c);const O=this.findFirstClosedMedia(l);if(O){const M=this.sessionDesc.mediaDescriptions.indexOf(O);this.sessionDesc.mediaDescriptions[M]=A}else this.sessionDesc.mediaDescriptions.push(A);return A}createOrRecycleSendMedia(t,n,r,o,a){const c=this.rtpCapabilities.send,l=t===Ce.VIDEO?c.videoCodecs:c.audioCodecs,h=t===Ce.VIDEO?c.videoExtensions:c.audioExtensions;this.currentMidIndex+=1;const f="".concat(this.currentMidIndex);let p={media:{mediaType:t,port:Vu,protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};p=this.mungSendMediaDesc(p,a);const E=this.findFirstClosedMedia(t);if(E){const T=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[T]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,n,r){const o=Mt(t);return AE(o),za(o,n),OE(o,n),pO(o),Pu(o,r,this.localCapabilities.send),o}mungSendMediaDesc(t,n){const r=Mt(t);return Pu(r,n,this.localCapabilities.recv),Ho(r),r}updateRecvMedia(t,n){const r=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(r!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=o}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(n=>gt()?n.media.port==="0"&&n.media.mediaType===t:n.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(n=>{var r,o;return((r=n.attributes)===null||r===void 0||(o=r.ssrcs[0])===null||o===void 0?void 0:o.ssrcId)===t[0].ssrcId})}getSSRC(t){var n;return(n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t))===null||n===void 0?void 0:n.attributes.ssrcs}}var qe;function $O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function ju(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$O(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$O(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let fB=(K((qe=class Th extends uu{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,n,r){super(t,n),_(this,"store",void 0),_(this,"peerConnection",void 0),_(this,"remoteSDP",void 0),_(this,"initialOffer",void 0),_(this,"transportEventReceiver",void 0),_(this,"statsFilter",void 0),_(this,"localCapabilities",void 0),_(this,"localCandidateCount",0),_(this,"allCandidatesReceived",!1),_(this,"establishPromise",void 0),_(this,"mutex",new Mn("NVExtentionsConnection-mutex")),_(this,"rtcMedia",void 0),this.store=n,this.peerConnection=r,this.statsFilter=DE(this.peerConnection,L("STATS_UPDATE_INTERVAL"),void 0,gt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(t){try{const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Ws(n.sdp),o=await mO(!L("USE_PUB_RTX")&&!L("USE_SUB_RTX"),L("FILTER_VIDEO_FEC"),L("FILTER_AUDIO_FEC"));return this.localCapabilities=o,this.initialOffer=n,ju(ju({},r),{},{rtpCapabilities:o,offerSDP:n.sdp})}catch(n){throw new N(I.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t,n,r,o,a,c){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new pB({remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:o,remoteSetup:a,localCapabilities:wE(this.localCapabilities),cname:c});const l=this.remoteSDP.toString(),h=xt.exports.parse(this.initialOffer.sdp),f=h.mediaDescriptions.find(T=>T.media.mediaType==="audio");f&&Ho(f);const p=xt.exports.print(h),E=this.logSDPExchange(p||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:p}),E==null||E(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(l){throw new N(I.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(l.toString()))}}async updateRemoteConnect(t){var n,r,o;(n=this.remoteSDP)===null||n===void 0||n.updateRemoteRTPCapabilities(t),(r=this.remoteSDP)===null||r===void 0||r.preloadRemoteMedia(2);const a=(o=this.remoteSDP)===null||o===void 0?void 0:o.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),v.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(t,n,r){var o=this;return ni(function*(){const a=yield Le(o.mutex.lock("From NVExtentionsConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const c=[];t.forEach(A=>{const O=o.peerConnection.addTransceiver(A._mediaStreamTrack,{direction:"sendonly"});c.push(O)}),gt()&&L("SIMULCAST")===!0&&(yield Le(o.applySimulcastForFirefox(c,t)));const l=yield Le(o.peerConnection.createOffer()),h=o.remoteSDP.predictReceivingMids(t.length),f=o.mungSendOfferSDP(l.sdp,t,h),p=xt.exports.parse(f),E=h.map(A=>{const O=p.mediaDescriptions.find(M=>M.attributes.mid===A);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return uO(O,L("USE_PUB_RTX"))});let T;try{T=yield E}catch(A){T=[],o.remoteSDP.receive(t,n,r,T);const O=o.remoteSDP.toString();throw yield Le(o.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Le(o.peerConnection.setRemoteDescription({type:"answer",sdp:O})),yield Le(o.stopSending(h,!0)),A}o.remoteSDP.receive(t,n,r,T);const y=o.remoteSDP.toString(),C=o.logSDPExchange(f,"offer","local","send");return yield Le(o.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield Le(o.applySimulcastEncodings(c,t)),yield Le(o.applySendEncodings(c,t)),C==null||C(y),yield Le(o.peerConnection.setRemoteDescription({type:"answer",sdp:y})),c.map((A,O)=>{const M=h[O];return{localSSRC:E[O],id:M,transceiver:A}})}catch(c){throw c instanceof N?c:new N(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");o.map(h=>{var f;h.direction="inactive",(f=h.stop)===null||f===void 0||f.call(h)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(o){throw new N(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(o.toString()))}finally{r&&r()}}async receive(t,n,r,o){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(t,n,r,o);if(c){const h=this.remoteSDP.toString(),f=this.logSDPExchange(h,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(p.sdp,a,t);f==null||f(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),v.debug("[NVExtentionsConnection] receive ".concat(t," by exchanging SDP."))}else v.debug("[NVExtentionsConnection] receive ".concat(t," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(h=>h.mid===a);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:a}}catch(a){throw new N(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(a.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);if(r){const o=this.remoteSDP.toString(),a=this.logSDPExchange(o,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c),v.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else v.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return n.map(o=>{const a=this.peerConnection.getTransceivers().find(c=>c.mid===o);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:o}})}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();r==null||r(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();r==null||r(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();r==null||r(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const r=await this.peerConnection.createOffer(),o=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,l)=>{c.direction="sendonly"});const r=await this.peerConnection.createOffer(),o=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return ni(function*(){const r=yield Le(n.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ot().supportPCSetConfiguration){const f=n.peerConnection.getConfiguration(),p=t===sn.RELAY?"relay":"all";f.iceTransportPolicy!==p&&(v.debug("restartICE change iceTransportPolicy from [".concat(f.iceTransportPolicy,"] to [").concat(p,"]")),f.iceTransportPolicy=p,n.peerConnection.setConfiguration(f))}else if(t===sn.RELAY)return;t!==sn.RELAY&&n.remoteSDP.updateCandidates(t);const o=yield Le(n.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=Ws(o.sdp),{remoteIceParameters:c}=yield a.iceParameters;n.remoteSDP.restartICE(c);const l=n.remoteSDP.toString(),h=n.logSDPExchange(o.sdp||"","offer","local","restartICE");yield Le(n.peerConnection.setLocalDescription(o)),h==null||h(l),yield Le(n.peerConnection.setRemoteDescription({type:"answer",sdp:l}))}catch(o){v.warning("restart ICE failed, abort operation",o)}finally{r()}})()}close(){var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const a=this.remoteSDP.toString(),c=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(r){throw new N(I.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(o=>o.mid===t);r.length===1&&(this.isVP8Simulcast(n)?gt()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(o=>o.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}getP2PConnectionParams(){var t;if((t=this.peerConnection.currentLocalDescription)===null||t===void 0||!t.sdp||!this.localCapabilities)throw new Error;return ju(ju({},Ws(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},L("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(qc(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...Th.turnServerConfigToIceServers(t.turnServer.servers)),L("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Th.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),L("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(gu(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!L("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}async applySendEncodings(t,n){try{if(!Ot().supportSetRtpSenderParameters||t.length!==n.length)return;for(let f=0;f<t.length;f++){const p=t[f],E=n[f];if(E&&E instanceof Ut){var r,o;if(this.isVP8Simulcast(E))continue;const T={},y={};switch(E._optimizationMode){case"motion":T.degradationPreference="maintain-framerate";break;case"detail":T.degradationPreference="maintain-resolution";break;default:T.degradationPreference="balanced"}var a,c,l,h;if((r=E._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&(y.maxBitrate=1e3*((a=E._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)),E._hints.includes(Wt.LOW_STREAM)&&((c=E._encoderConfig)!==null&&c!==void 0&&c.frameRate&&(y.maxFramerate=ao(E._encoderConfig.frameRate)),(l=E._encoderConfig)!==null&&l!==void 0&&l.scaleResolutionDownBy&&((h=E._encoderConfig)===null||h===void 0?void 0:h.scaleResolutionDownBy)>1&&(y.scaleResolutionDownBy=E._encoderConfig.scaleResolutionDownBy)),L("DSCP_TYPE")&&Ns()){const O=L("DSCP_TYPE");["very-low","low","medium","high"].includes(O)&&(y.networkPriority=O)}const C=p.sender.getParameters(),A=(o=C.encodings)===null||o===void 0?void 0:o[0];gt()&&!A&&(T.encodings=[y]),A&&Object.assign(A,y),Object.assign(C,T),await p.sender.setParameters(C)}}}catch{v.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,n,r){const o=xt.exports.parse(t);return n.forEach((a,c)=>{const l=r[c],h=o.mediaDescriptions.find(f=>f.attributes.mid===l);h&&(za(h,a),fO(h,a,this.store.codec))}),xt.exports.print(o)}mungReceiveAnswerSDP(t,n,r){const o=xt.exports.parse(t),a=o.mediaDescriptions.find(c=>c.attributes.mid===n);return a&&r===Ce.AUDIO&&a.media.mediaType==="audio"&&Ho(a),xt.exports.print(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var r,o,a,c;const h=t[l],f=n[l];if(f instanceof Ut&&!f._hints.includes(Wt.LOW_STREAM)&&(r=f._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((o=f._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(a=f._scalabiltyMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=f._scalabiltyMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const p={},E={high:1e3*(f._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const T=h.sender.getParameters();await h.sender.setParameters(Object.assign(T,p))}}}async applySimulcastEncodings(t,n){if(!gt()&&t.length===n.length)for(let r=0;r<t.length;r++){const o=n[r];if(o instanceof Ut&&this.isVP8Simulcast(o)){const a=t[r],c={},l={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const h=a.sender.getParameters();await a.sender.setParameters(Object.assign(h,c))}}}isVP8Simulcast(t){var n,r,o,a;return!!(t instanceof Ut&&L("SIMULCAST")&&this.store.codec==="vp8"&&!t._hints.includes(Wt.LOW_STREAM)&&(n=t._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((r=t._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(o=t._scalabiltyMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=t._scalabiltyMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,n,r,o){if(L("SDP_LOGGING"))return v.upload("exchanging ".concat(r," ").concat(n," SDP during NVExtentionsConnection.").concat(o,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",r==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Ot().supportPCSetConfiguration){const n=Th.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[Ir],Object.getOwnPropertyDescriptor(qe.prototype,"connect"),qe.prototype),K(qe.prototype,"updateRemoteConnect",[Ir],Object.getOwnPropertyDescriptor(qe.prototype,"updateRemoteConnect"),qe.prototype),K(qe.prototype,"receive",[Ir],Object.getOwnPropertyDescriptor(qe.prototype,"receive"),qe.prototype),K(qe.prototype,"batchReceive",[Ir],Object.getOwnPropertyDescriptor(qe.prototype,"batchReceive"),qe.prototype),K(qe.prototype,"stopReceiving",[Ir],Object.getOwnPropertyDescriptor(qe.prototype,"stopReceiving"),qe.prototype),K(qe.prototype,"muteRemote",[Ir],Object.getOwnPropertyDescriptor(qe.prototype,"muteRemote"),qe.prototype),K(qe.prototype,"unmuteRemote",[Ir],Object.getOwnPropertyDescriptor(qe.prototype,"unmuteRemote"),qe.prototype),K(qe.prototype,"muteLocal",[Ir],Object.getOwnPropertyDescriptor(qe.prototype,"muteLocal"),qe.prototype),K(qe.prototype,"unmuteLocal",[Ir],Object.getOwnPropertyDescriptor(qe.prototype,"unmuteLocal"),qe.prototype),K(qe.prototype,"close",[Ir],Object.getOwnPropertyDescriptor(qe.prototype,"close"),qe.prototype),K(qe.prototype,"updateEncoderConfig",[Ir],Object.getOwnPropertyDescriptor(qe.prototype,"updateEncoderConfig"),qe.prototype),K(qe.prototype,"updateSendParameters",[Ir],Object.getOwnPropertyDescriptor(qe.prototype,"updateSendParameters"),qe.prototype),K(qe.prototype,"replaceTrack",[Ir],Object.getOwnPropertyDescriptor(qe.prototype,"replaceTrack"),qe.prototype),K(qe.prototype,"getRemoteSSRC",[Ir],Object.getOwnPropertyDescriptor(qe.prototype,"getRemoteSSRC"),qe.prototype),qe);function Ir(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("From NVExtentionsConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];return await r.apply(this,l)}finally{a()}},n}var ot;function ZO(e){var t,n,r,o=2;for(typeof Symbol<"u"&&(n=cO,r=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new kE(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function kE(e){function t(n){if(Object(n)!==n)return se.reject(new TypeError(n+" is not an object."));var r=n.done;return se.resolve(n.value).then(function(o){return{value:o,done:r}})}return(kE=function(n){this.s=n,this.n=n.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?se.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?se.reject(n):t(r.apply(this.s,arguments))}},new kE(e)}let Yo=(K((ot=class vh extends uu{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,n){super(t,n),_(this,"store",void 0),_(this,"peerConnection",void 0),_(this,"cname",void 0),_(this,"mutex",new Mn("DataChannelConnection-mutex")),_(this,"dataChannel",void 0),_(this,"_p2pConnection",void 0),_(this,"establishPromise",void 0),_(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(vh.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new fB(t,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var t;const n=(t=this._nvMedia)===null||t===void 0?void 0:t.getLocalRtpCapabilities();return await this._p2pConnection.establish(n)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(t,n,r,o,a,c){return this.cname=c,await this._p2pConnection.connect(t,n,r,o,a,c),await new se((l,h)=>{const f=setTimeout(()=>{this.closeSignal(),h(new N(I.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(r))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(f),void l()},this.dataChannel.onerror=p=>{this.closeSignal(),h(p)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}send(t,n,r){var o=this;return ni(function*(){const a=yield Le(o.mutex.lock("From DataChannelConnection.send"));try{return yield*Du(ZO(o._p2pConnection.send(t,n,r)),Le)}finally{a()}})()}async stopSending(t,n){return this._p2pConnection.stopSending(t,n)}async receive(t,n,r,o){return this._nvMedia?(v.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,n,this.cname)):(v.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,n,r,o))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var n=this;return ni(function*(){return yield*Du(ZO(n._p2pConnection.restartICE(t)),Le)})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var n;(n=this._nvMedia)===null||n===void 0||n.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,n){return await this._p2pConnection.updateEncoderConfig(t,n)}async updateSendParameters(t,n){return await this._p2pConnection.updateSendParameters(t,n)}setStatsRemoteVideoIsReady(t,n){this._p2pConnection.setStatsRemoteVideoIsReady(t,n)}async replaceTrack(t,n){return await this._p2pConnection.replaceTrack(t,n)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,n,r,o){if(L("SDP_LOGGING"))return v.upload("exchanging ".concat(r," ").concat(n," SDP during DataChannelConnection.").concat(o,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",r==="local"?"remote":"local",o)}:void 0}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(qc(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...vh.turnServerConfigToIceServers(t.turnServer.servers)),L("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...vh.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),L("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(gu(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!L("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var n;return(n=this.onICEConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var n;return(n=this.onConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var n;return(n=this.onDTLSTransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var n;return(n=this.onDTLSTransportError)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var n;return(n=this.onICETransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var n;return(n=this.onFirstAudioReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var n;return(n=this.onFirstVideoReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var n;return(n=this.onFirstAudioDecoded)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,n,r)=>{var o;return(o=this.onFirstVideoDecoded)===null||o===void 0?void 0:o.call(this,t,n,r)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var n;return(n=this.onFirstVideoDecodedTimeout)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,n)=>{var r;return(r=this.onSelectedLocalCandidateChanged)===null||r===void 0?void 0:r.call(this,t,n)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,n)=>{var r;return(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0?void 0:r.call(this,t,n)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}}).prototype,"connect",[ii],Object.getOwnPropertyDescriptor(ot.prototype,"connect"),ot.prototype),K(ot.prototype,"receive",[ii],Object.getOwnPropertyDescriptor(ot.prototype,"receive"),ot.prototype),K(ot.prototype,"stopReceiving",[ii],Object.getOwnPropertyDescriptor(ot.prototype,"stopReceiving"),ot.prototype),K(ot.prototype,"muteRemote",[ii],Object.getOwnPropertyDescriptor(ot.prototype,"muteRemote"),ot.prototype),K(ot.prototype,"unmuteRemote",[ii],Object.getOwnPropertyDescriptor(ot.prototype,"unmuteRemote"),ot.prototype),K(ot.prototype,"muteLocal",[ii],Object.getOwnPropertyDescriptor(ot.prototype,"muteLocal"),ot.prototype),K(ot.prototype,"unmuteLocal",[ii],Object.getOwnPropertyDescriptor(ot.prototype,"unmuteLocal"),ot.prototype),K(ot.prototype,"close",[ii],Object.getOwnPropertyDescriptor(ot.prototype,"close"),ot.prototype),K(ot.prototype,"updateEncoderConfig",[ii],Object.getOwnPropertyDescriptor(ot.prototype,"updateEncoderConfig"),ot.prototype),K(ot.prototype,"updateSendParameters",[ii],Object.getOwnPropertyDescriptor(ot.prototype,"updateSendParameters"),ot.prototype),K(ot.prototype,"replaceTrack",[ii],Object.getOwnPropertyDescriptor(ot.prototype,"replaceTrack"),ot.prototype),K(ot.prototype,"getRemoteSSRC",[ii],Object.getOwnPropertyDescriptor(ot.prototype,"getRemoteSSRC"),ot.prototype),ot);function ii(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("From DataChannelConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];return await r.apply(this,l)}finally{a()}},n}var je;function ew(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function zo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ew(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ew(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function tw(e){var t,n,r,o=2;for(typeof Symbol<"u"&&(n=cO,r=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new ME(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function ME(e){function t(n){if(Object(n)!==n)return se.reject(new TypeError(n+" is not an object."));var r=n.done;return se.resolve(n.value).then(function(o){return{value:o,done:r}})}return(ME=function(n){this.s=n,this.n=n.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?se.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?se.reject(n):t(r.apply(this.s,arguments))}},new ME(e)}let mB=(K((je=class extends Et{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Ue.StateChange,t,this._state)}constructor(e,t){super(),_(this,"store",void 0),_(this,"statsUploader",void 0),_(this,"connection",void 0),_(this,"localTrackMap",new Map),_(this,"remoteUserMap",new Map),_(this,"pendingLocalTracks",[]),_(this,"pendingRemoteTracks",[]),_(this,"statsCollector",void 0),_(this,"isPlanB",!1),_(this,"shouldForwardP2PCreation",void 0),_(this,"iceFailedCount",0),_(this,"dtlsFailedCount",0),_(this,"mutex",new Mn("P2PChannel-mutex")),_(this,"_state",Ht.Disconnected),_(this,"_pcStatsUploadType",L("NEW_ICE_RESTART")?yi.FIRST_CONNECTION:yi.OLD_FIRST_CONNECTION),_(this,"_isInRestartIce",!1),_(this,"_isStartRestartIce",!1),_(this,"_restartStates",["disconnected","failed"]),_(this,"_restartTimer",void 0),_(this,"_isFirstConnected",!0),_(this,"handleMuteLocalTrack",async(n,r,o)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Ht.Connected)return void o(new N(I.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=this.filterTobeMutedTracks(n);if(c.length===0)return void r();const l=c.find(f=>f[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(c.map(f=>{let[,{id:p}]=f;return p}));const h=this.createMuteMessage(c);await vt(this,Ue.RequestMuteLocal,h),r()}catch(c){o(c)}finally{a()}}),_(this,"handleUnmuteLocalTrack",async(n,r,o)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Ht.Connected)return void o(new N(I.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void r();const l=c.find(f=>f[0]==="videoLowTrack");if(l){const f=l[1];if(f.track._originMediaStreamTrack.stop(),Ot().supportDualStreamEncoding){const p=n._mediaStreamTrack.clone();f.track._mediaStreamTrack=p,f.track._originMediaStreamTrack=p}else{const p=kO(n,js(this,Ue.RequestLowStreamParameter));f.track._mediaStreamTrack=p,f.track._originMediaStreamTrack=p}await new se((p,E)=>{this.handleReplaceTrack(f.track,p,E,!0)})}await this.connection.unmuteLocal(c.map(f=>{let[,{id:p}]=f;return p}));const h=this.createUnmuteMessage(c);await vt(this,Ue.RequestUnmuteLocal,h),r()}catch(c){o(c)}finally{a()}}),_(this,"handleUpdateVideoEncoder",async(n,r,o)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const c=this.localTrackMap.get(ce.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==Ht.Connected)return void r();const{id:l,track:h}=c;await this.connection.updateSendParameters(l,h),await this.connection.updateEncoderConfig(l,h),this.emit(Ue.UpdateVideoEncoder,h),r()}catch(c){o(c)}finally{a()}}),_(this,"handleSetOptimizationMode",async(n,r,o)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const c=this.localTrackMap.get(ce.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==Ht.Connected)return;const{id:l,track:h}=c;await this.connection.updateSendParameters(l,h),r()}catch(c){o(c)}finally{a()}}),_(this,"handleReplaceTrack",async(n,r,o,a)=>{let c;v.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof a=="boolean"&&a||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;const f=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:E}]=p;return n===E});if(!this.connection||!f||this.state!==Ht.Connected)return void r();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(n,f[1].id)),this.isPlanB){const p=f[1];p.id=n._mediaStreamTrack.id,this.localTrackMap.set(f[0],p)}if(f[0]===ce.LocalVideoTrack&&Ot().supportDualStreamEncoding){const p=this.localTrackMap.get(ce.LocalVideoLowTrack);if(p){const E=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=E,p.track._originMediaStreamTrack=E,await new se((T,y)=>{this.handleReplaceTrack(p.track,T,y,!0)})}}r()}catch(f){o(f)}finally{var h;(h=c)===null||h===void 0||h()}}),_(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),_(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),_(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),_(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new hB,this.bindStatsUploaderEvents(),this.isPlanB=!Ot().supportUnifiedPlan||L("CHROME_FORCE_PLAN_B")&&Ns(),this.shouldForwardP2PCreation=L("FORWARD_P2P_CREATION")&&Ot().supportPCSetConfiguration,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Yo({},this.store):this.isPlanB?new ud({},this.store):new uo({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=Ht.New;const r=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new Yo(e,this.store):this.isPlanB?new ud(e,this.store):new uo(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new N(I.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=L("NEW_ICE_RESTART")?yi.FIRST_CONNECTION:yi.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e,t,n,r,o,a){if(!this.connection)throw new N(I.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof Yo?this.connection.updateRemoteConnect(r):(this.store.peerConnectionStart(),await this.connection.connect(e,t,n,r,o,a),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ht.Connected)}async preConnect(e,t,n,r,o,a){if(!this.connection)throw new N(I.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const c=await this.connection.connect(e,t,n,r,o,a);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ht.Connected,c}getEstablishParams(){if(this.connection instanceof Yo)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publish(e,t,n){var r=this;return ni(function*(){const o=yield Le(r.mutex.lock("From P2PChannel.publish"));try{if(!r.connection||r.state!==Ht.Connected){if(r.state===Ht.Disconnected)throw new N(I.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const c=e.filter(l=>r.pendingLocalTracks.indexOf(l)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(c))}r.store.pubId=r.store.pubId+1,Ur.markPublishStart(r.store.clientId,r.store.pubId);const a=r.filterTobePublishedTracks(e,t,n);if(a.length===0)return void(yield Le(r.tryToUnmuteAudio(e)));yield*Du(tw(r.doPublish(r.connection,a)),Le)}finally{o()}})()}doPublish(e,t){var n=this;return ni(function*(){t.forEach(f=>{let{track:p,type:E}=f;const T=Date.now();n.store.publish(p.getTrackId(),E===ce.LocalAudioTrack?"audio":"video",T)}),n.bindLocalTrackEvents(t);const r=yield Le(e.send(t.map(f=>{let{track:p}=f;return p}),n.store.codec,n.store.audioCodec)),o=(yield Le(r.next())).value,a=n.createGatewayPublishMessage(t,o);let c;try{c=yield a}catch(f){throw r.throw(f),(f==null?void 0:f.code)===I.WS_ABORT&&t.forEach(p=>{let{track:E}=p;n.pendingLocalTracks.indexOf(E)===-1&&n.pendingLocalTracks.push(E)}),n.unbindLocalTrackEvents(t),f}const l=n.mapPubResToRemoteConfig(a,c),h=(yield Le(r.next(l))).value;t.forEach(f=>{let{type:p}=f;n.statsCollector.addLocalStats(p)}),n.assignLocalTracks(t,h),n.statsUploader.startUploadUplinkStats(),t.forEach(f=>{let{track:p,type:E}=f;const T=Date.now();n.store.publish(p.getTrackId(),E===ce.LocalAudioTrack?"audio":"video",void 0,T)})})()}publishLowStream(e){var t=this;return ni(function*(){if(!t.connection||t.state!==Ht.Connected)return;const n=yield Le(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const o=t.localTrackMap.get(ce.LocalVideoTrack);if(!o)throw new N(I.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(ce.LocalVideoLowTrack))throw new N(I.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const a=[{track:t.getLowVideoTrack(o.track,e),type:ce.LocalVideoLowTrack}];if(yield*Du(tw(t.doPublish(t.connection,a)),Le),o.track.muted||!o.track.enabled){var r;const c=(r=t.localTrackMap.get(ce.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;c!==void 0&&(yield Le(t.connection.muteLocal([c])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(v.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await vn(this,Ue.RequestRePublish,this.pendingLocalTracks),this.emit(Ue.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:r}=this.pendingRemoteTracks[t];(r!==Ce.AUDIO||n._audio_added_&&n._audioSSRC)&&(r!==Ce.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await vn(this,Ue.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===Ce.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(Ue.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Ht.Connected)return void e.forEach(r=>{const o=this.pendingLocalTracks.indexOf(r);o!==-1&&this.pendingLocalTracks.splice(o,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(r=>r[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishLowStream(){if(!this.connection||this.state!==Ht.Connected)return;const e=this.localTrackMap.get(ce.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[ce.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(r=>{let[,{id:o}]=r;return o})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[o,{track:a}]=r;return{type:o,track:a}})),t.forEach(r=>{let[o]=r;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats(),n}async subscribe(e,t,n,r,o){var a;if(!this.connection||this.state!==Ht.Connected)throw new N(I.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((a=this.remoteUserMap.get(e))!==null&&a!==void 0&&a.has(t))return;let c,l,h;if(o){const E=o.find(y=>{let{stream_type:C}=y;return C===t});if(!E)throw new N(I.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const T=await this.connection.receive(t,E.ssrcs,String(e._uintid),E.attributes);this.connection instanceof uo&&(h=T.transceiver),c=T.track,l=T.id}else{const E=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof uo&&(h=E.transceiver),c=E.track,l=E.id}t===Ce.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(c):(e._audioTrack=new xu(c,e.uid,e._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),h&&e._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(c):(e._videoTrack=new Uu(c,e.uid,e._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),h&&e._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._videoTrack));const f=this.remoteUserMap.get(e);f?f.set(t,l):this.remoteUserMap.set(e,new Map([[t,l]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadDownlinkStats();const p=this.pendingRemoteTracks.findIndex(E=>{let{user:T,kind:y}=E;return T.uid===e.uid&&t===y});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(Ue.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Ht.Connected)throw new N(I.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(n=>{var r;let{user:o,mediaType:a}=n;return!((r=this.remoteUserMap.get(o))!==null&&r!==void 0&&r.has(a))});const t=await this.connection.batchReceive(e.map(n=>{let{user:r,mediaType:o,ssrcId:a,rtxSsrcId:c}=n;return{kind:o,ssrcMsg:[{ssrcId:a,rtx:c}],mslabel:String(r._uintid)}}));e.forEach((n,r)=>{let{user:o,mediaType:a}=n;const{track:c,id:l,transceiver:h}=t[r];a===Ce.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack(c):(o._audioTrack=new xu(c,o.uid,o._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),h&&o._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack(c):(o._videoTrack=new Uu(c,o.uid,o._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),h&&o._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(o,o._videoTrack));const f=this.remoteUserMap.get(o);f?f.set(a,l):this.remoteUserMap.set(o,new Map([[a,l]])),this.statsCollector.addRemoteStats(o.uid),this.statsUploader.startUploadDownlinkStats();const p=this.pendingRemoteTracks.findIndex(E=>{let{user:T,kind:y}=E;return T.uid===o.uid&&a===y});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(Ue.MediaReconnectEnd,o.uid))})}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:h}=c;return t!==void 0?l.uid===e.uid&&t===h:l.uid===e.uid});if(r.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===Ht.Connected||n||r.forEach(c=>{let{kind:l}=c;var h;if(l===Ce.AUDIO)(h=e._audioTrack)===null||h===void 0||h._destroy(),e._audioTrack=void 0;else if(l===Ce.VIDEO){var f;(f=e._videoTrack)===null||f===void 0||f._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Ht.Connected)return;const o=this.filterTobeUnSubscribedTracks(e,t);if(o.length===0)return;await this.connection.stopReceiving(o.map(c=>{let[,{id:l}]=c;return l}));const a=this.createUnsubscribeMessage(o);return this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),o.forEach(c=>{let[l,{kind:h}]=c;var f,p;if(h===Ce.VIDEO&&l._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),h===Ce.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),n||((p=l._videoTrack)===null||p===void 0||p._destroy(),l._videoTrack=void 0);else if(h===Ce.AUDIO){var E;this.unbindRemoteTrackEvents(l._audioTrack),!n&&((E=l._audioTrack)===null||E===void 0||E._destroy(),l._audioTrack=void 0)}}),a}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:o,mediaType:a}of e){const c=this.pendingRemoteTracks.filter(l=>{let{user:h,kind:f}=l;return a!==void 0?h.uid===o.uid&&a===f:h.uid===o.uid});c.forEach(l=>{const h=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(h,1)}),t=t.concat(c)}if(!this.connection||this.state!==Ht.Connected)return void t.forEach(o=>{let{user:a,kind:c}=o;var l;if(c===Ce.AUDIO)(l=a._audioTrack)===null||l===void 0||l._destroy(),a._audioTrack=void 0;else if(c===Ce.VIDEO){var h;(h=a._videoTrack)===null||h===void 0||h._destroy(),a._videoTrack=void 0}});const n=bo(e).call(e,(o,a)=>{let{user:c,mediaType:l}=a;const h=this.filterTobeUnSubscribedTracks(c,l);return o.concat(h)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(o=>{let[,{id:a}]=o;return a}));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),n.forEach(o=>{let[a,{kind:c}]=o;var l,h;if(c===Ce.VIDEO&&a._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),c===Ce.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),(h=a._videoTrack)===null||h===void 0||h._destroy(),a._videoTrack=void 0;else if(c===Ce.AUDIO){var f;this.unbindRemoteTrackEvents(a._audioTrack),(f=a._audioTrack)===null||f===void 0||f._destroy(),a._audioTrack=void 0}}),r}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void v.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void v.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Ce.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void v.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||v.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(ce.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Jn){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[o]=r;return o!==ce.LocalAudioTrack}).filter(r=>{let[o]=r;return!(e&&o===ce.LocalVideoLowTrack)}).map(r=>{let[,{track:o}]=r;return o}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===ce.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}reportPublishEvent(e,t,n,r,o){if(e){const c=this.localTrackMap.get(ce.LocalAudioTrack),l=r?this.localTrackMap.get(ce.LocalVideoLowTrack):this.localTrackMap.get(ce.LocalVideoTrack);de.publish(this.store.sessionId,{eventElapse:Ur.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Wt.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var a;n||(n=[]);const c=n.find(h=>h instanceof Sn),l=r?(a=this.localTrackMap.get(ce.LocalVideoTrack))===null||a===void 0?void 0:a.track:n.find(h=>h instanceof Ut);de.publish(this.store.sessionId,{eventElapse:Ur.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Wt.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(e,t,n,r){const o=r===Ce.VIDEO?n._videoSSRC:n._audioSSRC;o&&de.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Ce.VIDEO,audio:r===Ce.AUDIO,peerid:n.uid,subscribeRequestid:r===Ce.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ur.measureFromSubscribeStart(this.store.clientId,o)})}reset(){v.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Mn("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Yo({},this.store):this.isPlanB?new ud({},this.store):new uo({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ce.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Jn){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=Ht.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ce.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ce.LocalVideoTrack);if(e)return{width:e.track._videoWidth||0,height:e.track._videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Ut||t&&t.track instanceof Sn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Ms(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ce.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Tm(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.connection&&(v.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Ht.Reconnecting,L("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Yo({},this.store):this.isPlanB?new ud({},this.store):new uo({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;switch(t){case ce.LocalVideoTrack:n._hints.includes(Wt.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case ce.LocalAudioTrack:n instanceof Jn?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);break;case ce.LocalVideoLowTrack:}}),this.emit(Ue.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Ms(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(Ue.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),v.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:o}=n;if((e instanceof aE?e.uid:e)===r.uid&&t===o)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return ni(function*(){if(!t.connection||t.state!==Ht.Connected||t.connection instanceof Yo)return;const n=yield Le(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield Le(t.connection.restartICE(e));const a=yield Le(r.next());if(a.done)return;const c=a.value,l=yield c;switch(t.reportPCDisconnectedOrFailed(e),e){case sn.TCP:t._pcStatsUploadType=yi.TCP_RESTART;break;case sn.RELAY:t._pcStatsUploadType=yi.RELAY_RESTART;break;default:t._pcStatsUploadType=yi.OLD_RESTART}t._isInRestartIce=!0,r.next(l)}catch(a){var o;(o=r)===null||o===void 0||o.throw(a)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(ce.LocalVideoTrack),n=this.localTrackMap.get(ce.LocalAudioTrack),r=e.videoSend.find(y=>y.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),o=e.audioSend.find(y=>y.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!r||!o)return 1;const a=ti(this,Ue.NeedSignalRTT),c=r?r.rttMs:void 0,l=o?o.rttMs:void 0,h=c&&l?(c+l)/2:c||l,f=(h&&a?(h+a)/2:h||a)||0,p=100*e.sendPacketLossRate*.7/50+.3*f/1500,E=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,T=t==null?void 0:t.track;if(T&&T._encoderConfig&&T._hints.indexOf(Wt.SCREEN_TRACK)===-1){const y=T._encoderConfig.bitrateMax,C=e.bitrate.actualEncoded;if(y&&C){const A=(1e3*y-C)/(1e3*y);return K2[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const o=r._audioSSRC,a=r._videoSSRC,c=e.audioRecv.find(C=>C.ssrc===o),l=e.videoRecv.find(C=>C.ssrc===a);if(!c&&!l)return void(t+=1);const h=ti(this,Ue.NeedSignalRTT),f=e.rtt,p=(f&&h?(f+h)/2:f||h)||0,E=c?c.jitterMs:void 0,T=e.recvPacketLossRate;let y=.7*T*100/50+.3*p/1500;E&&(y=.6*T*100/50+.2*p/1500+.2*E/400),t+=y<.1?1:y<.17?2:y<.36?3:y<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new se((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const r=[],o=Ot(),a=this.getAllTracks();e=uC(e=e.filter(h=>a.indexOf(h)===-1));let c=!1,l=!1;for(const h of e){if(h instanceof Ut&&(this.localTrackMap.has(ce.LocalVideoTrack)||c?new N(I.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:h,type:ce.LocalVideoTrack}),c=!0),t)){const f=this.getLowVideoTrack(h,n);r.push({track:f,type:ce.LocalVideoLowTrack})}if(h instanceof Sn){const f=this.localTrackMap.get(ce.LocalAudioTrack);if(f){if(!(f.track instanceof Jn))throw new N(I.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(h._bypassWebAudio)throw new N(I.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(h),this.bindLocalAudioTrackEvents(h,!0)}else if(l){const p=r.find(E=>{let{type:T}=E;return T===ce.LocalAudioTrack});if(!(p.track instanceof Jn))throw new N(I.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(h._bypassWebAudio)throw new N(I.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(h)}else{if(!o.webAudioMediaStreamDest||h instanceof Jn||h._bypassWebAudio)r.push({track:h,type:ce.LocalAudioTrack});else{const p=new Jn;p.addAudioTrack(h),r.push({track:p,type:ce.LocalAudioTrack})}l=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=uC(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof Sn){const o=this.localTrackMap.get(ce.LocalAudioTrack);if(!o)continue;o.track instanceof Jn?(o.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),o.track.trackList.length===0&&(t.push([ce.LocalAudioTrack,o]),o.track.close())):t.push([ce.LocalAudioTrack,o])}if(r instanceof Ut){const o=this.localTrackMap.get(ce.LocalVideoTrack);if(!o)continue;t.push([ce.LocalVideoTrack,o]);const a=this.localTrackMap.get(ce.LocalVideoLowTrack);a&&t.push([ce.LocalVideoLowTrack,a])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case ce.LocalVideoTrack:n.addListener(_e.GET_STATS,this.handleGetLocalVideoStats),n.addListener(_e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(_e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(_e.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(_e.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),n.addListener(_e.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(_e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(_e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ce.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);break;case ce.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Jn?e.trackList.forEach(n=>{n.addListener(_e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(_e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(_e.GET_STATS,this.handleGetLocalAudioStats),n.addListener(_e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(_e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(_e.GET_STATS,this.handleGetLocalAudioStats),e.addListener(_e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(_e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(_e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(_e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(_e.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case ce.LocalVideoTrack:n.off(_e.GET_STATS,this.handleGetLocalVideoStats),n.off(_e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(_e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(_e.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(_e.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),n.off(_e.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(_e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(_e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ce.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);break;case ce.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Jn?e.trackList.forEach(t=>{t.off(_e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(_e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(_e.GET_STATS,this.handleGetLocalAudioStats),t.off(_e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(_e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(_e.GET_STATS,this.handleGetLocalAudioStats),e.off(_e.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(_e.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(_e.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(_e.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(_e.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Uu&&t.addListener(_e.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof xu&&t.addListener(_e.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(_e.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(Ce.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Ce.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{let o,a,{track:c,type:l}=n;switch(l){case ce.LocalAudioTrack:o=Ft.Audio,a={dtx:c instanceof Eu&&c._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ce.LocalVideoTrack:o=c._hints.includes(Wt.SCREEN_TRACK)?Ft.Screen:Ft.High,a=zo(zo({},aC(c)),{},{codec:this.store.codec});break;case ce.LocalVideoLowTrack:o=Ft.Low,a=zo(zo({},aC(c)),{},{codec:this.store.codec})}return{stream_type:o,attributes:a,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(t=>{let n,[r,{track:o,ssrcs:a,id:c}]=t;switch(r){case ce.LocalVideoTrack:n=o._hints.includes(Wt.SCREEN_TRACK)?Ft.Screen:Ft.High;break;case ce.LocalAudioTrack:n=Ft.Audio;break;case ce.LocalVideoLowTrack:n=Ft.Low}return{stream_type:n,ssrcs:a,mid:c}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:o,type:a}=n;this.localTrackMap.set(a,{track:o,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Ue.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),L("NEW_ICE_RESTART")){if(this._restartStates.includes(t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=a=>{(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")&&(v.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(a)),ti(this,Ue.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ue.RequestRestartICE,a))},r=()=>{e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="checking"&&e.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),v.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Ue.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},o=L("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(L("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ot().supportPCSetConfiguration)n(sn.RELAY),this._restartTimer=window.setTimeout(r,o);else if(gt())n(sn.UDP),this._restartTimer=window.setTimeout(r,4e3);else{if(n(sn.TCP),Ot().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{n(sn.RELAY),this._restartTimer=window.setTimeout(r,o)},o));this._restartTimer=window.setTimeout(r,o)}},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&L("ICE_RESTART")&&ti(this,Ue.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ue.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(Ue.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(Ue.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),de.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:ft.TRACER}).onSuccess(),this.emit(Ue.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(Ms(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===t);var o;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(o=r.audioTrack)===null||o===void 0||o.emit(Ma.FIRST_FRAME_DECODED),de.firstRemoteFrame(this.store.sessionId,on.FIRST_AUDIO_DECODE,_t.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Ur.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(Ms(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===t);r&&de.firstRemoteFrame(this.store.sessionId,on.FIRST_AUDIO_RECEIVED,_t.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Ur.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;const r=Array.from(Ms(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);r&&de.firstRemoteFrame(this.store.sessionId,on.FIRST_VIDEO_RECEIVED,_t.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Ur.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",o=n.candidateType==="relay";n.candidateType!=="unknown"&&r===o||this.emit(Ue.ConnectionTypeChange,r),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Su(n))," -> ").concat(JSON.stringify(Su(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Su(n))," -> ").concat(JSON.stringify(Su(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ce.LocalAudioTrack);if(e instanceof Sn&&(n==null?void 0:n.track)instanceof Jn)return n.track.isActive||t.push([ce.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:a}]=o;return e===a});if(r&&(t.push(r),r[0]===ce.LocalVideoTrack)){const o=this.localTrackMap.get(ce.LocalVideoLowTrack);o&&t.push([ce.LocalVideoLowTrack,o])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ce.LocalAudioTrack);if(e instanceof Sn&&(n==null?void 0:n.track)instanceof Jn)return n.track.isActive&&t.push([ce.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:a}]=o;return e===a});if(r)if(r[0]===ce.LocalVideoTrack){t.push(r);const o=this.localTrackMap.get(ce.LocalVideoLowTrack);o&&t.push([ce.LocalVideoLowTrack,o])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{let n,[r,{track:o,ssrcs:a,id:c}]=t;switch(r){case ce.LocalAudioTrack:n=Ft.Audio;break;case ce.LocalVideoTrack:n=o._hints.includes(Wt.SCREEN_TRACK)?Ft.Screen:Ft.High;break;case ce.LocalVideoLowTrack:n=Ft.Low}return{stream_type:n,ssrcs:a,mid:c}})}createUnmuteMessage(e){return e.map(t=>{let n,[r,{track:o,ssrcs:a,id:c}]=t;switch(r){case ce.LocalAudioTrack:n=Ft.Audio;break;case ce.LocalVideoTrack:n=o._hints.includes(Wt.SCREEN_TRACK)?Ft.Screen:Ft.High;break;case ce.LocalVideoLowTrack:n=Ft.Low}return{stream_type:n,ssrcs:a,mid:c}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const o=r.get(t);if(!o)return n;n.push([e,{kind:t,id:o}])}else Array.from(r.entries()).forEach(o=>{let[a,c]=o;n.push([e,{kind:a,id:c}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:o,id:a}]=n;switch(o){case Ce.VIDEO:return void(r._videoSSRC&&t.push({stream_type:Ce.VIDEO,ssrcId:r._videoSSRC}));case Ce.AUDIO:return void(r._audioSSRC&&t.push({stream_type:Ce.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[r,{kind:o}]=n;if(t.has(r)){let a=t.get(r);o===Ce.VIDEO?a|=Lt.Video:a|=Lt.Audio,t.set(r,a)}else o===Ce.VIDEO?t.set(r,Lt.Video):t.set(r,Lt.Audio)}),{users:Array.from(t.entries()).map(n=>{let[r,o]=n;return{stream_id:r.uid,stream_type:o}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const o=this.remoteUserMap.get(n);o&&(o.delete(r),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ce.LocalVideoTrack),n=this.localTrackMap.get(ce.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t){return e.map((n,r)=>{var o;let{stream_type:a}=n;return(o=t.find(c=>{let{stream_type:l}=c;return a===l}))===null||o===void 0?void 0:o.attributes})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Sn){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map(a=>{let[,{id:c}]=a;return c})));const o=this.createUnmuteMessage(r);return void await vt(this,Ue.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Ue.RequestUploadStats,e,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Tn(lm(this.dtlsFailedCount,Dt)),this.emit(Ue.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await vn(this,Ue.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Ue.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ce.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Ut)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Ut).length>1)throw new N(I.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Sn).length>1&&(e.some(t=>t instanceof Sn&&t._bypassWebAudio)||!Ot().webAudioMediaStreamDest))throw new N(I.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Ut&&this.pendingLocalTracks.some(n=>n instanceof Ut))throw new N(I.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Sn&&this.pendingLocalTracks.some(n=>n instanceof Sn)&&(!Ot().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Sn&&n._bypassWebAudio)))throw new N(I.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=Ot().supportDualStreamEncoding,r=zo(zo({},{width:160,height:120,framerate:15,bitrate:50}),t);let o;o=n?e._mediaStreamTrack.clone():kO(e,r);const a=dt(8,"track-low-"),c=new Ut(o,zo(zo({},n&&{scaleResolutionDownBy:qj(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,a);return c.on(Jc.TRANSCEIVER_UPDATED,l=>{e._updateRtpTransceiver(l,ka.LOW_STREAM)}),c._hints.push(Wt.LOW_STREAM),e.addListener(_e.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof uo){var o,a,c,l;const h=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:f,dtlsTransportState:p,peerConnectionState:E}=this.connection,{local:T,remote:y}=await this.connection.getSelectedCandidatePair();de.pcStats(this.store.sessionId,{startTime:h,eventElapse:e-h||0,iceconnectionsate:f,dtlsstate:p,connectionstate:E,intSucc:t?1:2,error:r,selectedLocalCandidateProtocol:(o=T==null?void 0:T.protocol)!==null&&o!==void 0?o:"",selectedLocalCandidateType:(a=T.candidateType)!==null&&a!==void 0?a:"",selectedLocalCandidateAddress:"".concat(T.address,":").concat(T.port),selectedRemoteCandidateProtocol:(c=y.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(l=y.candidateType)!==null&&l!==void 0?l:"",selectedRemoteCandidateAddress:"".concat(y.address,":").concat(y.port),restartCnt:n})}}reportVideoFirstFrameDecoded(e,t,n,r){var o;const a=Array.from(Ms(o=this.remoteUserMap).call(o)).find(c=>c._videoSSRC===e);if(a){r||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(h=>h.userId===a.uid&&h.type==="video");de.firstRemoteVideoDecode(this.store.sessionId,on.FIRST_VIDEO_DECODE,_t.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:t,videoheight:n,subscribeElapse:Ur.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const o=r.get(t);if(!o)return!1;const a=await this.connection.getRemoteSSRC(o);return a!==void 0&&a!==n}resetConnection(e){v.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(e)),this.state===Ht.Connected?(v.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===du.datachannel?new Yo({},this.store):this.isPlanB?new ud({},this.store):new uo({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ce.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,ka.LOW_STREAM):n._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof uo&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===yi.TCP_RESTART&&e===sn.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,yi.DISCONNECTED_OR_FAILED)))}}).prototype,"startP2PConnection",[ar],Object.getOwnPropertyDescriptor(je.prototype,"startP2PConnection"),je.prototype),K(je.prototype,"connect",[ar],Object.getOwnPropertyDescriptor(je.prototype,"connect"),je.prototype),K(je.prototype,"preConnect",[ar],Object.getOwnPropertyDescriptor(je.prototype,"preConnect"),je.prototype),K(je.prototype,"unpublish",[ar],Object.getOwnPropertyDescriptor(je.prototype,"unpublish"),je.prototype),K(je.prototype,"unpublishLowStream",[ar],Object.getOwnPropertyDescriptor(je.prototype,"unpublishLowStream"),je.prototype),K(je.prototype,"subscribe",[ar],Object.getOwnPropertyDescriptor(je.prototype,"subscribe"),je.prototype),K(je.prototype,"massSubscribe",[ar],Object.getOwnPropertyDescriptor(je.prototype,"massSubscribe"),je.prototype),K(je.prototype,"unsubscribe",[ar],Object.getOwnPropertyDescriptor(je.prototype,"unsubscribe"),je.prototype),K(je.prototype,"massUnsubscribe",[ar],Object.getOwnPropertyDescriptor(je.prototype,"massUnsubscribe"),je.prototype),K(je.prototype,"muteRemote",[ar],Object.getOwnPropertyDescriptor(je.prototype,"muteRemote"),je.prototype),K(je.prototype,"unmuteRemote",[ar],Object.getOwnPropertyDescriptor(je.prototype,"unmuteRemote"),je.prototype),K(je.prototype,"hasRemoteMediaWithLock",[ar],Object.getOwnPropertyDescriptor(je.prototype,"hasRemoteMediaWithLock"),je.prototype),K(je.prototype,"disconnectForReconnect",[ar],Object.getOwnPropertyDescriptor(je.prototype,"disconnectForReconnect"),je.prototype),K(je.prototype,"updateBitrateLimit",[ar],Object.getOwnPropertyDescriptor(je.prototype,"updateBitrateLimit"),je.prototype),K(je.prototype,"remoteMediaSsrcChanged",[ar],Object.getOwnPropertyDescriptor(je.prototype,"remoteMediaSsrcChanged"),je.prototype),je);function ar(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("From P2PChannel.".concat(t));try{for(var c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];return await r.apply(this,l)}finally{a()}},n}function nw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function le(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nw(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nw(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var be;(function(e){e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL"})(be||(be={}));class EB{constructor(t,n,r,o){_(this,"state",void 0),this.state={codec:t,audioCodec:n,mode:r,clientId:o,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1}}dispatch(t){this.state=function(n,r){switch(r.type){case be.SET_SESSION_ID:return le(le({},n),{},{sessionId:r.sessionId});case be.SET_P2P_ID:return le(le({},n),{},{p2pId:r.p2pId});case be.SET_UID:return le(le({},n),{},{uid:r.uid});case be.SET_PUB_ID:return le(le({},n),{},{pubId:r.pubId});case be.KEY_METRIC_CLIENT_CREATED:return le(le({},n),{},{keyMetrics:le(le({},n.keyMetrics),{},{clientCreated:r.metric})});case be.KEY_METRIC_JOIN_START:return le(le({},n),{},{keyMetrics:le(le({},n.keyMetrics),{},{joinStart:r.metric})});case be.AVOID_JOIN_START:return le(le({},n),{},{avoidJoinStart:r.avoidJoinStart});case be.KEY_METRIC_JOIN_END:return le(le({},n),{},{keyMetrics:le(le({},n.keyMetrics),{},{joinEnd:r.metric})});case be.KEY_METRIC_REQUEST_AP_START:return le(le({},n),{},{keyMetrics:le(le({},n.keyMetrics),{},{requestAPStart:r.metric})});case be.KEY_METRIC_REQUEST_AP_END:return le(le({},n),{},{keyMetrics:le(le({},n.keyMetrics),{},{requestAPEnd:r.metric})});case be.KEY_METRIC_JOIN_GATEWAY_START:return le(le({},n),{},{keyMetrics:le(le({},n.keyMetrics),{},{joinGatewayStart:r.metric})});case be.KEY_METRIC_JOIN_GATEWAY_END:return le(le({},n),{},{keyMetrics:le(le({},n.keyMetrics),{},{joinGatewayEnd:r.metric})});case be.KEY_METRIC_PEER_CONNECTION_START:return le(le({},n),{},{keyMetrics:le(le({},n.keyMetrics),{},{peerConnectionStart:r.metric})});case be.KEY_METRIC_PEER_CONNECTION_END:return le(le({},n),{},{keyMetrics:le(le({},n.keyMetrics),{},{peerConnectionEnd:r.metric})});case be.KEY_METRIC_DESCRIPTION_START:return le(le({},n),{},{keyMetrics:le(le({},n.keyMetrics),{},{descriptionStart:r.metric})});case be.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return le(le({},n),{},{keyMetrics:le(le({},n.keyMetrics),{},{signalChannelOpen:r.metric})});case be.KEY_METRIC_ICE_CONNECTION_END:return le(le({},n),{},{keyMetrics:le(le({},n.keyMetrics),{},{iceConnectionEnd:r.metric})});case be.KEY_METRIC_PUBLISH:{const o=n.keyMetrics.publish,a=o.findIndex(c=>c.trackId===r.metric.trackId);return a!==-1?(o[a]=le(le({},o[a]),r.metric),le(le({},n),{},{keyMetrics:le(le({},n.keyMetrics),{},{publish:[...o]})})):le(le({},n),{},{keyMetrics:le(le({},n.keyMetrics),{},{publish:[...n.keyMetrics.publish,r.metric]})})}case be.KEY_METRIC_SUBSCRIBE:{const o=n.keyMetrics.subscribe,a=o.findIndex(c=>c.userId===r.metric.userId&&c.type===r.metric.type);return a!==-1?(o[a]=le(le({},o[a]),r.metric),le(le({},n),{},{keyMetrics:le(le({},n.keyMetrics),{},{subscribe:[...o]})})):le(le({},n),{},{keyMetrics:le(le({},n.keyMetrics),{},{subscribe:[...n.keyMetrics.subscribe,r.metric]})})}case be.SET_CLOUD_PROXY_SERVER_MODE:return n.cloudProxyServerMode=r.mode,n;case be.RECORD_JOIN_CHANNEL_SERVICE:return typeof r.index!="number"?n.joinChannelServiceRecords=[...n.joinChannelServiceRecords,r.record]:(n.joinChannelServiceRecords[r.index]=le(le({},n.joinChannelServiceRecords[r.index]),r.record),n.joinChannelServiceRecords=[...n.joinChannelServiceRecords]),n;case be.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return n.joinChannelServiceRecords=[],n;case be.RESET_KEY_METRICS:return n.keyMetrics={publish:[],subscribe:[]},n;case be.SET_USE_DATACHANNEL:return le(le({},n),{},{useDataChannel:r.val});default:return n}}(this.state,t)}set sessionId(t){this.dispatch({type:be.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:be.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:be.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:be.SET_UID,uid:t})}get uid(){return this.state.uid}set pubId(t){this.dispatch({type:be.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:be.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(t){this.dispatch({type:be.SET_USE_DATACHANNEL,val:t})}get useDataChannel(){return this.state.useDataChannel}clientCreated(){this.dispatch({type:be.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:be.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:be.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:be.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:be.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:be.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:be.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:be.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:be.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:be.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:be.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:be.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,n,r,o){this.dispatch({type:be.KEY_METRIC_PUBLISH,metric:le(le({trackId:t,type:n},r&&{publishStart:r}),o&&{publishEnd:o})})}subscribe(t,n,r,o,a,c,l){this.dispatch({type:be.KEY_METRIC_SUBSCRIBE,metric:le(le(le(le(le({userId:t,type:n},r&&{subscribeStart:r}),o&&{subscribeEnd:o}),a&&{firstFrame:a}),c&&{streamAdded:c}),l&&{firstDecoded:l})})}massSubscribe(t,n,r,o){t.forEach(a=>{this.dispatch({type:be.KEY_METRIC_SUBSCRIBE,metric:le(le(le({userId:a.userId,type:a.type},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),o&&{firstFrame:o})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,n){t.service==="gateway"&&Array.isArray(t.urls)&&(t.urls=t.urls.map(r=>r.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof n!="number"?(this.dispatch({type:be.RECORD_JOIN_CHANNEL_SERVICE,record:le(le({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(n<0||n>=this.state.joinChannelServiceRecords.length||this.dispatch({type:be.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:n}),n)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:be.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:be.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:be.AVOID_JOIN_START,avoidJoinStart:t})}}let Fu;const _B=()=>(Fu||Fu||(Fu=(window.location.protocol.split(":")[0]||"").toUpperCase(),Fu))==="HTTPS",rw=()=>window.isSecureContext!==void 0;function gB(e){let t=sw();return function(n,r){let o=n.appId;o!==void 0&&(Be(r,10),Wi(r,o));let a=n.cid;a!==void 0&&(Be(r,16),Be(r,a));let c=n.cname;c!==void 0&&(Be(r,26),Wi(r,c));let l=n.deviceId;l!==void 0&&(Be(r,34),Wi(r,l));let h=n.elapse;h!==void 0&&(Be(r,40),qo(r,h));let f=n.fileSize;f!==void 0&&(Be(r,48),qo(r,Ja(f)));let p=n.height;p!==void 0&&(Be(r,56),qo(r,Ja(p)));let E=n.jpg;E!==void 0&&(Be(r,66),Be(r,E.length),function(Qn,F){let J=Xa(Qn,F.length);Qn.bytes.set(F,J)}(r,E));let T=n.networkType;T!==void 0&&(Be(r,72),qo(r,Ja(T)));let y=n.osType;y!==void 0&&(Be(r,80),qo(r,Ja(y)));let C=n.requestId;C!==void 0&&(Be(r,90),Wi(r,C));let A=n.sdkVersion;A!==void 0&&(Be(r,98),Wi(r,A));let O=n.sequence;O!==void 0&&(Be(r,104),qo(r,Ja(O)));let M=n.sid;M!==void 0&&(Be(r,114),Wi(r,M));let U=n.timestamp;U!==void 0&&(Be(r,120),qo(r,U));let q=n.uid;q!==void 0&&(Be(r,128),Be(r,q));let ae=n.vid;ae!==void 0&&(Be(r,136),Be(r,ae));let X=n.width;X!==void 0&&(Be(r,144),qo(r,Ja(X)));let Q=n.service;Q!==void 0&&(Be(r,152),Be(r,Q));let Y=n.callbackData;Y!==void 0&&(Be(r,162),Wi(r,Y));let Z=n.jpgEncryption;Z!==void 0&&(Be(r,168),Be(r,Z));let Ge=n.requestType;Ge!==void 0&&(Be(r,176),Be(r,Ge));let pe=n.scorePorn;pe!==void 0&&(Be(r,185),FE(r,pe));let st=n.scoreSexy;st!==void 0&&(Be(r,193),FE(r,st));let $e=n.scoreNeutral;$e!==void 0&&(Be(r,201),FE(r,$e));let Nt=n.scene;Nt!==void 0&&(Be(r,208),Be(r,Nt));let cn=n.ossFilePrefix;cn!==void 0&&(Be(r,218),Wi(r,cn));let Ct=n.serviceVendor;if(Ct!==void 0)for(let Qn of Ct){Be(r,226);let F=sw();vB(Qn,F),Be(r,F.limit),CB(r,F),IB(F)}}(e,t),function(n){let r=n.bytes,o=n.limit;return r.length===o?r:r.subarray(0,o)}(t)}function SB(e){return function(n){let r={};e:for(;!aw(n);){let o=Hi(n);switch(o>>>3){case 0:break e;case 1:r.code=Hi(n);break;case 2:r.msg=cw(n,Hi(n));break;case 3:{let a=RB(n);r.data=TB(n),n.limit=a;break}default:iw(n,7&o)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function TB(e){let t={};e:for(;!aw(e);){let n=Hi(e);switch(n>>>3){case 0:break e;case 1:t.requestId=cw(e,Hi(e));break;case 2:t.requestType=Hi(e)>>>0;break;case 3:t.scorePorn=jE(e);break;case 4:t.scoreSexy=jE(e);break;case 5:t.scoreNeutral=jE(e);break;case 6:t.requestScene=Hi(e)>>>0;break;case 7:t.scene=Hi(e)>>>0;break;default:iw(e,7&n)}}return t}function vB(e,t){let n=e.service;n!==void 0&&(Be(t,8),Be(t,n));let r=e.vendor;r!==void 0&&(Be(t,16),Be(t,r));let o=e.token;o!==void 0&&(Be(t,26),Wi(t,o));let a=e.callbackUrl;a!==void 0&&(Be(t,34),Wi(t,a))}function RB(e){let t=Hi(e),n=e.limit;return e.limit=e.offset+t,n}function iw(e,t){switch(t){case 0:for(;128&dw(e););break;case 2:xE(e,Hi(e));break;case 5:xE(e,4);break;case 1:xE(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let yB=new Float32Array(1);new Uint8Array(yB.buffer);let UE=new Float64Array(1),Xn=new Uint8Array(UE.buffer);function Ja(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let ow=[];function sw(){const e=ow.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function IB(e){ow.push(e)}function xE(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function aw(e){return e.offset>=e.limit}function Xa(e,t){let n=e.bytes,r=e.offset,o=e.limit,a=r+t;if(a>n.length){let c=new Uint8Array(2*a);c.set(n),e.bytes=c}return e.offset=a,a>o&&(e.limit=a),r}function VE(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function cw(e,t){let n=VE(e,t),r=String.fromCharCode,o=e.bytes,a="",c="";for(let l=0;l<t;l++){let h,f,p,E,T=o[l+n];128&T?(224&T)==192?l+1>=t?c+=a:(h=o[l+n+1],(192&h)!=128?c+=a:(E=(31&T)<<6|63&h,E<128?c+=a:(c+=r(E),l++))):(240&T)==224?l+2>=t?c+=a:(h=o[l+n+1],f=o[l+n+2],(49344&(h|f<<8))!=32896?c+=a:(E=(15&T)<<12|(63&h)<<6|63&f,E<2048||E>=55296&&E<=57343?c+=a:(c+=r(E),l+=2))):(248&T)==240?l+3>=t?c+=a:(h=o[l+n+1],f=o[l+n+2],p=o[l+n+3],(12632256&(h|f<<8|p<<16))!=8421504?c+=a:(E=(7&T)<<18|(63&h)<<12|(63&f)<<6|63&p,E<65536||E>1114111?c+=a:(E-=65536,c+=r(55296+(E>>10),56320+(1023&E)),l+=3))):c+=a:c+=r(T)}return c}function Wi(e,t){let n=t.length,r=0;for(let c=0;c<n;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+t.charCodeAt(++c)-56613888),r+=l<128?1:l<2048?2:l<65536?3:4}Be(e,r);let o=Xa(e,r),a=e.bytes;for(let c=0;c<n;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+t.charCodeAt(++c)-56613888),l<128?a[o++]=l:(l<2048?a[o++]=l>>6&31|192:(l<65536?a[o++]=l>>12&15|224:(a[o++]=l>>18&7|240,a[o++]=l>>12&63|128),a[o++]=l>>6&63|128),a[o++]=63&l|128)}}function CB(e,t){let n=Xa(e,t.limit),r=e.bytes,o=t.bytes;for(let a=0,c=t.limit;a<c;a++)r[a+n]=o[a]}function dw(e){return e.bytes[VE(e,1)]}function lw(e,t){let n=Xa(e,1);e.bytes[n]=t}function jE(e){let t=VE(e,8),n=e.bytes;return Xn[0]=n[t++],Xn[1]=n[t++],Xn[2]=n[t++],Xn[3]=n[t++],Xn[4]=n[t++],Xn[5]=n[t++],Xn[6]=n[t++],Xn[7]=n[t++],UE[0]}function FE(e,t){let n=Xa(e,8),r=e.bytes;UE[0]=t,r[n++]=Xn[0],r[n++]=Xn[1],r[n++]=Xn[2],r[n++]=Xn[3],r[n++]=Xn[4],r[n++]=Xn[5],r[n++]=Xn[6],r[n++]=Xn[7]}function Hi(e){let t,n=0,r=0;do t=dw(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function Be(e,t){for(t>>>=0;t>=128;)lw(e,127&t|128),t>>>=7;lw(e,t)}function qo(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,a=o===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:o<128?9:10,c=Xa(e,a),l=e.bytes;switch(a){case 10:l[c+9]=o>>>7&1;case 9:l[c+8]=a!==9?128|o:127&o;case 8:l[c+7]=a!==8?r>>>21|128:r>>>21&127;case 7:l[c+6]=a!==7?r>>>14|128:r>>>14&127;case 6:l[c+5]=a!==6?r>>>7|128:r>>>7&127;case 5:l[c+4]=a!==5?128|r:127&r;case 4:l[c+3]=a!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=a!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=a!==2?n>>>7|128:n>>>7&127;case 1:l[c]=a!==1?128|n:127&n}}const AB=async(e,t,n)=>{const r=function(c){const l=[];for(let h=0;h<c.length;h+=2)l.push(parseInt(c.slice(h,h+2),16));return Uint8Array.from(l)}(function(c){const l="0123456789abcdef";function h(Ge){let pe,st="";for(pe=0;pe<=3;pe++)st+=l.charAt(Ge>>8*pe+4&15)+l.charAt(Ge>>8*pe&15);return st}function f(Ge,pe){const st=(65535&Ge)+(65535&pe);return(Ge>>16)+(pe>>16)+(st>>16)<<16|65535&st}function p(Ge,pe,st,$e,Nt,cn){return f(function(Ct,Qn){return Ct<<Qn|Ct>>>32-Qn}(f(f(pe,Ge),f($e,cn)),Nt),st)}function E(Ge,pe,st,$e,Nt,cn,Ct){return p(pe&st|~pe&$e,Ge,pe,Nt,cn,Ct)}function T(Ge,pe,st,$e,Nt,cn,Ct){return p(pe&$e|st&~$e,Ge,pe,Nt,cn,Ct)}function y(Ge,pe,st,$e,Nt,cn,Ct){return p(pe^st^$e,Ge,pe,Nt,cn,Ct)}function C(Ge,pe,st,$e,Nt,cn,Ct){return p(st^(pe|~$e),Ge,pe,Nt,cn,Ct)}const A=function(Ge){let pe;const st=1+(Ge.length+8>>6),$e=new Array(16*st);for(pe=0;pe<16*st;pe++)$e[pe]=0;for(pe=0;pe<Ge.length;pe++)$e[pe>>2]|=Ge.charCodeAt(pe)<<pe%4*8;return $e[pe>>2]|=128<<pe%4*8,$e[16*st-2]=8*Ge.length,$e}(c);let O,M,U,q,ae,X=1732584193,Q=-271733879,Y=-1732584194,Z=271733878;for(O=0;O<A.length;O+=16)M=X,U=Q,q=Y,ae=Z,X=E(X,Q,Y,Z,A[O+0],7,-680876936),Z=E(Z,X,Q,Y,A[O+1],12,-389564586),Y=E(Y,Z,X,Q,A[O+2],17,606105819),Q=E(Q,Y,Z,X,A[O+3],22,-1044525330),X=E(X,Q,Y,Z,A[O+4],7,-176418897),Z=E(Z,X,Q,Y,A[O+5],12,1200080426),Y=E(Y,Z,X,Q,A[O+6],17,-1473231341),Q=E(Q,Y,Z,X,A[O+7],22,-45705983),X=E(X,Q,Y,Z,A[O+8],7,1770035416),Z=E(Z,X,Q,Y,A[O+9],12,-1958414417),Y=E(Y,Z,X,Q,A[O+10],17,-42063),Q=E(Q,Y,Z,X,A[O+11],22,-1990404162),X=E(X,Q,Y,Z,A[O+12],7,1804603682),Z=E(Z,X,Q,Y,A[O+13],12,-40341101),Y=E(Y,Z,X,Q,A[O+14],17,-1502002290),Q=E(Q,Y,Z,X,A[O+15],22,1236535329),X=T(X,Q,Y,Z,A[O+1],5,-165796510),Z=T(Z,X,Q,Y,A[O+6],9,-1069501632),Y=T(Y,Z,X,Q,A[O+11],14,643717713),Q=T(Q,Y,Z,X,A[O+0],20,-373897302),X=T(X,Q,Y,Z,A[O+5],5,-701558691),Z=T(Z,X,Q,Y,A[O+10],9,38016083),Y=T(Y,Z,X,Q,A[O+15],14,-660478335),Q=T(Q,Y,Z,X,A[O+4],20,-405537848),X=T(X,Q,Y,Z,A[O+9],5,568446438),Z=T(Z,X,Q,Y,A[O+14],9,-1019803690),Y=T(Y,Z,X,Q,A[O+3],14,-187363961),Q=T(Q,Y,Z,X,A[O+8],20,1163531501),X=T(X,Q,Y,Z,A[O+13],5,-1444681467),Z=T(Z,X,Q,Y,A[O+2],9,-51403784),Y=T(Y,Z,X,Q,A[O+7],14,1735328473),Q=T(Q,Y,Z,X,A[O+12],20,-1926607734),X=y(X,Q,Y,Z,A[O+5],4,-378558),Z=y(Z,X,Q,Y,A[O+8],11,-2022574463),Y=y(Y,Z,X,Q,A[O+11],16,1839030562),Q=y(Q,Y,Z,X,A[O+14],23,-35309556),X=y(X,Q,Y,Z,A[O+1],4,-1530992060),Z=y(Z,X,Q,Y,A[O+4],11,1272893353),Y=y(Y,Z,X,Q,A[O+7],16,-155497632),Q=y(Q,Y,Z,X,A[O+10],23,-1094730640),X=y(X,Q,Y,Z,A[O+13],4,681279174),Z=y(Z,X,Q,Y,A[O+0],11,-358537222),Y=y(Y,Z,X,Q,A[O+3],16,-722521979),Q=y(Q,Y,Z,X,A[O+6],23,76029189),X=y(X,Q,Y,Z,A[O+9],4,-640364487),Z=y(Z,X,Q,Y,A[O+12],11,-421815835),Y=y(Y,Z,X,Q,A[O+15],16,530742520),Q=y(Q,Y,Z,X,A[O+2],23,-995338651),X=C(X,Q,Y,Z,A[O+0],6,-198630844),Z=C(Z,X,Q,Y,A[O+7],10,1126891415),Y=C(Y,Z,X,Q,A[O+14],15,-1416354905),Q=C(Q,Y,Z,X,A[O+5],21,-57434055),X=C(X,Q,Y,Z,A[O+12],6,1700485571),Z=C(Z,X,Q,Y,A[O+3],10,-1894986606),Y=C(Y,Z,X,Q,A[O+10],15,-1051523),Q=C(Q,Y,Z,X,A[O+1],21,-2054922799),X=C(X,Q,Y,Z,A[O+8],6,1873313359),Z=C(Z,X,Q,Y,A[O+15],10,-30611744),Y=C(Y,Z,X,Q,A[O+6],15,-1560198380),Q=C(Q,Y,Z,X,A[O+13],21,1309151649),X=C(X,Q,Y,Z,A[O+4],6,-145523070),Z=C(Z,X,Q,Y,A[O+11],10,-1120210379),Y=C(Y,Z,X,Q,A[O+2],15,718787259),Q=C(Q,Y,Z,X,A[O+9],21,-343485551),X=f(X,M),Q=f(Q,U),Y=f(Y,q),Z=f(Z,ae);return h(X)+h(Q)+h(Y)+h(Z)}(""+t+n)).slice(0,16),o=r.slice(0,12),a=await window.crypto.subtle.importKey("raw",r,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:o},a,e))},uw=async(e,t,n)=>await AB(e.buffer,t,n);function hw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}const OB=new Map([["moderation",1],["supervise",2]]);class Bu extends Et{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Bt.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=bo(n=t.map(r=>OB.get(r)||0)).call(n,(r,o)=>r+o),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),_(this,"name","AgoraRTCVideoContentInspect"),_(this,"_connectionState",gr.CONNECTING),_(this,"_innerConnectionState",void 0),_(this,"sequence",0),_(this,"inspectStartTime",void 0),_(this,"workerManagerConnection",void 0),_(this,"workerConnection",void 0),_(this,"workerMessageLengthLimit",void 0),_(this,"inspectIntervalMinimum",void 0),_(this,"qualityRatio",void 0),_(this,"_connectInfo",void 0),_(this,"_cancelTokenSource",mr.CancelToken.source()),_(this,"_retryConfig",void 0),_(this,"wmSequence",0),_(this,"inspectInterval",void 0),_(this,"inspectTimer",null),_(this,"ossFilePrefix",void 0),_(this,"extraInfo",void 0),_(this,"_inspectType",void 0),_(this,"_inspectMode",void 0),_(this,"_quality",1),_(this,"qualityTimer",null),_(this,"_inspectId",void 0),_(this,"_needWorkUrlOnly",!1),_(this,"inspectImage",()=>{if(this.connectionState!==gr.CONNECTED)throw new N(I.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===gr.CONNECTED?this.requestToInspectImage():v.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=dt(5,"inspect-"),this.workerMessageLengthLimit=L("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=L("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=L("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Fs("worker-manager-"+this._inspectId,Dt),this.on(Bt.STATE_CHANGE,(n,r)=>{this._innerConnectionState=n,v.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Sr[n]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Fs("worker-"+this._inspectId,Dt),this.handleWorkerEvents()}async init(t,n){this.emit(Bt.STATE_CHANGE,Sr.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new se((o,a)=>{this.on(Bt.CONNECTION_STATE_CHANGE,(c,l)=>{l===gr.CONNECTED&&o()}),this.requestAP(t,r,n).then(c=>{this.connectWorkerManager(c)}).catch(c=>{a(c)})})}async requestAP(t,n,r){const o=L("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),a=await function(l,h,f,p){let{appId:E,areaCode:T,cname:y,sid:C,token:A,uid:O}=h;Wa++;const M="image_moderation_api",U={service_name:M,json_body:JSON.stringify({appId:E,areaCode:T,cname:y,command:"allocateEdge",requestId:Wa,seq:Wa,sid:C,token:A,ts:Date.now(),uid:O+""})};let q,ae,X=l[0];return vi(async()=>{q=Date.now();const Q=await Zr(X,{data:U,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ae=Date.now()-q,Q.code!==0){const pe=new N(I.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Q.code,{retry:!0,responseTime:ae});throw v.error(pe.toString()),pe}const Y=JSON.parse(Q.json_body);if(Y.code!==200){const pe=new N(I.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Y.code,", reason: ").concat(Y.reason),{code:Y.code,responseTime:ae});throw v.error(pe.toString()),pe}if(!Y.servers||!Array.isArray(Y.servers)||Y.servers.length===0){const pe=new N(I.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Y.code,responseTime:ae});throw v.error(pe.toString()),pe}const Z=L("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Ge=L("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Y.servers.map(pe=>{let{address:st,wss:$e}=pe;if(st&&$e)return"wss://".concat(st.replace(/\./g,"-"),".").concat(Z,":").concat(Ge||$e)}).filter(pe=>!!pe),workerToken:Y.workerToken,vid:Y.vid,responseTime:ae}},(Q,Y)=>(de.apworkerEvent(C,{success:!0,sc:200,serviceName:M,responseDetail:JSON.stringify(Q.addressList),firstSuccess:Y===0,responseTime:ae,serverIp:l[Y%l.length]}),!1),(Q,Y)=>(de.apworkerEvent(C,{success:!1,sc:Q.data&&Q.data.code||200,serviceName:M,responseTime:ae,serverIp:l[Y%l.length]}),!!(Q.code!==I.OPERATION_ABORTED&&Q.code!==I.UNEXPECTED_RESPONSE||Q.data&&Q.data.retry)&&(X=l[(Y+1)%l.length],!0)),p)}(o,t,n,r);this.emit(Bt.STATE_CHANGE,Sr.AP_CONNECTED);const{addressList:c}=a;return this.wmSequence++,c}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Bt.STATE_CHANGE,Sr.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(ve.CONNECTED,async()=>{this.emit(Bt.STATE_CHANGE,Sr.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.18.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(ve.CLOSED,()=>{this._innerConnectionState<Sr.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(ve.FAILED,()=>{this._innerConnectionState<Sr.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(ve.RECONNECTING,()=>{this._innerConnectionState<Sr.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(ve.ON_MESSAGE,async t=>{this.emit(Bt.STATE_CHANGE,Sr.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(t.data);if(r.code!==200)throw v.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new N(I.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&n))throw v.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new N(I.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const o=L("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,a=n.replace(/:\d+\/?$/,":".concat(o));this.emit(Bt.STATE_CHANGE,Sr.CONNECT_WORKER,a),this._needWorkUrlOnly?this.emit(Bt.REQUEST_NEW_WORKER_URL,a):await this.connectWorker(a)}}),this.workerManagerConnection.on(ve.WILL_RECONNECT,(t,n)=>{n(t)}),this.workerManagerConnection.on(ve.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(ve.CONNECTED,async()=>{this.emit(Bt.STATE_CHANGE,Sr.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=gr.CONNECTED}),this.workerConnection.on(ve.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const r=SB(new Uint8Array(t.data));if(L("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&v.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Bt.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var n;const o={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},a=bo(n=Object.keys(o)).call(n,(l,h)=>o[l]>o[h]?l:h,"porn"),c=Object.keys(o).find(l=>l===a);this.emit(Bt.INSPECT_RESULT,c)}else this.emit(Bt.INSPECT_RESULT,void 0,new N(I.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(Bt.INSPECT_RESULT,void 0,new N(I.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else v.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Bt.INSPECT_RESULT,void 0,new N(I.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(ve.CLOSED,()=>{this.connectionState=gr.CLOSED}),this.workerConnection.on(ve.FAILED,()=>{this.connectionState=gr.CLOSED}),this.workerConnection.on(ve.RECONNECTING,()=>{this.connectionState=this.connectionState===gr.CONNECTED?gr.RECONNECTING:gr.CONNECTING}),this.workerConnection.on(ve.WILL_RECONNECT,(t,n)=>{t==="recover"&&n(t),n("tryNext")}),this.workerConnection.on(ve.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(Bt.REQUEST_NEW_WORKER_URL,r=>{t([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{n(r)})})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){this.sequence++;const t=ti(this,Bt.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Bt.INSPECT_RESULT,void 0,new N(I.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(t,n);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(Bt.INSPECT_RESULT,void 0,new N(I.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:r,cname:o,cid:a,vid:c,sid:l,uid:h}=n;const f=Date.now(),p=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await uw(p,r,o),T=this.sequence+"-"+a+"-"+h+"-"+f+"-"+dt(12,""),y={appId:r,cid:a,cname:o,deviceId:"",elapse:Bu.intToLong(Number(f-this.inspectStartTime)),fileSize:E.byteLength,jpgEncryption:2,height:p.height,width:p.width,jpg:E,networkType:6,osType:7,requestId:T,sdkVersion:"4.18.1",sequence:this.sequence,sid:l,timestamp:Bu.intToLong(f),uid:h,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete y.callbackData,this.ossFilePrefix===void 0&&delete y.ossFilePrefix;const C=gB(y);if(C.byteLength<this.workerMessageLengthLimit){if(L("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const A=function(O){for(var M=1;M<arguments.length;M++){var U=arguments[M]!=null?arguments[M]:{};M%2?hw(Object(U),!0).forEach(function(q){_(O,q,U[q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(U)):hw(Object(U)).forEach(function(q){Object.defineProperty(O,q,Object.getOwnPropertyDescriptor(U,q))})}return O}({},y);delete A.jpg,v.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(A))}return C}{const A=this.quality*this.qualityRatio;return this.quality=A,await this.generateRequestData(t,{appId:r,cname:o,cid:a,vid:c,sid:l,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=mr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=gr.CLOSED,this.emit(Bt.STATE_CHANGE,Sr.CLOSED)}}function wB(e){let t=function(){const n=DB.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,r){let o=n.appId;o!==void 0&&(wt(r,10),Ks(r,o));let a=n.cid;a!==void 0&&(wt(r,16),wt(r,a));let c=n.cname;c!==void 0&&(wt(r,26),Ks(r,c));let l=n.deviceId;l!==void 0&&(wt(r,34),Ks(r,l));let h=n.elapse;h!==void 0&&(wt(r,40),Jo(r,h));let f=n.fileSize;f!==void 0&&(wt(r,48),Jo(r,Qa(f)));let p=n.height;p!==void 0&&(wt(r,56),Jo(r,Qa(p)));let E=n.jpg;E!==void 0&&(wt(r,66),wt(r,E.length),fw(r,E));let T=n.networkType;T!==void 0&&(wt(r,72),Jo(r,Qa(T)));let y=n.osType;y!==void 0&&(wt(r,80),Jo(r,Qa(y)));let C=n.requestId;C!==void 0&&(wt(r,90),Ks(r,C));let A=n.sdkVersion;A!==void 0&&(wt(r,98),Ks(r,A));let O=n.sequence;O!==void 0&&(wt(r,104),Jo(r,Qa(O)));let M=n.sid;M!==void 0&&(wt(r,114),Ks(r,M));let U=n.timestamp;U!==void 0&&(wt(r,120),Jo(r,U));let q=n.uid;q!==void 0&&(wt(r,128),wt(r,q));let ae=n.vid;ae!==void 0&&(wt(r,136),wt(r,ae));let X=n.width;X!==void 0&&(wt(r,144),Jo(r,Qa(X)));let Q=n.service;Q!==void 0&&(wt(r,152),wt(r,Q));let Y=n.callbackData;Y!==void 0&&(wt(r,162),wt(r,Y.length),fw(r,Y));let Z=n.ticket;Z!==void 0&&(wt(r,170),Ks(r,Z))}(e,t),function(n){let r=n.bytes,o=n.limit;return r.length===o?r:r.subarray(0,o)}(t)}function NB(e){return function(n){let r={};e:for(;!PB(n);){let o=hd(n);switch(o>>>3){case 0:break e;case 1:r.code=hd(n);break;case 2:r.msg=mw(n,hd(n));break;case 3:r.requestId=mw(n,hd(n));break;case 4:r.timestamp=LB(n,!1);break;default:bB(n,7&o)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function bB(e,t){switch(t){case 0:for(;128&oi(e););break;case 2:BE(e,hd(e));break;case 5:BE(e,4);break;case 1:BE(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Qa(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let DB=[];function BE(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function PB(e){return e.offset>=e.limit}function Gu(e,t){let n=e.bytes,r=e.offset,o=e.limit,a=r+t;if(a>n.length){let c=new Uint8Array(2*a);c.set(n),e.bytes=c}return e.offset=a,a>o&&(e.limit=a),r}function pw(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function fw(e,t){let n=Gu(e,t.length);e.bytes.set(t,n)}function mw(e,t){let n=pw(e,t),r=String.fromCharCode,o=e.bytes,a="",c="";for(let l=0;l<t;l++){let h,f,p,E,T=o[l+n];128&T?(224&T)==192?l+1>=t?c+=a:(h=o[l+n+1],(192&h)!=128?c+=a:(E=(31&T)<<6|63&h,E<128?c+=a:(c+=r(E),l++))):(240&T)==224?l+2>=t?c+=a:(h=o[l+n+1],f=o[l+n+2],(49344&(h|f<<8))!=32896?c+=a:(E=(15&T)<<12|(63&h)<<6|63&f,E<2048||E>=55296&&E<=57343?c+=a:(c+=r(E),l+=2))):(248&T)==240?l+3>=t?c+=a:(h=o[l+n+1],f=o[l+n+2],p=o[l+n+3],(12632256&(h|f<<8|p<<16))!=8421504?c+=a:(E=(7&T)<<18|(63&h)<<12|(63&f)<<6|63&p,E<65536||E>1114111?c+=a:(E-=65536,c+=r(55296+(E>>10),56320+(1023&E)),l+=3))):c+=a:c+=r(T)}return c}function Ks(e,t){let n=t.length,r=0;for(let c=0;c<n;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+t.charCodeAt(++c)-56613888),r+=l<128?1:l<2048?2:l<65536?3:4}wt(e,r);let o=Gu(e,r),a=e.bytes;for(let c=0;c<n;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+t.charCodeAt(++c)-56613888),l<128?a[o++]=l:(l<2048?a[o++]=l>>6&31|192:(l<65536?a[o++]=l>>12&15|224:(a[o++]=l>>18&7|240,a[o++]=l>>12&63|128),a[o++]=l>>6&63|128),a[o++]=63&l|128)}}function oi(e){return e.bytes[pw(e,1)]}function Ew(e,t){let n=Gu(e,1);e.bytes[n]=t}function hd(e){let t,n=0,r=0;do t=oi(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function wt(e,t){for(t>>>=0;t>=128;)Ew(e,127&t|128),t>>>=7;Ew(e,t)}function LB(e,t){let n,r=0,o=0,a=0;return n=oi(e),r=127&n,128&n&&(n=oi(e),r|=(127&n)<<7,128&n&&(n=oi(e),r|=(127&n)<<14,128&n&&(n=oi(e),r|=(127&n)<<21,128&n&&(n=oi(e),o=127&n,128&n&&(n=oi(e),o|=(127&n)<<7,128&n&&(n=oi(e),o|=(127&n)<<14,128&n&&(n=oi(e),o|=(127&n)<<21,128&n&&(n=oi(e),a=127&n,128&n&&(n=oi(e),a|=(127&n)<<7))))))))),{low:r|o<<28,high:o>>>4|a<<24,unsigned:t}}function Jo(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,a=o===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:o<128?9:10,c=Gu(e,a),l=e.bytes;switch(a){case 10:l[c+9]=o>>>7&1;case 9:l[c+8]=a!==9?128|o:127&o;case 8:l[c+7]=a!==8?r>>>21|128:r>>>21&127;case 7:l[c+6]=a!==7?r>>>14|128:r>>>14&127;case 6:l[c+5]=a!==6?r>>>7|128:r>>>7&127;case 5:l[c+4]=a!==5?128|r:127&r;case 4:l[c+3]=a!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=a!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=a!==2?n>>>7|128:n>>>7&127;case 1:l[c]=a!==1?128|n:127&n}}const _w={},gw={},Sw=4294967296,Tw=18446744073709552e3,vw=Tw/2,GE=yw(0,!0),Rw=yw(0),kB=$a(0,-2147483648,!1),MB=$a(-1,2147483647,!1),UB=$a(-1,-1,!0);function yw(e,t){let n,r,o;return t?(o=0<=(e>>>=0)&&e<256)&&(r=gw[e],r)?r:(n=$a(e,0,!0),o&&(gw[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(r=_w[e],r)?r:(n=$a(e,e<0?-1:0,!1),o&&(_w[e]=n),n)}function $a(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function xB(e,t){if(isNaN(e))return t?GE:Rw;if(t){if(e<0)return GE;if(e>=Tw)return UB}else{if(e<=-vw)return kB;if(e+1>=vw)return MB}return e<0?t?GE:Rw:$a(e%Sw|0,e/Sw|0,t)}function Iw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}class WE extends Et{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Mr.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),_(this,"name","AgoraRTCImageModeration"),_(this,"_connectionState",or.CONNECTING),_(this,"_sequence",0),_(this,"_moderationStartTime",void 0),_(this,"_workerConnection",void 0),_(this,"_workerMessageLengthLimit",void 0),_(this,"_qualityRatio",void 0),_(this,"_connectInfo",void 0),_(this,"_cancelTokenSource",mr.CancelToken.source()),_(this,"_retryConfig",void 0),_(this,"_moderationInterval",void 0),_(this,"_moderationTimer",null),_(this,"_moderationMode",1),_(this,"_quality",1),_(this,"_qualityTimer",null),_(this,"_ticket",void 0),_(this,"_moderationIntervalMinimum",void 0),_(this,"_uploadFailedNum",0),_(this,"_uploadNum",0),_(this,"_uploadTimer",null),_(this,"_moderationId",void 0),_(this,"inspectImage",()=>{if(this.connectionState!==or.CONNECTED)throw new N(I.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===or.CONNECTED?this.requestToInspectImage():v.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=dt(5,"image-moderation-"),this._workerMessageLengthLimit=L("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=L("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,this._qualityRatio=L("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Fs("worker-"+this._moderationId,Dt),this.on(Mr.STATE_CHANGE,(r,o)=>{v.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Fo[r]," ").concat(o||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(Mr.STATE_CHANGE,Fo.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new se((o,a)=>{this.on(Mr.CONNECTION_STATE_CHANGE,(c,l)=>{c===or.CONNECTED&&o()}),this.requestAP(t,r,n).then(c=>{this.connectWorker(c)}).catch(c=>{a(c)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,v.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===or.CONNECTED&&this.inspectImage()}async requestAP(t,n,r){const o=L("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),a=await function(h,f,p,E){let{appId:T,areaCode:y,cname:C,sid:A,token:O,uid:M}=f;Wa++;const U="moderation_plugin",q={service_name:U,json_body:JSON.stringify({appId:T,areaCode:y,cname:C,command:"allocateEdge",requestId:Wa,seq:Wa,sid:A,appToken:O,ts:Date.now(),uid:M+""})};let ae,X,Q=h[0];return vi(async()=>{ae=Date.now();const Y=await Zr(Q,{data:q,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(X=Date.now()-ae,Y.code!==0){const pe=new N(I.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Y.code,{retry:!0,responseTime:X});throw v.error(pe.toString()),pe}const Z=JSON.parse(Y.json_body);if(Z.code!==200){const pe=new N(I.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Z.code,", reason: ").concat(Z.reason),{code:Z.code,responseTime:X});throw v.error(pe.toString()),pe}if(!Z.servers||!Array.isArray(Z.servers)||Z.servers.length===0){const pe=new N(I.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Z.code,responseTime:X});throw v.error(pe.toString()),pe}if(!Z.servers.some(pe=>!!pe.wss)){const pe=new N(I.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Z.code,responseTime:X});throw v.error(pe.toString()),pe}const Ge=L("IMAGE_MODERATION_WORKER_HOST");return{addressList:Z.servers.map(pe=>{let{address:st,wss:$e}=pe;if(st&&$e)return"wss://".concat(st.replace(/\./g,"-"),".").concat(Ge,":").concat($e,"/moderation")}).filter(pe=>!!pe),workerToken:Z.workerToken,vid:Z.vid,ticket:Z.appTicket,responseTime:X}},(Y,Z)=>(de.apworkerEvent(A,{success:!0,sc:200,serviceName:U,responseDetail:JSON.stringify(Y.addressList),firstSuccess:Z===0,responseTime:X,serverIp:h[Z%h.length]}),!1),(Y,Z)=>(de.apworkerEvent(A,{success:!1,sc:Y.data&&Y.data.code||200,serviceName:U,responseTime:X,serverIp:h[Z%h.length]}),!!(Y.code!==I.OPERATION_ABORTED&&Y.code!==I.UNEXPECTED_RESPONSE||Y.data&&Y.data.retry)&&(Q=h[(Z+1)%h.length],!0)),E)}(o,t,n,r);this.emit(Mr.STATE_CHANGE,Fo.AP_CONNECTED);const{addressList:c,ticket:l}=a;return this._ticket=l,c}async connectWorker(t){this.emit(Mr.STATE_CHANGE,Fo.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(ve.CONNECTED,async()=>{this.emit(Mr.STATE_CHANGE,Fo.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=or.CONNECTED}),this._workerConnection.on(ve.CLOSED,()=>{this.connectionState=or.CLOSED}),this._workerConnection.on(ve.FAILED,()=>{this.connectionState=or.CLOSED}),this._workerConnection.on(ve.RECONNECTING,()=>{this.connectionState=this.connectionState===or.CONNECTED?or.RECONNECTING:or.CONNECTING}),this._workerConnection.on(ve.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=NB(new Uint8Array(t.data));L("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,v.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{de.reportApiInvoke(this._connectInfo.sid||null,{name:Pt.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:ft.TRACER}).onError(new N(I.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},L("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else v.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(ve.WILL_RECONNECT,(t,n)=>{t==="recover"&&n(t),n("tryNext")}),this._workerConnection.on(ve.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=ti(this,Mr.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(L("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(t,n);this._workerConnection.sendMessage(r,!0,!0)}else L("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:r,cname:o,cid:a,vid:c,sid:l,uid:h}=n;const f=Date.now(),p=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await uw(p,r,o),T=this._sequence+"-"+a+"-"+h+"-"+f+"-"+dt(12,""),y={appId:r,cid:a,cname:o,deviceId:"",elapse:WE.intToLong(Number(f-this._moderationStartTime)),fileSize:p.buffer.byteLength,height:p.height,width:p.width,jpg:E,networkType:6,osType:7,requestId:T,sdkVersion:"4.18.1",sequence:this._sequence,sid:l,timestamp:xB(f),uid:h,vid:c,service:this._moderationMode,ticket:this._ticket},C=wB(y);if(C.byteLength<this._workerMessageLengthLimit){if(L("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const A=function(O){for(var M=1;M<arguments.length;M++){var U=arguments[M]!=null?arguments[M]:{};M%2?Iw(Object(U),!0).forEach(function(q){_(O,q,U[q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(U)):Iw(Object(U)).forEach(function(q){Object.defineProperty(O,q,Object.getOwnPropertyDescriptor(U,q))})}return O}({},y);delete A.jpg,v.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(A))}return C}{const A=this.quality*this._qualityRatio;return this.quality=A,await this.generateRequestData(t,{appId:r,cname:o,cid:a,vid:c,sid:l,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=mr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=or.CLOSED,this.emit(Mr.STATE_CHANGE,Fo.CLOSED)}}var Cw,Aw,Ow,ww,Nw,bw,Dw,Pw,Lw,kw,Mw,Uw,xw,Vw,jw,Fw,Bw,Gw,Ww,Hw,Kw,Yw,zw,qw,Jw,Xw,Qw,$w,Zw,e0,t0,n0,r0,i0,o0,s0,a0,c0,d0,ee;function l0(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function pd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?l0(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l0(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let VB=(Cw=fe(),Aw=fe({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),t.map(n=>n?Object(n).toString():"null"))}),Ow=fe({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId()))}),ww=fe({argsMap:(e,t,n)=>[t.uid,n]}),Nw=fe({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:o}=n;return[r==null?void 0:r.uid,o]})}),bw=fe({argsMap:(e,t,n)=>[t.uid,n]}),Dw=fe({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:o}=n;return{uid:r==null?void 0:r.uid,mediaType:o}})}),Pw=fe(),Lw=fe(),kw=fe(),Mw=fe(),Uw=fe(),xw=fe(),Vw=fe(),jw=fe(),Fw=fe(),Bw=fe(),Gw=fe(),Ww=fe(),Hw=fe(),Kw=fe(),Yw=fe({argsMap:(e,t)=>[t]}),zw=fe(),qw=fe(),Jw=fe(),Xw=fe(),Qw=fe(),$w=fe(),Zw=fe(),e0=fe(),t0=fe(),n0=fe(),r0=fe({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),i0=fe(),o0=fe(),s0=fe(),a0=fe(),c0=fe({reportResult:!0}),d0=fe(),K((ee=class extends Et{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),_(this,"store",void 0),_(this,"_uid",void 0),_(this,"_channelName",void 0),_(this,"_uintUid",void 0),_(this,"_users",[]),_(this,"_config",void 0),_(this,"_clientId",void 0),_(this,"_appId",void 0),_(this,"_sessionId",null),_(this,"_key",void 0),_(this,"_joinInfo",void 0),_(this,"_gateway",void 0),_(this,"_statsCollector",void 0),_(this,"_configDistribute",void 0),_(this,"_leaveMutex",new Mn("client-leave")),_(this,"_publishMutex",new Mn("client-publish")),_(this,"_renewTokenMutex",new Mn("client-renewtoken")),_(this,"_subscribeMutex",new Mn("client-subscribe")),_(this,"_encryptionMode","none"),_(this,"_encryptionSecret",null),_(this,"_encryptionSalt",null),_(this,"_proxyServer",void 0),_(this,"_turnServer",{servers:[],mode:"auto"}),_(this,"_cloudProxyServerMode","disabled"),_(this,"_isDualStreamEnabled",!1),_(this,"_defaultStreamFallbackType",void 0),_(this,"_lowStreamParameter",void 0),_(this,"_streamFallbackTypeCacheMap",new Map),_(this,"_remoteStreamTypeCacheMap",new Map),_(this,"_axiosCancelSource",mr.CancelToken.source()),_(this,"_audioVolumeIndicationInterval",void 0),_(this,"_networkQualityInterval",void 0),_(this,"_userOfflineTimeout",void 0),_(this,"_streamRemovedTimeout",void 0),_(this,"_injectStreamingClient",void 0),_(this,"_liveTranscodeStreamingClient",void 0),_(this,"_liveRawStreamingClient",void 0),_(this,"_channelMediaRelayClient",void 0),_(this,"_networkQualitySensitivity","normal"),_(this,"_p2pChannel",void 0),_(this,"_useLocalAccessPoint",!1),_(this,"_setLocalAPVersion",void 0),_(this,"_joinAndNotLeaveYet",!1),_(this,"_numberOfJoinCount",0),_(this,"_remoteDefaultVideoStreamType",void 0),_(this,"_inspect",void 0),_(this,"_moderation",void 0),_(this,"_license",void 0),_(this,"_handleLocalTrackEnable",(n,r,o)=>{this.publish(n,!1).then(r).catch(o)}),_(this,"_handleLocalTrackDisable",(n,r,o)=>{this.unpublish(n).then(r).catch(o)}),_(this,"_handleUserOnline",n=>{if(L("BLOCK_LOCAL_CLIENT")&&ks(n.uid,this.channelName))return void v.debug("[".concat(n.uid,"] will be ignored in local"));this.isStringUID&&typeof n.uid!="string"&&v.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const r=this._users.find(o=>o.uid===n.uid);if(r)r._trust_in_room_=!0;else{const o=new aE(n.uid,n.uint_id||n.uid);this._users.push(o),v.debug("[".concat(this._clientId,"] user online"),n.uid),this.safeEmit(De.USER_JOINED,o)}}),_(this,"_handleUserOffline",n=>{if(L("BLOCK_LOCAL_CLIENT")&&ks(n.uid,this.channelName))return;const r=this._users.find(o=>o.uid===n.uid);r&&(this._handleRemoveStream(n),Qm(this._users,r),this._remoteStreamTypeCacheMap.delete(r.uid),this._streamFallbackTypeCacheMap.delete(r.uid),v.debug("[".concat(this._clientId,"] user offline"),n.uid,"reason:",n.reason),this.safeEmit(De.USER_LEAVED,r,n.reason))}),_(this,"_handleAddAudioOrVideoStream",(n,r,o,a,c,l,h)=>{if(L("BLOCK_LOCAL_CLIENT")&&ks(r,this.channelName))return;const f=this._users.find(E=>E.uid===r);if(!f)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));v.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(n)),this.store.subscribe(f.uid,n,void 0,void 0,void 0,Date.now());const p=n==="audio"?f.hasAudio:f.hasVideo;f._uintid||(f._uintid=c||r),n==="audio"?f._trust_audio_stream_added_state_=!0:f._trust_video_stream_added_state_=!0,n==="audio"?(f._audio_added_=!0,o!==void 0&&(f._audioSSRC=o),a!==void 0&&(f._cname=a),l&&(f._audioOrtc=l)):(f._video_added_=!0,o!==void 0&&(f._videoSSRC=o),a!==void 0&&(f._cname=a),h!==void 0&&(f._rtxSsrcId=h),l&&(f._videoOrtc=l)),(n==="audio"?f.hasAudio:f.hasVideo)&&!p&&(v.info("[".concat(this._clientId,"] remote user ").concat(f.uid," published ").concat(n)),this.safeEmit(De.USER_PUBLISHED,f,n)),n==="video"?de.onGatewayStream(this._sessionId,on.ON_ADD_VIDEO_STREAM,_t.ON_ADD_VIDEO_STREAM,{peer:c||r}):de.onGatewayStream(this._sessionId,on.ON_ADD_AUDIO_STREAM,_t.ON_ADD_AUDIO_STREAM,{peer:c||r}),this._p2pChannel.remoteMediaSsrcChanged(f,n,o).then(E=>{if(E)return v.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(f.uid," after rejoin because SSRC id changed.")),this._p2pChannel.unsubscribe(f,n,!0).then(()=>this._subscribe(f,n,!0).catch(T=>{v.error("[".concat(this._clientId,"] resubscribe error"),T.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(f,n)&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(f.uid," after reconnect.")),this._subscribe(f,n,!0).catch(E=>{v.error("[".concat(this._clientId,"] resubscribe error"),E.toString())}))}),_(this,"_handleRemoveStream",n=>{if(L("BLOCK_LOCAL_CLIENT")&&ks(n.uid,this.channelName))return;const r=this._users.find(a=>a.uid===n.uid);if(!r)return void v.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));v.debug("[".concat(this._clientId,"] stream removed with uid ").concat(n.uid));let o=()=>{};r.hasAudio&&r.hasVideo?o=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(De.USER_UNPUBLISHED,r,"audio"),v.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(De.USER_UNPUBLISHED,r,"video")}:r.hasVideo?o=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(De.USER_UNPUBLISHED,r,"video")}:r.hasAudio&&(o=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(De.USER_UNPUBLISHED,r,"audio")}),r._trust_audio_stream_added_state_=!0,r._trust_video_stream_added_state_=!0,r._audio_added_=!1,r._video_added_=!1,this._p2pChannel.unsubscribe(r).then(a=>{if(a)return this._gateway.unsubscribe(a,r.uid)}),r._audioSSRC=void 0,r._videoSSRC=void 0,r._audioOrtc=void 0,r._videoOrtc=void 0,r._rtxSsrcId=void 0,de.onGatewayStream(this._sessionId,on.ON_REMOVE_STREAM,_t.ON_REMOVE_STREAM,{peer:n.uint_id||n.uid}),o()}),_(this,"_handleSetStreamLocalEnable",(n,r,o)=>{if(L("BLOCK_LOCAL_CLIENT")&&ks(r,this.channelName))return;const a=this._users.find(h=>h.uid===r);if(!a)return void v.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));v.debug("[".concat(this._clientId,"] local ").concat(n," ").concat(o?"enabled":"disabled"," with uid ").concat(r));const c=n==="audio"?a.hasAudio:a.hasVideo;if(n==="audio"){a._trust_audio_enabled_state_=!0;const h=a._audio_enabled_;if(a._audio_enabled_=o,a._audio_enabled_===h)return;{const f=a._audio_enabled_?"enable-local-audio":"disable-local-audio";v.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(r,", msg: ").concat(f)),this.safeEmit(De.USER_INFO_UPDATED,r,f)}}else{a._trust_video_enabled_state_=!0;const h=a._video_enabled_;if(a._video_enabled_=o,a._video_enabled_===h)return;{const f=a._video_enabled_?"enable-local-video":"disable-local-video";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(f)),this.safeEmit(De.USER_INFO_UPDATED,r,f)}}const l=n==="audio"?a.hasAudio:a.hasVideo;return c!==l?!c&&l?(v.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(n)),void this.safeEmit(De.USER_PUBLISHED,a,n)):(n==="video"&&a._videoTrack&&a._videoTrack._destroy(),n==="audio"&&a._audioTrack,this._p2pChannel.muteRemote(a,n),v.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(n)),void this.safeEmit(De.USER_UNPUBLISHED,a,n)):void 0}),_(this,"_handleMuteStream",(n,r,o)=>{if(L("BLOCK_LOCAL_CLIENT")&&ks(n,this.channelName))return;v.debug("[".concat(this._clientId,"] receive mute message"),n,r,o);const a=this._users.find(h=>h.uid===n);if(!a)return void v.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(n));const c=r==="audio"?a.hasAudio:a.hasVideo;if(r==="audio"){a._trust_audio_mute_state_=!0;const h=a._audio_muted_;if(a._audio_muted_=o,a._audio_muted_===h)return;{const f=a._audio_muted_?"mute-audio":"unmute-audio";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(f)),this.safeEmit(De.USER_INFO_UPDATED,n,f)}}else{a._trust_video_mute_state_=!0;const h=a._video_muted_;if(a._video_muted_=o,a._video_muted_===h)return;{const f=a._video_muted_?"mute-video":"unmute-video";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(f)),this.safeEmit(De.USER_INFO_UPDATED,n,f)}}const l=r==="audio"?a.hasAudio:a.hasVideo;if(c!==l){if(!c&&l)return(r==="audio"?a._audioSSRC:a._videoSSRC)?(v.info("[".concat(this._clientId,"] remote user ").concat(n," published ").concat(r)),void this.safeEmit(De.USER_PUBLISHED,a,r)):void v.warning("[".concat(this._clientId,"] remote user ").concat(n," receive ").concat(r," unmute message  before add stream message, ").concat(r," SSRC doesn't exist yet."));r==="video"&&a._videoTrack&&a._videoTrack._destroy(),r==="audio"&&a._audioTrack,this._p2pChannel.muteRemote(a,r),v.info("[".concat(this._clientId,"] remote user ").concat(n," unpublished ").concat(r)),this.safeEmit(De.USER_UNPUBLISHED,a,r)}}),_(this,"_handleP2PLost",async n=>{v.debug("[".concat(this._clientId,"] receive p2p lost"),n),parseInt(n.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():v.warning("[".concat(this._clientId,"] P2PLost stream not found"),n)}),_(this,"_handleTokenWillExpire",()=>{v.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(De.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),_(this,"_handleBeforeUnload",n=>{n.type==="beforeunload"&&n.returnValue!==void 0&&n.returnValue!==""||(this.leave(),v.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),_(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(De.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const n={downlinkNetworkQuality:0,uplinkNetworkQuality:0};n.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),n.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(De.NETWORK_QUALITY,n)}),this._config=e,this._clientId=dt(5,"client-"),this.store=new EB(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),v.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(kr," build: ").concat(hm,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{wy(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(n){v.warning("[".concat(this._clientId,"] ").concat(n.toString()))}this._statsCollector=new Fa(this.store),this._statsCollector.onStatsException=(n,r,o)=>{v.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(n,", msg: ").concat(r,", uid: ").concat(o)),this.safeEmit(De.EXCEPTION,{code:n,msg:r,uid:o})},this._statsCollector.onUploadPublishDuration=(n,r,o,a)=>{const c=this._users.find(l=>l.uid===n);c&&de.peerPublishStatus(this._sessionId,{subscribeElapse:a,audioPublishDuration:r,videoPublishDuration:o,peer:c._uintid})},this.store.useDataChannel=Ot().supportDataChannel&&L("SIGNAL_CHANNEL"),this._gateway=new eF(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Dt,httpRetryConfig:e.httpRetryConfig||Dt,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new dF,this._p2pChannel=new mB(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async join(e,t,n,r,o){const a=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const c=_B(),l=rw()?window.isSecureContext:"Browser Not Support";if(!rw()&&!c||!window.isSecureContext){const y="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";v.warning(y)}const h=Xm();this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),v.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const f=de.reportApiInvoke(h,{name:Pt.JOIN,options:[e,t,n,r],states:{isHttps:c,isSecureContext:l},tag:ft.TRACER});de.setAppId(e);try{if(!n&&n!==null)throw new N(I.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&fn(n,"token",1,2047),fn(e,"appid",1,2047),Rm(t),r&&ym(r),o&&fn(o,"optionalInfo",1,2047)}catch(y){throw f.onError(y),y}if(v.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(a)),this._leaveMutex.isLocked&&(v.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),v.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const y=new N(I.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw f.onError(y),y}this._sessionId||(this._sessionId=h,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const p=pd({clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:o,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(p.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(p.stringUid=r,this._uintUid?(p.uid=this._uintUid,this._uintUid=void 0):p.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(p.aesmode=this._encryptionMode,p.aespassword=await(async y=>{const C=$m(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),A=await window.crypto.subtle.importKey("spki",C,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),O=Fm(y),M=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},A,O);return vu(new Uint8Array(M))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new N(I.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(p.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:t,appId:e});const E=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&E===this._sessionId&&de.joinChannelTimeout(this._sessionId,5)},5e3);try{let y;const C=p.cloudProxyServer;if(["proxy3","proxy4","proxy5"].includes(C)){const U=L("PROXY_SERVER_TYPE3");Array.isArray(U)?p.proxyServer=U[0]:p.proxyServer=U}if(de.setProxyServer(p.proxyServer),v.setProxyServer(p.proxyServer),this.store.requestAPStart(),p.stringUid&&!p.uid){const U=await MC(p.stringUid,p,this._axiosCancelSource.token,this._config.httpRetryConfig||Dt,this.store);v.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(p.stringUid," => ").concat(U)),p.uid=U,y=await kC(p,this._axiosCancelSource.token,this._config.httpRetryConfig||Dt,!0,this.store)}else y=await kC(p,this._axiosCancelSource.token,this._config.httpRetryConfig||Dt,!0,this.store);if(!this._joinAndNotLeaveYet)throw new N(I.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(p,this._axiosCancelSource.token),this._configDistribute.on(Xc.UPDATE_BITRATE_LIMIT,U=>{this._p2pChannel.updateBitrateLimit(U)})},0),this._key=n||e;const A=y.gatewayInfo;this._joinInfo=pd(pd({},p),{},{cid:A.cid,uid:p.uid?p.uid:A.uid,vid:A.vid,apResponse:A.res,uni_lbs_ip:A.uni_lbs_ip,gatewayAddrs:A.gatewayAddrs});const O=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new N(I.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));f.onSuccess(O),this._appId=e,this._channelName=p.cname,this._uid=O,this.store.uid=O,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Dn()?"beforeunload":"pagehide",this._handleBeforeUnload)},0);const M=p.stringUid?"string uid: ".concat(p.stringUid,",uid: ").concat(p.uid):"uid: ".concat(this._uid);return v.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(M)),setTimeout(()=>{v.startUpload()},5e3),this.store.joinEnd(),T=this,Ls.includes(T)||Ls.push(T),O}catch(y){const C=Array.isArray(y)?y[0]:y;throw C&&C.code===I.OPERATION_ABORTED?v.warning("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),C):v.error("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),C),C.code!==I.OPERATION_ABORTED&&this._numberOfJoinCount===a&&(this._gateway.state="DISCONNECTED",this._reset()),f.onError(C),C}var T}_joinGateway(){if(!this._joinInfo||!this._key)throw new N(I.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!L("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(e=>e).catch(e=>{if(e.code===I.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,Ke.FALLBACK),e;if(e.code===I.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,Ke.FALLBACK),e;throw e}).then(e=>{if(e instanceof N){if(e.code===I.INIT_WEBSOCKET_TIMEOUT){if(v.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new N(I.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const t=L("PROXY_SERVER_TYPE3");if(Array.isArray(t))if(this._joinInfo.apUrl){const r=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),o=r.slice(r.length-2).join(".");t.forEach(a=>{this._joinInfo&&a.includes(o)&&(this._joinInfo.proxyServer=a)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=t[0])}else this._joinInfo.proxyServer=t[0];else this._joinInfo.proxyServer=t;const n=L("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return n&&n[1]&&n[1]!=="443"&&v.setProxyServer(this._joinInfo.proxyServer),L("STATS_COLLECTOR_PORT").toString()!=="443"&&de.setProxyServer(this._joinInfo.proxyServer),de.reportApiInvoke(this._sessionId,{name:Pt.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:ft.TRACER}).onSuccess(),this.safeEmit(De.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),L("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(r=>{"forceturn"in r&&(r.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(v.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new N(I.INVALID_OPERATION);return de.reportApiInvoke(this._sessionId,{name:Pt.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:ft.TRACER}).onSuccess(),this._joinGateway()}return e}).then(e=>e)}async leave(){v.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Dn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=Ls.indexOf(t);n!==-1&&Ls.splice(n,1)}(this);const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return v.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),v.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(Array.isArray(e)||(e=[e]),e.length===0)throw new N(I.INVALID_PARAMS,"track list is empty");if(this._gateway.role==="audience")throw new N(I.INVALID_OPERATION,"audience can not publish stream");for(const r of e){if(!(r instanceof Bm))throw new N(I.INVALID_PARAMS,"parameter is not local track");if(!r._enabled&&t)throw new N(I.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(r.getTrackId()))}v.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(e.map(r=>"".concat(r.getTrackId()," "))));const n=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&e.forEach(r=>{const o=this._configDistribute.getBitrateLimit();r instanceof Ut&&o&&r.setBitrateLimit(o.uplink)});try{await this._publishHighStream(e),v.info("[".concat(this._clientId,"] Publish success, id ").concat(e.map(r=>"".concat(r.getTrackId()," "))))}catch(r){throw v.error("[".concat(this._clientId,"] publish error"),r.toString()),r}finally{n()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new N(I.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");e?Array.isArray(e)||(e=[e]):e=this._p2pChannel.getAllTracks(!0),v.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(n=>"".concat(n.getTrackId()," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublish(e);n&&await this._gateway.unpublish(n,this._uid),v.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(r=>"".concat(r.getTrackId()))))}catch(n){throw v.error("[".concat(this._clientId,"] unpublish error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t){return this._subscribe(e,t)}async _subscribe(e,t,n){if($t(t,"mediaType",["audio","video"]),!this._joinInfo)throw new N(I.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new N(I.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===e)){const h=new N(I.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),h}if(!e.hasAudio&&!e.hasVideo){const h=new N(I.INVALID_REMOTE_USER,"user is not published");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),h}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const h=new N(I.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),h}const r=t==="audio"?e._audioSSRC:e._videoSSRC,o=t==="audio"?e._audioOrtc:e._videoOrtc,a=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?Ce.AUDIO:Ce.VIDEO,ssrcId:r},l=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{Ur.markSubscribeStart(this.store.clientId,r),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,r,a,o);try{await this._gateway.subscribe(e.uid,c,!0)}catch(f){if((f==null?void 0:f.code)!==I.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),f;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(f){throw this._p2pChannel.reportSubscribeEvent(!1,f==null?void 0:f.code,e,t),f}v.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(f=>{v.warning("[".concat(this._clientId,"] auto set fallback failed"),f)});const h=t==="audio"?e._audioTrack:e._videoTrack;if(!h)throw new N(I.UNEXPECTED_ERROR,"can not find remote track in user object");return h}catch(h){throw v.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),h),h}finally{l()}}async massSubscribe(e){if(io(e,"subscribeList"),!this._joinInfo)throw new N(I.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new N(I.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(l=>{let{user:h,mediaType:f}=l;return"user: ".concat(h==null?void 0:h.uid,", mediaType: ").concat(f)}).join("; ")));const o=(e=[...e]).map(l=>{let{user:h,mediaType:f}=l;return{user:h,mediaType:f}}),a=await this._p2pChannel.globalLock();try{var c;for(let h=e.length-1;h>=0;h--){const f=e[h],{user:p,mediaType:E}=f;if($t(E,"mediaType",["audio","video"]),!p){const C=new N(I.INVALID_PARAMS,"user property does not exist in subscribeList item");throw v.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),C}if(!this._users.find(C=>C===p)){const C=new N(I.INVALID_REMOTE_USER,"user is not in the channel");v.error("[".concat(this._clientId,"] can not massSubscribe ").concat(p.uid,", this user is not in the channel")),o[h].error=C,e.splice(h,1);continue}if(E==="audio"&&(!p.hasAudio||p._audioSSRC===void 0)||E==="video"&&(!p.hasVideo||p._videoSSRC===void 0)){const C=new N(I.REMOTE_USER_IS_NOT_PUBLISHED);v.error("[".concat(this._clientId,"] can not subscribe ").concat(p.uid," with mediaType ").concat(E,", remote user is not published")),o[h].error=C,e.splice(h,1);continue}const T=Lt.Video|Lt.LwoVideo,y=n.get(p);if(y){if(E==="video"?y&T:y&Lt.Audio){e.splice(h,1),v.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(p.uid,", mediaType:").concat(E," twice"));continue}n.set(p,y|(E==="video"?T:Lt.Audio))}else n.set(p,E==="video"?T:Lt.Audio)}for(let h=e.length-1;h>=0;h--){const f=e[h],{user:p,mediaType:E}=f,T=Lt.Video|Lt.LwoVideo;if(this._p2pChannel.hasRemoteMedia(p,E)){await this._p2pChannel.unmuteRemoteNoLock(p,E);const y=n.get(p);n.set(p,E==="video"?y^T:y^Lt.Audio),e.splice(h,1)}}this.store.massSubscribe(e.map(h=>({userId:h.user.uid,type:h.mediaType})),t);const l=bo(c=Array.from(n.entries())).call(c,(h,f)=>{let[p,E]=f;if(E===0)return h;const T={stream_id:p.uid,stream_type:E};return E&Lt.Audio&&(T.audio_ssrc=p._audioSSRC),E&Lt.Video&&(T.video_ssrc=p._videoSSRC),h.push(T),h},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(f=>{let{user:p,mediaType:E}=f;return{user:p,mediaType:E,ssrcId:E===Ce.VIDEO?p._videoSSRC:p._audioSSRC,rtxSsrcId:E===Ce.VIDEO?p._rtxSsrcId:void 0}}));const h=new Map;if(l.length>0){const f=await this._gateway.subscribeAll(l,!0);((f==null?void 0:f.users)||[]).forEach(p=>{let{stream_id:E,video_error_code:T,audio_error_code:y,error_code:C}=p;(T||y||C)&&h.set(E,{video_error_code:T,audio_error_code:y,error_code:C})})}if(Array.from(h.entries()).length>0){const f=Array.from(h.entries()).map(p=>{let E,[T,y]=p;return y.error_code||y.video_error_code&&y.audio_error_code?E=void 0:y.video_error_code?E=Ce.VIDEO:y.audio_error_code&&(E=Ce.AUDIO),{user:this.remoteUsers.find(C=>C.uid===T),mediaType:E}});await this._p2pChannel.massUnsubscribeNoLock(f)}for(const f of o){const p=h.get(f.user.uid);if(p){const E=p.error_code||f.mediaType==="audio"&&p.audio_error_code||f.mediaType==="video"&&p.video_error_code;if(E){const T=ed(E);v.error("user:".concat(f.user.uid," mediaType:").concat(f.mediaType," has massSubscribe error ").concat(T.desc)),f.error=new N(I.SUBSCRIBE_FAILED,"code ".concat(E,": ").concat(T.desc))}}f.error||(f.mediaType==="video"?f.track=f.user.videoTrack:f.track=f.user.audioTrack)}return this.store.massSubscribe(o.filter(f=>!f.error).map(f=>({userId:f.user.uid,type:f.mediaType})),void 0,Date.now()),o.forEach(f=>{var p;de.subscribe(this.store.sessionId,{succ:!!f.error,ec:((p=f.error)===null||p===void 0?void 0:p.code)||null,video:f.mediaType===Ce.VIDEO,audio:f.mediaType===Ce.AUDIO,peerid:f.user.uid,subscribeRequestid:f.mediaType===Ce.VIDEO?f.user._videoSSRC:f.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t)},!0)}),v.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(f=>{let{user:p,mediaType:E}=f;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(E)}).join("; "))),o}catch(h){throw await this._p2pChannel.massUnsubscribeNoLock(e),h}}finally{a(),r()}}async unsubscribe(e,t){if(t&&$t(t,"mediaType",["audio","video"]),!this._joinInfo)throw new N(I.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(r=>r===e)){const r=new N(I.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),r}v.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const n=await this._subscribeMutex.lock();try{const r=await this._p2pChannel.unsubscribe(e,t);r&&await this._gateway.unsubscribe(r,e.uid),v.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}catch(r){if(r.code===I.DISCONNECT_P2P)return void v.warning("disconnecting p2p, abort unsubscribe request.");throw v.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),r.toString()),r}finally{n()}}async massUnsubscribe(e){if(io(e,"unsubscribeList"),!this._joinInfo)throw new N(I.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");v.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:r,mediaType:o}=n;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(o,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:o}=e[n];if(!r){const c=new N(I.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw v.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),c}if($t(o,"mediaType",["video","audio",void 0]),!this._users.find(c=>c===r)){v.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const a=Lt.Video|Lt.LwoVideo;if(t.has(r)){const c=t.get(r);let l;switch(o){case"video":l=c&a;break;case"audio":l=c&Lt.Audio;break;default:l=c&(Lt.Audio|a)}if(l){v.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(o," twice.")),e.splice(n,1);continue}o?o==="audio"?t.set(r,c|Lt.Audio):o==="video"&&t.set(r,c|a):t.set(r,c|Lt.Audio|a)}else o?o==="audio"?t.set(r,Lt.Audio):o==="video"&&t.set(r,a):t.set(r,Lt.Audio|a)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),v.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:o,mediaType:a}=r;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(a,";")}).join()))}catch(n){if(n.code===I.DISCONNECT_P2P)return void v.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw v.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}setLowStreamParameter(e){(function(n){if(!n)throw new N(I.INVALID_PARAMS);ut(n.width)||vm(n.width,"streamParameter.width"),ut(n.height)||vm(n.height,"streamParameter.height"),ut(n.framerate)||vm(n.framerate,"streamParameter.framerate"),ut(n.bitrate)||it(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&v.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),v.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e}async enableDualStream(){if(!Ot().supportDualStream)throw de.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new N(I.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new N(I.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw de.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,de.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),v.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new N(I.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(ce.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw de.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,de.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),v.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(n){$t(n,"role",["audience","host"])}(e),t&&wy(t),this.mode==="rtc")throw v.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new N(I.INVALID_OPERATION,"rtc mode can not use setClientRole");if(t&&t.level&&e==="host")throw new N(I.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new N(I.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,v.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}setProxyServer(e,t){if(fn(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new N(I.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new N(I.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,de.setProxyServer(this._proxyServer),v.setProxyServer(this._proxyServer),v.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new N(I.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new N(I.INVALID_OPERATION,"You have already set the proxy")}if(qc(e))return this._turnServer={servers:e,mode:"original-manual"},void v.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>Oy(n)),this._turnServer={servers:e,mode:"manual"},v.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new N(I.INVALID_OPERATION,"you should set license before join channel");if(fn(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new N(I.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,v.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new N(I.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new N(I.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new N(I.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new N(I.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,v.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new N(I.INVALID_OPERATION,"Stop proxy server after leave channel");de.setProxyServer(),v.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",v.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new N(I.INVALID_PARAMS,"accessPoints is required.");io(e.accessPoints.serverList,"accessPoints.serverList"),fn(e.accessPoints.domain,"accessPoints.domain");const t=(T,y)=>{it(T,y,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new N(I.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");L("CLOSE_AFB_FOR_LOCAL_AP")&&(nt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),nt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,o=e.accessPoints.domain,a=e.accessPoints.serverList.map(T=>r.test(T)?"".concat(T.replace(/\./g,"-"),".").concat(o):T),c=a.map(T=>"".concat(T,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,nt("WEBCS_DOMAIN",c),nt("WEBCS_DOMAIN_BACKUP_LIST",c),nt("GATEWAY_DOMAINS",[o]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(io(e.report.hostname,"report.hostname"),nt("EVENT_REPORT_DOMAIN",e.report.hostname[0]),nt("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(nt("EVENT_REPORT_DOMAIN",a[0]),nt("EVENT_REPORT_BACKUP_DOMAIN",a[1]||a[0]));let l=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),l=e.report.port),nt("STATS_COLLECTOR_PORT",l),e.report?nt("ENABLE_EVENT_REPORT",!0):nt("ENABLE_EVENT_REPORT",!1);let h="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(io(e.log.hostname,"log.hostname"),h=e.log.hostname[0]):h=a[0];let f=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),f=e.log.port),nt("LOG_UPLOAD_SERVER","".concat(h,":").concat(f));let p=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(io(e.cds.hostname,"cds.hostname"),p=e.cds.hostname):p=a;let E=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),E=e.cds.port),nt("CDS_AP",p.map(T=>"".concat(T,":").concat(E))),e.cds?nt("ENABLE_CONFIG_DISTRIBUTE",!0):nt("ENABLE_CONFIG_DISTRIBUTE",!1),v.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(io(e,"serverList"),fn(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new N(I.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(r=>n.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,nt("WEBCS_DOMAIN",e),nt("WEBCS_DOMAIN_BACKUP_LIST",e),nt("GATEWAY_DOMAINS",[t]),nt("EVENT_REPORT_DOMAIN",e[0]),nt("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),nt("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),v.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if($t(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw v.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else v.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){$t(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(r=>r.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw v.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}v.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){$t(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw v.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}v.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n){if(function(r){$t(r,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),fn(t,"secret"),["aes-128-gcm2","aes-256-gcm2"].includes(e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new N(I.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new N(I.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||v.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=vu(n))}async renewToken(e){if(fn(e,"token",1,2047),!this._key||!this._joinInfo)throw new N(I.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(L("USE_NEW_TOKEN")){v.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await cF(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Dt);v.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else v.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});v.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,v.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?v.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(De.VOLUME_INDICATOR,e)},L("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new N(I.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new N(I.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new N(I.LIVE_STREAMING_TASK_CONFLICT);const n=t?jt.TRANSCODE:jt.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(jt.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new N(I.INVALID_PARAMS,"can not find live streaming url to stop");await se.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async addInjectStreamUrl(e,t){if(!this._joinInfo)throw new N(I.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const n=this._createLiveStreamingClient(jt.INJECT);n.setInjectStreamConfig(t,0),await n.startLiveStreamingTask(e,jt.INJECT)}async removeInjectStreamUrl(){var e;const t=this._createLiveStreamingClient(jt.INJECT),n=Array.from(Fi(e=t.streamingTasks).call(e)).find(r=>r.mode===jt.INJECT);if(!this._joinInfo||!n)throw new N(I.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await t.stopLiveStreamingTask(n.url)}async startChannelMediaRelay(e){WC(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){WC(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendStreamMessage(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new N(I.INVALID_OPERATION,"can not send data stream, not joined");if(typeof e=="string"&&(e=new TextEncoder().encode(e)),new Blob([e]).size>1024)throw new N(I.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(Ee.DATA_STREAM,{payload:vu(e)},!t)}sendMetadata(e){if(!this._joinInfo)throw new N(I.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new N(I.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ee.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:vu(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(RV),!this._joinInfo)throw new N(I.INVALID_OPERATION,"can not send custom report, not joined");await de.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){$t(t.spatialLayer,"spatialLayer",[0,1,2,3]),$t(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw v.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}_reset(){if(v.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=mr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy()}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Mn("client-publish"),this._subscribeMutex=new Mn("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){const n=e||Xm();e?v.debug("[".concat(this._clientId,"] new Session ").concat(n)):v.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n)),this._sessionId=n,this.store.sessionId=n,t?de.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:t.channel,appid:t.appId,mode:this.mode}):this._joinInfo?de.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&de.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=n),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new N(I.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new N(I.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&L("FORCE_TURN")&&!L("TURN_ENABLE_TCP")&&!L("TURN_ENABLE_UDP"))throw new N(I.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");v.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter),r=(await n.next()).value;if(r){var t;let o;try{o=await this._gateway.publish(this._uid,r,!0)}catch(a){if(a.code!==I.DISCONNECT_P2P)throw n.throw(a),a}await n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const o of e)o instanceof Ut&&o._encoderConfig&&this._gateway.setVideoProfile(o._encoderConfig),!o.muted&&o.enabled||await this._p2pChannel.muteLocalTrack(o)}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===I.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new N(I.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new N(I.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));v.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await n.next()).value;if(r){var t;let o;try{o=await this._gateway.publish(this._uid,r,!0)}catch(a){if(a.code!==I.DISCONNECT_P2P)throw n.throw(a),a}n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===I.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new N(I.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const t=()=>new uF(this._joinInfo,this._config.websocketRetryConfig||Dt,this._config.httpRetryConfig||Dt),n=r=>{r.onLiveStreamError=(o,a)=>{de.reportApiInvoke(this._sessionId,{name:Pt.ON_LIVE_STREAM_ERROR,options:[o,a],tag:ft.TRACER}).onSuccess(),this.safeEmit(De.LIVE_STREAMING_ERROR,o,a)},r.onLiveStreamWarning=(o,a)=>{de.reportApiInvoke(this._sessionId,{name:Pt.ON_LIVE_STREAM_WARNING,options:[o,a],tag:ft.TRACER}).onSuccess(),this.safeEmit(De.LIVE_STREAMING_WARNING,o,a)},r.on(La.REQUEST_WORKER_MANAGER_LIST,(o,a,c)=>{if(!this._joinInfo)return c(new N(I.INVALID_OPERATION,"can not find join info to get worker manager"));xC(o,this._joinInfo,this._axiosCancelSource.token,Dt).then(a).catch(c)})};switch(e){case jt.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),n(this._liveRawStreamingClient)),this._liveRawStreamingClient;case jt.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),n(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case jt.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on(La.REQUEST_WORKER_MANAGER_LIST,(r,o,a)=>{if(!this._joinInfo)return a(new N(I.INVALID_OPERATION,"can not find join info to get worker manager"));xC(r,this._joinInfo,this._axiosCancelSource.token,Dt).then(o).catch(a)}),this._injectStreamingClient.onInjectStatusChange=(r,o,a)=>{this.emit(De.INJECT_STREAM_STATUS,r,o,a)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new N(I.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:t}=this.getLocalVideoStats(),n={width:e,height:t};this._channelMediaRelayClient=new pF(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Dt,this._config.httpRetryConfig||Dt,n),this._channelMediaRelayClient.on("state",r=>{r===kn.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(De.CHANNEL_MEDIA_RELAY_STATE,r)}),this._channelMediaRelayClient.on("event",r=>{this.safeEmit(De.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._statsCollector.onStatsChanged=(r,o)=>{var a;r==="resolution"&&((a=this._channelMediaRelayClient)===null||a===void 0||a.setVideoProfile(o))}}return this._channelMediaRelayClient}_handleGatewayEvents(){this._gateway.on(mt.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(mt.CONNECTION_STATE_CHANGE,(e,t,n)=>{var r;if(n===Ke.FALLBACK)return;const o=()=>{this.safeEmit(De.CONNECTION_STATE_CHANGE,e,t,n)};if(de.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:Pt.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:ft.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),v.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void o();if(e==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._audioSSRC=void 0,c._videoSSRC=void 0,c._videoOrtc=void 0,c._audioOrtc=void 0,c._cname=void 0,c._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var a;this._streamFallbackTypeCacheMap.forEach((c,l)=>{this._gateway.setStreamFallbackOption(l,c).catch(h=>{v.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),h)})}),this._remoteStreamTypeCacheMap.forEach((c,l)=>{this._gateway.setRemoteVideoStreamType(l,c).catch(h=>{v.warning("[".concat(this._clientId,"] auto set remote stream type failed"),h)})}),this._remoteDefaultVideoStreamType!==void 0&&((a=this._joinInfo)===null||a===void 0?void 0:a.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{v.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{v.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{v.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(v.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,"audio",!1)),c._trust_video_mute_state_||(v.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,"video",!1)),c._trust_audio_enabled_state_||(v.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(v.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(v.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(v.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(v.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3)}o()}),this._gateway.on(mt.REQUEST_NEW_GATEWAY_LIST,(e,t)=>{if(!this._joinInfo)return t(new N(I.UNEXPECTED_ERROR,"can not recover, no join info"));iE(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Dt,this.store).then(n=>{this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip),e(n.gatewayInfo.gatewayAddrs.map(r=>{if(this._joinInfo&&this._joinInfo.proxyServer){const o=r.address.split(":");return"wss://".concat(this._joinInfo.proxyServer,"/ws/?h=").concat(o[0],"&p=").concat(o[1])}return"wss://".concat(r.address)}))}).catch(t)}),this._gateway.on(mt.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(De.NETWORK_QUALITY,e)}),this._gateway.on(mt.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(De.STREAM_TYPE_CHANGED,e,t),de.reportApiInvoke(this._sessionId,{name:Pt.STREAM_TYPE_CHANGE,options:[e,t],tag:ft.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(mt.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(mt.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(mt.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{t(await this._p2pChannel.startP2PConnection(e))}catch(r){n(r)}}),this._gateway.on(mt.JOIN_RESPONSE,(e,t)=>{const{dtlsParameters:n,iceParameters:r,candidates:o,rtpCapabilities:a,setup:c,cname:l}=hO(e.ortc,t);this._p2pChannel.connect(r,n,o,a,c,l)}),this._gateway.on(mt.REQUEST_DC_CONNECTION_PARAMS,e=>{e(this._p2pChannel.getEstablishParams())}),this._gateway.on(mt.RESET_SIGNAL,e=>{this._p2pChannel.resetConnection(e),this._handleGatewaySignalEvents()}),this._gateway.on(mt.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(mt.DATACHANNEL_PRECONNECT,async(e,t,n,r)=>{var o,a,c,l,h,f;await this._p2pChannel.startP2PConnection({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},!0);const p=function(E,T){let y;return T&&T.ip&&typeof T.port=="number"?(y=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:T.ip,port:T.port.toString(),type:"host",extension:{}}],v.debug("Using remote candidate from AP ".concat(T.ip,":").concat(T.port)),T.ip6&&(y.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:T.ip6,port:T.port.toString(),type:"host",extension:{}}),v.debug("Using IPV6 remote candidate from AP ".concat(T.ip6,":").concat(T.port)))):y=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:E.ip,port:E.port.toString(),type:"host",extension:{}}],y}(e,t);return this._p2pChannel.preConnect({iceUfrag:"".concat((a=this._joinInfo)===null||a===void 0?void 0:a.apResponse.cid,"_").concat((c=this._joinInfo)===null||c===void 0?void 0:c.apResponse.cert),icePwd:"".concat((l=this._joinInfo)===null||l===void 0?void 0:l.apResponse.cid,"_").concat((h=this._joinInfo)===null||h===void 0?void 0:h.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(f=L("FINGERPRINT"))!==null&&f!==void 0?f:e.fingerprint}]},p,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(n).catch(r)})}_handleGatewaySignalEvents(){this._gateway.signal.on(Ne.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Ne.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Ne.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(Ne.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Ne.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Ne.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Ne.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,"audio",!0)),this._gateway.signal.on(Ne.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,"audio",!1)),this._gateway.signal.on(Ne.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,"video",!0)),this._gateway.signal.on(Ne.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,"video",!1)),this._gateway.signal.on(Ne.RECEIVE_METADATA,e=>{const t=$m(e.metadata);this.safeEmit(De.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Ne.ON_DATA_STREAM,e=>{e.seq&&delete e.seq,e.payload=$m(e.payload),this.safeEmit(De.STREAM_MESSAGE,e.uid,e.payload),this.onStreamMessage&&this.onStreamMessage(e)}),this._gateway.signal.on(Ne.ON_CRYPT_ERROR,()=>{$c(()=>{v.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(De.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Ne.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Ne.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{v.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0),this.safeEmit(De.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Ne.ON_STREAM_FALLBACK_UPDATE,e=>{v.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(De.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Ne.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),v.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Ne.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Ne.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(he.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Ee.PUBLISH:{if(!t)return;const c=(t=t).ortc;if(c){var n,r,o,a;const l=c.some(p=>{let{stream_type:E}=p;return E===Ft.Audio}),h=c.some(p=>{let{stream_type:E}=p;return E!==Ft.Audio}),f=c.some(p=>{let{stream_type:E}=p;return E===Ft.Screen||E===Ft.ScreenLow});t.state==="offer"&&de.publish(this._joinInfo.sid,{eventElapse:Ur.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:I.TIMEOUT,audio:l,video:h,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:f,audioName:l?(n=c.find(p=>{let{stream_type:E}=p;return E===Ft.Audio}))===null||n===void 0||(r=n.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0,videoName:h?(o=c.find(p=>{let{stream_type:E}=p;return E!==Ft.Audio}))===null||o===void 0||(a=o.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0})}break}case Ee.SUBSCRIBE:(t=t)&&de.subscribe(this._joinInfo.sid,{succ:!1,ec:I.TIMEOUT,audio:t.stream_type===Ce.AUDIO,video:t.stream_type===Ce.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:Ur.measureFromSubscribeStart(this.store.clientId,t.ssrcId)})}}),this._gateway.signal.on(Ne.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Ne.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;L("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(r=>!ks(r.audio_ssrc,this.channelName)));const t=[],n=[];for(const r of e.users){let o=this._users.find(f=>f.uid===r.stream_id);o?o._trust_in_room_=!0:(o=new aE(r.stream_id,r.stream_id),this._users.push(o),this.getListeners(De.PUBLISHED_USER_LIST).length===0&&(v.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(De.USER_JOINED,o)));const a=Lt.Audio&r.stream_type,c=(Lt.Video|Lt.LwoVideo)&r.stream_type,l=a&&o.hasAudio,h=c&&o.hasVideo;c&&(o._trust_video_stream_added_state_=!0,o._video_added_=!0,o._videoSSRC=r.video_ssrc,o._rtxSsrcId=r.video_rtx),a&&(o._trust_audio_stream_added_state_=!0,o._audio_added_=!0,o._audioSSRC=r.audio_ssrc),a&&!l&&this.getListeners(De.PUBLISHED_USER_LIST).length===0&&(v.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published audio")),this.safeEmit(De.USER_PUBLISHED,o,"audio")),c&&!h&&this.getListeners(De.PUBLISHED_USER_LIST).length===0&&(v.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published video")),this.safeEmit(De.USER_PUBLISHED,o,"video")),(a&&!l||c&&!h)&&t.push(o),c&&this._p2pChannel.hasPendingRemoteMedia(o,"video")&&n.push({user:o,mediaType:"video"}),a&&this._p2pChannel.hasPendingRemoteMedia(o,"audio")&&n.push({user:o,mediaType:"audio"})}n.length>0&&(v.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(r=>{v.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(De.PUBLISHED_USER_LIST).length>0?(v.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(r=>r.uid).join(", "))),this.safeEmit(De.PUBLISHED_USER_LIST,t)):v.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(r=>r.uid).join(", ")))})}_handleP2PChannelEvents(){this._p2pChannel.on(Ue.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===I.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Ue.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===I.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Ue.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(Ue.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:r,kind:o}of e)o===Ce.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){n(r)}}),this._p2pChannel.on(Ue.RequestUploadStats,(e,t)=>{this._gateway.uploadStats(e,t)}),this._p2pChannel.on(Ue.MediaReconnectStart,e=>{this.safeEmit(De.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Ue.MediaReconnectEnd,e=>{this.safeEmit(De.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Ue.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ue.RequestRestartICE,async e=>{const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let o;try{o=await this._gateway.restartICE({iceParameters:r})}catch(c){return void t.throw(c)}const{iceParameters:a}=function(c){const l=c.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}}(o);await t.next({remoteIceParameters:a})}),this._p2pChannel.on(Ue.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Ue.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:o,gatewayAddress:a}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),{dtlsParameters:c,iceParameters:l,candidates:h,rtpCapabilities:f,setup:p,cname:E}=hO(o,a);await this._p2pChannel.connect(l,c,h,f,p,E),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Ue.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(Ue.P2PLost,()=>{this.safeEmit(De.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ue.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Ue.ConnectionTypeChange,e=>{this.safeEmit(De.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Ue.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ue.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new N(I.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new N(I.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!e)throw new N(I.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!e.inspectType||!Array.isArray(e.inspectType))throw new N(I.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const t=[...new Set(e.inspectType)];t.forEach(n=>{if(!["supervise","moderation"].includes(n))throw new N(I.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(n," is not a valid inspect type."))}),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new N(I.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const t=new Bu(e);this._inspect=t,this.handleVideoInspectEvents(this._inspect),await t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},Dt)}catch(t){throw Array.isArray(t)?t[0]:t}}async disableContentInspect(){if(!this._inspect)throw new N(I.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Da(e,"enabled"),e){if(!t)throw new N(I.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(it(t.interval,"interval",1e3,1/0),this.connectionState!=="CONNECTED"||!this._joinInfo)throw new N(I.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(t);const n=new WE(t);this._moderation=n,this.handleImageModerationEvents(this._moderation),await n.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},Dt)}catch(n){throw Array.isArray(n)?n[0]:n}}else{if(!this._moderation)throw new N(I.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(n){throw Array.isArray(n)?n[0]:n}}}handleImageModerationEvents(e){e.on(Mr.CONNECTION_STATE_CHANGE,(t,n)=>{switch(this.emit(De.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t){case or.CONNECTED:if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new N(I.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Mr.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}handleVideoInspectEvents(e){e.on(Bt.CONNECTION_STATE_CHANGE,(t,n)=>{switch(this.emit(De.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n){case gr.CONNECTED:if(this.connectionState!=="CONNECTED")return void this.emit(De.CONTENT_INSPECT_ERROR,new N(I.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Bt.INSPECT_RESULT,(t,n)=>{var r;if((n==null?void 0:n.code)===I.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return v.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.emit(De.CONTENT_INSPECT_RESULT,t,n)}),e.on(Bt.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return v.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Da(e,"enabled"),nt("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}}).prototype,"leave",[Cw],Object.getOwnPropertyDescriptor(ee.prototype,"leave"),ee.prototype),K(ee.prototype,"publish",[Aw],Object.getOwnPropertyDescriptor(ee.prototype,"publish"),ee.prototype),K(ee.prototype,"unpublish",[Ow],Object.getOwnPropertyDescriptor(ee.prototype,"unpublish"),ee.prototype),K(ee.prototype,"subscribe",[ww],Object.getOwnPropertyDescriptor(ee.prototype,"subscribe"),ee.prototype),K(ee.prototype,"massSubscribe",[Nw],Object.getOwnPropertyDescriptor(ee.prototype,"massSubscribe"),ee.prototype),K(ee.prototype,"unsubscribe",[bw],Object.getOwnPropertyDescriptor(ee.prototype,"unsubscribe"),ee.prototype),K(ee.prototype,"massUnsubscribe",[Dw],Object.getOwnPropertyDescriptor(ee.prototype,"massUnsubscribe"),ee.prototype),K(ee.prototype,"setLowStreamParameter",[Pw],Object.getOwnPropertyDescriptor(ee.prototype,"setLowStreamParameter"),ee.prototype),K(ee.prototype,"enableDualStream",[Lw],Object.getOwnPropertyDescriptor(ee.prototype,"enableDualStream"),ee.prototype),K(ee.prototype,"disableDualStream",[kw],Object.getOwnPropertyDescriptor(ee.prototype,"disableDualStream"),ee.prototype),K(ee.prototype,"setClientRole",[Mw],Object.getOwnPropertyDescriptor(ee.prototype,"setClientRole"),ee.prototype),K(ee.prototype,"setProxyServer",[Uw],Object.getOwnPropertyDescriptor(ee.prototype,"setProxyServer"),ee.prototype),K(ee.prototype,"setTurnServer",[xw],Object.getOwnPropertyDescriptor(ee.prototype,"setTurnServer"),ee.prototype),K(ee.prototype,"setLicense",[Vw],Object.getOwnPropertyDescriptor(ee.prototype,"setLicense"),ee.prototype),K(ee.prototype,"startProxyServer",[jw],Object.getOwnPropertyDescriptor(ee.prototype,"startProxyServer"),ee.prototype),K(ee.prototype,"stopProxyServer",[Fw],Object.getOwnPropertyDescriptor(ee.prototype,"stopProxyServer"),ee.prototype),K(ee.prototype,"setLocalAccessPointsV2",[Bw],Object.getOwnPropertyDescriptor(ee.prototype,"setLocalAccessPointsV2"),ee.prototype),K(ee.prototype,"setLocalAccessPoints",[Gw],Object.getOwnPropertyDescriptor(ee.prototype,"setLocalAccessPoints"),ee.prototype),K(ee.prototype,"setRemoteDefaultVideoStreamType",[Ww],Object.getOwnPropertyDescriptor(ee.prototype,"setRemoteDefaultVideoStreamType"),ee.prototype),K(ee.prototype,"setRemoteVideoStreamType",[Hw],Object.getOwnPropertyDescriptor(ee.prototype,"setRemoteVideoStreamType"),ee.prototype),K(ee.prototype,"setStreamFallbackOption",[Kw],Object.getOwnPropertyDescriptor(ee.prototype,"setStreamFallbackOption"),ee.prototype),K(ee.prototype,"setEncryptionConfig",[Yw],Object.getOwnPropertyDescriptor(ee.prototype,"setEncryptionConfig"),ee.prototype),K(ee.prototype,"renewToken",[zw],Object.getOwnPropertyDescriptor(ee.prototype,"renewToken"),ee.prototype),K(ee.prototype,"enableAudioVolumeIndicator",[qw],Object.getOwnPropertyDescriptor(ee.prototype,"enableAudioVolumeIndicator"),ee.prototype),K(ee.prototype,"startLiveStreaming",[Jw],Object.getOwnPropertyDescriptor(ee.prototype,"startLiveStreaming"),ee.prototype),K(ee.prototype,"setLiveTranscoding",[Xw],Object.getOwnPropertyDescriptor(ee.prototype,"setLiveTranscoding"),ee.prototype),K(ee.prototype,"stopLiveStreaming",[Qw],Object.getOwnPropertyDescriptor(ee.prototype,"stopLiveStreaming"),ee.prototype),K(ee.prototype,"addInjectStreamUrl",[$w],Object.getOwnPropertyDescriptor(ee.prototype,"addInjectStreamUrl"),ee.prototype),K(ee.prototype,"removeInjectStreamUrl",[Zw],Object.getOwnPropertyDescriptor(ee.prototype,"removeInjectStreamUrl"),ee.prototype),K(ee.prototype,"startChannelMediaRelay",[e0],Object.getOwnPropertyDescriptor(ee.prototype,"startChannelMediaRelay"),ee.prototype),K(ee.prototype,"updateChannelMediaRelay",[t0],Object.getOwnPropertyDescriptor(ee.prototype,"updateChannelMediaRelay"),ee.prototype),K(ee.prototype,"stopChannelMediaRelay",[n0],Object.getOwnPropertyDescriptor(ee.prototype,"stopChannelMediaRelay"),ee.prototype),K(ee.prototype,"sendCustomReportMessage",[r0],Object.getOwnPropertyDescriptor(ee.prototype,"sendCustomReportMessage"),ee.prototype),K(ee.prototype,"pickSVCLayer",[i0],Object.getOwnPropertyDescriptor(ee.prototype,"pickSVCLayer"),ee.prototype),K(ee.prototype,"enableContentInspect",[o0],Object.getOwnPropertyDescriptor(ee.prototype,"enableContentInspect"),ee.prototype),K(ee.prototype,"disableContentInspect",[s0],Object.getOwnPropertyDescriptor(ee.prototype,"disableContentInspect"),ee.prototype),K(ee.prototype,"setImageModeration",[a0],Object.getOwnPropertyDescriptor(ee.prototype,"setImageModeration"),ee.prototype),K(ee.prototype,"getJoinChannelServiceRecords",[c0],Object.getOwnPropertyDescriptor(ee.prototype,"getJoinChannelServiceRecords"),ee.prototype),K(ee.prototype,"setPublishAudioFilterEnabled",[d0],Object.getOwnPropertyDescriptor(ee.prototype,"setPublishAudioFilterEnabled"),ee.prototype),ee);class jB extends iI{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(zn.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),_(this,"audioBuffer",void 0),_(this,"sourceNode",void 0),_(this,"startPlayTime",0),_(this,"startPlayOffset",0),_(this,"pausePlayTime",0),_(this,"options",void 0),_(this,"currentLoopCount",0),_(this,"currentPlaybackSpeed",100),_(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):v.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const u0=new Map;async function FB(e,t){let n=null;if(typeof e=="string"){const o=u0.get(e);if(o)return v.debug("use cached audio resource: ",e),o;try{n=(await vi(()=>mr.get(e,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(a){throw new N(I.FETCH_AUDIO_FILE_FAILED,a.toString())}}else n=await new se((a,c)=>{const l=new FileReader;l.onload=h=>{h.target?a(h.target.result):c(new N(I.READ_LOCAL_AUDIO_FILE_ERROR))},l.onerror=()=>{c(new N(I.READ_LOCAL_AUDIO_FILE_ERROR))},l.readAsArrayBuffer(e)});const r=await function(o){const a=xa();return new se((c,l)=>{a.decodeAudioData(o,h=>{c(h)},h=>{l(new N(I.DECODE_AUDIO_FILE_FAILED,h.toString()))})})}(n);return typeof e=="string"&&t&&u0.set(e,r),r}function h0(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Wu(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?h0(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h0(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function HE(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=Wu(Wu({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?v.debug("[".concat(e,"] set content hint to"),n.optimizationMode):v.debug("[".concat(e,"] set content hint failed")))):v.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}const BB=He().name;function GB(e,t,n,r){let o,a=0,c=null;return new se((l,h)=>{setTimeout(()=>{o&&(o(),l(a))},t),o=nI(()=>{(function(){a>r&&o&&(o(),l(a));const f=n.getContext("2d");if(!f){const T=new N(I.UNEXPECTED_ERROR,"can not get canvas 2d context.");return v.error(T.toString()),void h(T)}f.drawImage(e,0,0,160,120);const p=f.getImageData(0,0,n.width,n.height),E=Math.floor(p.data.length/3);if(c){for(let T=0;T<E;T+=3)if(p.data[T]!==c[T])return a+=1,void(c=p.data);c=p.data}else c=p.data})()},30)})}class fd{constructor(t,n){_(this,"id",0),_(this,"element",void 0),_(this,"peerPair",void 0),_(this,"context",void 0),_(this,"audioPlayerElement",void 0),_(this,"audioTrack",void 0),fd.count+=1,this.id=fd.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(r,o)=>{const a=o==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(a),r.iceGatheringState==="complete"?r.localDescription:new se(c=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&c(r.localDescription)}})},n=async(r,o)=>await r.setRemoteDescription(o);try{const r=await t(this.peerPair[0],"offer");await n(this.peerPair[1],r);const o=await t(this.peerPair[1],"answer");await n(this.peerPair[0],o)}catch(r){throw new N(I.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(o){throw new N(I.LOCAL_AEC_ERROR,o.toString()).print()}if(!n)throw new N(I.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=n.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){v.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var p0,Hu;_(fd,"count",0);const WB=window.AudioContext||window.webkitAudioContext,HB=new(p0=fe({report:de}),K((Hu=class{constructor(){_(this,"units",[]),_(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return v.debug("the system does not need to process local aec"),-1;this.context||(this.context=new WB);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new fd(e,this.context),this.units.push(t)),t.startEchoCancellation(),v.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return He().name!==Xe.SAFARI}}).prototype,"processExternalMediaAEC",[p0],Object.getOwnPropertyDescriptor(Hu.prototype,"processExternalMediaAEC"),Hu.prototype),Hu);function f0(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function m0(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?f0(Object(n),!0).forEach(function(r){_(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f0(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const KE=window||document;function E0(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!KE)return;const n=Kt._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=o=>{if(!(o&&o.blockedURI&&(Kt.onSecurityPolicyViolation||Kt.getListeners(Ii.SECURITY_POLICY_VIOLATION).length>0)))return;const a=o.blockedURI;L("CSP_DETECTED_HOSTNAME_LIST").some(c=>a.includes(c))&&(Kt.onSecurityPolicyViolation&&typeof Kt.onSecurityPolicyViolation=="function"&&Kt.onSecurityPolicyViolation(o),Kt.getListeners(Ii.SECURITY_POLICY_VIOLATION).length>0&&Kt.safeEmit(Ii.SECURITY_POLICY_VIOLATION,o))};n&&KE.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||Kt.getListeners(Ii.SECURITY_POLICY_VIOLATION).length>0)&&KE.addEventListener("securitypolicyviolation",r),Kt._cspEventHandlerPointer=r}nt("PROCESS_ID","process-".concat(dt(8,""),"-").concat(dt(4,""),"-").concat(dt(4,""),"-").concat(dt(4,""),"-").concat(dt(12,""))),function(){const e=He();Cn.getDisplayMedia=function(t){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),Cn.getStreamFromExtension=e.name===Xe.CHROME&&Number(e.version)>34,Cn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),Cn.supportMinBitrate=e.name===Xe.CHROME||e.name===Xe.EDGE,Cn.supportSetRtpSenderParameters=function(){const t=He();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!Ns()||!(!Dn()&&!Jl())||t.name===Xe.FIREFOX&&Number(t.version)>=64}(),e.name===Xe.SAFARI&&(Number(e.version)>=14?Cn.supportDualStream=!0:Cn.supportDualStream=!1),Cn.webAudioMediaStreamDest=function(){const t=He();return!(t.name===Xe.SAFARI&&Number(t.version)<12)}(),Cn.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),Cn.supportWebGL=typeof WebGLRenderingContext<"u",Cn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Ns()||(Cn.webAudioWithAEC=!0),Cn.supportShareAudio=function(){const t=He();return(t.os===pn.WIN_10||t.os===pn.WIN_81||t.os===pn.WIN_7||t.os===pn.LINUX||t.os===pn.MAC_OS)&&t.name===Xe.CHROME&&Number(t.version)>=74}(),Cn.supportDualStreamEncoding=function(){const t=He();return L("DISABLE_WEBAUDIO")?!0:t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&L("CHROME_DUAL_STREAM_USE_ENCODING"))}(),Cn.supportDataChannel=function(){return!!(zf(76)||function(t){const n=He();return!(n.name!==Xe.FIREFOX||!n.osVersion)&&Number(n.version)>=t}(68)||function(t){const n=He();return!(n.name!==Xe.SAFARI||!n.osVersion)&&Number(n.version)>=t}(14))}(),Cn.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!gt()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Cn.supportWebRTCEncodedTransform=function(){const t=He();return t.name==="Chrome"&&Number(t.version)>=86}(),v.info("browser compatibility",JSON.stringify(Cn),JSON.stringify(e))}(),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void v.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();v.debug("Loading global parameters from cache",t),Object.keys(t).forEach(r=>{if(Object.prototype.hasOwnProperty.call(Yn,r)){const{value:o,expires:a}=t[r];if(a&&a<=n)return;Ps[r]=o,Yn[r]=o}})}catch(t){v.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(Ps.AREAS)&&Ps.AREAS.length>0&&tE(Ps.AREAS,!0);const Kt=function(e){const t=new Et,n=e,r={getListeners:t.getListeners.bind(t),on:(o,a)=>(function(c,l){c===Ii.SECURITY_POLICY_VIOLATION&&E0(l,!0)}(o,a),t.on.bind(t)(o,a)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return m0(m0({},n),r)}({__CLIENT_LIST__:Ls,__TRACK_LIST__:Yc,VERSION:kr,BUILD:hm,setParameter:(e,t,n)=>{v.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),nt(e,t,n)},getParameter:L,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"});const n=(await t.createOffer()).sdp;if(!n)return e;t.close(),t=null,e=function(r){const o={video:[],audio:[]};return r.match(/ VP8/i)&&o.video.push("VP8"),r.match(/ VP9/i)&&o.video.push("VP9"),r.match(/ AV1/i)&&o.video.push("AV1"),r.match(/ H264/i)&&o.video.push("H264"),r.match(/ H265/i)&&o.video.push("H265"),r.match(/ opus/i)&&o.audio.push("OPUS"),r.match(/ PCMU/i)&&o.audio.push("PCMU"),r.match(/ PCMA/i)&&o.audio.push("PCMA"),r.match(/ G722/i)&&o.audio.push("G722"),o}(n)}catch(t){throw new N(I.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=de.reportApiInvoke(null,{name:Pt.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:ft.TRACER});let t=!1;try{const a=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;t=!!(a&&c&&l)}catch(a){return v.error("check system requirement failed: ",a),!1}let n=!1;const r=He();r.name===Xe.CHROME&&Number(r.version)>=58&&(!Jx()||qx())&&(n=!0),r.name===Xe.FIREFOX&&Number(r.version)>=56&&(n=!0),r.name===Xe.OPERA&&Number(r.version)>=45&&(n=!0),r.name===Xe.SAFARI&&Number(r.version)>=11&&(n=!0),(wR()||He().name===Xe.QQ)&&(n=!0),v.debug("checkSystemRequirements, api:",t,"browser",n);const o=t&&n;return e.onSuccess(o),o},getDevices:function(e){return Rr.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Rr.getRecordingDevices(e)},getCameras:function(e){return Rr.getCamerasDevices(e)},getElectronScreenSources:sI,getPlaybackDevices:function(e){return Rr.getSpeakers(e)},createClient:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const t=de.reportApiInvoke(null,{name:Pt.CREATE_CLIENT,options:[e],tag:ft.TRACER});try{IV(e)}catch(n){throw t.onError(n),n}return e.audioCodec===void 0&&(e.audioCodec="opus"),t.onSuccess(),new VB(pd(pd({forceWaitGatewayResponse:!0},e),{},{role:e.mode==="rtc"?"host":e.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=de.reportApiInvoke(null,{tag:ft.TRACER,name:Pt.CREATE_CAM_VIDEO_TRACK,options:[Wu({},e)]}),n=Cu(e),r=dt(8,"track-cam-");let o=null;v.info("start create camera video track with config",JSON.stringify(e),"trackId",r);try{o=(await ei({video:n},r)).getVideoTracks()[0]||null}catch(c){throw t.onError(c),c}if(!o){const c=new N(I.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(c),c.throw()}e.optimizationMode&&HE(r,o,e,Ds(e.encoderConfig));const a=new bA(o,e,n,e.scalabiltyMode?au(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return t.onSuccess(a.getTrackId()),v.info("create camera video success, trackId:",r),a},createCustomVideoTrack:function(e){const t=de.reportApiInvoke(null,{tag:ft.TRACER,name:Pt.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new Ut(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?au(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,dt(8,"track-cus-"),[Wt.CUSTOM_TRACK]);return t.onSuccess(n.getTrackId()),v.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=de.reportApiInvoke(null,{tag:ft.TRACER,name:Pt.CREATE_SCREEN_VIDEO_TRACK,options:[Wu({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const r=fF(e),o=dt(8,"track-scr-v-");let a=null,c=null;const l=Ot();if(!l.supportShareAudio&&t==="enable"){const p=new N(I.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(p),p.throw()}v.info("start create screen video track with config",e,"withAudio",t,"trackId",o);try{const p=await ei({screen:r,screenAudio:t==="auto"?l.supportShareAudio:t==="enable"},o);a=p.getVideoTracks()[0]||null,c=p.getAudioTracks()[0]||null}catch(p){throw n.onError(p),p}if(!a){const p=new N(I.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(p),p.throw()}if(!c&&t==="enable"){a&&a.stop();const p=new N(I.SHARE_AUDIO_NOT_ALLOWED);return n.onError(p),p.throw()}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(HE(o,a,e,e.encoderConfig&&fm(e.encoderConfig)),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const h=new Ut(a,e.encoderConfig?fm(e.encoderConfig):{},e.scalabiltyMode?au(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[Wt.SCREEN_TRACK]);if(!c)return n.onSuccess(h.getTrackId()),v.info("create screen video track success","video:",h.getTrackId()),h;const f=new Sn(c,void 0,dt(8,"track-scr-a-"),!1,!0);return n.onSuccess([h.getTrackId(),f.getTrackId()]),v.info("create screen video track success","video:",h.getTrackId(),"audio:",f.getTrackId()),[h,f]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=de.reportApiInvoke(null,{tag:ft.TRACER,name:Pt.CREATE_MIC_AND_CAM_TRACKS,options:[e,t]}),r=Cu(t),o=JC(e),a=dt(8,"track-mic-"),c=dt(8,"track-cam-");let l=null,h=null;v.info("start create camera video track(".concat(c,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const E=await ei({audio:o,video:r},"".concat(a,"-").concat(c));l=E.getAudioTracks()[0],h=E.getVideoTracks()[0]}catch(E){throw n.onError(E),E}if(!l||!h){const E=new N(I.UNEXPECTED_ERROR,"can not find tracks in media stream");return n.onError(E),E.throw()}t.optimizationMode&&HE(c,h,t,Ds(t.encoderConfig));const f=new Eu(l,e,o,a),p=new bA(h,t,r,t.scalabiltyMode?au(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,c);return n.onSuccess([f.getTrackId(),p.getTrackId()]),v.info("create camera video track(".concat(c,") and microphone audio track(").concat(a,") success")),[f,p]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=de.reportApiInvoke(null,{tag:ft.TRACER,name:Pt.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=JC(e),r=dt(8,"track-mic-");let o=null;v.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{o=(await ei({audio:n},r)).getAudioTracks()[0]||null}catch(c){throw t.onError(c),c}if(!o){const c=new N(I.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(c),c.throw()}const a=new Eu(o,e,n,r);return t.onSuccess(a.getTrackId()),v.info("create microphone audio track success, trackId:",r),a},createCustomAudioTrack:function(e){const t=de.reportApiInvoke(null,{tag:ft.TRACER,name:Pt.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new Sn(e.mediaStreamTrack,e.encoderConfig?cu(e.encoderConfig):{},dt(8,"track-cus-"),!1,!0);return v.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(e){const t=de.reportApiInvoke(null,{tag:ft.TRACER,name:Pt.CREATE_BUFFER_AUDIO_TRACK,options:[e]});if(L("DISABLE_WEBAUDIO"))throw new N(I.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const n=dt(8,"track-buf-");v.info("start create buffer source audio track with config",JSON.stringify(e),"trackId",n);const r=e.source;if(!(e.source instanceof AudioBuffer))try{e.source=await FB(e.source,e.cacheOnlineFile)}catch(c){return t.onError(c),c.throw()}const o=new jB(e.source),a=new Kj(r,o,e.encoderConfig?cu(e.encoderConfig):{},n);return v.info("create buffer source audio track success, trackId:",n),t.onSuccess(a.getTrackId()),a},setAppType:function(e){if(v.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw v.debug("Invalid appType"),new N(I.INVALID_PARAMS,"invalid app type",e);nt("APP_TYPE",Math.floor(e))},setLogLevel:function(e){v.setLogLevel(e)},enableLogUpload:function(){L("USE_NEW_LOG")?nt("UPLOAD_LOG",!0):v.enableLogUpload()},disableLogUpload:function(){L("USE_NEW_LOG")?nt("UPLOAD_LOG",!1):v.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new GC},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=de.reportApiInvoke(null,{tag:ft.TRACER,name:Pt.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Sn||e instanceof xu)){const h=new N(I.INVALID_TRACK,"the parameter is not a audio track");return n.onError(h),h.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof Sn?e.getTrackLabel():"remote_track",o=e.getVolumeLevel();let a=o,c=o;const l=Date.now();return new se(h=>{const f=setInterval(()=>{const p=e.getVolumeLevel();a=p>a?p:a,c=p<c?p:c;const E=a-c>1e-4,T=Date.now()-l;if(E||T>t){clearInterval(f);const y=E,C={duration:T,deviceLabel:r,maxVolumeLevel:a,result:y};v.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(C))),n.onSuccess(C),h(y)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=de.reportApiInvoke(null,{tag:ft.TRACER,name:Pt.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Ut||e instanceof Uu)){const T=new N(I.INVALID_TRACK,"the parameter is not a video track");return n.onError(T),T.throw()}const r=4;t&&t<1e3&&(t=1e3);const o=e instanceof Ut?e.getTrackLabel():"remote_track",a=e.getMediaStreamTrack(!0),c=document.createElement("video");c.style.width="1px",c.style.height="1px",c.setAttribute("muted",""),c.muted=!0,c.setAttribute("playsinline",""),c.controls=!1,(Dn()||Jl())&&(c.style.opacity="0.01",c.style.position="fixed",c.style.left="0",c.style.top="0",document.body.appendChild(c)),c.srcObject=new MediaStream([a]),c.play();const l=document.createElement("canvas");l.width=160,l.height=120;let h=0,f=0;try{const T=Date.now();h=await GB(c,t,l,r),f=Date.now()-T}catch(T){throw n.onError(T),T}BB===Xe.SAFARI&&(c.pause(),c.remove()),c.srcObject=null;const p=h>r,E={duration:f,changedPicNum:h,deviceLabel:o,result:p};return v.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(E))),n.onSuccess(E),p},setArea:tE,audioElementPlayCenter:sr,processExternalMediaAEC:function(e){HB.processExternalMediaAEC(e)},registerExtensions:function(e){e.forEach(t=>{const n=t;n.__registered__=!0,n.logger.hookLog=v.extLog,n.reporter.hookApiInvoke=de.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach(r=>{n.parameters[r]=L(r)})})},ChannelMediaRelayError:xo,ChannelMediaRelayEvent:Ri,ChannelMediaRelayState:kn,RemoteStreamFallbackType:Pm,RemoteStreamType:Dm,ConnectionDisconnectedReason:Ke,AudienceLatencyLevelType:Am,AREAS:Me});return Object.defineProperties(Kt,{onAudioAutoplayFailed:{get:()=>Tr.onAudioAutoplayFailed,set:e=>{Tr.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Tr.onAutoplayFailed,set:e=>{Tr.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Kt._onSecurityPolicyViolation,set(e){Kt._onSecurityPolicyViolation=e,E0(e)}}}),Rr.on(oo.CAMERA_DEVICE_CHANGED,e=>{v.info("camera device changed",JSON.stringify(e)),Kt.onCameraChanged&&Kt.onCameraChanged(e),Kt.safeEmit(Ii.CAMERA_CHANGED,e)}),Rr.on(oo.RECORDING_DEVICE_CHANGED,e=>{v.info("microphone device changed",JSON.stringify(e)),Kt.onMicrophoneChanged&&Kt.onMicrophoneChanged(e),Kt.safeEmit(Ii.MICROPHONE_CHANGED,e)}),Rr.on(oo.PLAYOUT_DEVICE_CHANGED,e=>{v.debug("playout device changed",JSON.stringify(e)),Kt.onPlaybackDeviceChanged&&Kt.onPlaybackDeviceChanged(e),Kt.safeEmit(Ii.PLAYBACK_DEVICE_CHANGED,e)}),sr.onAutoplayFailed=()=>{v.info("detect audio element autoplay failed"),Tr.onAudioAutoplayFailed&&Tr.onAudioAutoplayFailed()},Ye.on("autoplay-failed",()=>{v.info("detect webaudio autoplay failed"),Tr.onAudioAutoplayFailed&&Tr.onAudioAutoplayFailed(),Kt.safeEmit(Ii.AUTOPLAY_FAILED)}),window&&(window.__ARTC__=Kt),Kt})})(XD);var _W=XD.exports;const $D=KB(_W),gW=({user:i})=>{const s=Cr.useRef();return Cr.useEffect(()=>{i.videoTrack.play(s.current)},[]),bt.jsx("div",{children:bt.jsx("div",{ref:s,style:{width:"250px",height:"250px"}})})},SW="5f41eed412454d93ab8e2d9b61430bc6",TW="007eJxTYHgT+kt1X5mRzcmdDBwRWWcOJu+pnHNY4r2Qg95VHj/Bm3EKDJZmhmkGaRbGlinJqSYmiSaJaUnmhoZJxgapqckphskWya4XUxoCGRnCjzWwMDJAIIjPxlCSWlhQlM/AAABwzSAl",vW="teqpro",ho=$D.createClient({mode:"rtc",codec:"vp8"}),RW=()=>{const[i,s]=Cr.useState([]),[d,u]=Cr.useState([]),m=async(R,b)=>{await ho.subscribe(R,b),b==="video"&&s(P=>[...P,R]),b==="audio"&&R.audioTrack.play()},g=R=>{s(b=>b.filter(P=>P.uid!==R.uid))};return Cr.useEffect(()=>(ho.on("user-published",m),ho.on("user-left",g),ho.join(SW,vW,TW,null).then(R=>Promise.all([$D.createMicrophoneAndCameraTracks(),R])).then(([R,b])=>{const[P,k]=R;u(R),s(H=>[...H,{uid:b,videoTrack:k,audioTrack:P}]),ho.publish(R)}),()=>{for(let R of d)R.stop(),R.close();ho.off("user-published",m),ho.off("user-left",g),ho.unpublish(tracks).then(()=>ho.leave())}),[]),bt.jsx("div",{style:{display:"flex",justifyContent:"flex-start"},children:bt.jsx("div",{style:{flex:1,display:"grid",gridTemplateColumns:"'repeat(2, 200px)'",gridGap:10},children:i.map(R=>bt.jsx(gW,{user:R},R.uid))})})};function ZD(i,s){return function(){return i.apply(s,arguments)}}const{toString:yW}=Object.prototype,{getPrototypeOf:fS}=Object,pp=(i=>s=>{const d=yW.call(s);return i[d]||(i[d]=d.slice(8,-1).toLowerCase())})(Object.create(null)),$i=i=>(i=i.toLowerCase(),s=>pp(s)===i),fp=i=>s=>typeof s===i,{isArray:bc}=Array,nl=fp("undefined");function IW(i){return i!==null&&!nl(i)&&i.constructor!==null&&!nl(i.constructor)&&ui(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const eP=$i("ArrayBuffer");function CW(i){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(i):s=i&&i.buffer&&eP(i.buffer),s}const AW=fp("string"),ui=fp("function"),tP=fp("number"),mp=i=>i!==null&&typeof i=="object",OW=i=>i===!0||i===!1,Rh=i=>{if(pp(i)!=="object")return!1;const s=fS(i);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},wW=$i("Date"),NW=$i("File"),bW=$i("Blob"),DW=$i("FileList"),PW=i=>mp(i)&&ui(i.pipe),LW=i=>{let s;return i&&(typeof FormData=="function"&&i instanceof FormData||ui(i.append)&&((s=pp(i))==="formdata"||s==="object"&&ui(i.toString)&&i.toString()==="[object FormData]"))},kW=$i("URLSearchParams"),MW=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function cl(i,s,{allOwnKeys:d=!1}={}){if(i===null||typeof i>"u")return;let u,m;if(typeof i!="object"&&(i=[i]),bc(i))for(u=0,m=i.length;u<m;u++)s.call(null,i[u],u,i);else{const g=d?Object.getOwnPropertyNames(i):Object.keys(i),R=g.length;let b;for(u=0;u<R;u++)b=g[u],s.call(null,i[b],b,i)}}function nP(i,s){s=s.toLowerCase();const d=Object.keys(i);let u=d.length,m;for(;u-- >0;)if(m=d[u],s===m.toLowerCase())return m;return null}const rP=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),iP=i=>!nl(i)&&i!==rP;function Eg(){const{caseless:i}=iP(this)&&this||{},s={},d=(u,m)=>{const g=i&&nP(s,m)||m;Rh(s[g])&&Rh(u)?s[g]=Eg(s[g],u):Rh(u)?s[g]=Eg({},u):bc(u)?s[g]=u.slice():s[g]=u};for(let u=0,m=arguments.length;u<m;u++)arguments[u]&&cl(arguments[u],d);return s}const UW=(i,s,d,{allOwnKeys:u}={})=>(cl(s,(m,g)=>{d&&ui(m)?i[g]=ZD(m,d):i[g]=m},{allOwnKeys:u}),i),xW=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),VW=(i,s,d,u)=>{i.prototype=Object.create(s.prototype,u),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:s.prototype}),d&&Object.assign(i.prototype,d)},jW=(i,s,d,u)=>{let m,g,R;const b={};if(s=s||{},i==null)return s;do{for(m=Object.getOwnPropertyNames(i),g=m.length;g-- >0;)R=m[g],(!u||u(R,i,s))&&!b[R]&&(s[R]=i[R],b[R]=!0);i=d!==!1&&fS(i)}while(i&&(!d||d(i,s))&&i!==Object.prototype);return s},FW=(i,s,d)=>{i=String(i),(d===void 0||d>i.length)&&(d=i.length),d-=s.length;const u=i.indexOf(s,d);return u!==-1&&u===d},BW=i=>{if(!i)return null;if(bc(i))return i;let s=i.length;if(!tP(s))return null;const d=new Array(s);for(;s-- >0;)d[s]=i[s];return d},GW=(i=>s=>i&&s instanceof i)(typeof Uint8Array<"u"&&fS(Uint8Array)),WW=(i,s)=>{const u=(i&&i[Symbol.iterator]).call(i);let m;for(;(m=u.next())&&!m.done;){const g=m.value;s.call(i,g[0],g[1])}},HW=(i,s)=>{let d;const u=[];for(;(d=i.exec(s))!==null;)u.push(d);return u},KW=$i("HTMLFormElement"),YW=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(d,u,m){return u.toUpperCase()+m}),ON=(({hasOwnProperty:i})=>(s,d)=>i.call(s,d))(Object.prototype),zW=$i("RegExp"),oP=(i,s)=>{const d=Object.getOwnPropertyDescriptors(i),u={};cl(d,(m,g)=>{s(m,g,i)!==!1&&(u[g]=m)}),Object.defineProperties(i,u)},qW=i=>{oP(i,(s,d)=>{if(ui(i)&&["arguments","caller","callee"].indexOf(d)!==-1)return!1;const u=i[d];if(ui(u)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+d+"'")})}})},JW=(i,s)=>{const d={},u=m=>{m.forEach(g=>{d[g]=!0})};return bc(i)?u(i):u(String(i).split(s)),d},XW=()=>{},QW=(i,s)=>(i=+i,Number.isFinite(i)?i:s),S_="abcdefghijklmnopqrstuvwxyz",wN="0123456789",sP={DIGIT:wN,ALPHA:S_,ALPHA_DIGIT:S_+S_.toUpperCase()+wN},$W=(i=16,s=sP.ALPHA_DIGIT)=>{let d="";const{length:u}=s;for(;i--;)d+=s[Math.random()*u|0];return d};function ZW(i){return!!(i&&ui(i.append)&&i[Symbol.toStringTag]==="FormData"&&i[Symbol.iterator])}const e4=i=>{const s=new Array(10),d=(u,m)=>{if(mp(u)){if(s.indexOf(u)>=0)return;if(!("toJSON"in u)){s[m]=u;const g=bc(u)?[]:{};return cl(u,(R,b)=>{const P=d(R,m+1);!nl(P)&&(g[b]=P)}),s[m]=void 0,g}}return u};return d(i,0)},t4=$i("AsyncFunction"),n4=i=>i&&(mp(i)||ui(i))&&ui(i.then)&&ui(i.catch),te={isArray:bc,isArrayBuffer:eP,isBuffer:IW,isFormData:LW,isArrayBufferView:CW,isString:AW,isNumber:tP,isBoolean:OW,isObject:mp,isPlainObject:Rh,isUndefined:nl,isDate:wW,isFile:NW,isBlob:bW,isRegExp:zW,isFunction:ui,isStream:PW,isURLSearchParams:kW,isTypedArray:GW,isFileList:DW,forEach:cl,merge:Eg,extend:UW,trim:MW,stripBOM:xW,inherits:VW,toFlatObject:jW,kindOf:pp,kindOfTest:$i,endsWith:FW,toArray:BW,forEachEntry:WW,matchAll:HW,isHTMLForm:KW,hasOwnProperty:ON,hasOwnProp:ON,reduceDescriptors:oP,freezeMethods:qW,toObjectSet:JW,toCamelCase:YW,noop:XW,toFiniteNumber:QW,findKey:nP,global:rP,isContextDefined:iP,ALPHABET:sP,generateString:$W,isSpecCompliantForm:ZW,toJSONObject:e4,isAsyncFn:t4,isThenable:n4};function ht(i,s,d,u,m){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",s&&(this.code=s),d&&(this.config=d),u&&(this.request=u),m&&(this.response=m)}te.inherits(ht,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:te.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const aP=ht.prototype,cP={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{cP[i]={value:i}});Object.defineProperties(ht,cP);Object.defineProperty(aP,"isAxiosError",{value:!0});ht.from=(i,s,d,u,m,g)=>{const R=Object.create(aP);return te.toFlatObject(i,R,function(P){return P!==Error.prototype},b=>b!=="isAxiosError"),ht.call(R,i.message,s,d,u,m),R.cause=i,R.name=i.name,g&&Object.assign(R,g),R};const r4=null;function _g(i){return te.isPlainObject(i)||te.isArray(i)}function dP(i){return te.endsWith(i,"[]")?i.slice(0,-2):i}function NN(i,s,d){return i?i.concat(s).map(function(m,g){return m=dP(m),!d&&g?"["+m+"]":m}).join(d?".":""):s}function i4(i){return te.isArray(i)&&!i.some(_g)}const o4=te.toFlatObject(te,{},null,function(s){return/^is[A-Z]/.test(s)});function Ep(i,s,d){if(!te.isObject(i))throw new TypeError("target must be an object");s=s||new FormData,d=te.toFlatObject(d,{metaTokens:!0,dots:!1,indexes:!1},!1,function(oe,Je){return!te.isUndefined(Je[oe])});const u=d.metaTokens,m=d.visitor||H,g=d.dots,R=d.indexes,P=(d.Blob||typeof Blob<"u"&&Blob)&&te.isSpecCompliantForm(s);if(!te.isFunction(m))throw new TypeError("visitor must be a function");function k(j){if(j===null)return"";if(te.isDate(j))return j.toISOString();if(!P&&te.isBlob(j))throw new ht("Blob is not supported. Use a Buffer instead.");return te.isArrayBuffer(j)||te.isTypedArray(j)?P&&typeof Blob=="function"?new Blob([j]):Buffer.from(j):j}function H(j,oe,Je){let V=j;if(j&&!Je&&typeof j=="object"){if(te.endsWith(oe,"{}"))oe=u?oe:oe.slice(0,-2),j=JSON.stringify(j);else if(te.isArray(j)&&i4(j)||(te.isFileList(j)||te.endsWith(oe,"[]"))&&(V=te.toArray(j)))return oe=dP(oe),V.forEach(function(G,ne){!(te.isUndefined(G)||G===null)&&s.append(R===!0?NN([oe],ne,g):R===null?oe:oe+"[]",k(G))}),!1}return _g(j)?!0:(s.append(NN(Je,oe,g),k(j)),!1)}const B=[],z=Object.assign(o4,{defaultVisitor:H,convertValue:k,isVisitable:_g});function ie(j,oe){if(!te.isUndefined(j)){if(B.indexOf(j)!==-1)throw Error("Circular reference detected in "+oe.join("."));B.push(j),te.forEach(j,function(V,x){(!(te.isUndefined(V)||V===null)&&m.call(s,V,te.isString(x)?x.trim():x,oe,z))===!0&&ie(V,oe?oe.concat(x):[x])}),B.pop()}}if(!te.isObject(i))throw new TypeError("data must be an object");return ie(i),s}function bN(i){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(u){return s[u]})}function mS(i,s){this._pairs=[],i&&Ep(i,this,s)}const lP=mS.prototype;lP.append=function(s,d){this._pairs.push([s,d])};lP.toString=function(s){const d=s?function(u){return s.call(this,u,bN)}:bN;return this._pairs.map(function(m){return d(m[0])+"="+d(m[1])},"").join("&")};function s4(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function uP(i,s,d){if(!s)return i;const u=d&&d.encode||s4,m=d&&d.serialize;let g;if(m?g=m(s,d):g=te.isURLSearchParams(s)?s.toString():new mS(s,d).toString(u),g){const R=i.indexOf("#");R!==-1&&(i=i.slice(0,R)),i+=(i.indexOf("?")===-1?"?":"&")+g}return i}class a4{constructor(){this.handlers=[]}use(s,d,u){return this.handlers.push({fulfilled:s,rejected:d,synchronous:u?u.synchronous:!1,runWhen:u?u.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){te.forEach(this.handlers,function(u){u!==null&&s(u)})}}const DN=a4,hP={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},c4=typeof URLSearchParams<"u"?URLSearchParams:mS,d4=typeof FormData<"u"?FormData:null,l4=typeof Blob<"u"?Blob:null,u4=(()=>{let i;return typeof navigator<"u"&&((i=navigator.product)==="ReactNative"||i==="NativeScript"||i==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),h4=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Ji={isBrowser:!0,classes:{URLSearchParams:c4,FormData:d4,Blob:l4},isStandardBrowserEnv:u4,isStandardBrowserWebWorkerEnv:h4,protocols:["http","https","file","blob","url","data"]};function p4(i,s){return Ep(i,new Ji.classes.URLSearchParams,Object.assign({visitor:function(d,u,m,g){return Ji.isNode&&te.isBuffer(d)?(this.append(u,d.toString("base64")),!1):g.defaultVisitor.apply(this,arguments)}},s))}function f4(i){return te.matchAll(/\w+|\[(\w*)]/g,i).map(s=>s[0]==="[]"?"":s[1]||s[0])}function m4(i){const s={},d=Object.keys(i);let u;const m=d.length;let g;for(u=0;u<m;u++)g=d[u],s[g]=i[g];return s}function pP(i){function s(d,u,m,g){let R=d[g++];const b=Number.isFinite(+R),P=g>=d.length;return R=!R&&te.isArray(m)?m.length:R,P?(te.hasOwnProp(m,R)?m[R]=[m[R],u]:m[R]=u,!b):((!m[R]||!te.isObject(m[R]))&&(m[R]=[]),s(d,u,m[R],g)&&te.isArray(m[R])&&(m[R]=m4(m[R])),!b)}if(te.isFormData(i)&&te.isFunction(i.entries)){const d={};return te.forEachEntry(i,(u,m)=>{s(f4(u),m,d,0)}),d}return null}const E4={"Content-Type":void 0};function _4(i,s,d){if(te.isString(i))try{return(s||JSON.parse)(i),te.trim(i)}catch(u){if(u.name!=="SyntaxError")throw u}return(d||JSON.stringify)(i)}const _p={transitional:hP,adapter:["xhr","http"],transformRequest:[function(s,d){const u=d.getContentType()||"",m=u.indexOf("application/json")>-1,g=te.isObject(s);if(g&&te.isHTMLForm(s)&&(s=new FormData(s)),te.isFormData(s))return m&&m?JSON.stringify(pP(s)):s;if(te.isArrayBuffer(s)||te.isBuffer(s)||te.isStream(s)||te.isFile(s)||te.isBlob(s))return s;if(te.isArrayBufferView(s))return s.buffer;if(te.isURLSearchParams(s))return d.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let b;if(g){if(u.indexOf("application/x-www-form-urlencoded")>-1)return p4(s,this.formSerializer).toString();if((b=te.isFileList(s))||u.indexOf("multipart/form-data")>-1){const P=this.env&&this.env.FormData;return Ep(b?{"files[]":s}:s,P&&new P,this.formSerializer)}}return g||m?(d.setContentType("application/json",!1),_4(s)):s}],transformResponse:[function(s){const d=this.transitional||_p.transitional,u=d&&d.forcedJSONParsing,m=this.responseType==="json";if(s&&te.isString(s)&&(u&&!this.responseType||m)){const R=!(d&&d.silentJSONParsing)&&m;try{return JSON.parse(s)}catch(b){if(R)throw b.name==="SyntaxError"?ht.from(b,ht.ERR_BAD_RESPONSE,this,null,this.response):b}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ji.classes.FormData,Blob:Ji.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};te.forEach(["delete","get","head"],function(s){_p.headers[s]={}});te.forEach(["post","put","patch"],function(s){_p.headers[s]=te.merge(E4)});const ES=_p,g4=te.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),S4=i=>{const s={};let d,u,m;return i&&i.split(`
`).forEach(function(R){m=R.indexOf(":"),d=R.substring(0,m).trim().toLowerCase(),u=R.substring(m+1).trim(),!(!d||s[d]&&g4[d])&&(d==="set-cookie"?s[d]?s[d].push(u):s[d]=[u]:s[d]=s[d]?s[d]+", "+u:u)}),s},PN=Symbol("internals");function yd(i){return i&&String(i).trim().toLowerCase()}function yh(i){return i===!1||i==null?i:te.isArray(i)?i.map(yh):String(i)}function T4(i){const s=Object.create(null),d=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let u;for(;u=d.exec(i);)s[u[1]]=u[2];return s}const v4=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function T_(i,s,d,u,m){if(te.isFunction(u))return u.call(this,s,d);if(m&&(s=d),!!te.isString(s)){if(te.isString(u))return s.indexOf(u)!==-1;if(te.isRegExp(u))return u.test(s)}}function R4(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,d,u)=>d.toUpperCase()+u)}function y4(i,s){const d=te.toCamelCase(" "+s);["get","set","has"].forEach(u=>{Object.defineProperty(i,u+d,{value:function(m,g,R){return this[u].call(this,s,m,g,R)},configurable:!0})})}class gp{constructor(s){s&&this.set(s)}set(s,d,u){const m=this;function g(b,P,k){const H=yd(P);if(!H)throw new Error("header name must be a non-empty string");const B=te.findKey(m,H);(!B||m[B]===void 0||k===!0||k===void 0&&m[B]!==!1)&&(m[B||P]=yh(b))}const R=(b,P)=>te.forEach(b,(k,H)=>g(k,H,P));return te.isPlainObject(s)||s instanceof this.constructor?R(s,d):te.isString(s)&&(s=s.trim())&&!v4(s)?R(S4(s),d):s!=null&&g(d,s,u),this}get(s,d){if(s=yd(s),s){const u=te.findKey(this,s);if(u){const m=this[u];if(!d)return m;if(d===!0)return T4(m);if(te.isFunction(d))return d.call(this,m,u);if(te.isRegExp(d))return d.exec(m);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,d){if(s=yd(s),s){const u=te.findKey(this,s);return!!(u&&this[u]!==void 0&&(!d||T_(this,this[u],u,d)))}return!1}delete(s,d){const u=this;let m=!1;function g(R){if(R=yd(R),R){const b=te.findKey(u,R);b&&(!d||T_(u,u[b],b,d))&&(delete u[b],m=!0)}}return te.isArray(s)?s.forEach(g):g(s),m}clear(s){const d=Object.keys(this);let u=d.length,m=!1;for(;u--;){const g=d[u];(!s||T_(this,this[g],g,s,!0))&&(delete this[g],m=!0)}return m}normalize(s){const d=this,u={};return te.forEach(this,(m,g)=>{const R=te.findKey(u,g);if(R){d[R]=yh(m),delete d[g];return}const b=s?R4(g):String(g).trim();b!==g&&delete d[g],d[b]=yh(m),u[b]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const d=Object.create(null);return te.forEach(this,(u,m)=>{u!=null&&u!==!1&&(d[m]=s&&te.isArray(u)?u.join(", "):u)}),d}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,d])=>s+": "+d).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...d){const u=new this(s);return d.forEach(m=>u.set(m)),u}static accessor(s){const u=(this[PN]=this[PN]={accessors:{}}).accessors,m=this.prototype;function g(R){const b=yd(R);u[b]||(y4(m,R),u[b]=!0)}return te.isArray(s)?s.forEach(g):g(s),this}}gp.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);te.freezeMethods(gp.prototype);te.freezeMethods(gp);const go=gp;function v_(i,s){const d=this||ES,u=s||d,m=go.from(u.headers);let g=u.data;return te.forEach(i,function(b){g=b.call(d,g,m.normalize(),s?s.status:void 0)}),m.normalize(),g}function fP(i){return!!(i&&i.__CANCEL__)}function dl(i,s,d){ht.call(this,i??"canceled",ht.ERR_CANCELED,s,d),this.name="CanceledError"}te.inherits(dl,ht,{__CANCEL__:!0});function I4(i,s,d){const u=d.config.validateStatus;!d.status||!u||u(d.status)?i(d):s(new ht("Request failed with status code "+d.status,[ht.ERR_BAD_REQUEST,ht.ERR_BAD_RESPONSE][Math.floor(d.status/100)-4],d.config,d.request,d))}const C4=Ji.isStandardBrowserEnv?function(){return{write:function(d,u,m,g,R,b){const P=[];P.push(d+"="+encodeURIComponent(u)),te.isNumber(m)&&P.push("expires="+new Date(m).toGMTString()),te.isString(g)&&P.push("path="+g),te.isString(R)&&P.push("domain="+R),b===!0&&P.push("secure"),document.cookie=P.join("; ")},read:function(d){const u=document.cookie.match(new RegExp("(^|;\\s*)("+d+")=([^;]*)"));return u?decodeURIComponent(u[3]):null},remove:function(d){this.write(d,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function A4(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function O4(i,s){return s?i.replace(/\/+$/,"")+"/"+s.replace(/^\/+/,""):i}function mP(i,s){return i&&!A4(s)?O4(i,s):s}const w4=Ji.isStandardBrowserEnv?function(){const s=/(msie|trident)/i.test(navigator.userAgent),d=document.createElement("a");let u;function m(g){let R=g;return s&&(d.setAttribute("href",R),R=d.href),d.setAttribute("href",R),{href:d.href,protocol:d.protocol?d.protocol.replace(/:$/,""):"",host:d.host,search:d.search?d.search.replace(/^\?/,""):"",hash:d.hash?d.hash.replace(/^#/,""):"",hostname:d.hostname,port:d.port,pathname:d.pathname.charAt(0)==="/"?d.pathname:"/"+d.pathname}}return u=m(window.location.href),function(R){const b=te.isString(R)?m(R):R;return b.protocol===u.protocol&&b.host===u.host}}():function(){return function(){return!0}}();function N4(i){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return s&&s[1]||""}function b4(i,s){i=i||10;const d=new Array(i),u=new Array(i);let m=0,g=0,R;return s=s!==void 0?s:1e3,function(P){const k=Date.now(),H=u[g];R||(R=k),d[m]=P,u[m]=k;let B=g,z=0;for(;B!==m;)z+=d[B++],B=B%i;if(m=(m+1)%i,m===g&&(g=(g+1)%i),k-R<s)return;const ie=H&&k-H;return ie?Math.round(z*1e3/ie):void 0}}function LN(i,s){let d=0;const u=b4(50,250);return m=>{const g=m.loaded,R=m.lengthComputable?m.total:void 0,b=g-d,P=u(b),k=g<=R;d=g;const H={loaded:g,total:R,progress:R?g/R:void 0,bytes:b,rate:P||void 0,estimated:P&&R&&k?(R-g)/P:void 0,event:m};H[s?"download":"upload"]=!0,i(H)}}const D4=typeof XMLHttpRequest<"u",P4=D4&&function(i){return new Promise(function(d,u){let m=i.data;const g=go.from(i.headers).normalize(),R=i.responseType;let b;function P(){i.cancelToken&&i.cancelToken.unsubscribe(b),i.signal&&i.signal.removeEventListener("abort",b)}te.isFormData(m)&&(Ji.isStandardBrowserEnv||Ji.isStandardBrowserWebWorkerEnv?g.setContentType(!1):g.setContentType("multipart/form-data;",!1));let k=new XMLHttpRequest;if(i.auth){const ie=i.auth.username||"",j=i.auth.password?unescape(encodeURIComponent(i.auth.password)):"";g.set("Authorization","Basic "+btoa(ie+":"+j))}const H=mP(i.baseURL,i.url);k.open(i.method.toUpperCase(),uP(H,i.params,i.paramsSerializer),!0),k.timeout=i.timeout;function B(){if(!k)return;const ie=go.from("getAllResponseHeaders"in k&&k.getAllResponseHeaders()),oe={data:!R||R==="text"||R==="json"?k.responseText:k.response,status:k.status,statusText:k.statusText,headers:ie,config:i,request:k};I4(function(V){d(V),P()},function(V){u(V),P()},oe),k=null}if("onloadend"in k?k.onloadend=B:k.onreadystatechange=function(){!k||k.readyState!==4||k.status===0&&!(k.responseURL&&k.responseURL.indexOf("file:")===0)||setTimeout(B)},k.onabort=function(){k&&(u(new ht("Request aborted",ht.ECONNABORTED,i,k)),k=null)},k.onerror=function(){u(new ht("Network Error",ht.ERR_NETWORK,i,k)),k=null},k.ontimeout=function(){let j=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const oe=i.transitional||hP;i.timeoutErrorMessage&&(j=i.timeoutErrorMessage),u(new ht(j,oe.clarifyTimeoutError?ht.ETIMEDOUT:ht.ECONNABORTED,i,k)),k=null},Ji.isStandardBrowserEnv){const ie=(i.withCredentials||w4(H))&&i.xsrfCookieName&&C4.read(i.xsrfCookieName);ie&&g.set(i.xsrfHeaderName,ie)}m===void 0&&g.setContentType(null),"setRequestHeader"in k&&te.forEach(g.toJSON(),function(j,oe){k.setRequestHeader(oe,j)}),te.isUndefined(i.withCredentials)||(k.withCredentials=!!i.withCredentials),R&&R!=="json"&&(k.responseType=i.responseType),typeof i.onDownloadProgress=="function"&&k.addEventListener("progress",LN(i.onDownloadProgress,!0)),typeof i.onUploadProgress=="function"&&k.upload&&k.upload.addEventListener("progress",LN(i.onUploadProgress)),(i.cancelToken||i.signal)&&(b=ie=>{k&&(u(!ie||ie.type?new dl(null,i,k):ie),k.abort(),k=null)},i.cancelToken&&i.cancelToken.subscribe(b),i.signal&&(i.signal.aborted?b():i.signal.addEventListener("abort",b)));const z=N4(H);if(z&&Ji.protocols.indexOf(z)===-1){u(new ht("Unsupported protocol "+z+":",ht.ERR_BAD_REQUEST,i));return}k.send(m||null)})},Ih={http:r4,xhr:P4};te.forEach(Ih,(i,s)=>{if(i){try{Object.defineProperty(i,"name",{value:s})}catch{}Object.defineProperty(i,"adapterName",{value:s})}});const L4={getAdapter:i=>{i=te.isArray(i)?i:[i];const{length:s}=i;let d,u;for(let m=0;m<s&&(d=i[m],!(u=te.isString(d)?Ih[d.toLowerCase()]:d));m++);if(!u)throw u===!1?new ht(`Adapter ${d} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(te.hasOwnProp(Ih,d)?`Adapter '${d}' is not available in the build`:`Unknown adapter '${d}'`);if(!te.isFunction(u))throw new TypeError("adapter is not a function");return u},adapters:Ih};function R_(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new dl(null,i)}function kN(i){return R_(i),i.headers=go.from(i.headers),i.data=v_.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),L4.getAdapter(i.adapter||ES.adapter)(i).then(function(u){return R_(i),u.data=v_.call(i,i.transformResponse,u),u.headers=go.from(u.headers),u},function(u){return fP(u)||(R_(i),u&&u.response&&(u.response.data=v_.call(i,i.transformResponse,u.response),u.response.headers=go.from(u.response.headers))),Promise.reject(u)})}const MN=i=>i instanceof go?i.toJSON():i;function Ac(i,s){s=s||{};const d={};function u(k,H,B){return te.isPlainObject(k)&&te.isPlainObject(H)?te.merge.call({caseless:B},k,H):te.isPlainObject(H)?te.merge({},H):te.isArray(H)?H.slice():H}function m(k,H,B){if(te.isUndefined(H)){if(!te.isUndefined(k))return u(void 0,k,B)}else return u(k,H,B)}function g(k,H){if(!te.isUndefined(H))return u(void 0,H)}function R(k,H){if(te.isUndefined(H)){if(!te.isUndefined(k))return u(void 0,k)}else return u(void 0,H)}function b(k,H,B){if(B in s)return u(k,H);if(B in i)return u(void 0,k)}const P={url:g,method:g,data:g,baseURL:R,transformRequest:R,transformResponse:R,paramsSerializer:R,timeout:R,timeoutMessage:R,withCredentials:R,adapter:R,responseType:R,xsrfCookieName:R,xsrfHeaderName:R,onUploadProgress:R,onDownloadProgress:R,decompress:R,maxContentLength:R,maxBodyLength:R,beforeRedirect:R,transport:R,httpAgent:R,httpsAgent:R,cancelToken:R,socketPath:R,responseEncoding:R,validateStatus:b,headers:(k,H)=>m(MN(k),MN(H),!0)};return te.forEach(Object.keys(Object.assign({},i,s)),function(H){const B=P[H]||m,z=B(i[H],s[H],H);te.isUndefined(z)&&B!==b||(d[H]=z)}),d}const EP="1.4.0",_S={};["object","boolean","number","function","string","symbol"].forEach((i,s)=>{_S[i]=function(u){return typeof u===i||"a"+(s<1?"n ":" ")+i}});const UN={};_S.transitional=function(s,d,u){function m(g,R){return"[Axios v"+EP+"] Transitional option '"+g+"'"+R+(u?". "+u:"")}return(g,R,b)=>{if(s===!1)throw new ht(m(R," has been removed"+(d?" in "+d:"")),ht.ERR_DEPRECATED);return d&&!UN[R]&&(UN[R]=!0,console.warn(m(R," has been deprecated since v"+d+" and will be removed in the near future"))),s?s(g,R,b):!0}};function k4(i,s,d){if(typeof i!="object")throw new ht("options must be an object",ht.ERR_BAD_OPTION_VALUE);const u=Object.keys(i);let m=u.length;for(;m-- >0;){const g=u[m],R=s[g];if(R){const b=i[g],P=b===void 0||R(b,g,i);if(P!==!0)throw new ht("option "+g+" must be "+P,ht.ERR_BAD_OPTION_VALUE);continue}if(d!==!0)throw new ht("Unknown option "+g,ht.ERR_BAD_OPTION)}}const gg={assertOptions:k4,validators:_S},es=gg.validators;class Xh{constructor(s){this.defaults=s,this.interceptors={request:new DN,response:new DN}}request(s,d){typeof s=="string"?(d=d||{},d.url=s):d=s||{},d=Ac(this.defaults,d);const{transitional:u,paramsSerializer:m,headers:g}=d;u!==void 0&&gg.assertOptions(u,{silentJSONParsing:es.transitional(es.boolean),forcedJSONParsing:es.transitional(es.boolean),clarifyTimeoutError:es.transitional(es.boolean)},!1),m!=null&&(te.isFunction(m)?d.paramsSerializer={serialize:m}:gg.assertOptions(m,{encode:es.function,serialize:es.function},!0)),d.method=(d.method||this.defaults.method||"get").toLowerCase();let R;R=g&&te.merge(g.common,g[d.method]),R&&te.forEach(["delete","get","head","post","put","patch","common"],j=>{delete g[j]}),d.headers=go.concat(R,g);const b=[];let P=!0;this.interceptors.request.forEach(function(oe){typeof oe.runWhen=="function"&&oe.runWhen(d)===!1||(P=P&&oe.synchronous,b.unshift(oe.fulfilled,oe.rejected))});const k=[];this.interceptors.response.forEach(function(oe){k.push(oe.fulfilled,oe.rejected)});let H,B=0,z;if(!P){const j=[kN.bind(this),void 0];for(j.unshift.apply(j,b),j.push.apply(j,k),z=j.length,H=Promise.resolve(d);B<z;)H=H.then(j[B++],j[B++]);return H}z=b.length;let ie=d;for(B=0;B<z;){const j=b[B++],oe=b[B++];try{ie=j(ie)}catch(Je){oe.call(this,Je);break}}try{H=kN.call(this,ie)}catch(j){return Promise.reject(j)}for(B=0,z=k.length;B<z;)H=H.then(k[B++],k[B++]);return H}getUri(s){s=Ac(this.defaults,s);const d=mP(s.baseURL,s.url);return uP(d,s.params,s.paramsSerializer)}}te.forEach(["delete","get","head","options"],function(s){Xh.prototype[s]=function(d,u){return this.request(Ac(u||{},{method:s,url:d,data:(u||{}).data}))}});te.forEach(["post","put","patch"],function(s){function d(u){return function(g,R,b){return this.request(Ac(b||{},{method:s,headers:u?{"Content-Type":"multipart/form-data"}:{},url:g,data:R}))}}Xh.prototype[s]=d(),Xh.prototype[s+"Form"]=d(!0)});const Ch=Xh;class gS{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let d;this.promise=new Promise(function(g){d=g});const u=this;this.promise.then(m=>{if(!u._listeners)return;let g=u._listeners.length;for(;g-- >0;)u._listeners[g](m);u._listeners=null}),this.promise.then=m=>{let g;const R=new Promise(b=>{u.subscribe(b),g=b}).then(m);return R.cancel=function(){u.unsubscribe(g)},R},s(function(g,R,b){u.reason||(u.reason=new dl(g,R,b),d(u.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const d=this._listeners.indexOf(s);d!==-1&&this._listeners.splice(d,1)}static source(){let s;return{token:new gS(function(m){s=m}),cancel:s}}}const M4=gS;function U4(i){return function(d){return i.apply(null,d)}}function x4(i){return te.isObject(i)&&i.isAxiosError===!0}const Sg={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Sg).forEach(([i,s])=>{Sg[s]=i});const V4=Sg;function _P(i){const s=new Ch(i),d=ZD(Ch.prototype.request,s);return te.extend(d,Ch.prototype,s,{allOwnKeys:!0}),te.extend(d,s,null,{allOwnKeys:!0}),d.create=function(m){return _P(Ac(i,m))},d}const bn=_P(ES);bn.Axios=Ch;bn.CanceledError=dl;bn.CancelToken=M4;bn.isCancel=fP;bn.VERSION=EP;bn.toFormData=Ep;bn.AxiosError=ht;bn.Cancel=bn.CanceledError;bn.all=function(s){return Promise.all(s)};bn.spread=U4;bn.isAxiosError=x4;bn.mergeConfig=Ac;bn.AxiosHeaders=go;bn.formToJSON=i=>pP(te.isHTMLForm(i)?new FormData(i):i);bn.HttpStatusCode=V4;bn.default=bn;const j4=bn,F4=[{label:"C#",value:"1"},{label:"F#",value:"3"},{label:"Java",value:"4"},{label:"Python",value:"5"},{label:"C (gcc)",value:"6"},{label:"C++ (gcc)",value:"7"},{label:"Php",value:"8"},{label:"Haskell",value:"11"},{label:"Ruby",value:"12"},{label:"Perl",value:"13"},{label:"Lua",value:"14"},{label:"Nasm",value:"15"},{label:"Javascript",value:"17"},{label:"Go",value:"20"},{label:"Scala",value:"21"},{label:"D",value:"30"},{label:"Swift",value:"37"},{label:"Bash",value:"38"},{label:"Erlang",value:"40"},{label:"Elixir",value:"41"},{label:"Ocaml",value:"42"},{label:"Kotlin",value:"43"},{label:"Rust",value:"46"},{label:"Clojure",value:"47"},{label:"ATS",value:"48"},{label:"Cobol",value:"49"},{label:"Coffeescript",value:"50"},{label:"Crystal",value:"51"},{label:"Elm",value:"52"},{label:"Groovy",value:"53"},{label:"Idris",value:"54"},{label:"Julia",value:"55"},{label:"Mercury",value:"56"},{label:"Nim",value:"57"},{label:"Nix",value:"58"},{label:"Raku",value:"59"},{label:"TypeScript",value:"60"}];function B4(){const[i,s]=Cr.useState(""),[d,u]=Cr.useState(!1),[m,g]=Cr.useState(!1),[R,b]=Cr.useState(""),[P,k]=Cr.useState("5"),[H,B]=Cr.useState(""),z=async()=>{u(!0),B("");const j=new URLSearchParams;j.set("LanguageChoice",P),j.set("Program",R);const oe={method:"POST",url:"https://code-compiler.p.rapidapi.com/v2",headers:{"content-type":"application/x-www-form-urlencoded","X-RapidAPI-Key":"c40e63ca05msh21cc53be5c61ed5p1be771jsnda85c9acad28","X-RapidAPI-Host":"code-compiler.p.rapidapi.com"},data:j};try{const Je=await j4.request(oe),V=Je.data.Result,x=Je.data.Errors;x?(s(x+`
`+V),B(x)):(s(V),B(""))}catch(Je){console.error(Je),B("Error compiling code. Please check your code and try again.")}u(!1)},ie=async()=>{g(!0),g(!1)};return bt.jsxs("div",{children:[bt.jsx("h2",{className:"compiler-title",children:"Code Compiler"}),bt.jsx("label",{className:"enter-code-here-label",children:"Enter Code here:"}),bt.jsxs("div",{style:{display:"flex",gap:"10px"},children:["  ",bt.jsx("textarea",{className:"input",id:"input",name:"input",rows:20,style:{minHeight:"400px",minWidth:"300px",resize:"vertical",font:"monospace",whiteSpace:"pre-wrap",wordWrap:"break-word"},onChange:j=>b(j.target.value),value:R}),bt.jsx("textarea",{className:"output",id:"output",name:"output",readOnly:!0,value:i,style:{minHeight:"400px",minWidth:"300px",color:H?"red":"black",backgroundColor:H?"#ffebeb":"white"}})]}),bt.jsxs("div",{className:"language-selector",children:[bt.jsx("label",{children:"Choose a programming language:"}),bt.jsx("select",{value:P,onChange:j=>k(j.target.value),children:F4.map(j=>bt.jsx("option",{value:j.value,children:j.label},j.value))})]}),bt.jsx("div",{className:"language-buttons-container",children:bt.jsxs("center",{children:[bt.jsx("button",{type:"button",className:"CompileSubmitButton",onClick:z,disabled:d,children:d?"Compiling...":"Compile"}),bt.jsx("button",{type:"button",className:"CompileSubmitButton",onClick:ie,disabled:m,children:m?"Submitting...":"Submit"})]})})]})}function G4(){const[i,s]=Cr.useState(!1);return bt.jsxs("div",{className:"App",children:[bt.jsx("h1",{children:"TeqPro Virtual Call"}),i?bt.jsxs("div",{className:"container",children:[bt.jsx("div",{className:"video-container",children:bt.jsx(RW,{})}),bt.jsx("div",{className:"code-compiler-container",children:bt.jsx(B4,{})})]}):bt.jsx("button",{onClick:()=>s(!0),children:"Join Room"})]})}y_.createRoot(document.getElementById("root")).render(bt.jsx(G4,{}));
